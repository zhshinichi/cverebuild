{
    "published_date": "2024-11-13T14:19:51.342Z",
    "patch_commits": [
        {
            "url": "https://github.com/yugabyte/yugabyte-db/commit/920989b6c0db0222bb7a0cce46febc76cf72d438",
            "content": "[PLAT-14788]mask SAS token in backup config response and logs\n\nSummary:\nRedact SAS token in backup response and v1 backup logs.\nSAS token is basically a bunch of query params,\neg `sp=racwdli&st=2024-09-02T08:35:05Z&se=2024-12-31T16:35:05Z&sv=2022-11-02&sr=c&sig=****`.\n\nIn v1 backups we are logging this token without redacting the sig.\n\nTest Plan: Manually reproduced the issue by taking v1 backups on a universe. verfied the sig is redacted after my changes. Also verified that the SAS token is masked on backup config UI.\n\nReviewers: #yba-api-review!, vkumar, amalyshev\n\nReviewed By: amalyshev\n\nSubscribers: yugaware\n\nDifferential Revision: https://phorge.dev.yugabyte.com/D37715\n\nFilename: managed/src/main/java/com/yugabyte/yw/common/RedactingService.java:\n```\n@@ -32,6 +32,9 @@\npublic class RedactingService {\n           \"$..ysqlCurrentPassword\",\n           \"$..sshPrivateKeyContent\");\n \n+  public static final List<String> SECRET_QUERY_PARAMS_FOR_LOGS =\n+      ImmutableList.of(/* SAS Token */ \"sig\");\n+\n   public static final List<String> SECRET_PATHS_FOR_LOGS =\n       ImmutableList.<String>builder()\n           .addAll(SECRET_PATHS_FOR_APIS)\n\n@@ -150,6 +153,16 @@\npublic static String redactString(String input) {\n     return output;\n   }\n \n+  public static String redactQueryParams(String input) {\n+    String output = input;\n+    for (String param : SECRET_QUERY_PARAMS_FOR_LOGS) {\n+      String regex = \"([?&]\" + param + \"=)([^&]+)\";\n+      String replacement = \"$1\" + SECRET_REPLACEMENT;\n+      output = output.replaceAll(regex, replacement);\n+    }\n+    return output;\n+  }\n+\n   public enum RedactionTarget {\n     LOGS,\n     APIS;\n```\n\nFilename: managed/src/main/java/com/yugabyte/yw/common/ShellProcessHandler.java:\n```\n@@ -239,13 +239,13 @@\nprivate String getOutputLines(BufferedReader reader, boolean logOutput) {\n             .peek(\n                 line -> {\n                   if (logOutput) {\n-                    log.debug(fileMarker, line);\n+                    log.debug(fileMarker, RedactingService.redactQueryParams(line));\n                   }\n                 })\n             .collect(Collectors.joining(\"\\n\"))\n             .trim();\n     if (logOutput && cloudLoggingEnabled && lines.length() > 0) {\n-      log.debug(consoleMarker, lines);\n+      log.debug(consoleMarker, RedactingService.redactQueryParams(lines));\n     }\n     return lines;\n   }\n```\n\nFilename: managed/src/main/java/com/yugabyte/yw/models/helpers/CommonUtils.java:\n```\n@@ -84,7 +84,14 @@\npublic class CommonUtils {\n   // Sensisitve field substrings\n   private static final List<String> sensitiveFieldSubstrings =\n       Arrays.asList(\n-          \"KEY\", \"SECRET\", \"CREDENTIALS\", \"API\", \"POLICY\", \"HC_VAULT_TOKEN\", \"vaultToken\");\n+          \"KEY\",\n+          \"SECRET\",\n+          \"CREDENTIALS\",\n+          \"API\",\n+          \"POLICY\",\n+          \"HC_VAULT_TOKEN\",\n+          \"vaultToken\",\n+          \"SAS_TOKEN\");\n   // Exclude following strings from being sensitive fields\n   private static final List<String> excludedFieldNames =\n       Arrays.asList(\n```"
        }
    ],
    "sw_version": "v2.20.6.0",
    "sw_version_wget": "https://github.com/yugabyte/yugabyte-db/archive/refs/tags/v2.20.6.0.zip",
    "description": "An information disclosure vulnerability exists in the backup configuration process where the SAS token is not masked in the configuration response. This oversight results in sensitive information leakage within the yb_backup log files, exposing the SAS token in plaintext. The leakage occurs during the backup procedure, leading to potential unauthorized access to resources associated with the SAS token.\u00a0This issue affects YugabyteDB Anywhere: from 2.20.0.0 before 2.20.7.0, from 2.23.0.0 before 2.23.1.0, from 2024.1.0.0 before 2024.1.3.0.",
    "sec_adv": [],
    "cwe": [
        {
            "id": "CWE-532",
            "value": "CWE-532: Information Exposure Through Log Files"
        }
    ],
    "dir_tree": ".\n\n0 directories\n",
    "repo_path": "simple_grpc_server/"
}