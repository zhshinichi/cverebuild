# CVE-2025-1752 Detailed Report

## Summary of the CVE
CVE-2025-1752 is a Denial of Service (DoS) vulnerability identified in the `KnowledgeBaseWebReader` class of the `llama-index-readers-web` package, specifically affecting version 0.3.5. The vulnerability arises from the improper handling of the `max_depth` parameter in the `get_article_urls` function, which allows an attacker to exploit the recursive nature of the function. This can lead to excessive resource consumption, ultimately crashing the Python process due to exhaustion of the recursion limit.

### Vulnerability Type
- **CWE-400**: Uncontrolled Resource Consumption

### Affected Version
- `llama-index-readers-web==0.3.5`

## Root Cause of the Vulnerability
The root cause of the vulnerability lies in the implementation of the `get_article_urls` function. The function is designed to recursively crawl through a knowledge base to find a list of articles. However, the original implementation does not properly enforce the `max_depth` parameter, which is intended to limit the depth of recursion.

### Code Analysis
The original code snippet for the `get_article_urls` function is as follows:

```python
def get_article_urls(
    self, browser: Any, root_url: str, current_url: str, max_depth: int = 100
) -> List[str]:
    # ... (code omitted for brevity)
    for link in links:
        article_urls.extend(
            self.get_article_urls(browser, root_url, url, max_depth)
        )
    # ...
```

In this implementation:
- The `max_depth` parameter is passed to the recursive calls, but there is no mechanism to track the current depth of recursion. As a result, the function can call itself indefinitely, leading to a stack overflow when the recursion limit is reached.

### Patch Analysis
The patch introduced in commit `3c65db2947271de3bd1927dc66a044da385de4da` addresses this issue by adding a `depth` parameter to the function and implementing a check to terminate recursion when the maximum depth is reached:

```python
def get_article_urls(
    self, browser: Any, root_url: str, current_url: str, max_depth: int = 100, depth: int = 0
) -> List[str]:
    if depth >= max_depth:
        print(f"Reached max depth ({max_depth}): {current_url}")
        return []
    
    # ... (rest of the code)
    for link in links:
        article_urls.extend(
            self.get_article_urls(browser, root_url, url, max_depth, depth + 1)
        )
```

In this revised implementation:
- A new parameter `depth` is introduced to keep track of the current recursion level.
- The function checks if the current `depth` exceeds `max_depth`, and if so, it terminates the recursion and returns an empty list.

## Exploitation Details
To exploit this vulnerability, an attacker could craft a payload that repeatedly invokes the `get_article_urls` function without respecting the `max_depth` limit. The attacker would need to provide a URL structure that leads to a scenario where the function continues to recurse indefinitely.

### Steps to Exploit
1. **Setup**: The attacker sets up a server that hosts a knowledge base with a structure that allows for deep recursion (e.g., circular links or a large number of nested links).
2. **Invoke the Function**: The attacker sends a request to the application that triggers the `get_article_urls` function with a high `max_depth` value or without proper checks.
3. **Resource Exhaustion**: As the function recursively calls itself without hitting the `max_depth` limit, it consumes system resources, leading to a crash of the Python process.

### Example Payload
An example of how an attacker might invoke the vulnerable function could look like this (in pseudocode):

```python
# Pseudocode to demonstrate the exploit
browser = setup_browser()  # Setup a Playwright browser instance
root_url = "http://vulnerable-knowledge-base.com"
current_url = "http://vulnerable-knowledge-base.com/start"

# This call could lead to excessive recursion
urls = knowledge_base_reader.get_article_urls(browser, root_url, current_url, max_depth=1000)
```

In this example, if the `get_article_urls` function does not properly handle the recursion depth, it could lead to a crash.

## Conclusion
CVE-2025-1752 represents a significant risk due to its potential to cause Denial of Service through resource exhaustion. The vulnerability has been addressed in version 0.3.6 of the `llama-index-readers-web` package, which implements proper depth tracking in the recursive function. Users of the affected version are strongly advised to upgrade to the patched version to mitigate this risk.