"# CVE Report for CVE-2025-29927\n\n## Summary\nCVE-2025-29927 is a critical vulnerability identified in Next.js, a popular React framework for building full-stack web applications. The vulnerability falls under the category of **CWE-285: Improper Authorization**. It affects Next.js versions starting from **1.11.4** and prior to **12.3.5**, **13.5.9**, **14.2.25**, and **15.2.3**. The issue allows unauthorized users to bypass authorization checks if these checks are implemented in middleware.\n\n## Root Cause of the Vulnerability\nThe root cause of this vulnerability lies in the handling of the `x-middleware-subrequest` header within the Next.js middleware. When an external request containing this header is processed, the middleware does not adequately validate the origin of the request, allowing unauthorized access to protected resources.\n\nThe provided patch addresses this issue by introducing a mechanism to filter out the `x-middleware-subrequest` header unless it originates from the same session. This is achieved by adding a unique identifier (`x-middleware-subrequest-id`) to track the session and ensure that only valid requests are processed. The relevant code changes in the patch include:\n\n1. **Header Filtering**: The patch modifies the `filterInternalHeaders` function to delete the `x-middleware-subrequest` header if it does not match the expected session ID.\n2. **Session ID Generation**: A random session ID is generated and stored in a global variable, which is then used to validate incoming requests.\n\n### Code Analysis\nThe following code snippets from the patch illustrate the changes made to address the vulnerability:\n\n```javascript\n// Middleware request header filtering\nif (\n  header === 'x-middleware-subrequest' &&\n  headers['x-middleware-subrequest-id'] !==\n    (globalThis as any)[Symbol.for('@next/middleware-subrequest-id')]\n) {\n  delete headers['x-middleware-subrequest']\n}\n```\n\nThis code ensures that only requests with a valid session ID can pass through the middleware, effectively preventing unauthorized access.\n\n## Exploitation Details\nTo exploit this vulnerability, an attacker could send a crafted HTTP request to a Next.js application that relies on middleware for authorization checks. The request would include the `x-middleware-subrequest` header, allowing the attacker to bypass the authorization mechanism.\n\n### Overview of Exploit Steps\n1. **Identify Target**: The attacker identifies a Next.js application running an affected version.\n2. **Craft Request**: The attacker crafts an HTTP request with the `x-middleware-subrequest` header.\n3. **Send Request**: The attacker sends the request to the application, targeting an endpoint that requires authorization.\n4. **Bypass Authorization**: If the middleware does not properly validate the request, the attacker gains unauthorized access to the resource.\n\n## Environment Setup Requirements\n- **Port**: 3000 (default for Next.js applications)\n- **Target Endpoint**: `/redirect-to-somewhere` (as indicated in the PoC)\n- **Explicit Configuration**: None explicitly mentioned in the advisory.\n\n## Complete PoC Code\n```javascript\nit('should filter request header properly', async () => {\n  const res = await next.fetch('/redirect-to-somewhere', {\n    headers: {\n      'x-middleware-subrequest':\n        'middleware:middleware:middleware:middleware:middleware',\n    },\n    redirect: 'manual',\n  })\n\n  expect(res.status).toBe(307)\n  expect(res.headers.get('location')).toContain('/somewhere')\n})\n```\n\nThis proof-of-concept code demonstrates how an attacker could attempt to exploit the vulnerability by sending a request with the `x-middleware-subrequest` header to the specified endpoint. The expected behavior is to receive a 307 redirect response, indicating that the authorization check was bypassed.\n\n## üöÄ DEPLOYMENT STRATEGY (USE THIS - DO NOT GUESS!)\n\n**Repository URL**: https://github.com/vercel/next.js\n**Platform**: N/A\n**Language**: javascript\n**Build Tool**: npm\n\n### Build Commands:\n```bash\ngit clone https://github.com/vercel/next.js\ncd $(basename https://github.com/vercel/next.js)\nnpm install\n```\n\n### Start Commands:\n```bash\nnpm start  # Êàñ node server.js / node index.js\n```\n\n### Deployment Notes:\n‰ªé GitHub Ê∫êÁ†ÅÈÉ®ÁΩ≤„ÄÇËØ≠Ë®Ä: javascript, ÊûÑÂª∫Â∑•ÂÖ∑: npm\n\n‚ö†Ô∏è **CRITICAL INSTRUCTIONS**:\n1. DO NOT try to find Docker images or guess repository URLs\n2. USE THE REPOSITORY URL PROVIDED ABOVE\n3. Clone from the specified repository and follow build/start commands\n4. If build commands fail, analyze error and adapt (but keep using the same repo)\n"