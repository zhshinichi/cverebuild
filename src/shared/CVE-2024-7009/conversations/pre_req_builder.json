{
    "overview": "This project is the full source code of calibre (\u22647.15.0), an e-book management suite with an integrated content-server exposing a full-text search API backed by SQLite FTS. The CVE-\u2026 vulnerability lies in src/calibre/db/fts/connect.py, in the FTS.search() method, where user-controlled parameters highlight_start and highlight_end are directly interpolated into the snippet() or highlight() SQL call. This allows an attacker to break out of the SQL string context, inject arbitrary SQL (including ATTACH statements), and exfiltrate or write data on the server filesystem.\n\nTo reproduce the vulnerability, one must:\n1. Build/run the unpatched content-server locally.\n2. Create or point the server at a library with FTS enabled and at least one indexed book.\n3. Issue a crafted HTTP GET to the /fts/snippets/{book_ids} endpoint with a malicious highlight_end parameter that injects SQL.\n4. Observe that arbitrary SQL executes (e.g., data from another SQLite file is returned).",
    "files": "1. src/calibre/db/fts/connect.py  \n   - Contains the vulnerable f\u2010string interpolation of highlight_start/highlight_end into the snippet() or highlight() SQL call.\n\n2. src/calibre/srv/fts.py  \n   - Defines the HTTP endpoint /fts/snippets/{book_ids} that ultimately invokes the vulnerable FTS.search().\n\n3. src/calibre/srv/standalone.py and src/calibre/linux.py  \n   - Provide the entry point (\u201ccalibre-server\u201d) to launch the content-server.\n\n4. run-local  \n   - A helper script to run calibre commands directly from source.\n\nAdditionally:\n- pyproject.toml and setup.py  \n  - Specify Python \u22653.8 requirement.\n- No requirements.txt; dependencies must be installed system-wide (see Services).",
    "services": "No external database or Docker containers are needed. The content-server uses SQLite via APSW (the \u201cAnother Python SQLite Wrapper\u201d).  \n\nPrerequisites:\n- Python 3.8 or newer.\n- The APSW Python package installed (e.g., pip install apsw).\n- A directory to serve as a calibre library (either a new empty library or an existing one).\n\nConfiguration:\n1. Install APSW into the same Python environment used to run calibre.\n2. Index the library for full-text search:\n   \u2022 Use the calibre command-line:  \n     `calibredb add path/to/book.epub --library-path path/to/library`  \n     `calibredb search --fts-index path/to/library`  \n   \u2022 Or start the server and POST to /fts/indexing and /fts/reindex endpoints.\n3. Launch the server on a free port (default 8080):  \n   `python3 src/calibre/linux.py calibre-server --listen-on 0.0.0.0:8080 path/to/library`\n   or  \n   `./run-local calibre-server --listen-on 0.0.0.0:8080 path/to/library`\n\nNo other services (Redis, MySQL, etc.) are required.",
    "output": "A successfully built and configured server will log to stdout/access log and listen for HTTP requests. When visiting:\n  http://localhost:8080/  \nyou see the calibre content-server home page.  \n\nTo reproduce the CVE:\n- Send a GET request to  \n  `/fts/snippets/{book_id}?query=test&highlight_end=<injection>&snippet_size=32`  \n- Observe that injected SQL executes (e.g., sensitive data from another attached DB is returned in the JSON response).\n\nWhen patched, highlight_start and highlight_end are passed as SQL parameters (placeholders) and cannot break out of the snippet() context, preventing injection."
}