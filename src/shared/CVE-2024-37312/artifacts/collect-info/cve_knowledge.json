"# CVE Report: CVE-2024-37312\n\n## Summary\nCVE-2024-37312 is a vulnerability found in the \"user_oidc\" application, which serves as an OpenID Connect user backend for Nextcloud. The vulnerability is classified under CWE-284, indicating improper access control. The affected version of the software is v1.3.6. The issue arises from a lack of access control on the ID4me endpoint, which allows an attacker to register an account and potentially gain access to data that is available to all registered users.\n\n## Root Cause of the Vulnerability\nThe root cause of the vulnerability lies in the implementation of the ID4me endpoint within the \"user_oidc\" application. Specifically, the code did not enforce proper access control checks to determine whether the ID4me feature was enabled or disabled. As a result, even if the ID4me feature was disabled, the endpoint remained accessible, allowing unauthorized users to register accounts.\n\nThe provided patch addresses this issue by introducing checks to ensure that the ID4me routes are not accessible when the feature is disabled. The patch modifies the `Id4meController` class, adding checks in the `showLogin`, `login`, and `code` methods to return a 403 Forbidden response if the ID4me service is disabled. This effectively prevents unauthorized access to the ID4me functionality.\n\n### Code Analysis\nThe following code snippets from the patch illustrate the changes made to enforce access control:\n\n```php\nif (!$this->id4MeService->getID4ME()) {\n    $message = $this->l10n->t('ID4Me is disabled');\n    return $this->build403TemplateResponse($message, Http::STATUS_FORBIDDEN, [], false);\n}\n```\n\nThis check is added in multiple methods to ensure that any attempt to access ID4me functionality is blocked if the service is disabled.\n\n## Exploitation Details\nTo exploit this vulnerability, an attacker would need to send requests to the ID4me endpoint without proper access control in place. The steps to exploit the vulnerability would generally involve:\n\n1. Sending a request to the ID4me registration endpoint.\n2. If the endpoint is accessible (which it should not be if the patch is applied), the attacker can register a new account.\n3. Once registered, the attacker could potentially access data that is available to all registered users.\n\nThe advisory does not provide explicit steps for exploitation, but the above overview outlines a plausible attack vector based on the vulnerability description.\n\n## Environment Setup Requirements\n- **Port**: 8080 (assumed default for Nextcloud applications)\n- **Target Endpoint**: `/id4me/login` (based on the context of the ID4me feature)\n- **Explicit Configuration**: Ensure that the ID4me feature is disabled to reproduce the vulnerability.\n\n## Complete PoC Code\nThe advisory does not provide a specific proof-of-concept (PoC) code snippet. However, the following code from the patch is critical to understanding the vulnerability and its fix:\n\n```php\nif (!$this->id4MeService->getID4ME()) {\n    $message = $this->l10n->t('ID4Me is disabled');\n    return $this->build403TemplateResponse($message, Http::STATUS_FORBIDDEN, [], false);\n}\n```\n\nThis code is essential for enforcing access control on the ID4me routes, preventing unauthorized access when the feature is disabled. \n\nIn conclusion, CVE-2024-37312 highlights a significant security oversight in the \"user_oidc\" application, which has been addressed in the patched versions. Users are strongly advised to upgrade to the recommended versions to mitigate this vulnerability.\n\n## ğŸš€ DEPLOYMENT STRATEGY (USE THIS - DO NOT GUESS!)\n\n**Repository URL**: https://github.com/nextcloud/security-advisories\n**Platform**: N/A\n**Language**: None\n**Build Tool**: None\n\n### Build Commands:\n```bash\n\n```\n\n### Start Commands:\n```bash\n\n```\n\n### Deployment Notes:\nä» GitHub æºç éƒ¨ç½²ã€‚è¯­è¨€: æœªçŸ¥, æ„å»ºå·¥å…·: æœªçŸ¥\n\nâš ï¸ **CRITICAL INSTRUCTIONS**:\n1. DO NOT try to find Docker images or guess repository URLs\n2. USE THE REPOSITORY URL PROVIDED ABOVE\n3. Clone from the specified repository and follow build/start commands\n4. If build commands fail, analyze error and adapt (but keep using the same repo)\n"