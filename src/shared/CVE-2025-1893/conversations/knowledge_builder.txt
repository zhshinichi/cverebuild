# CVE Report for CVE-2025-1893

## Summary
CVE-2025-1893 is a vulnerability identified in Open5GS versions up to 2.7.2, specifically affecting the function `gmm_state_authentication` located in the file `src/amf/gmm-sm.c` of the Access and Mobility Management Function (AMF) component. This vulnerability is classified under CWE-404, which pertains to Denial of Service (DoS). The flaw allows a single User Equipment (UE) to crash the AMF, leading to a complete loss of mobility and session management services. Consequently, all registered UEs will lose connectivity, and new registrations will be blocked until the AMF is restarted, resulting in significant availability impacts across the network.

## Root Cause of the Vulnerability
The root cause of the vulnerability lies in the handling of unexpected Service-Based Interface (SBI) responses during the handover process between two gNodeBs (gNBs). When the AMF receives an unexpected SBI response from the Unified Data Management (UDM) while sending a `smf-select-data` request, it enters an invalid state. This situation arises because the state machine in `gmm_state_registration` encounters an unknown state, which leads to a crash of the AMF.

The provided patch addresses this issue by adding explicit handling for various SBI messages. Specifically, it checks the HTTP response status of the SBI messages. If the response status is not one of the expected values (OK, CREATED, or NO_CONTENT), a warning is logged, and the message is ignored. This change prevents the AMF from transitioning into an abnormal state, thereby improving stability during frequent handovers.

### Code Analysis
The relevant code changes in the patch are as follows:

```c
+        CASE(OGS_SBI_SERVICE_NAME_NUDM_SDM)
+            if ((sbi_message->res_status != OGS_SBI_HTTP_STATUS_OK) &&
+                (sbi_message->res_status != OGS_SBI_HTTP_STATUS_CREATED) &&
+                (sbi_message->res_status != OGS_SBI_HTTP_STATUS_NO_CONTENT)) {
+                ogs_error("[%s] HTTP response error [%d]",
+                          amf_ue->supi, sbi_message->res_status);
+            }
+
+            SWITCH(sbi_message->h.resource.component[1])
+            CASE(OGS_SBI_RESOURCE_NAME_AM_DATA)
+            CASE(OGS_SBI_RESOURCE_NAME_SMF_SELECT_DATA)
+            CASE(OGS_SBI_RESOURCE_NAME_UE_CONTEXT_IN_SMF_DATA)
+            CASE(OGS_SBI_RESOURCE_NAME_SDM_SUBSCRIPTIONS)
+                ogs_warn("[%s] Ignore SBI message", amf_ue->supi);
+                break;
+
+            DEFAULT
+                ogs_error("Invalid resource name [%s]",
+                        sbi_message->h.resource.component[1]);
+                ogs_assert_if_reached();
+            END
+            break;
```

This code snippet shows the addition of checks for the response status and resource names, which are crucial for maintaining the AMF's state integrity.

## Exploitation Details
To exploit this vulnerability, an attacker would need to send a specially crafted SBI response to the AMF during the handover process. The attacker could manipulate the response to trigger the AMF's transition into an invalid state, leading to a crash. The exploit can be executed remotely, making it a significant threat to network availability.

### Overview of Exploit Steps
1. **Identify Target AMF**: The attacker identifies the target AMF instance within the network.
2. **Initiate Handover**: The attacker initiates a handover process that involves the AMF.
3. **Send Malicious SBI Response**: The attacker sends an unexpected SBI response to the AMF during the handover, causing it to enter an invalid state.
4. **AMF Crash**: The AMF crashes, resulting in a denial of service for all registered UEs.

## Environment Setup Requirements
- **Port**: 8080 (assumed default for AMF services)
- **Target Endpoint**: `/sbi/udm/sdm`
- **Explicit Configuration**: None explicitly mentioned in the advisory.

## Complete PoC Code
The advisory does not provide a specific proof-of-concept (PoC) code. However, the relevant code changes from the patch are included above, which are necessary to understand the vulnerability and its exploitation. 

In conclusion, CVE-2025-1893 poses a significant risk to the availability of services provided by Open5GS, and it is crucial to apply the patch identified by the commit hash `e31e9965f00d9c744a7f728497cb4f3e97744ee8` to mitigate this vulnerability.