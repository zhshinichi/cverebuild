"# CVE Report for CVE-2024-35227\n\n## Summary\nCVE-2024-35227 is a high-severity vulnerability affecting the Discourse platform, specifically prior to version 3.2.3 on the `stable` branch and version 3.3.0.beta3 on the `tests-passed` branch. The vulnerability is classified under CWE-20: Improper Input Validation. The affected version of Discourse is v3.2.2. The vulnerability allows an attacker to exploit the Oneboxing feature against a carefully crafted malicious URL, potentially leading to a denial of service (DoS) condition that reduces the availability of the Discourse instance.\n\n## Root Cause of the Vulnerability\nThe root cause of the vulnerability lies in the use of `Object#send` within the Onebox engine's implementation. The `send` method allows calling any method on an object, which can be dangerous if the input is not properly validated. An attacker can craft a malicious URL that, when processed, could invoke unintended methods or access sensitive data, leading to a denial of service.\n\nThe patch addresses this issue by replacing `Object#send` with `Object#public_send`, which only allows calling public methods. This change mitigates the risk of invoking private or protected methods, thus enhancing the security of the Onebox engine.\n\n### Code Analysis\nThe relevant code before the patch:\n```ruby\ndef set_from_normalizer_data(normalizer)\n  normalizer.data.each do |k, _|\n    v = normalizer.send(k)  # Vulnerable line\n    @raw[k] ||= v unless v.nil?\n  end\nend\n```\n\nThe patched code:\n```ruby\ndef set_from_normalizer_data(normalizer)\n  normalizer.data.each do |k, _|\n    v = normalizer.public_send(k)  # Safer line\n    @raw[k] ||= v unless v.nil?\n  end\nend\n```\nBy using `public_send`, the code now restricts method calls to only those that are publicly accessible, thus reducing the attack surface.\n\n## Exploitation Details\nTo exploit this vulnerability, an attacker would need to craft a malicious URL that, when processed by the Onebox feature, triggers the vulnerable code path. The attacker could potentially manipulate the input to invoke unintended methods, leading to a denial of service.\n\n### Overview of Exploit Steps\n1. Identify a Discourse instance running an affected version (v3.2.2).\n2. Construct a malicious URL that, when oneboxed, will invoke the vulnerable method.\n3. Send the crafted URL to the Discourse instance, causing it to process the Onebox.\n4. Monitor the instance for signs of reduced availability or service disruption.\n\n## Environment Setup Requirements\n- Port: 3000 (default for Discourse)\n- Target Endpoint: `/onebox` (or any endpoint that processes Onebox requests)\n- Explicit Configuration: None explicitly mentioned in the advisory.\n\n## Complete PoC Code\nThe advisory does not provide a specific proof-of-concept code snippet. However, the following is a conceptual representation of how an exploit might be structured based on the vulnerability:\n\n```ruby\n# Example of a crafted malicious URL\nmalicious_url = \"http://example.com/malicious?param=attack\"\n\n# Sending the malicious URL to the Discourse instance\n# This would typically be done through a web request to the Discourse instance\n```\n\nThis conceptual code illustrates the idea of sending a crafted URL to exploit the vulnerability, but the exact implementation would depend on the specific context and environment of the Discourse instance.\n\n## üöÄ DEPLOYMENT STRATEGY (USE THIS - DO NOT GUESS!)\n\n**Repository URL**: https://github.com/discourse/discourse\n**Platform**: N/A\n**Language**: None\n**Build Tool**: None\n\n### Build Commands:\n```bash\n\n```\n\n### Start Commands:\n```bash\n\n```\n\n### Deployment Notes:\n‰ªé GitHub Ê∫êÁ†ÅÈÉ®ÁΩ≤„ÄÇËØ≠Ë®Ä: Êú™Áü•, ÊûÑÂª∫Â∑•ÂÖ∑: Êú™Áü•\n\n‚ö†Ô∏è **CRITICAL INSTRUCTIONS**:\n1. DO NOT try to find Docker images or guess repository URLs\n2. USE THE REPOSITORY URL PROVIDED ABOVE\n3. Clone from the specified repository and follow build/start commands\n4. If build commands fail, analyze error and adapt (but keep using the same repo)\n"