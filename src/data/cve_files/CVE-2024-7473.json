{
    "CVE-2024-7473": {
        "published_date": "2024-10-29T12:48:38.296Z",
        "patch_commits": [
            {
                "url": "https://github.com/lunary-ai/lunary/commit/88b55b01fcbab0fbbc5b8032a38d0345af98ecfa",
                "content": "ci: add ml image in release (#469)\n\nFilename: .github/workflows/update-ml.yml:\n```\n@@ -0,0 +1,42 @@\n+name: Build and push ml image\n+\n+on:\n+  release:\n+    types: [published]\n+\n+jobs:\n+  build-push:\n+    runs-on: ubuntu-latest\n+    steps:\n+      - name: Check out the private ml repo\n+        uses: actions/checkout@v4\n+        with:\n+          repository: lunary/ml\n+\n+      - name: Log in to Docker Hub\n+        uses: docker/login-action@v3\n+        with:\n+          username: ${{ secrets.DOCKERHUB_USERNAME }}\n+          password: ${{ secrets.DOCKERHUB_TOKEN }}\n+\n+      - name: Set up Docker Buildx\n+        uses: docker/setup-buildx-action@v3\n+        with:\n+          version: \"lab:latest\"\n+          driver: cloud\n+          endpoint: \"lunary/lunary\"\n+\n+      - name: Remove 'v' prefix from release tag\n+        id: release_tag\n+        run: echo \"tag=$(echo ${{ github.event.release.tag_name }} | sed 's/^v//')\" >> $GITHUB_OUTPUT\n+\n+      - name: Build and push ml\n+        uses: docker/build-push-action@v5\n+        with:\n+          push: true\n+          tags: |\n+            lunary/ml:latest\n+            lunary/ml:${{ steps.release_tag.outputs.tag }}\n+          platforms: linux/arm64,linux/amd64\n+          cache-from: type=gha\n+          cache-to: type=gha,mode=max\n```"
            }
        ],
        "sw_version": "v1.4.3-alpha.2",
        "sw_version_wget": "https://github.com/lunary-ai/lunary/archive/refs/tags/v1.4.3-alpha.2.zip",
        "description": "An IDOR vulnerability exists in the 'Evaluations' function of the 'umgws datasets' section in lunary-ai/lunary versions 1.3.2. This vulnerability allows an authenticated user to update other users' prompts by manipulating the 'id' parameter in the request. The issue is fixed in version 1.4.3.",
        "sec_adv": [
            {
                "url": "https://huntr.com/bounties/afecd927-b5f6-44ba-9147-5c45091beda5",
                "content": "Bounties\nPartners\nCommunity\nInfo\nSUBMIT REPORT\nIdor update any prompts in lunary-ai/lunary\nValid\nReported on Jul 1st 2024\nDescription\nIn the \"Evalutuions\" function in the umgws datasets section, use only \"id\", a user-controlled argument. This could lead to an IDOR vulnerability that updates other users' prompts when the user changes the id value.\ndatasets.patch(\n  \"/prompts/:id\",\n  checkAccess(\"datasets\", \"update\"),\n  async (ctx: Context) => {\n    const { id } = ctx.params\n    const { messages } = ctx.request.body as {\n      messages: string\n    }\n\n    const [prompt] =\n      await sql`update dataset_prompt set messages = ${messages} where id = ${id} returning *`\n\n    ctx.body = prompt\n  },\n)\nProof of Concept\nCreate user A and user B. Login to my 2 users\nValuations -> datasets -> prompts\nEdit prompts and intercept request in burp suite and change id from request.\nPATCH /v1/datasets/prompts/6c41d65e-c0fb-44fb-ba10-eb30e9d9cce5(CHANGE HERE)) HTTP/2\nHost: localhost:3333\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:127.0) Gecko/20100101 Firefox/127.0\nAccept: */*\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate, br\nReferer: http://localhost:8080/\nContent-Type: application/json\nAuthorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI3NTg3NTk3Ny1lMjQzLTQwOWQtYjc2NC1kMDRjNTUyN2JhNzQiLCJlbWFpbCI6ImdyYXlkZW5pQGZ0aGNhcGl0YWwuY29tIiwib3JnSWQiOiI2NjIxNWI5Yi1hZjMxLTQyNjgtOGY3Ny0zODUwNGU3MWU1MDYiLCJleHAiOjE3MjI0MTA3MTYsImlhdCI6MTcxOTgxODcxNiwibmJmIjoxNzE5ODE4NzE2fQ.rNkirRCw8CJmPyjK6TvHSFNTqq-cZ8EMPpC3Y0CTXK8\nContent-Length: 191\nOrigin: http://localhost:8080/\nConnection: close\n\n{\"messages\":[{\"role\":\"system\",\"content\":\"You are a helpful assistant.\"},{\"role\":\"user\",\"content\":\"Hello! I need help with something.ZCSDFSDFfgbdfhg\"},{\"role\":\"hacker\",\"content\":\"Paylaod\"}\n]}\nImpact\nAnother user who does not have permission to change the id value can modify other people's prompts.\nWe are processing your report and will contact thelunary-ai/lunary team within 24 hours.a year ago\nhuntr-helper\ncommenteda year ago\nAdmin\nThis report was determined to not have enough information for the maintainer or the Huntr team to triage.\nPlease add more details in all sections of the report.\nAdditionally, at least one PoC (Proof of Concept), needs to be provided. We strongly prefer the PoC to be in any of the following formats:\nSequence of cURL commands\nA script in any programming language\nA Metasploit Module\nPlease note: while videos demonstrating exploitation are a welcomed addition to the report, they should not be used as a replacement for the PoC.\nMarcello\ncommented10 months ago\nAdmin\nHow would an attacker realistically exploit this? They'd have to know the UUID of the prompt in advance to actually update the prompt no?\nhuntr-helpermodified the Severity from High (7.6) to High (7.5)10 months ago\nChiencp\ncommented10 months ago\nResearcher\nHi Marcello,\nThank you for the response,\nAlthough it may seem impossible for attacker to exploit this bug right now. There are many risks to it, for examples:\nUUID is usually private because they are used internally, not because they are sensitive or anything. So developers are not treating them as serious as password or PII, which has higher chance to leak in the future, or maybe you can find these private UUIDs right now, in some request error messages.\nWe usually treat attack as a complete outsider. But what if attacker has some kind privilege that makes it possible for him to obtain victim private UUID. For example:\nattacker is victim colleague in real life. Victim UUIDs may leak via screenshot, screen sharing or a moment of victims leaving their computer un-locked.\nattacker is admin of a group that victim attended (group admin sees more info of group members than normal users, private UUIDs may leak here)\nIn some types of SaaS websites, admin can impersonate other users in read-only mode. They can steal private UUIDs this while impersonating victim.\nAlso I have also referenced the same issue with other valid reports on huntrdev like: https://huntr.com/bounties/11248071-11b2-42d9-991a-504bf2044332\nBest regards.\nChiencp modified the report10 months ago\nChiencp modified the report10 months ago\nWe have contacted a member of thelunary-ai/lunary team and are waiting to hear back10 months ago\nWe have sent a follow up to the lunary-ai/lunary team. We will try again in 4 days.10 months ago\nWe have sent a second follow up to the lunary-ai/lunary team. We will try again in 7 days.10 months ago\nWe have sent a third follow up to the lunary-ai/lunary team. We will try again in 14 days.10 months ago\nWe have sent a fourth follow up to the lunary-ai/lunary team. We will send a final notification 48 hours before report publication.10 months ago\nThis report has now been passed to internal triage and should be resolved within 14 days.10 months ago\nThe researcher has received a minor penalty to their credibility for miscalculating the severity: -1\nHugues Chocart validated this vulnerability9 months ago\nmeme-dmhas been awarded the disclosure bounty\nThe fix bounty is now up for grabs\nThe researcher's credibility has increased: +7\nCVE-2024-7473assigned to this report.9 months ago\nHugues Chocartmarked this as fixedin 1.4.3with commit88b55b9 months ago\nHugues Chocarthas been awarded the fix bounty\nWe have notified the lunary-ai/lunary maintainers about this report in their weekly follow-up8 months ago\nWe have sent a warning to the lunary-ai/lunary team to inform them that this report will be published in 48 hours8 months ago\nThis vulnerability has now been published8 months ago\nChiencp\ncommented7 months ago\nResearcher\nCan you make your cve public?\nChiencp\ncommented7 months ago\nResearcher\nCan you make your cve public?\nSign in to join this conversation\nCVE\nCVE-2024-7473\n(Published)\nVulnerability Type\nCWE-639: Authorization Bypass Through User-Controlled Key\nSeverity\nHigh (7.5)\nAttack vector\nNetwork\nAttack complexity\nLow\nPrivileges required\nNone\nUser interaction\nNone\nScope\nUnchanged\nConfidentiality\nNone\nIntegrity\nHigh\nAvailability\nNone\nOpen in visual CVSS calculator\nRegistry\nNpm\nAffected Version\n1.3.2\nVisibility\nPublic\nStatus\nFixed\nDisclosure Bounty\n$450\nFix Bounty\n$112.5\nFound by\nFixed by\nSupported by Protect AI and leading the way to MLSecOps and greater AI security.\nÂ© 2024\nPrivacy Policy\nTerms of Service\nCode of Conduct\nCookie Preferences\nContact Us",
                "effective": true,
                "effective_reason": "The advisory includes a specific description and concrete steps to demonstrate and utilize the vulnerability through altering user input to access unauthorized data."
            }
        ],
        "cwe": [
            {
                "id": "CWE-269",
                "value": "CWE-269 Improper Privilege Management"
            }
        ]
    }
}