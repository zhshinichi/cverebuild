{
    "CVE-2024-40637": {
        "published_date": "2024-07-16T22:56:35.541Z",
        "patch_commits": [
            {
                "url": "https://github.com/dbt-labs/dbt-core/commit/3c82a0296d227cb1be295356df314c11716f4ff6",
                "content": "deprecate materialization overrides from imported packages (#9971) (#10008)\n\nFilename: .changes/unreleased/Features-20231218-195854.yaml:\n```\n@@ -0,0 +1,6 @@\n+kind: Features\n+body: Move flags from UserConfig in profiles.yml to flags in dbt_project.yml\n+time: 2023-12-18T19:58:54.075811-05:00\n+custom:\n+  Author: gshank\n+  Issue: \"9183\"\n```\n\nFilename: .changes/unreleased/Features-20240422-173703.yaml:\n```\n@@ -0,0 +1,6 @@\n+kind: Features\n+body: Add require_explicit_package_overrides_for_builtin_materializations to dbt_project.yml flags, which can be used to opt-out of overriding built-in materializations from packages\n+time: 2024-04-22T17:37:03.892268-04:00\n+custom:\n+  Author: michelleark\n+  Issue: \"10007\"\n```\n\nFilename: .changes/unreleased/Under the Hood-20240418-172528.yaml:\n```\n@@ -0,0 +1,6 @@\n+kind: Under the Hood\n+body: Raise deprecation warning if installed package overrides built-in materialization\n+time: 2024-04-18T17:25:28.37886-04:00\n+custom:\n+  Author: michelleark\n+  Issue: \"9971\"\n```\n\nFilename: core/dbt/cli/flags.py:\n```\n@@ -3,6 +3,7 @@\nfrom dataclasses import dataclass\n from importlib import import_module\n from multiprocessing import get_context\n+from pathlib import Path\n from pprint import pformat as pf\n from typing import Any, Callable, Dict, List, Optional, Set, Union\n\n@@ -11,8 +12,8 @@\nfrom dbt.cli.exceptions import DbtUsageException\n from dbt.cli.resolvers import default_log_path, default_project_dir\n from dbt.cli.types import Command as CliCommand\n-from dbt.config.profile import read_user_config\n-from dbt.contracts.project import UserConfig\n+from dbt.config.project import read_project_flags\n+from dbt.contracts.project import ProjectFlags\n from dbt.exceptions import DbtInternalError\n from dbt.deprecations import renamed_env_var\n from dbt.helper_types import WarnErrorOptions\n\n@@ -24,7 +25,8 @@\nFLAGS_DEFAULTS = {\n     \"INDIRECT_SELECTION\": \"eager\",\n     \"TARGET_PATH\": None,\n-    # Cli args without user_config or env var option.\n+    \"WARN_ERROR\": None,\n+    # Cli args without project_flags or env var option.\n     \"FULL_REFRESH\": False,\n     \"STRICT_MODE\": False,\n     \"STORE_FAILURES\": False,\n\n@@ -76,7 +78,7 @@\nclass Flags:\n     \"\"\"Primary configuration artifact for running dbt\"\"\"\n \n     def __init__(\n-        self, ctx: Optional[Context] = None, user_config: Optional[UserConfig] = None\n+        self, ctx: Optional[Context] = None, project_flags: Optional[ProjectFlags] = None\n     ) -> None:\n \n         # Set the default flags.\n\n@@ -201,27 +203,40 @@\ndef _assign_params(\n                 invoked_subcommand_ctx, params_assigned_from_default, deprecated_env_vars\n             )\n \n-        if not user_config:\n+        if not project_flags:\n+            project_dir = getattr(self, \"PROJECT_DIR\", str(default_project_dir()))\n             profiles_dir = getattr(self, \"PROFILES_DIR\", None)\n-            user_config = read_user_config(profiles_dir) if profiles_dir else None\n+            if profiles_dir and project_dir:\n+                project_flags = read_project_flags(project_dir, profiles_dir)\n+            else:\n+                project_flags = None\n \n         # Add entire invocation command to flags\n         object.__setattr__(self, \"INVOCATION_COMMAND\", \"dbt \" + \" \".join(sys.argv[1:]))\n \n-        # Overwrite default assignments with user config if available.\n-        if user_config:\n+        if project_flags:\n+            # Overwrite default assignments with project flags if available.\n             param_assigned_from_default_copy = params_assigned_from_default.copy()\n             for param_assigned_from_default in params_assigned_from_default:\n-                user_config_param_value = getattr(user_config, param_assigned_from_default, None)\n-                if user_config_param_value is not None:\n+                project_flags_param_value = getattr(\n+                    project_flags, param_assigned_from_default, None\n+                )\n+                if project_flags_param_value is not None:\n                     object.__setattr__(\n                         self,\n                         param_assigned_from_default.upper(),\n-                        convert_config(param_assigned_from_default, user_config_param_value),\n+                        convert_config(param_assigned_from_default, project_flags_param_value),\n                     )\n                     param_assigned_from_default_copy.remove(param_assigned_from_default)\n             params_assigned_from_default = param_assigned_from_default_copy\n \n+            # Add project-level flags that are not available as CLI options / env vars\n+            for (\n+                project_level_flag_name,\n+                project_level_flag_value,\n+            ) in project_flags.project_only_flags.items():\n+                object.__setattr__(self, project_level_flag_name.upper(), project_level_flag_value)\n+\n         # Set hard coded flags.\n         object.__setattr__(self, \"WHICH\", invoked_subcommand_name or ctx.info_name)\n         object.__setattr__(self, \"MP_CONTEXT\", get_context(\"spawn\"))\n\n@@ -235,9 +250,11 @@\ndef _assign_params(\n         # Starting in v1.5, if `log-path` is set in `dbt_project.yml`, it will raise a deprecation warning,\n         # with the possibility of removing it in a future release.\n         if getattr(self, \"LOG_PATH\", None) is None:\n-            project_dir = getattr(self, \"PROJECT_DIR\", default_project_dir())\n+            project_dir = getattr(self, \"PROJECT_DIR\", str(default_project_dir()))\n             version_check = getattr(self, \"VERSION_CHECK\", True)\n-            object.__setattr__(self, \"LOG_PATH\", default_log_path(project_dir, version_check))\n+            object.__setattr__(\n+                self, \"LOG_PATH\", default_log_path(Path(project_dir), version_check)\n+            )\n \n         # Support console DO NOT TRACK initiative.\n         if os.getenv(\"DO_NOT_TRACK\", \"\").lower() in (\"1\", \"t\", \"true\", \"y\", \"yes\"):\n```\n\nFilename: core/dbt/config/__init__.py:\n```\n@@ -1,4 +1,4 @@\n# all these are just exports, they need \"noqa\" so flake8 will not complain.\n-from .profile import Profile, read_user_config  # noqa\n+from .profile import Profile  # noqa\n from .project import Project, IsFQNResource, PartialProject  # noqa\n from .runtime import RuntimeConfig  # noqa\n```\n\nFilename: core/dbt/config/profile.py:\n```\n@@ -8,7 +8,7 @@\nfrom dbt.clients.system import load_file_contents\n from dbt.clients.yaml_helper import load_yaml_text\n from dbt.contracts.connection import Credentials, HasCredentials\n-from dbt.contracts.project import ProfileConfig, UserConfig\n+from dbt.contracts.project import ProfileConfig\n from dbt.exceptions import (\n     CompilationError,\n     DbtProfileError,\n\n@@ -19,7 +19,6 @@\n)\n from dbt.events.types import MissingProfileTarget\n from dbt.events.functions import fire_event\n-from dbt.utils import coerce_dict_str\n \n from .renderer import ProfileRenderer\n\n@@ -51,27 +50,13 @@\ndef read_profile(profiles_dir: str) -> Dict[str, Any]:\n     return {}\n \n \n-def read_user_config(directory: str) -> UserConfig:\n-    try:\n-        profile = read_profile(directory)\n-        if profile:\n-            user_config = coerce_dict_str(profile.get(\"config\", {}))\n-            if user_config is not None:\n-                UserConfig.validate(user_config)\n-                return UserConfig.from_dict(user_config)\n-    except (DbtRuntimeError, ValidationError):\n-        pass\n-    return UserConfig()\n-\n-\n # The Profile class is included in RuntimeConfig, so any attribute\n # additions must also be set where the RuntimeConfig class is created\n # `init=False` is a workaround for https://bugs.python.org/issue45081\n @dataclass(init=False)\n class Profile(HasCredentials):\n     profile_name: str\n     target_name: str\n-    user_config: UserConfig\n     threads: int\n     credentials: Credentials\n     profile_env_vars: Dict[str, Any]\n\n@@ -80,7 +65,6 @@\ndef __init__(\n         self,\n         profile_name: str,\n         target_name: str,\n-        user_config: UserConfig,\n         threads: int,\n         credentials: Credentials,\n     ):\n\n@@ -89,7 +73,6 @@\ndef __init__(\n         \"\"\"\n         self.profile_name = profile_name\n         self.target_name = target_name\n-        self.user_config = user_config\n         self.threads = threads\n         self.credentials = credentials\n         self.profile_env_vars = {}  # never available on init\n\n@@ -106,12 +89,10 @@\ndef to_profile_info(self, serialize_credentials: bool = False) -> Dict[str, Any]\n         result = {\n             \"profile_name\": self.profile_name,\n             \"target_name\": self.target_name,\n-            \"user_config\": self.user_config,\n             \"threads\": self.threads,\n             \"credentials\": self.credentials,\n         }\n         if serialize_credentials:\n-            result[\"user_config\"] = self.user_config.to_dict(omit_none=True)\n             result[\"credentials\"] = self.credentials.to_dict(omit_none=True)\n         return result\n\n@@ -124,7 +105,6 @@\ndef to_target_dict(self) -> Dict[str, Any]:\n                 \"name\": self.target_name,\n                 \"target_name\": self.target_name,\n                 \"profile_name\": self.profile_name,\n-                \"config\": self.user_config.to_dict(omit_none=True),\n             }\n         )\n         return target\n\n@@ -246,7 +226,6 @@\ndef from_credentials(\n         threads: int,\n         profile_name: str,\n         target_name: str,\n-        user_config: Optional[Dict[str, Any]] = None,\n     ) -> \"Profile\":\n         \"\"\"Create a profile from an existing set of Credentials and the\n         remaining information.\n\n@@ -255,20 +234,13 @@\ndef from_credentials(\n         :param threads: The number of threads to use for connections.\n         :param profile_name: The profile name used for this profile.\n         :param target_name: The target name used for this profile.\n-        :param user_config: The user-level config block from the\n-            raw profiles, if specified.\n         :raises DbtProfileError: If the profile is invalid.\n         :returns: The new Profile object.\n         \"\"\"\n-        if user_config is None:\n-            user_config = {}\n-        UserConfig.validate(user_config)\n-        user_config_obj: UserConfig = UserConfig.from_dict(user_config)\n \n         profile = cls(\n             profile_name=profile_name,\n             target_name=target_name,\n-            user_config=user_config_obj,\n             threads=threads,\n             credentials=credentials,\n         )\n\n@@ -316,7 +288,6 @@\ndef from_raw_profile_info(\n         raw_profile: Dict[str, Any],\n         profile_name: str,\n         renderer: ProfileRenderer,\n-        user_config: Optional[Dict[str, Any]] = None,\n         target_override: Optional[str] = None,\n         threads_override: Optional[int] = None,\n     ) -> \"Profile\":\n\n@@ -328,8 +299,6 @@\ndef from_raw_profile_info(\n             disk as yaml and its values rendered with jinja.\n         :param profile_name: The profile name used.\n         :param renderer: The config renderer.\n-        :param user_config: The global config for the user, if it\n-            was present.\n         :param target_override: The target to use, if provided on\n             the command line.\n         :param threads_override: The thread count to use, if\n\n@@ -338,9 +307,6 @@\ndef from_raw_profile_info(\n             target could not be found\n         :returns: The new Profile object.\n         \"\"\"\n-        # user_config is not rendered.\n-        if user_config is None:\n-            user_config = raw_profile.get(\"config\")\n         # TODO: should it be, and the values coerced to bool?\n         target_name, profile_data = cls.render_profile(\n             raw_profile, profile_name, target_override, renderer\n\n@@ -361,7 +327,6 @@\ndef from_raw_profile_info(\n             profile_name=profile_name,\n             target_name=target_name,\n             threads=threads,\n-            user_config=user_config,\n         )\n \n     @classmethod\n\n@@ -396,13 +361,11 @@\ndef from_raw_profiles(\n         if not raw_profile:\n             msg = f\"Profile {profile_name} in profiles.yml is empty\"\n             raise DbtProfileError(INVALID_PROFILE_MESSAGE.format(error_string=msg))\n-        user_config = raw_profiles.get(\"config\")\n \n         return cls.from_raw_profile_info(\n             raw_profile=raw_profile,\n             profile_name=profile_name,\n             renderer=renderer,\n-            user_config=user_config,\n             target_override=target_override,\n             threads_override=threads_override,\n         )\n```\n\nFilename: core/dbt/config/project.py:\n```\n@@ -16,7 +16,7 @@\nfrom dbt.flags import get_flags\n from dbt import deprecations\n-from dbt.constants import DEPENDENCIES_FILE_NAME, PACKAGES_FILE_NAME\n+from dbt.constants import DEPENDENCIES_FILE_NAME, PACKAGES_FILE_NAME, DBT_PROJECT_FILE_NAME\n from dbt.clients.system import path_exists, resolve_path_from_base, load_file_contents\n from dbt.clients.yaml_helper import load_yaml_text\n from dbt.contracts.connection import QueryComment\n\n@@ -31,12 +31,13 @@\nfrom dbt.helper_types import NoValue\n from dbt.semver import VersionSpecifier, versions_compatible\n from dbt.version import get_installed_version\n-from dbt.utils import MultiDict, md5\n+from dbt.utils import MultiDict, md5, coerce_dict_str\n from dbt.node_types import NodeType\n from dbt.config.selectors import SelectorDict\n from dbt.contracts.project import (\n     Project as ProjectContract,\n     SemverString,\n+    ProjectFlags,\n )\n from dbt.contracts.project import PackageConfig, ProjectPackageMetadata\n from dbt.dataclass_schema import ValidationError\n\n@@ -77,8 +78,8 @@\n\"\"\"\n \n MISSING_DBT_PROJECT_ERROR = \"\"\"\\\n-No dbt_project.yml found at expected path {path}\n-Verify that each entry within packages.yml (and their transitive dependencies) contains a file named dbt_project.yml\n+No {DBT_PROJECT_FILE_NAME} found at expected path {path}\n+Verify that each entry within packages.yml (and their transitive dependencies) contains a file named {DBT_PROJECT_FILE_NAME}\n \"\"\"\n\n@@ -183,16 +184,20 @@\ndef value_or(value: Optional[T], default: T) -> T:\n def load_raw_project(project_root: str) -> Dict[str, Any]:\n \n     project_root = os.path.normpath(project_root)\n-    project_yaml_filepath = os.path.join(project_root, \"dbt_project.yml\")\n+    project_yaml_filepath = os.path.join(project_root, DBT_PROJECT_FILE_NAME)\n \n     # get the project.yml contents\n     if not path_exists(project_yaml_filepath):\n-        raise DbtProjectError(MISSING_DBT_PROJECT_ERROR.format(path=project_yaml_filepath))\n+        raise DbtProjectError(\n+            MISSING_DBT_PROJECT_ERROR.format(\n+                path=project_yaml_filepath, DBT_PROJECT_FILE_NAME=DBT_PROJECT_FILE_NAME\n+            )\n+        )\n \n     project_dict = _load_yaml(project_yaml_filepath)\n \n     if not isinstance(project_dict, dict):\n-        raise DbtProjectError(\"dbt_project.yml does not parse to a dictionary\")\n+        raise DbtProjectError(f\"{DBT_PROJECT_FILE_NAME} does not parse to a dictionary\")\n \n     return project_dict\n\n@@ -307,21 +312,21 @@\ndef get_rendered(\n             selectors_dict=rendered_selectors,\n         )\n \n-    # Called by Project.from_project_root (not PartialProject.from_project_root!)\n+    # Called by Project.from_project_root which first calls PartialProject.from_project_root\n     def render(self, renderer: DbtProjectYamlRenderer) -> \"Project\":\n         try:\n             rendered = self.get_rendered(renderer)\n             return self.create_project(rendered)\n         except DbtProjectError as exc:\n             if exc.path is None:\n-                exc.path = os.path.join(self.project_root, \"dbt_project.yml\")\n+                exc.path = os.path.join(self.project_root, DBT_PROJECT_FILE_NAME)\n             raise\n \n     def render_package_metadata(self, renderer: PackageRenderer) -> ProjectPackageMetadata:\n         packages_data = renderer.render_data(self.packages_dict)\n         packages_config = package_config_from_data(packages_data)\n         if not self.project_name:\n-            raise DbtProjectError(\"Package dbt_project.yml must have a name!\")\n+            raise DbtProjectError(f\"Package defined in {DBT_PROJECT_FILE_NAME} must have a name!\")\n         return ProjectPackageMetadata(self.project_name, packages_config.packages)\n \n     def check_config_path(\n\n@@ -332,7 +337,7 @@\ndef check_config_path(\n                 msg = (\n                     \"{deprecated_path} and {expected_path} cannot both be defined. The \"\n                     \"`{deprecated_path}` config has been deprecated in favor of `{expected_path}`. \"\n-                    \"Please update your `dbt_project.yml` configuration to reflect this \"\n+                    f\"Please update your `{DBT_PROJECT_FILE_NAME}` configuration to reflect this \"\n                     \"change.\"\n                 )\n                 raise DbtProjectError(\n\n@@ -404,11 +409,11 @@\ndef create_project(self, rendered: RenderComponents) -> \"Project\":\n \n         docs_paths: List[str] = value_or(cfg.docs_paths, all_source_paths)\n         asset_paths: List[str] = value_or(cfg.asset_paths, [])\n-        flags = get_flags()\n+        global_flags = get_flags()\n \n-        flag_target_path = str(flags.TARGET_PATH) if flags.TARGET_PATH else None\n+        flag_target_path = str(global_flags.TARGET_PATH) if global_flags.TARGET_PATH else None\n         target_path: str = flag_or(flag_target_path, cfg.target_path, \"target\")\n-        log_path: str = str(flags.LOG_PATH)\n+        log_path: str = str(global_flags.LOG_PATH)\n \n         clean_targets: List[str] = value_or(cfg.clean_targets, [target_path])\n         packages_install_path: str = value_or(cfg.packages_install_path, \"dbt_packages\")\n\n@@ -545,6 +550,12 @@\ndef from_project_root(\n             packages_specified_path,\n         ) = package_and_project_data_from_root(project_root)\n         selectors_dict = selector_data_from_root(project_root)\n+\n+        if \"flags\" in project_dict:\n+            # We don't want to include \"flags\" in the Project,\n+            # it goes in ProjectFlags\n+            project_dict.pop(\"flags\")\n+\n         return cls.from_dicts(\n             project_root=project_root,\n             project_dict=project_dict,\n\n@@ -681,7 +692,6 @@\ndef to_project_config(self, with_packages=False):\n                 \"exposures\": self.exposures,\n                 \"vars\": self.vars.to_dict(),\n                 \"require-dbt-version\": [v.to_version_string() for v in self.dbt_version],\n-                \"config-version\": self.config_version,\n                 \"restrict-access\": self.restrict_access,\n                 \"dbt-cloud\": self.dbt_cloud,\n             }\n\n@@ -745,3 +755,52 @@\ndef get_macro_search_order(self, macro_namespace: str):\n     def project_target_path(self):\n         # If target_path is absolute, project_root will not be included\n         return os.path.join(self.project_root, self.target_path)\n+\n+\n+def read_project_flags(project_dir: str, profiles_dir: str) -> ProjectFlags:\n+    try:\n+        project_flags: Dict[str, Any] = {}\n+        # Read project_flags from dbt_project.yml first\n+        # Flags are instantiated before the project, so we don't\n+        # want to throw an error for non-existence of dbt_project.yml here\n+        # because it breaks things.\n+        project_root = os.path.normpath(project_dir)\n+        project_yaml_filepath = os.path.join(project_root, DBT_PROJECT_FILE_NAME)\n+        if path_exists(project_yaml_filepath):\n+            try:\n+                project_dict = load_raw_project(project_root)\n+                if \"flags\" in project_dict:\n+                    project_flags = project_dict.pop(\"flags\")\n+            except Exception:\n+                # This is probably a yaml load error.The error will be reported\n+                # later, when the project loads.\n+                pass\n+\n+        from dbt.config.profile import read_profile\n+\n+        profile = read_profile(profiles_dir)\n+        profile_project_flags: Optional[Dict[str, Any]] = {}\n+        if profile:\n+            profile_project_flags = coerce_dict_str(profile.get(\"config\", {}))\n+\n+        if project_flags and profile_project_flags:\n+            raise DbtProjectError(\n+                f\"Do not specify both 'config' in profiles.yml and 'flags' in {DBT_PROJECT_FILE_NAME}. \"\n+                \"Using 'config' in profiles.yml is deprecated.\"\n+            )\n+\n+        if profile_project_flags:\n+            # This can't use WARN_ERROR or WARN_ERROR_OPTIONS because they're in\n+            # the config that we're loading. Uses special \"warn\" method.\n+            deprecations.warn(\"project-flags-moved\")\n+            project_flags = profile_project_flags\n+\n+        if project_flags is not None:\n+            ProjectFlags.validate(project_flags)\n+            return ProjectFlags.from_dict(project_flags)\n+    except (DbtProjectError) as exc:\n+        # We don't want to eat the DbtProjectError for UserConfig to ProjectFlags\n+        raise exc\n+    except (DbtRuntimeError, ValidationError):\n+        pass\n+    return ProjectFlags()\n```\n\nFilename: core/dbt/config/runtime.py:\n```\n@@ -20,7 +20,7 @@\nfrom dbt.config.project import load_raw_project\n from dbt.contracts.connection import AdapterRequiredConfig, Credentials, HasCredentials\n from dbt.contracts.graph.manifest import ManifestMetadata\n-from dbt.contracts.project import Configuration, UserConfig\n+from dbt.contracts.project import Configuration\n from dbt.contracts.relation import ComponentName\n from dbt.dataclass_schema import ValidationError\n from dbt.events.functions import warn_or_error\n\n@@ -176,7 +176,6 @@\ndef from_parts(\n             profile_env_vars=profile.profile_env_vars,\n             profile_name=profile.profile_name,\n             target_name=profile.target_name,\n-            user_config=profile.user_config,\n             threads=profile.threads,\n             credentials=profile.credentials,\n             args=args,\n\n@@ -428,7 +427,6 @@\ndef _connection_keys(self):\n class UnsetProfile(Profile):\n     def __init__(self):\n         self.credentials = UnsetCredentials()\n-        self.user_config = UserConfig()  # This will be read in _get_rendered_profile\n         self.profile_name = \"\"\n         self.target_name = \"\"\n         self.threads = -1\n```\n\nFilename: core/dbt/constants.py:\n```\n@@ -9,6 +9,7 @@\n\"https://docs.getdbt.com/docs/package-management#section-specifying-package-versions\"\n )\n \n+DBT_PROJECT_FILE_NAME = \"dbt_project.yml\"\n PACKAGES_FILE_NAME = \"packages.yml\"\n DEPENDENCIES_FILE_NAME = \"dependencies.yml\"\n MANIFEST_FILE_NAME = \"manifest.json\"\n```\n\nFilename: core/dbt/contracts/connection.py:\n```\n@@ -181,17 +181,9 @@\ndef __post_serialize__(self, dct):\n         return dct\n \n \n-class UserConfigContract(Protocol):\n-    send_anonymous_usage_stats: bool\n-    use_colors: Optional[bool] = None\n-    partial_parse: Optional[bool] = None\n-    printer_width: Optional[int] = None\n-\n-\n class HasCredentials(Protocol):\n     credentials: Credentials\n     profile_name: str\n-    user_config: UserConfigContract\n     target_name: str\n     threads: int\n```\n\nFilename: core/dbt/contracts/graph/manifest.py:\n```\n@@ -23,7 +23,6 @@\n)\n from typing_extensions import Protocol\n from uuid import UUID\n-\n from dbt.contracts.graph.nodes import (\n     BaseNode,\n     Documentation,\n\n@@ -59,7 +58,7 @@\nfrom dbt.events.contextvars import get_node_info\n from dbt.node_types import NodeType, AccessType\n from dbt.flags import get_flags, MP_CONTEXT\n-from dbt import tracking\n+from dbt import tracking, deprecations\n import dbt.utils\n\n@@ -562,11 +561,29 @@\ndef __lt__(self, other: object) -> bool:\n \n \n class CandidateList(List[M]):\n-    def last(self) -> Optional[Macro]:\n+    def last_candidate(\n+        self, valid_localities: Optional[List[Locality]] = None\n+    ) -> Optional[MacroCandidate]:\n+        \"\"\"\n+        Obtain the last (highest precedence) MacroCandidate from the CandidateList of any locality in valid_localities.\n+        If valid_localities is not specified, return the last MacroCandidate of any locality.\n+        \"\"\"\n         if not self:\n             return None\n         self.sort()\n-        return self[-1].macro\n+\n+        if valid_localities is None:\n+            return self[-1]\n+\n+        for candidate in reversed(self):\n+            if candidate.locality in valid_localities:\n+                return candidate\n+\n+        return None\n+\n+    def last(self) -> Optional[Macro]:\n+        last_candidate = self.last_candidate()\n+        return last_candidate.macro if last_candidate is not None else None\n \n \n def _get_locality(macro: Macro, root_project_name: str, internal_packages: Set[str]) -> Locality:\n\n@@ -850,7 +867,33 @@\ndef find_materialization_macro_by_name(\n                 for specificity, atype in enumerate(self._get_parent_adapter_types(adapter_type))\n             )\n         )\n-        return candidates.last()\n+        core_candidates = [\n+            candidate for candidate in candidates if candidate.locality == Locality.Core\n+        ]\n+\n+        materialization_candidate = candidates.last_candidate()\n+        # If an imported materialization macro was found that also had a core candidate, fire a deprecation\n+        if (\n+            materialization_candidate is not None\n+            and materialization_candidate.locality == Locality.Imported\n+            and core_candidates\n+        ):\n+            # preserve legacy behaviour - allow materialization override\n+            if (\n+                get_flags().require_explicit_package_overrides_for_builtin_materializations\n+                is False\n+            ):\n+                deprecations.warn(\n+                    \"package-materialization-override\",\n+                    package_name=materialization_candidate.macro.package_name,\n+                    materialization_name=materialization_name,\n+                )\n+            else:\n+                materialization_candidate = candidates.last_candidate(\n+                    valid_localities=[Locality.Core, Locality.Root]\n+                )\n+\n+        return materialization_candidate.macro if materialization_candidate else None\n \n     def get_resource_fqns(self) -> Mapping[str, PathSet]:\n         resource_fqns: Dict[str, Set[Tuple[str, ...]]] = {}\n```\n\nFilename: core/dbt/contracts/project.py:\n```\n@@ -1,5 +1,5 @@\nfrom dbt.contracts.util import Replaceable, Mergeable, list_str, Identifier\n-from dbt.contracts.connection import QueryComment, UserConfigContract\n+from dbt.contracts.connection import QueryComment\n from dbt.helper_types import NoValue\n from dbt.dataclass_schema import (\n     dbtClassMixin,\n\n@@ -248,7 +248,7 @@\ndef validate(cls, data):\n \n \n @dataclass\n-class UserConfig(ExtensibleDbtClassMixin, Replaceable, UserConfigContract):\n+class ProjectFlags(ExtensibleDbtClassMixin, Replaceable):\n     cache_selected_only: Optional[bool] = None\n     debug: Optional[bool] = None\n     fail_fast: Optional[bool] = None\n\n@@ -260,6 +260,7 @@\nclass UserConfig(ExtensibleDbtClassMixin, Replaceable, UserConfigContract):\n     partial_parse: Optional[bool] = None\n     populate_cache: Optional[bool] = None\n     printer_width: Optional[int] = None\n+    require_explicit_package_overrides_for_builtin_materializations: bool = False\n     send_anonymous_usage_stats: bool = DEFAULT_SEND_ANONYMOUS_USAGE_STATS\n     static_parser: Optional[bool] = None\n     use_colors: Optional[bool] = None\n\n@@ -270,12 +271,17 @@\nclass UserConfig(ExtensibleDbtClassMixin, Replaceable, UserConfigContract):\n     warn_error_options: Optional[Dict[str, Union[str, List[str]]]] = None\n     write_json: Optional[bool] = None\n \n+    @property\n+    def project_only_flags(self) -> Dict[str, Any]:\n+        return {\n+            \"require_explicit_package_overrides_for_builtin_materializations\": self.require_explicit_package_overrides_for_builtin_materializations,\n+        }\n+\n \n @dataclass\n class ProfileConfig(HyphenatedDbtClassMixin, Replaceable):\n     profile_name: str = field(metadata={\"preserve_underscore\": True})\n     target_name: str = field(metadata={\"preserve_underscore\": True})\n-    user_config: UserConfig = field(metadata={\"preserve_underscore\": True})\n     threads: int\n     # TODO: make this a dynamic union of some kind?\n     credentials: Optional[Dict[str, Any]]\n```\n\nFilename: core/dbt/deprecations.py:\n```\n@@ -96,6 +96,25 @@\nclass CollectFreshnessReturnSignature(DBTDeprecation):\n     _event = \"CollectFreshnessReturnSignature\"\n \n \n+class ProjectFlagsMovedDeprecation(DBTDeprecation):\n+    _name = \"project-flags-moved\"\n+    _event = \"ProjectFlagsMovedDeprecation\"\n+\n+    def show(self, *args, **kwargs) -> None:\n+        if self.name not in active_deprecations:\n+            event = self.event(**kwargs)\n+            # We can't do warn_or_error because the ProjectFlags\n+            # is where that is set up and we're just reading it.\n+            dbt.events.functions.fire_event(event)\n+            self.track_deprecation_warn()\n+            active_deprecations.add(self.name)\n+\n+\n+class PackageMaterializationOverrideDeprecation(DBTDeprecation):\n+    _name = \"package-materialization-override\"\n+    _event = \"PackageMaterializationOverrideDeprecation\"\n+\n+\n def renamed_env_var(old_name: str, new_name: str):\n     class EnvironmentVariableRenamed(DBTDeprecation):\n         _name = f\"environment-variable-renamed:{old_name}\"\n\n@@ -134,6 +153,8 @@\ndef warn(name, *args, **kwargs):\n     ConfigLogPathDeprecation(),\n     ConfigTargetPathDeprecation(),\n     CollectFreshnessReturnSignature(),\n+    ProjectFlagsMovedDeprecation(),\n+    PackageMaterializationOverrideDeprecation(),\n ]\n \n deprecations: Dict[str, DBTDeprecation] = {d.name: d for d in deprecations_list}\n```\n\nFilename: core/dbt/events/types.proto:\n```\n@@ -394,6 +394,26 @@\nmessage CollectFreshnessReturnSignatureMsg {\n     CollectFreshnessReturnSignature data = 2;\n }\n \n+// D013\n+message ProjectFlagsMovedDeprecation {\n+}\n+\n+message ProjectFlagsMovedDeprecationMsg {\n+    EventInfo info = 1;\n+    ProjectFlagsMovedDeprecation data = 2;\n+}\n+\n+// D016\n+message PackageMaterializationOverrideDeprecation {\n+    string package_name = 1;\n+    string materialization_name = 2;\n+}\n+\n+message PackageMaterializationOverrideDeprecationMsg {\n+    EventInfo info = 1;\n+    PackageMaterializationOverrideDeprecation data = 2;\n+}\n+\n // E - DB Adapter\n \n // E001\n```\n\nFilename: core/dbt/events/types.py:\n```\n@@ -797,6 +797,29 @@\ndef message(self) -> str:\n         return line_wrap_message(warning_tag(msg))\n \n \n+class ProjectFlagsMovedDeprecation(WarnLevel):\n+    def code(self) -> str:\n+        return \"D013\"\n+\n+    def message(self) -> str:\n+        description = (\n+            \"User config should be moved from the 'config' key in profiles.yml to the 'flags' \"\n+            \"key in dbt_project.yml.\"\n+        )\n+        # Can't use line_wrap_message here because flags.printer_width isn't available yet\n+        return warning_tag(f\"Deprecated functionality\\n\\n{description}\")\n+\n+\n+class PackageMaterializationOverrideDeprecation(WarnLevel):\n+    def code(self) -> str:\n+        return \"D016\"\n+\n+    def message(self) -> str:\n+        description = f\"Installed package '{self.package_name}' is overriding the built-in materialization '{self.materialization_name}'. Overrides of built-in materializations from installed packages will be deprecated in future versions of dbt. Please refer to https://docs.getdbt.com/reference/global-configs/legacy-behaviors#require_explicit_package_overrides_for_builtin_materializations for detailed documentation and suggested workarounds.\"\n+\n+        return line_wrap_message(warning_tag(description))\n+\n+\n # =======================================================\n # I - Project parsing\n # =======================================================\n```\n\nFilename: core/dbt/events/types_pb2.py:\n```\n\n```\n\nFilename: core/dbt/flags.py:\n```\n@@ -39,23 +39,24 @@\ndef get_flags():\n     return GLOBAL_FLAGS\n \n \n-def set_from_args(args: Namespace, user_config):\n+def set_from_args(args: Namespace, project_flags):\n     global GLOBAL_FLAGS\n     from dbt.cli.main import cli\n     from dbt.cli.flags import Flags, convert_config\n \n-    # we set attributes of args after initialize the flags, but user_config\n+    # we set attributes of args after initialize the flags, but project_flags\n     # is being read in the Flags constructor, so we need to read it here and pass in\n-    # to make sure we use the correct user_config\n-    if (hasattr(args, \"PROFILES_DIR\") or hasattr(args, \"profiles_dir\")) and not user_config:\n-        from dbt.config.profile import read_user_config\n+    # to make sure we use the correct project_flags\n+    profiles_dir = getattr(args, \"PROFILES_DIR\", None) or getattr(args, \"profiles_dir\", None)\n+    project_dir = getattr(args, \"PROJECT_DIR\", None) or getattr(args, \"project_dir\", None)\n+    if profiles_dir and project_dir:\n+        from dbt.config.project import read_project_flags\n \n-        profiles_dir = getattr(args, \"PROFILES_DIR\", None) or getattr(args, \"profiles_dir\")\n-        user_config = read_user_config(profiles_dir)\n+        project_flags = read_project_flags(project_dir, profiles_dir)\n \n     # make a dummy context to get the flags, totally arbitrary\n     ctx = cli.make_context(\"run\", [\"run\"])\n-    flags = Flags(ctx, user_config)\n+    flags = Flags(ctx, project_flags)\n     for arg_name, args_param_value in vars(args).items():\n         args_param_value = convert_config(arg_name, args_param_value)\n         object.__setattr__(flags, arg_name.upper(), args_param_value)\n```\n\nFilename: core/dbt/include/starter_project/dbt_project.yml:\n```\n@@ -4,7 +4,6 @@\n# name or the intended use of these models\n name: '{project_name}'\n version: '1.0.0'\n-config-version: 2\n \n # This setting configures which \"profile\" dbt uses for this project.\n profile: '{profile_name}'\n```\n\nFilename: core/dbt/tests/fixtures/project.py:\n```\n@@ -142,7 +142,6 @@\ndef profiles_config_update():\n @pytest.fixture(scope=\"class\")\n def dbt_profile_data(unique_schema, dbt_profile_target, profiles_config_update):\n     profile = {\n-        \"config\": {\"send_anonymous_usage_stats\": False},\n         \"test\": {\n             \"outputs\": {\n                 \"default\": {},\n\n@@ -181,6 +180,7 @@\ndef dbt_project_yml(project_root, project_config_update):\n     project_config = {\n         \"name\": \"test\",\n         \"profile\": \"test\",\n+        \"flags\": {\"send_anonymous_usage_stats\": False},\n     }\n     if project_config_update:\n         if isinstance(project_config_update, dict):\n```\n\nFilename: core/dbt/tracking.py:\n```\n@@ -471,7 +471,6 @@\ndef process(self, record):\n \n \n def initialize_from_flags(send_anonymous_usage_stats, profiles_dir):\n-    # Setting these used to be in UserConfig, but had to be moved here\n     global active_user\n     if send_anonymous_usage_stats:\n         active_user = User(profiles_dir)\n```\n\nFilename: core/dbt/utils.py:\n```\n@@ -623,7 +623,7 @@\ndef _connection_exception_retry(fn, max_attempts: int, attempt: int = 0):\n def args_to_dict(args):\n     var_args = vars(args).copy()\n     # update the args with the flags, which could also come from environment\n-    # variables or user_config\n+    # variables or project_flags\n     flag_dict = flags.get_flag_dict()\n     var_args.update(flag_dict)\n     dict_args = {}\n```\n\nFilename: tests/functional/basic/test_mixed_case_db.py:\n```\n@@ -16,7 +16,6 @@\ndef models():\n def dbt_profile_data(unique_schema):\n \n     return {\n-        \"config\": {\"send_anonymous_usage_stats\": False},\n         \"test\": {\n             \"outputs\": {\n                 \"default\": {\n```\n\nFilename: tests/functional/basic/test_project.py:\n```\n@@ -77,11 +77,16 @@\ndef test_dbt_cloud(self, project):\n         conf = yaml.safe_load(\n             Path(os.path.join(project.project_root, \"dbt_project.yml\")).read_text()\n         )\n-        assert conf == {\"name\": \"test\", \"profile\": \"test\"}\n+        assert conf == {\n+            \"name\": \"test\",\n+            \"profile\": \"test\",\n+            \"flags\": {\"send_anonymous_usage_stats\": False},\n+        }\n \n         config = {\n             \"name\": \"test\",\n             \"profile\": \"test\",\n+            \"flags\": {\"send_anonymous_usage_stats\": False},\n             \"dbt-cloud\": {\n                 \"account_id\": \"123\",\n                 \"application\": \"test\",\n```\n\nFilename: tests/functional/configs/test_disabled_configs.py:\n```\n@@ -9,7 +9,6 @@\nclass TestDisabledConfigs(BaseConfigProject):\n     @pytest.fixture(scope=\"class\")\n     def dbt_profile_data(self, unique_schema):\n         return {\n-            \"config\": {\"send_anonymous_usage_stats\": False},\n             \"test\": {\n                 \"outputs\": {\n                     \"default\": {\n```\n\nFilename: tests/functional/dependencies/test_local_dependency.py:\n```\n@@ -253,6 +253,10 @@\nclass TestSimpleDependencyNoVersionCheckConfig(BaseDependencyTest):\n     @pytest.fixture(scope=\"class\")\n     def project_config_update(self):\n         return {\n+            \"flags\": {\n+                \"send_anonymous_usage_stats\": False,\n+                \"version_check\": False,\n+            },\n             \"models\": {\n                 \"schema\": \"dbt_test\",\n             },\n\n@@ -261,15 +265,6 @@\ndef project_config_update(self):\n             },\n         }\n \n-    @pytest.fixture(scope=\"class\")\n-    def profiles_config_update(self):\n-        return {\n-            \"config\": {\n-                \"send_anonymous_usage_stats\": False,\n-                \"version_check\": False,\n-            }\n-        }\n-\n     @pytest.fixture(scope=\"class\")\n     def macros(self):\n         return {\"macro.sql\": macros__macro_override_schema_sql}\n```\n\nFilename: tests/functional/deprecations/test_deprecations.py:\n```\n@@ -2,7 +2,8 @@\nfrom dbt import deprecations\n import dbt.exceptions\n-from dbt.tests.util import run_dbt\n+from dbt.tests.util import run_dbt, write_file\n+import yaml\n \n \n models__already_exists_sql = \"\"\"\n\n@@ -157,3 +158,31 @@\ndef test_exposure_name_fail(self, project):\n         exc_str = \" \".join(str(exc.value).split())  # flatten all whitespace\n         expected_msg = \"Starting in v1.3, the 'name' of an exposure should contain only letters, numbers, and underscores.\"\n         assert expected_msg in exc_str\n+\n+\n+class TestPrjectFlagsMovedDeprecation:\n+    @pytest.fixture(scope=\"class\")\n+    def profiles_config_update(self):\n+        return {\n+            \"config\": {\"send_anonymous_usage_stats\": False},\n+        }\n+\n+    @pytest.fixture(scope=\"class\")\n+    def dbt_project_yml(self, project_root, project_config_update):\n+        project_config = {\n+            \"name\": \"test\",\n+            \"profile\": \"test\",\n+        }\n+        write_file(yaml.safe_dump(project_config), project_root, \"dbt_project.yml\")\n+        return project_config\n+\n+    @pytest.fixture(scope=\"class\")\n+    def models(self):\n+        return {\"my_model.sql\": \"select 1 as fun\"}\n+\n+    def test_profile_config_deprecation(self, project):\n+        deprecations.reset_deprecations()\n+        assert deprecations.active_deprecations == set()\n+        run_dbt([\"parse\"])\n+        expected = {\"project-flags-moved\"}\n+        assert expected == deprecations.active_deprecations\n```\n\nFilename: tests/functional/fail_fast/test_fail_fast_run.py:\n```\n@@ -44,15 +44,15 @@\ndef test_fail_fast_run(\n \n class TestFailFastFromConfig(FailFastBase):\n     @pytest.fixture(scope=\"class\")\n-    def profiles_config_update(self):\n+    def project_config_update(self):\n         return {\n-            \"config\": {\n+            \"flags\": {\n                 \"send_anonymous_usage_stats\": False,\n                 \"fail_fast\": True,\n             }\n         }\n \n-    def test_fail_fast_run_user_config(\n+    def test_fail_fast_run_project_flags(\n         self,\n         project,\n         models,  # noqa: F811\n```\n\nFilename: tests/functional/init/test_init.py:\n```\n@@ -67,9 +67,7 @@\ndef test_init_task_in_project_with_existing_profiles_yml(\n         with open(os.path.join(project.profiles_dir, \"profiles.yml\"), \"r\") as f:\n             assert (\n                 f.read()\n-                == \"\"\"config:\n-  send_anonymous_usage_stats: false\n-test:\n+                == \"\"\"test:\n   outputs:\n     dev:\n       dbname: test_db\n\n@@ -369,9 +367,7 @@\ndef test_init_task_in_project_with_invalid_profile_template(\n         with open(os.path.join(project.profiles_dir, \"profiles.yml\"), \"r\") as f:\n             assert (\n                 f.read()\n-                == \"\"\"config:\n-  send_anonymous_usage_stats: false\n-test:\n+                == \"\"\"test:\n   outputs:\n     dev:\n       dbname: test_db\n\n@@ -408,7 +404,6 @@\nclass TestInitOutsideOfProject(TestInitOutsideOfProjectBase):\n     @pytest.fixture(scope=\"class\")\n     def dbt_profile_data(self, unique_schema):\n         return {\n-            \"config\": {\"send_anonymous_usage_stats\": False},\n             \"test\": {\n                 \"outputs\": {\n                     \"default2\": {\n\n@@ -491,9 +486,7 @@\ndef test_init_task_outside_of_project(\n         with open(os.path.join(project.profiles_dir, \"profiles.yml\"), \"r\") as f:\n             assert (\n                 f.read()\n-                == f\"\"\"config:\n-  send_anonymous_usage_stats: false\n-{project_name}:\n+                == f\"\"\"{project_name}:\n   outputs:\n     dev:\n       dbname: test_db\n\n@@ -538,7 +531,6 @@\ndef test_init_task_outside_of_project(\n # name or the intended use of these models\n name: '{project_name}'\n version: '1.0.0'\n-config-version: 2\n \n # This setting configures which \"profile\" dbt uses for this project.\n profile: '{project_name}'\n\n@@ -657,7 +649,6 @@\ndef test_init_provided_project_name_and_skip_profile_setup(\n # name or the intended use of these models\n name: '{project_name}'\n version: '1.0.0'\n-config-version: 2\n \n # This setting configures which \"profile\" dbt uses for this project.\n profile: '{project_name}'\n```\n\nFilename: tests/functional/materializations/conftest.py:\n```\n@@ -325,6 +325,21 @@\n{%- endmaterialization -%}\n \"\"\"\n \n+custom_materialization_dep__dbt_project_yml = \"\"\"\n+name: custom_materialization_default\n+macro-paths: ['macros']\n+\"\"\"\n+\n+custom_materialization_sql = \"\"\"\n+{% materialization custom_materialization, default %}\n+    {%- set target_relation = this.incorporate(type='table') %}\n+    {% call statement('main') -%}\n+        select 1 as column1\n+    {%- endcall %}\n+    {{ return({'relations': [target_relation]}) }}\n+{% endmaterialization %}\n+\"\"\"\n+\n \n @pytest.fixture(scope=\"class\")\n def override_view_adapter_pass_dep(project_root):\n\n@@ -368,3 +383,12 @@\ndef override_view_return_no_relation(project_root):\n         },\n     }\n     write_project_files(project_root, \"override-view-return-no-relation\", files)\n+\n+\n+@pytest.fixture(scope=\"class\")\n+def custom_materialization_dep(project_root):\n+    files = {\n+        \"dbt_project.yml\": custom_materialization_dep__dbt_project_yml,\n+        \"macros\": {\"custom_materialization.sql\": custom_materialization_sql},\n+    }\n+    write_project_files(project_root, \"custom-materialization-dep\", files)\n```\n\nFilename: tests/functional/materializations/test_custom_materialization.py:\n```\n@@ -1,7 +1,7 @@\nimport pytest\n \n from dbt.tests.util import run_dbt\n-\n+from dbt import deprecations\n \n models__model_sql = \"\"\"\n {{ config(materialized='view') }}\n\n@@ -10,34 +10,196 @@\n\"\"\"\n \n \n+models_custom_materialization__model_sql = \"\"\"\n+{{ config(materialized='custom_materialization') }}\n+select 1 as id\n+\n+\"\"\"\n+\n+\n @pytest.fixture(scope=\"class\")\n def models():\n     return {\"model.sql\": models__model_sql}\n \n \n+@pytest.fixture(scope=\"class\")\n+def set_up_deprecations():\n+    deprecations.reset_deprecations()\n+    assert deprecations.active_deprecations == set()\n+\n+\n class TestOverrideAdapterDependency:\n     # make sure that if there's a dependency with an adapter-specific\n     # materialization, we honor that materialization\n     @pytest.fixture(scope=\"class\")\n     def packages(self):\n         return {\"packages\": [{\"local\": \"override-view-adapter-dep\"}]}\n \n-    def test_adapter_dependency(self, project, override_view_adapter_dep):\n+    def test_adapter_dependency(self, project, override_view_adapter_dep, set_up_deprecations):\n+        run_dbt([\"deps\"])\n+        # this should error because the override is buggy\n+        run_dbt([\"run\"], expect_pass=False)\n+\n+        # overriding a built-in materialization scoped to adapter from package is deprecated\n+        assert deprecations.active_deprecations == {\"package-materialization-override\"}\n+\n+\n+class TestOverrideAdapterDependencyDeprecated:\n+    # make sure that if there's a dependency with an adapter-specific\n+    # materialization, we honor that materialization\n+    @pytest.fixture(scope=\"class\")\n+    def packages(self):\n+        return {\"packages\": [{\"local\": \"override-view-adapter-dep\"}]}\n+\n+    @pytest.fixture(scope=\"class\")\n+    def project_config_update(self):\n+        return {\n+            \"flags\": {\n+                \"require_explicit_package_overrides_for_builtin_materializations\": True,\n+            },\n+        }\n+\n+    def test_adapter_dependency_deprecate_overrides(\n+        self, project, override_view_adapter_dep, set_up_deprecations\n+    ):\n+        run_dbt([\"deps\"])\n+        # this should pass because the override is buggy and unused\n+        run_dbt([\"run\"])\n+\n+        # no deprecation warning -- flag used correctly\n+        assert deprecations.active_deprecations == set()\n+\n+\n+class TestOverrideAdapterDependencyLegacy:\n+    # make sure that if there's a dependency with an adapter-specific\n+    # materialization, we honor that materialization\n+    @pytest.fixture(scope=\"class\")\n+    def packages(self):\n+        return {\"packages\": [{\"local\": \"override-view-adapter-dep\"}]}\n+\n+    @pytest.fixture(scope=\"class\")\n+    def project_config_update(self):\n+        return {\n+            \"flags\": {\n+                \"require_explicit_package_overrides_for_builtin_materializations\": False,\n+            },\n+        }\n+\n+    def test_adapter_dependency(self, project, override_view_adapter_dep, set_up_deprecations):\n         run_dbt([\"deps\"])\n         # this should error because the override is buggy\n         run_dbt([\"run\"], expect_pass=False)\n \n+        # overriding a built-in materialization scoped to adapter from package is deprecated\n+        assert deprecations.active_deprecations == {\"package-materialization-override\"}\n+\n \n class TestOverrideDefaultDependency:\n     @pytest.fixture(scope=\"class\")\n     def packages(self):\n         return {\"packages\": [{\"local\": \"override-view-default-dep\"}]}\n \n-    def test_default_dependency(self, project, override_view_default_dep):\n+    def test_default_dependency(self, project, override_view_default_dep, set_up_deprecations):\n+        run_dbt([\"deps\"])\n+        # this should error because the override is buggy\n+        run_dbt([\"run\"], expect_pass=False)\n+\n+        # overriding a built-in materialization from package is deprecated\n+        assert deprecations.active_deprecations == {\"package-materialization-override\"}\n+\n+\n+class TestOverrideDefaultDependencyDeprecated:\n+    @pytest.fixture(scope=\"class\")\n+    def packages(self):\n+        return {\"packages\": [{\"local\": \"override-view-default-dep\"}]}\n+\n+    @pytest.fixture(scope=\"class\")\n+    def project_config_update(self):\n+        return {\n+            \"flags\": {\n+                \"require_explicit_package_overrides_for_builtin_materializations\": True,\n+            },\n+        }\n+\n+    def test_default_dependency_deprecated(\n+        self, project, override_view_default_dep, set_up_deprecations\n+    ):\n+        run_dbt([\"deps\"])\n+        # this should pass because the override is buggy and unused\n+        run_dbt([\"run\"])\n+\n+        # overriding a built-in materialization from package is deprecated\n+        assert deprecations.active_deprecations == set()\n+\n+\n+class TestOverrideDefaultDependencyLegacy:\n+    @pytest.fixture(scope=\"class\")\n+    def packages(self):\n+        return {\"packages\": [{\"local\": \"override-view-default-dep\"}]}\n+\n+    @pytest.fixture(scope=\"class\")\n+    def project_config_update(self):\n+        return {\n+            \"flags\": {\n+                \"require_explicit_package_overrides_for_builtin_materializations\": False,\n+            },\n+        }\n+\n+    def test_default_dependency(self, project, override_view_default_dep, set_up_deprecations):\n+        run_dbt([\"deps\"])\n+        # this should error because the override is buggy\n+        run_dbt([\"run\"], expect_pass=False)\n+\n+        # overriding a built-in materialization from package is deprecated\n+        assert deprecations.active_deprecations == {\"package-materialization-override\"}\n+\n+\n+root_view_override_macro = \"\"\"\n+{% materialization view, default %}\n+ {{ return(view_default_override.materialization_view_default()) }}\n+{% endmaterialization %}\n+\"\"\"\n+\n+\n+class TestOverrideDefaultDependencyRootOverride:\n+    @pytest.fixture(scope=\"class\")\n+    def packages(self):\n+        return {\"packages\": [{\"local\": \"override-view-default-dep\"}]}\n+\n+    @pytest.fixture(scope=\"class\")\n+    def macros(self):\n+        return {\"my_view.sql\": root_view_override_macro}\n+\n+    def test_default_dependency_with_root_override(\n+        self, project, override_view_default_dep, set_up_deprecations\n+    ):\n         run_dbt([\"deps\"])\n         # this should error because the override is buggy\n         run_dbt([\"run\"], expect_pass=False)\n \n+        # using an package-overriden built-in materialization in a root matereialization is _not_ deprecated\n+        assert deprecations.active_deprecations == set()\n+\n+\n+class TestCustomMaterializationDependency:\n+    @pytest.fixture(scope=\"class\")\n+    def models(self):\n+        return {\"model.sql\": models_custom_materialization__model_sql}\n+\n+    @pytest.fixture(scope=\"class\")\n+    def packages(self):\n+        return {\"packages\": [{\"local\": \"custom-materialization-dep\"}]}\n+\n+    def test_custom_materialization_deopendency(\n+        self, project, custom_materialization_dep, set_up_deprecations\n+    ):\n+        run_dbt([\"deps\"])\n+        # custom materilization is valid\n+        run_dbt([\"run\"])\n+\n+        # using a custom materialization is from an installed package is _not_ deprecated\n+        assert deprecations.active_deprecations == set()\n+\n \n class TestOverrideAdapterDependencyPassing:\n     @pytest.fixture(scope=\"class\")\n```\n\nFilename: tests/functional/metrics/test_metric_deferral.py:\n```\n@@ -23,7 +23,6 @@\ndef setup(self, project):\n     @pytest.fixture(scope=\"class\")\n     def dbt_profile_data(self, unique_schema):\n         return {\n-            \"config\": {\"send_anonymous_usage_stats\": False},\n             \"test\": {\n                 \"outputs\": {\n                     \"default\": {\n```\n\nFilename: tests/functional/run_operations/test_run_operations.py:\n```\n@@ -28,7 +28,6 @@\ndef macros(self):\n     @pytest.fixture(scope=\"class\")\n     def dbt_profile_data(self, unique_schema):\n         return {\n-            \"config\": {\"send_anonymous_usage_stats\": False},\n             \"test\": {\n                 \"outputs\": {\n                     \"default\": {\n```\n\nFilename: tests/unit/test_cli_flags.py:\n```\n@@ -9,7 +9,7 @@\nfrom dbt.cli.flags import Flags\n from dbt.cli.main import cli\n from dbt.cli.types import Command\n-from dbt.contracts.project import UserConfig\n+from dbt.contracts.project import ProjectFlags\n from dbt.exceptions import DbtInternalError\n from dbt.helper_types import WarnErrorOptions\n from dbt.tests.util import rm_file, write_file\n\n@@ -27,8 +27,8 @@\ndef run_context(self) -> click.Context:\n         return self.make_dbt_context(\"run\", [\"run\"])\n \n     @pytest.fixture\n-    def user_config(self) -> UserConfig:\n-        return UserConfig()\n+    def project_flags(self) -> ProjectFlags:\n+        return ProjectFlags()\n \n     def test_which(self, run_context):\n         flags = Flags(run_context)\n\n@@ -110,35 +110,35 @@\ndef test_anonymous_usage_state(\n         flags = Flags(run_context)\n         assert flags.SEND_ANONYMOUS_USAGE_STATS == expected_anonymous_usage_stats\n \n-    def test_empty_user_config_uses_default(self, run_context, user_config):\n-        flags = Flags(run_context, user_config)\n+    def test_empty_project_flags_uses_default(self, run_context, project_flags):\n+        flags = Flags(run_context, project_flags)\n         assert flags.USE_COLORS == run_context.params[\"use_colors\"]\n \n-    def test_none_user_config_uses_default(self, run_context):\n+    def test_none_project_flags_uses_default(self, run_context):\n         flags = Flags(run_context, None)\n         assert flags.USE_COLORS == run_context.params[\"use_colors\"]\n \n-    def test_prefer_user_config_to_default(self, run_context, user_config):\n-        user_config.use_colors = False\n+    def test_prefer_project_flags_to_default(self, run_context, project_flags):\n+        project_flags.use_colors = False\n         # ensure default value is not the same as user config\n-        assert run_context.params[\"use_colors\"] is not user_config.use_colors\n+        assert run_context.params[\"use_colors\"] is not project_flags.use_colors\n \n-        flags = Flags(run_context, user_config)\n-        assert flags.USE_COLORS == user_config.use_colors\n+        flags = Flags(run_context, project_flags)\n+        assert flags.USE_COLORS == project_flags.use_colors\n \n-    def test_prefer_param_value_to_user_config(self):\n-        user_config = UserConfig(use_colors=False)\n+    def test_prefer_param_value_to_project_flags(self):\n+        project_flags = ProjectFlags(use_colors=False)\n         context = self.make_dbt_context(\"run\", [\"--use-colors\", \"True\", \"run\"])\n \n-        flags = Flags(context, user_config)\n+        flags = Flags(context, project_flags)\n         assert flags.USE_COLORS\n \n-    def test_prefer_env_to_user_config(self, monkeypatch, user_config):\n-        user_config.use_colors = False\n+    def test_prefer_env_to_project_flags(self, monkeypatch, project_flags):\n+        project_flags.use_colors = False\n         monkeypatch.setenv(\"DBT_USE_COLORS\", \"True\")\n         context = self.make_dbt_context(\"run\", [\"run\"])\n \n-        flags = Flags(context, user_config)\n+        flags = Flags(context, project_flags)\n         assert flags.USE_COLORS\n \n     def test_mutually_exclusive_options_passed_separately(self):\n\n@@ -163,14 +163,14 @@\ndef test_mutually_exclusive_options_from_cli(self):\n             Flags(context)\n \n     @pytest.mark.parametrize(\"warn_error\", [True, False])\n-    def test_mutually_exclusive_options_from_user_config(self, warn_error, user_config):\n-        user_config.warn_error = warn_error\n+    def test_mutually_exclusive_options_from_project_flags(self, warn_error, project_flags):\n+        project_flags.warn_error = warn_error\n         context = self.make_dbt_context(\n             \"run\", [\"--warn-error-options\", '{\"include\": \"all\"}', \"run\"]\n         )\n \n         with pytest.raises(DbtUsageException):\n-            Flags(context, user_config)\n+            Flags(context, project_flags)\n \n     @pytest.mark.parametrize(\"warn_error\", [\"True\", \"False\"])\n     def test_mutually_exclusive_options_from_envvar(self, warn_error, monkeypatch):\n\n@@ -182,14 +182,16 @@\ndef test_mutually_exclusive_options_from_envvar(self, warn_error, monkeypatch):\n             Flags(context)\n \n     @pytest.mark.parametrize(\"warn_error\", [True, False])\n-    def test_mutually_exclusive_options_from_cli_and_user_config(self, warn_error, user_config):\n-        user_config.warn_error = warn_error\n+    def test_mutually_exclusive_options_from_cli_and_project_flags(\n+        self, warn_error, project_flags\n+    ):\n+        project_flags.warn_error = warn_error\n         context = self.make_dbt_context(\n             \"run\", [\"--warn-error-options\", '{\"include\": \"all\"}', \"run\"]\n         )\n \n         with pytest.raises(DbtUsageException):\n-            Flags(context, user_config)\n+            Flags(context, project_flags)\n \n     @pytest.mark.parametrize(\"warn_error\", [\"True\", \"False\"])\n     def test_mutually_exclusive_options_from_cli_and_envvar(self, warn_error, monkeypatch):\n\n@@ -202,15 +204,15 @@\ndef test_mutually_exclusive_options_from_cli_and_envvar(self, warn_error, monkey\n             Flags(context)\n \n     @pytest.mark.parametrize(\"warn_error\", [\"True\", \"False\"])\n-    def test_mutually_exclusive_options_from_user_config_and_envvar(\n-        self, user_config, warn_error, monkeypatch\n+    def test_mutually_exclusive_options_from_project_flags_and_envvar(\n+        self, project_flags, warn_error, monkeypatch\n     ):\n-        user_config.warn_error = warn_error\n+        project_flags.warn_error = warn_error\n         monkeypatch.setenv(\"DBT_WARN_ERROR_OPTIONS\", '{\"include\": \"all\"}')\n         context = self.make_dbt_context(\"run\", [\"run\"])\n \n         with pytest.raises(DbtUsageException):\n-            Flags(context, user_config)\n+            Flags(context, project_flags)\n \n     @pytest.mark.parametrize(\n         \"cli_colors,cli_colors_file,flag_colors,flag_colors_file\",\n\n@@ -319,10 +321,10 @@\ndef test_log_format_interaction(\n         assert flags.LOG_FORMAT_FILE == flag_log_format_file\n \n     def test_log_settings_from_config(self):\n-        \"\"\"Test that values set in UserConfig for log settings will set flags as expected\"\"\"\n+        \"\"\"Test that values set in ProjectFlags for log settings will set flags as expected\"\"\"\n         context = self.make_dbt_context(\"run\", [\"run\"])\n \n-        config = UserConfig(log_format=\"json\", log_level=\"warn\", use_colors=False)\n+        config = ProjectFlags(log_format=\"json\", log_level=\"warn\", use_colors=False)\n \n         flags = Flags(context, config)\n\n@@ -334,11 +336,11 @@\ndef test_log_settings_from_config(self):\n         assert flags.USE_COLORS_FILE is False\n \n     def test_log_file_settings_from_config(self):\n-        \"\"\"Test that values set in UserConfig for log *file* settings will set flags as expected, leaving the console\n+        \"\"\"Test that values set in ProjectFlags for log *file* settings will set flags as expected, leaving the console\n         logging flags with their default values\"\"\"\n         context = self.make_dbt_context(\"run\", [\"run\"])\n \n-        config = UserConfig(log_format_file=\"json\", log_level_file=\"warn\", use_colors_file=False)\n+        config = ProjectFlags(log_format_file=\"json\", log_level_file=\"warn\", use_colors_file=False)\n \n         flags = Flags(context, config)\n\n@@ -369,6 +371,14 @@\ndef test_global_flag_at_child_context(self):\n \n         assert flags_a.USE_COLORS == flags_b.USE_COLORS\n \n+    def test_set_project_only_flags(self, project_flags, run_context):\n+        flags = Flags(run_context, project_flags)\n+\n+        for project_only_flag, project_only_flag_value in project_flags.project_only_flags.items():\n+            assert getattr(flags, project_only_flag) == project_only_flag_value\n+            # sanity check: ensure project_only_flag is not part of the click context\n+            assert project_only_flag not in run_context.params\n+\n     def _create_flags_from_dict(self, cmd, d):\n         write_file(\"\", \"profiles.yml\")\n         result = Flags.from_dict(cmd, d)\n\n@@ -409,3 +419,38 @@\ndef test_from_dict_0_value(self):\n         args_dict = {\"log_file_max_bytes\": 0}\n         flags = Flags.from_dict(Command.RUN, args_dict)\n         assert flags.LOG_FILE_MAX_BYTES == 0\n+\n+\n+def test_project_flag_defaults():\n+    flags = ProjectFlags()\n+    # From # 9183: Let's add a unit test that ensures that:\n+    # every attribute of ProjectFlags that has a corresponding click option\n+    # in params.py should be set to None by default (except for anon user\n+    # tracking). Going forward, flags can have non-None defaults if they\n+    # do not have a corresponding CLI option/env var. These will be used\n+    # to control backwards incompatible interface or behaviour changes.\n+\n+    # List of all flags except send_anonymous_usage_stats\n+    project_flags = [\n+        \"cache_selected_only\",\n+        \"debug\",\n+        \"fail_fast\",\n+        \"indirect_selection\",\n+        \"log_format\",\n+        \"log_format_file\",\n+        \"log_level\",\n+        \"log_level_file\",\n+        \"partial_parse\",\n+        \"populate_cache\",\n+        \"printer_width\",\n+        \"static_parser\",\n+        \"use_colors\",\n+        \"use_colors_file\",\n+        \"use_experimental_parser\",\n+        \"version_check\",\n+        \"warn_error\",\n+        \"warn_error_options\",\n+        \"write_json\",\n+    ]\n+    for flag in project_flags:\n+        assert getattr(flags, flag) is None\n```\n\nFilename: tests/unit/test_config.py:\n```\n@@ -119,12 +119,17 @@\nclass BaseConfigTest(unittest.TestCase):\n     \"\"\"\n \n     def setUp(self):\n+        # Write project\n+        self.project_dir = normalize(tempfile.mkdtemp())\n         self.default_project_data = {\n             \"version\": \"0.0.1\",\n             \"name\": \"my_test_project\",\n             \"profile\": \"default\",\n-            \"config-version\": 2,\n         }\n+        self.write_project(self.default_project_data)\n+\n+        # Write profile\n+        self.profiles_dir = normalize(tempfile.mkdtemp())\n         self.default_profile_data = {\n             \"default\": {\n                 \"outputs\": {\n\n@@ -176,6 +181,8 @@\ndef setUp(self):\n             },\n             \"empty_profile_data\": {},\n         }\n+        self.write_profile(self.default_profile_data)\n+\n         self.args = Namespace(\n             profiles_dir=self.profiles_dir,\n             cli_vars={},\n\n@@ -203,13 +210,6 @@\ndef assertRaisesOrReturns(self, exc):\n         else:\n             return self.assertRaises(exc)\n \n-\n-class BaseFileTest(BaseConfigTest):\n-    def setUp(self):\n-        self.project_dir = normalize(tempfile.mkdtemp())\n-        self.profiles_dir = normalize(tempfile.mkdtemp())\n-        super().setUp()\n-\n     def tearDown(self):\n         try:\n             shutil.rmtree(self.project_dir)\n\n@@ -248,11 +248,6 @@\ndef write_empty_profile(self):\n \n \n class TestProfile(BaseConfigTest):\n-    def setUp(self):\n-        self.profiles_dir = \"/invalid-path\"\n-        self.project_dir = \"/invalid-project-path\"\n-        super().setUp()\n-\n     def from_raw_profiles(self):\n         renderer = empty_profile_renderer()\n         return dbt.config.Profile.from_raw_profiles(self.default_profile_data, \"default\", renderer)\n\n@@ -262,8 +257,6 @@\ndef test_from_raw_profiles(self):\n         self.assertEqual(profile.profile_name, \"default\")\n         self.assertEqual(profile.target_name, \"postgres\")\n         self.assertEqual(profile.threads, 7)\n-        self.assertTrue(profile.user_config.send_anonymous_usage_stats)\n-        self.assertIsNone(profile.user_config.use_colors)\n         self.assertTrue(isinstance(profile.credentials, PostgresCredentials))\n         self.assertEqual(profile.credentials.type, \"postgres\")\n         self.assertEqual(profile.credentials.host, \"postgres-db-hostname\")\n\n@@ -273,29 +266,6 @@\ndef test_from_raw_profiles(self):\n         self.assertEqual(profile.credentials.schema, \"postgres-schema\")\n         self.assertEqual(profile.credentials.database, \"postgres-db-name\")\n \n-    def test_config_override(self):\n-        self.default_profile_data[\"config\"] = {\n-            \"send_anonymous_usage_stats\": False,\n-            \"use_colors\": False,\n-        }\n-        profile = self.from_raw_profiles()\n-        self.assertEqual(profile.profile_name, \"default\")\n-        self.assertEqual(profile.target_name, \"postgres\")\n-        self.assertFalse(profile.user_config.send_anonymous_usage_stats)\n-        self.assertFalse(profile.user_config.use_colors)\n-\n-    def test_partial_config_override(self):\n-        self.default_profile_data[\"config\"] = {\n-            \"send_anonymous_usage_stats\": False,\n-            \"printer_width\": 60,\n-        }\n-        profile = self.from_raw_profiles()\n-        self.assertEqual(profile.profile_name, \"default\")\n-        self.assertEqual(profile.target_name, \"postgres\")\n-        self.assertFalse(profile.user_config.send_anonymous_usage_stats)\n-        self.assertIsNone(profile.user_config.use_colors)\n-        self.assertEqual(profile.user_config.printer_width, 60)\n-\n     def test_missing_type(self):\n         del self.default_profile_data[\"default\"][\"outputs\"][\"postgres\"][\"type\"]\n         with self.assertRaises(dbt.exceptions.DbtProfileError) as exc:\n\n@@ -337,7 +307,7 @@\ndef test_extra_path(self):\n             }\n         )\n         with self.assertRaises(dbt.exceptions.DbtProjectError) as exc:\n-            project_from_config_norender(self.default_project_data)\n+            project_from_config_norender(self.default_project_data, project_root=self.project_dir)\n \n         self.assertIn(\"source-paths and model-paths\", str(exc.exception))\n         self.assertIn(\"cannot both be defined.\", str(exc.exception))\n\n@@ -403,11 +373,7 @@\ndef test_invalid_env_vars(self):\n         self.assertIn(\"Could not convert value 'hello' into type 'number'\", str(exc.exception))\n \n \n-class TestProfileFile(BaseFileTest):\n-    def setUp(self):\n-        super().setUp()\n-        self.write_profile(self.default_profile_data)\n-\n+class TestProfileFile(BaseConfigTest):\n     def from_raw_profile_info(self, raw_profile=None, profile_name=\"default\", **kwargs):\n         if raw_profile is None:\n             raw_profile = self.default_profile_data[\"default\"]\n\n@@ -438,8 +404,6 @@\ndef test_profile_simple(self):\n         self.assertEqual(profile.profile_name, \"default\")\n         self.assertEqual(profile.target_name, \"postgres\")\n         self.assertEqual(profile.threads, 7)\n-        self.assertTrue(profile.user_config.send_anonymous_usage_stats)\n-        self.assertIsNone(profile.user_config.use_colors)\n         self.assertTrue(isinstance(profile.credentials, PostgresCredentials))\n         self.assertEqual(profile.credentials.type, \"postgres\")\n         self.assertEqual(profile.credentials.host, \"postgres-db-hostname\")\n\n@@ -464,8 +428,6 @@\ndef test_profile_override(self):\n         self.assertEqual(profile.profile_name, \"other\")\n         self.assertEqual(profile.target_name, \"other-postgres\")\n         self.assertEqual(profile.threads, 3)\n-        self.assertTrue(profile.user_config.send_anonymous_usage_stats)\n-        self.assertIsNone(profile.user_config.use_colors)\n         self.assertTrue(isinstance(profile.credentials, PostgresCredentials))\n         self.assertEqual(profile.credentials.type, \"postgres\")\n         self.assertEqual(profile.credentials.host, \"other-postgres-db-hostname\")\n\n@@ -485,8 +447,6 @@\ndef test_env_vars(self):\n         self.assertEqual(profile.profile_name, \"default\")\n         self.assertEqual(profile.target_name, \"with-vars\")\n         self.assertEqual(profile.threads, 1)\n-        self.assertTrue(profile.user_config.send_anonymous_usage_stats)\n-        self.assertIsNone(profile.user_config.use_colors)\n         self.assertEqual(profile.credentials.type, \"postgres\")\n         self.assertEqual(profile.credentials.host, \"env-postgres-host\")\n         self.assertEqual(profile.credentials.port, 6543)\n\n@@ -505,8 +465,6 @@\ndef test_env_vars_env_target(self):\n         self.assertEqual(profile.profile_name, \"default\")\n         self.assertEqual(profile.target_name, \"with-vars\")\n         self.assertEqual(profile.threads, 1)\n-        self.assertTrue(profile.user_config.send_anonymous_usage_stats)\n-        self.assertIsNone(profile.user_config.use_colors)\n         self.assertEqual(profile.credentials.type, \"postgres\")\n         self.assertEqual(profile.credentials.host, \"env-postgres-host\")\n         self.assertEqual(profile.credentials.port, 6543)\n\n@@ -537,8 +495,6 @@\ndef test_cli_and_env_vars(self):\n         self.assertEqual(profile.profile_name, \"default\")\n         self.assertEqual(profile.target_name, \"cli-and-env-vars\")\n         self.assertEqual(profile.threads, 1)\n-        self.assertTrue(profile.user_config.send_anonymous_usage_stats)\n-        self.assertIsNone(profile.user_config.use_colors)\n         self.assertEqual(profile.credentials.type, \"postgres\")\n         self.assertEqual(profile.credentials.host, \"cli-postgres-host\")\n         self.assertEqual(profile.credentials.port, 6543)\n\n@@ -567,18 +523,19 @@\ndef test_profile_with_empty_profile_data(self):\n \n \n def project_from_config_norender(\n-    cfg, packages=None, path=\"/invalid-root-path\", verify_version=False\n+    cfg, packages=None, project_root=\"/invalid-root-path\", verify_version=False\n ):\n     if packages is None:\n         packages = {}\n     partial = dbt.config.project.PartialProject.from_dicts(\n-        path,\n+        project_root,\n         project_dict=cfg,\n         packages_dict=packages,\n         selectors_dict={},\n         verify_version=verify_version,\n     )\n-    # no rendering\n+    # no rendering ... Why?\n+    partial.project_dict[\"project-root\"] = project_root\n     rendered = dbt.config.project.RenderComponents(\n         project_dict=partial.project_dict,\n         packages_dict=partial.packages_dict,\n\n@@ -590,14 +547,14 @@\ndef project_from_config_norender(\n def project_from_config_rendered(\n     cfg,\n     packages=None,\n-    path=\"/invalid-root-path\",\n+    project_root=\"/invalid-root-path\",\n     verify_version=False,\n     packages_specified_path=PACKAGES_FILE_NAME,\n ):\n     if packages is None:\n         packages = {}\n     partial = dbt.config.project.PartialProject.from_dicts(\n-        path,\n+        project_root,\n         project_dict=cfg,\n         packages_dict=packages,\n         selectors_dict={},\n\n@@ -608,18 +565,14 @@\ndef project_from_config_rendered(\n \n \n class TestProject(BaseConfigTest):\n-    def setUp(self):\n-        self.profiles_dir = \"/invalid-profiles-path\"\n-        self.project_dir = \"/invalid-root-path\"\n-        super().setUp()\n-        self.default_project_data[\"project-root\"] = self.project_dir\n-\n     def test_defaults(self):\n-        project = project_from_config_norender(self.default_project_data)\n+        project = project_from_config_norender(\n+            self.default_project_data, project_root=self.project_dir\n+        )\n         self.assertEqual(project.project_name, \"my_test_project\")\n         self.assertEqual(project.version, \"0.0.1\")\n         self.assertEqual(project.profile_name, \"default\")\n-        self.assertEqual(project.project_root, \"/invalid-root-path\")\n+        self.assertEqual(project.project_root, self.project_dir)\n         self.assertEqual(project.model_paths, [\"models\"])\n         self.assertEqual(project.macro_paths, [\"macros\"])\n         self.assertEqual(project.seed_paths, [\"seeds\"])\n\n@@ -645,30 +598,38 @@\ndef test_defaults(self):\n         str(project)\n \n     def test_eq(self):\n-        project = project_from_config_norender(self.default_project_data)\n-        other = project_from_config_norender(self.default_project_data)\n+        project = project_from_config_norender(\n+            self.default_project_data, project_root=self.project_dir\n+        )\n+        other = project_from_config_norender(\n+            self.default_project_data, project_root=self.project_dir\n+        )\n         self.assertEqual(project, other)\n \n     def test_neq(self):\n-        project = project_from_config_norender(self.default_project_data)\n+        project = project_from_config_norender(\n+            self.default_project_data, project_root=self.project_dir\n+        )\n         self.assertNotEqual(project, object())\n \n     def test_implicit_overrides(self):\n         self.default_project_data.update(\n             {\n                 \"model-paths\": [\"other-models\"],\n-                \"target-path\": \"other-target\",\n             }\n         )\n-        project = project_from_config_norender(self.default_project_data)\n+        project = project_from_config_norender(\n+            self.default_project_data, project_root=self.project_dir\n+        )\n         self.assertEqual(\n             set(project.docs_paths),\n             set([\"other-models\", \"seeds\", \"snapshots\", \"analyses\", \"macros\"]),\n         )\n-        self.assertEqual(project.clean_targets, [\"other-target\"])\n \n     def test_hashed_name(self):\n-        project = project_from_config_norender(self.default_project_data)\n+        project = project_from_config_norender(\n+            self.default_project_data, project_root=self.project_dir\n+        )\n         self.assertEqual(project.hashed_name(), \"754cd47eac1d6f50a5f7cd399ec43da4\")\n \n     def test_all_overrides(self):\n\n@@ -682,7 +643,6 @@\ndef test_all_overrides(self):\n                 \"analysis-paths\": [\"other-analyses\"],\n                 \"docs-paths\": [\"docs\"],\n                 \"asset-paths\": [\"other-assets\"],\n-                \"target-path\": \"other-target\",\n                 \"clean-targets\": [\"another-target\"],\n                 \"packages-install-path\": \"other-dbt_packages\",\n                 \"quoting\": {\"identifier\": False},\n\n@@ -731,19 +691,19 @@\ndef test_all_overrides(self):\n                 {\"git\": \"git@example.com:dbt-labs/dbt-utils.git\", \"revision\": \"test-rev\"},\n             ],\n         }\n-        project = project_from_config_norender(self.default_project_data, packages=packages)\n+        project = project_from_config_norender(\n+            self.default_project_data, project_root=self.project_dir, packages=packages\n+        )\n         self.assertEqual(project.project_name, \"my_test_project\")\n         self.assertEqual(project.version, \"0.0.1\")\n         self.assertEqual(project.profile_name, \"default\")\n-        self.assertEqual(project.project_root, \"/invalid-root-path\")\n         self.assertEqual(project.model_paths, [\"other-models\"])\n         self.assertEqual(project.macro_paths, [\"other-macros\"])\n         self.assertEqual(project.seed_paths, [\"other-seeds\"])\n         self.assertEqual(project.test_paths, [\"other-tests\"])\n         self.assertEqual(project.analysis_paths, [\"other-analyses\"])\n         self.assertEqual(project.docs_paths, [\"docs\"])\n         self.assertEqual(project.asset_paths, [\"other-assets\"])\n-        self.assertEqual(project.target_path, \"other-target\")\n         self.assertEqual(project.clean_targets, [\"another-target\"])\n         self.assertEqual(project.packages_install_path, \"other-dbt_packages\")\n         self.assertEqual(project.quoting, {\"identifier\": False})\n\n@@ -815,11 +775,12 @@\ndef test_string_run_hooks(self):\n     def test_invalid_project_name(self):\n         self.default_project_data[\"name\"] = \"invalid-project-name\"\n         with self.assertRaises(dbt.exceptions.DbtProjectError) as exc:\n-            project_from_config_norender(self.default_project_data)\n+            project_from_config_norender(self.default_project_data, project_root=self.project_dir)\n \n         self.assertIn(\"invalid-project-name\", str(exc.exception))\n \n     def test_no_project(self):\n+        os.remove(os.path.join(self.project_dir, \"dbt_project.yml\"))\n         renderer = empty_project_renderer()\n         with self.assertRaises(dbt.exceptions.DbtProjectError) as exc:\n             dbt.config.Project.from_project_root(self.project_dir, renderer)\n\n@@ -829,12 +790,12 @@\ndef test_no_project(self):\n     def test_invalid_version(self):\n         self.default_project_data[\"require-dbt-version\"] = \"hello!\"\n         with self.assertRaises(dbt.exceptions.DbtProjectError):\n-            project_from_config_norender(self.default_project_data)\n+            project_from_config_norender(self.default_project_data, project_root=self.project_dir)\n \n     def test_unsupported_version(self):\n         self.default_project_data[\"require-dbt-version\"] = \">99999.0.0\"\n         # allowed, because the RuntimeConfig checks, not the Project itself\n-        project_from_config_norender(self.default_project_data)\n+        project_from_config_norender(self.default_project_data, project_root=self.project_dir)\n \n     def test_none_values(self):\n         self.default_project_data.update(\n\n@@ -884,7 +845,9 @@\ndef test_query_comment_disabled(self):\n                 \"query-comment\": None,\n             }\n         )\n-        project = project_from_config_norender(self.default_project_data)\n+        project = project_from_config_norender(\n+            self.default_project_data, project_root=self.project_dir\n+        )\n         self.assertEqual(project.query_comment.comment, \"\")\n         self.assertEqual(project.query_comment.append, False)\n\n@@ -893,12 +856,16 @@\ndef test_query_comment_disabled(self):\n                 \"query-comment\": \"\",\n             }\n         )\n-        project = project_from_config_norender(self.default_project_data)\n+        project = project_from_config_norender(\n+            self.default_project_data, project_root=self.project_dir\n+        )\n         self.assertEqual(project.query_comment.comment, \"\")\n         self.assertEqual(project.query_comment.append, False)\n \n     def test_default_query_comment(self):\n-        project = project_from_config_norender(self.default_project_data)\n+        project = project_from_config_norender(\n+            self.default_project_data, project_root=self.project_dir\n+        )\n         self.assertEqual(project.query_comment, QueryComment())\n \n     def test_default_query_comment_append(self):\n\n@@ -907,7 +874,9 @@\ndef test_default_query_comment_append(self):\n                 \"query-comment\": {\"append\": True},\n             }\n         )\n-        project = project_from_config_norender(self.default_project_data)\n+        project = project_from_config_norender(\n+            self.default_project_data, project_root=self.project_dir\n+        )\n         self.assertEqual(project.query_comment.comment, DEFAULT_QUERY_COMMENT)\n         self.assertEqual(project.query_comment.append, True)\n\n@@ -917,7 +886,9 @@\ndef test_custom_query_comment_append(self):\n                 \"query-comment\": {\"comment\": \"run by user test\", \"append\": True},\n             }\n         )\n-        project = project_from_config_norender(self.default_project_data)\n+        project = project_from_config_norender(\n+            self.default_project_data, project_root=self.project_dir\n+        )\n         self.assertEqual(project.query_comment.comment, \"run by user test\")\n         self.assertEqual(project.query_comment.append, True)\n\n@@ -939,17 +910,13 @@\ndef test_packages_from_dependencies(self):\n         assert git_package.git == \"{{ env_var('some_package') }}\"\n \n \n-class TestProjectFile(BaseFileTest):\n-    def setUp(self):\n-        super().setUp()\n-        self.write_project(self.default_project_data)\n-        # and after the fact, add the project root\n-        self.default_project_data[\"project-root\"] = self.project_dir\n-\n+class TestProjectFile(BaseConfigTest):\n     def test_from_project_root(self):\n         renderer = empty_project_renderer()\n         project = dbt.config.Project.from_project_root(self.project_dir, renderer)\n-        from_config = project_from_config_norender(self.default_project_data)\n+        from_config = project_from_config_norender(\n+            self.default_project_data, project_root=self.project_dir\n+        )\n         self.assertEqual(project, from_config)\n         self.assertEqual(project.version, \"0.0.1\")\n         self.assertEqual(project.project_name, \"my_test_project\")\n\n@@ -966,12 +933,7 @@\ndef run(self):\n         pass\n \n \n-class TestConfiguredTask(BaseFileTest):\n-    def setUp(self):\n-        super().setUp()\n-        self.write_project(self.default_project_data)\n-        self.write_profile(self.default_profile_data)\n-\n+class TestConfiguredTask(BaseConfigTest):\n     def tearDown(self):\n         super().tearDown()\n         # These tests will change the directory to the project path,\n\n@@ -990,15 +952,13 @@\ndef test_configured_task_dir_change_with_bad_path(self):\n             InheritsFromConfiguredTask.from_args(self.args)\n \n \n-class TestVariableProjectFile(BaseFileTest):\n+class TestVariableProjectFile(BaseConfigTest):\n     def setUp(self):\n         super().setUp()\n         self.default_project_data[\"version\"] = \"{{ var('cli_version') }}\"\n         self.default_project_data[\"name\"] = \"blah\"\n         self.default_project_data[\"profile\"] = \"{{ env_var('env_value_profile') }}\"\n         self.write_project(self.default_project_data)\n-        # and after the fact, add the project root\n-        self.default_project_data[\"project-root\"] = self.project_dir\n \n     def test_cli_and_env_vars(self):\n         renderer = dbt.config.renderer.DbtProjectYamlRenderer(None, {\"cli_version\": \"0.1.2\"})\n\n@@ -1015,15 +975,11 @@\ndef test_cli_and_env_vars(self):\n \n \n class TestRuntimeConfig(BaseConfigTest):\n-    def setUp(self):\n-        self.profiles_dir = \"/invalid-profiles-path\"\n-        self.project_dir = \"/invalid-root-path\"\n-        super().setUp()\n-        self.default_project_data[\"project-root\"] = self.project_dir\n-\n     def get_project(self):\n         return project_from_config_norender(\n-            self.default_project_data, verify_version=self.args.version_check\n+            self.default_project_data,\n+            project_root=self.project_dir,\n+            verify_version=self.args.version_check,\n         )\n \n     def get_profile(self):\n\n@@ -1072,14 +1028,6 @@\ndef test_str(self):\n         # to make sure nothing terrible happens\n         str(config)\n \n-    def test_validate_fails(self):\n-        project = self.get_project()\n-        profile = self.get_profile()\n-        # invalid - must be boolean\n-        profile.user_config.use_colors = 100\n-        with self.assertRaises(dbt.exceptions.DbtProjectError):\n-            dbt.config.RuntimeConfig.from_parts(project, profile, {})\n-\n     def test_supported_version(self):\n         self.default_project_data[\"require-dbt-version\"] = \">0.0.0\"\n         conf = self.from_parts()\n\n@@ -1203,7 +1151,9 @@\ndef setUp(self):\n         }\n \n     def get_project(self):\n-        return project_from_config_norender(self.default_project_data, verify_version=True)\n+        return project_from_config_norender(\n+            self.default_project_data, project_root=self.project_dir, verify_version=True\n+        )\n \n     def get_profile(self):\n         renderer = empty_profile_renderer()\n\n@@ -1235,14 +1185,7 @@\ndef test__warn_for_unused_resource_config_paths(self):\n             assert expected_msg in msg\n \n \n-class TestRuntimeConfigFiles(BaseFileTest):\n-    def setUp(self):\n-        super().setUp()\n-        self.write_profile(self.default_profile_data)\n-        self.write_project(self.default_project_data)\n-        # and after the fact, add the project root\n-        self.default_project_data[\"project-root\"] = self.project_dir\n-\n+class TestRuntimeConfigFiles(BaseConfigTest):\n     def test_from_args(self):\n         with temp_cd(self.project_dir):\n             config = dbt.config.RuntimeConfig.from_args(self.args)\n\n@@ -1272,7 +1215,7 @@\ndef test_from_args(self):\n         self.assertEqual(config.project_name, \"my_test_project\")\n \n \n-class TestVariableRuntimeConfigFiles(BaseFileTest):\n+class TestVariableRuntimeConfigFiles(BaseConfigTest):\n     def setUp(self):\n         super().setUp()\n         self.default_project_data.update(\n\n@@ -1304,9 +1247,6 @@\ndef setUp(self):\n             }\n         )\n         self.write_project(self.default_project_data)\n-        self.write_profile(self.default_profile_data)\n-        # and after the fact, add the project root\n-        self.default_project_data[\"project-root\"] = self.project_dir\n \n     def test_cli_and_env_vars(self):\n         self.args.target = \"cli-and-env-vars\"\n\n@@ -1380,3 +1320,30 @@\ndef test_lookups(self):\n         for node, key, expected_value in expected:\n             value = vars_provider.vars_for(node, \"postgres\").get(key)\n             assert value == expected_value\n+\n+\n+class TestMultipleProjectFlags(BaseConfigTest):\n+    def setUp(self):\n+        super().setUp()\n+\n+        self.default_project_data.update(\n+            {\n+                \"flags\": {\n+                    \"send_anonymous_usage_data\": False,\n+                }\n+            }\n+        )\n+        self.write_project(self.default_project_data)\n+\n+        self.default_profile_data.update(\n+            {\n+                \"config\": {\n+                    \"send_anonymous_usage_data\": False,\n+                }\n+            }\n+        )\n+        self.write_profile(self.default_profile_data)\n+\n+    def test_setting_multiple_flags(self):\n+        with pytest.raises(dbt.exceptions.DbtProjectError):\n+            set_from_args(self.args, None)\n```\n\nFilename: tests/unit/test_events.py:\n```\n@@ -138,6 +138,10 @@\ndef test_event_codes(self):\n     types.ConfigLogPathDeprecation(deprecated_path=\"\"),\n     types.ConfigTargetPathDeprecation(deprecated_path=\"\"),\n     types.CollectFreshnessReturnSignature(),\n+    types.ProjectFlagsMovedDeprecation(),\n+    types.PackageMaterializationOverrideDeprecation(\n+        package_name=\"my_package\", materialization_name=\"view\"\n+    ),\n     # E - DB Adapter ======================\n     types.AdapterEventDebug(),\n     types.AdapterEventInfo(),\n```\n\nFilename: tests/unit/test_flags.py:\n```\n@@ -1,340 +0,0 @@\n-import os\n-from unittest import TestCase\n-from argparse import Namespace\n-import pytest\n-\n-from dbt import flags\n-from dbt.contracts.project import UserConfig\n-from dbt.graph.selector_spec import IndirectSelection\n-from dbt.helper_types import WarnErrorOptions\n-\n-# Skip due to interface for flag updated\n-pytestmark = pytest.mark.skip\n-\n-\n-class TestFlags(TestCase):\n-    def setUp(self):\n-        self.args = Namespace()\n-        self.user_config = UserConfig()\n-\n-    def test__flags(self):\n-\n-        # use_experimental_parser\n-        self.user_config.use_experimental_parser = True\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.USE_EXPERIMENTAL_PARSER, True)\n-        os.environ[\"DBT_USE_EXPERIMENTAL_PARSER\"] = \"false\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.USE_EXPERIMENTAL_PARSER, False)\n-        setattr(self.args, \"use_experimental_parser\", True)\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.USE_EXPERIMENTAL_PARSER, True)\n-        # cleanup\n-        os.environ.pop(\"DBT_USE_EXPERIMENTAL_PARSER\")\n-        delattr(self.args, \"use_experimental_parser\")\n-        flags.USE_EXPERIMENTAL_PARSER = False\n-        self.user_config.use_experimental_parser = None\n-\n-        # static_parser\n-        self.user_config.static_parser = False\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.STATIC_PARSER, False)\n-        os.environ[\"DBT_STATIC_PARSER\"] = \"true\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.STATIC_PARSER, True)\n-        setattr(self.args, \"static_parser\", False)\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.STATIC_PARSER, False)\n-        # cleanup\n-        os.environ.pop(\"DBT_STATIC_PARSER\")\n-        delattr(self.args, \"static_parser\")\n-        flags.STATIC_PARSER = True\n-        self.user_config.static_parser = None\n-\n-        # warn_error\n-        self.user_config.warn_error = False\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.WARN_ERROR, False)\n-        os.environ[\"DBT_WARN_ERROR\"] = \"true\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.WARN_ERROR, True)\n-        setattr(self.args, \"warn_error\", False)\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.WARN_ERROR, False)\n-        # cleanup\n-        os.environ.pop(\"DBT_WARN_ERROR\")\n-        delattr(self.args, \"warn_error\")\n-        flags.WARN_ERROR = False\n-        self.user_config.warn_error = None\n-\n-        # warn_error_options\n-        self.user_config.warn_error_options = '{\"include\": \"all\"}'\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.WARN_ERROR_OPTIONS, WarnErrorOptions(include=\"all\"))\n-        os.environ[\"DBT_WARN_ERROR_OPTIONS\"] = '{\"include\": []}'\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.WARN_ERROR_OPTIONS, WarnErrorOptions(include=[]))\n-        setattr(self.args, \"warn_error_options\", '{\"include\": \"all\"}')\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.WARN_ERROR_OPTIONS, WarnErrorOptions(include=\"all\"))\n-        # cleanup\n-        os.environ.pop(\"DBT_WARN_ERROR_OPTIONS\")\n-        delattr(self.args, \"warn_error_options\")\n-        self.user_config.warn_error_options = None\n-\n-        # write_json\n-        self.user_config.write_json = True\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.WRITE_JSON, True)\n-        os.environ[\"DBT_WRITE_JSON\"] = \"false\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.WRITE_JSON, False)\n-        setattr(self.args, \"write_json\", True)\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.WRITE_JSON, True)\n-        # cleanup\n-        os.environ.pop(\"DBT_WRITE_JSON\")\n-        delattr(self.args, \"write_json\")\n-\n-        # partial_parse\n-        self.user_config.partial_parse = True\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.PARTIAL_PARSE, True)\n-        os.environ[\"DBT_PARTIAL_PARSE\"] = \"false\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.PARTIAL_PARSE, False)\n-        setattr(self.args, \"partial_parse\", True)\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.PARTIAL_PARSE, True)\n-        # cleanup\n-        os.environ.pop(\"DBT_PARTIAL_PARSE\")\n-        delattr(self.args, \"partial_parse\")\n-        self.user_config.partial_parse = False\n-\n-        # use_colors\n-        self.user_config.use_colors = True\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.USE_COLORS, True)\n-        os.environ[\"DBT_USE_COLORS\"] = \"false\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.USE_COLORS, False)\n-        setattr(self.args, \"use_colors\", True)\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.USE_COLORS, True)\n-        # cleanup\n-        os.environ.pop(\"DBT_USE_COLORS\")\n-        delattr(self.args, \"use_colors\")\n-\n-        # debug\n-        self.user_config.debug = True\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.DEBUG, True)\n-        os.environ[\"DBT_DEBUG\"] = \"True\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.DEBUG, True)\n-        os.environ[\"DBT_DEBUG\"] = \"False\"\n-        setattr(self.args, \"debug\", True)\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.DEBUG, True)\n-        # cleanup\n-        os.environ.pop(\"DBT_DEBUG\")\n-        delattr(self.args, \"debug\")\n-        self.user_config.debug = None\n-\n-        # log_format -- text, json, default\n-        self.user_config.log_format = \"text\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.LOG_FORMAT, \"text\")\n-        os.environ[\"DBT_LOG_FORMAT\"] = \"json\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.LOG_FORMAT, \"json\")\n-        setattr(self.args, \"log_format\", \"text\")\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.LOG_FORMAT, \"text\")\n-        # cleanup\n-        os.environ.pop(\"DBT_LOG_FORMAT\")\n-        delattr(self.args, \"log_format\")\n-        self.user_config.log_format = None\n-\n-        # version_check\n-        self.user_config.version_check = True\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.VERSION_CHECK, True)\n-        os.environ[\"DBT_VERSION_CHECK\"] = \"false\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.VERSION_CHECK, False)\n-        setattr(self.args, \"version_check\", True)\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.VERSION_CHECK, True)\n-        # cleanup\n-        os.environ.pop(\"DBT_VERSION_CHECK\")\n-        delattr(self.args, \"version_check\")\n-\n-        # fail_fast\n-        self.user_config.fail_fast = True\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.FAIL_FAST, True)\n-        os.environ[\"DBT_FAIL_FAST\"] = \"false\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.FAIL_FAST, False)\n-        setattr(self.args, \"fail_fast\", True)\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.FAIL_FAST, True)\n-        # cleanup\n-        os.environ.pop(\"DBT_FAIL_FAST\")\n-        delattr(self.args, \"fail_fast\")\n-        self.user_config.fail_fast = False\n-\n-        # send_anonymous_usage_stats\n-        self.user_config.send_anonymous_usage_stats = True\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.SEND_ANONYMOUS_USAGE_STATS, True)\n-        os.environ[\"DBT_SEND_ANONYMOUS_USAGE_STATS\"] = \"false\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.SEND_ANONYMOUS_USAGE_STATS, False)\n-        setattr(self.args, \"send_anonymous_usage_stats\", True)\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.SEND_ANONYMOUS_USAGE_STATS, True)\n-        os.environ[\"DO_NOT_TRACK\"] = \"1\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.SEND_ANONYMOUS_USAGE_STATS, False)\n-        # cleanup\n-        os.environ.pop(\"DBT_SEND_ANONYMOUS_USAGE_STATS\")\n-        os.environ.pop(\"DO_NOT_TRACK\")\n-        delattr(self.args, \"send_anonymous_usage_stats\")\n-\n-        # printer_width\n-        self.user_config.printer_width = 100\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.PRINTER_WIDTH, 100)\n-        os.environ[\"DBT_PRINTER_WIDTH\"] = \"80\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.PRINTER_WIDTH, 80)\n-        setattr(self.args, \"printer_width\", \"120\")\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.PRINTER_WIDTH, 120)\n-        # cleanup\n-        os.environ.pop(\"DBT_PRINTER_WIDTH\")\n-        delattr(self.args, \"printer_width\")\n-        self.user_config.printer_width = None\n-\n-        # indirect_selection\n-        self.user_config.indirect_selection = \"eager\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.INDIRECT_SELECTION, IndirectSelection.Eager)\n-        self.user_config.indirect_selection = \"cautious\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.INDIRECT_SELECTION, IndirectSelection.Cautious)\n-        self.user_config.indirect_selection = \"buildable\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.INDIRECT_SELECTION, IndirectSelection.Buildable)\n-        self.user_config.indirect_selection = None\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.INDIRECT_SELECTION, IndirectSelection.Eager)\n-        os.environ[\"DBT_INDIRECT_SELECTION\"] = \"cautious\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.INDIRECT_SELECTION, IndirectSelection.Cautious)\n-        setattr(self.args, \"indirect_selection\", \"cautious\")\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.INDIRECT_SELECTION, IndirectSelection.Cautious)\n-        # cleanup\n-        os.environ.pop(\"DBT_INDIRECT_SELECTION\")\n-        delattr(self.args, \"indirect_selection\")\n-        self.user_config.indirect_selection = None\n-\n-        # quiet\n-        self.user_config.quiet = True\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.QUIET, True)\n-        # cleanup\n-        self.user_config.quiet = None\n-\n-        # no_print\n-        self.user_config.no_print = True\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.NO_PRINT, True)\n-        # cleanup\n-        self.user_config.no_print = None\n-\n-        # cache_selected_only\n-        self.user_config.cache_selected_only = True\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.CACHE_SELECTED_ONLY, True)\n-        os.environ[\"DBT_CACHE_SELECTED_ONLY\"] = \"false\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.CACHE_SELECTED_ONLY, False)\n-        setattr(self.args, \"cache_selected_only\", True)\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.CACHE_SELECTED_ONLY, True)\n-        # cleanup\n-        os.environ.pop(\"DBT_CACHE_SELECTED_ONLY\")\n-        delattr(self.args, \"cache_selected_only\")\n-        self.user_config.cache_selected_only = False\n-\n-        # target_path/log_path\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertIsNone(flags.LOG_PATH)\n-        os.environ[\"DBT_LOG_PATH\"] = \"a/b/c\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.LOG_PATH, \"a/b/c\")\n-        setattr(self.args, \"log_path\", \"d/e/f\")\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.LOG_PATH, \"d/e/f\")\n-        # cleanup\n-        os.environ.pop(\"DBT_LOG_PATH\")\n-        delattr(self.args, \"log_path\")\n-\n-    def test__flags_are_mutually_exclusive(self):\n-        # options from user config\n-        self.user_config.warn_error = False\n-        self.user_config.warn_error_options = '{\"include\":\"all\"}'\n-        with pytest.raises(ValueError):\n-            flags.set_from_args(self.args, self.user_config)\n-        # cleanup\n-        self.user_config.warn_error = None\n-        self.user_config.warn_error_options = None\n-\n-        # options from args\n-        setattr(self.args, \"warn_error\", False)\n-        setattr(self.args, \"warn_error_options\", '{\"include\":\"all\"}')\n-        with pytest.raises(ValueError):\n-            flags.set_from_args(self.args, self.user_config)\n-        # cleanup\n-        delattr(self.args, \"warn_error\")\n-        delattr(self.args, \"warn_error_options\")\n-\n-        # options from environment\n-        os.environ[\"DBT_WARN_ERROR\"] = \"false\"\n-        os.environ[\"DBT_WARN_ERROR_OPTIONS\"] = '{\"include\": []}'\n-        with pytest.raises(ValueError):\n-            flags.set_from_args(self.args, self.user_config)\n-        # cleanup\n-        os.environ.pop(\"DBT_WARN_ERROR\")\n-        os.environ.pop(\"DBT_WARN_ERROR_OPTIONS\")\n-\n-        # options from user config + args\n-        self.user_config.warn_error = False\n-        setattr(self.args, \"warn_error_options\", '{\"include\":\"all\"}')\n-        with pytest.raises(ValueError):\n-            flags.set_from_args(self.args, self.user_config)\n-        # cleanup\n-        self.user_config.warn_error = None\n-        delattr(self.args, \"warn_error_options\")\n-\n-        # options from user config + environ\n-        self.user_config.warn_error = False\n-        os.environ[\"DBT_WARN_ERROR_OPTIONS\"] = '{\"include\": []}'\n-        with pytest.raises(ValueError):\n-            flags.set_from_args(self.args, self.user_config)\n-        # cleanup\n-        self.user_config.warn_error = None\n-        os.environ.pop(\"DBT_WARN_ERROR_OPTIONS\")\n-\n-        # options from args + environ\n-        setattr(self.args, \"warn_error\", False)\n-        os.environ[\"DBT_WARN_ERROR_OPTIONS\"] = '{\"include\": []}'\n-        with pytest.raises(ValueError):\n-            flags.set_from_args(self.args, self.user_config)\n-        # cleanup\n-        delattr(self.args, \"warn_error\")\n-        os.environ.pop(\"DBT_WARN_ERROR_OPTIONS\")\n```\n\nFilename: tests/unit/test_graph.py:\n```\n@@ -16,6 +16,7 @@\nimport dbt.parser.manifest\n from dbt import tracking\n from dbt.contracts.files import SourceFile, FileHash, FilePath\n+from dbt.contracts.project import ProjectFlags\n from dbt.contracts.graph.manifest import MacroManifest, ManifestStateCheck\n from dbt.graph import NodeSelector, parse_difference\n from dbt.events.functions import setup_event_logger\n\n@@ -140,7 +141,7 @@\ndef get_config(self, extra_cfg=None):\n         cfg.update(extra_cfg)\n \n         config = config_from_parts_or_dicts(project=cfg, profile=self.profile)\n-        dbt.flags.set_from_args(Namespace(), config)\n+        dbt.flags.set_from_args(Namespace(), ProjectFlags())\n         setup_event_logger(dbt.flags.get_flags())\n         object.__setattr__(dbt.flags.get_flags(), \"PARTIAL_PARSE\", False)\n         return config\n```\n\nFilename: tests/unit/test_graph_selection.py:\n```\n@@ -13,9 +13,9 @@\nfrom dbt import flags\n \n from argparse import Namespace\n-from dbt.contracts.project import UserConfig\n+from dbt.contracts.project import ProjectFlags\n \n-flags.set_from_args(Namespace(), UserConfig())\n+flags.set_from_args(Namespace(), ProjectFlags())\n \n \n def _get_graph():\n```\n\nFilename: tests/unit/test_manifest.py:\n```\n@@ -1224,7 +1224,7 @@\ndef test_find_generate_macros_by_name(macros, expectations):\n FindMaterializationSpec = namedtuple(\"FindMaterializationSpec\", \"macros,adapter_type,expected\")\n \n \n-def _materialization_parameter_sets():\n+def _materialization_parameter_sets_legacy():\n     # inject the plugins used for materialization parameter tests\n     with mock.patch(\"dbt.adapters.base.plugin.project_name_from_path\") as get_name:\n         get_name.return_value = \"foo\"\n\n@@ -1371,12 +1371,187 @@\ndef id_mat(arg):\n         return \"_\".join(arg)\n \n \n+@pytest.mark.parametrize(\n+    \"macros,adapter_type,expected\",\n+    _materialization_parameter_sets_legacy(),\n+    ids=id_mat,\n+)\n+def test_find_materialization_by_name_legacy(macros, adapter_type, expected):\n+    set_from_args(\n+        Namespace(\n+            SEND_ANONYMOUS_USAGE_STATS=False,\n+            REQUIRE_EXPLICIT_PACKAGE_OVERRIDES_FOR_BUILTIN_MATERIALIZATIONS=False,\n+        ),\n+        None,\n+    )\n+\n+    manifest = make_manifest(macros=macros)\n+    result = manifest.find_materialization_macro_by_name(\n+        project_name=\"root\",\n+        materialization_name=\"my_materialization\",\n+        adapter_type=adapter_type,\n+    )\n+    if expected is None:\n+        assert result is expected\n+    else:\n+        expected_package, expected_adapter_type = expected\n+        assert result.adapter_type == expected_adapter_type\n+        assert result.package_name == expected_package\n+\n+\n+def _materialization_parameter_sets():\n+    # inject the plugins used for materialization parameter tests\n+    with mock.patch(\"dbt.adapters.base.plugin.project_name_from_path\") as get_name:\n+        get_name.return_value = \"foo\"\n+        FooPlugin = AdapterPlugin(\n+            adapter=mock.MagicMock(),\n+            credentials=mock.MagicMock(),\n+            include_path=\"/path/to/root/plugin\",\n+        )\n+        FooPlugin.adapter.type.return_value = \"foo\"\n+        inject_plugin(FooPlugin)\n+\n+        BarPlugin = AdapterPlugin(\n+            adapter=mock.MagicMock(),\n+            credentials=mock.MagicMock(),\n+            include_path=\"/path/to/root/plugin\",\n+            dependencies=[\"foo\"],\n+        )\n+        BarPlugin.adapter.type.return_value = \"bar\"\n+        inject_plugin(BarPlugin)\n+\n+        sets = [\n+            FindMaterializationSpec(macros=[], adapter_type=\"foo\", expected=None),\n+        ]\n+\n+        # default only, each project\n+        sets.extend(\n+            FindMaterializationSpec(\n+                macros=[MockMaterialization(project, adapter_type=None)],\n+                adapter_type=\"foo\",\n+                expected=(project, \"default\"),\n+            )\n+            for project in [\"root\", \"dep\", \"dbt\"]\n+        )\n+\n+        # other type only, each project\n+        sets.extend(\n+            FindMaterializationSpec(\n+                macros=[MockMaterialization(project, adapter_type=\"bar\")],\n+                adapter_type=\"foo\",\n+                expected=None,\n+            )\n+            for project in [\"root\", \"dep\", \"dbt\"]\n+        )\n+\n+        # matching type only, each project\n+        sets.extend(\n+            FindMaterializationSpec(\n+                macros=[MockMaterialization(project, adapter_type=\"foo\")],\n+                adapter_type=\"foo\",\n+                expected=(project, \"foo\"),\n+            )\n+            for project in [\"root\", \"dep\", \"dbt\"]\n+        )\n+\n+        sets.extend(\n+            [\n+                # matching type and default everywhere\n+                FindMaterializationSpec(\n+                    macros=[\n+                        MockMaterialization(project, adapter_type=atype)\n+                        for (project, atype) in product([\"root\", \"dep\", \"dbt\"], [\"foo\", None])\n+                    ],\n+                    adapter_type=\"foo\",\n+                    expected=(\"root\", \"foo\"),\n+                ),\n+                # default in core, override is in dep, and root has unrelated override\n+                # should find the dbt default because default materializations cannot be overwritten by packages.\n+                FindMaterializationSpec(\n+                    macros=[\n+                        MockMaterialization(\"root\", adapter_type=\"bar\"),\n+                        MockMaterialization(\"dep\", adapter_type=\"foo\"),\n+                        MockMaterialization(\"dbt\", adapter_type=None),\n+                    ],\n+                    adapter_type=\"foo\",\n+                    expected=(\"dbt\", \"default\"),\n+                ),\n+                # default in core, unrelated override is in dep, and root has an override\n+                # should find the root override.\n+                FindMaterializationSpec(\n+                    macros=[\n+                        MockMaterialization(\"root\", adapter_type=\"foo\"),\n+                        MockMaterialization(\"dep\", adapter_type=\"bar\"),\n+                        MockMaterialization(\"dbt\", adapter_type=None),\n+                    ],\n+                    adapter_type=\"foo\",\n+                    expected=(\"root\", \"foo\"),\n+                ),\n+                # default in core, override is in dep, and root has an override too.\n+                # should find the root override.\n+                FindMaterializationSpec(\n+                    macros=[\n+                        MockMaterialization(\"root\", adapter_type=\"foo\"),\n+                        MockMaterialization(\"dep\", adapter_type=\"foo\"),\n+                        MockMaterialization(\"dbt\", adapter_type=None),\n+                    ],\n+                    adapter_type=\"foo\",\n+                    expected=(\"root\", \"foo\"),\n+                ),\n+                # core has default + adapter, dep has adapter, root has default\n+                # should find the default adapter implementation, because it's the most specific\n+                # and default materializations cannot be overwritten by packages\n+                FindMaterializationSpec(\n+                    macros=[\n+                        MockMaterialization(\"root\", adapter_type=None),\n+                        MockMaterialization(\"dep\", adapter_type=\"foo\"),\n+                        MockMaterialization(\"dbt\", adapter_type=None),\n+                        MockMaterialization(\"dbt\", adapter_type=\"foo\"),\n+                    ],\n+                    adapter_type=\"foo\",\n+                    expected=(\"dbt\", \"foo\"),\n+                ),\n+            ]\n+        )\n+\n+        # inherit from parent adapter\n+        sets.extend(\n+            FindMaterializationSpec(\n+                macros=[MockMaterialization(project, adapter_type=\"foo\")],\n+                adapter_type=\"bar\",\n+                expected=(project, \"foo\"),\n+            )\n+            for project in [\"root\", \"dep\", \"dbt\"]\n+        )\n+        sets.extend(\n+            FindMaterializationSpec(\n+                macros=[\n+                    MockMaterialization(project, adapter_type=\"foo\"),\n+                    MockMaterialization(project, adapter_type=\"bar\"),\n+                ],\n+                adapter_type=\"bar\",\n+                expected=(project, \"bar\"),\n+            )\n+            for project in [\"root\", \"dep\", \"dbt\"]\n+        )\n+\n+        return sets\n+\n+\n @pytest.mark.parametrize(\n     \"macros,adapter_type,expected\",\n     _materialization_parameter_sets(),\n     ids=id_mat,\n )\n def test_find_materialization_by_name(macros, adapter_type, expected):\n+    set_from_args(\n+        Namespace(\n+            SEND_ANONYMOUS_USAGE_STATS=False,\n+            REQUIRE_EXPLICIT_PACKAGE_OVERRIDES_FOR_BUILTIN_MATERIALIZATIONS=True,\n+        ),\n+        None,\n+    )\n+\n     manifest = make_manifest(macros=macros)\n     result = manifest.find_materialization_macro_by_name(\n         project_name=\"root\",\n```"
            },
            {
                "url": "https://github.com/dbt-labs/dbt-core/commit/87ac4deb00cc9fe334706e42a365903a1d581624",
                "content": "[Backport] deprecate materialization overrides from imported packages (#9998)\n\nFilename: .changes/unreleased/Features-20231218-195854.yaml:\n```\n@@ -0,0 +1,6 @@\n+kind: Features\n+body: Move flags from UserConfig in profiles.yml to flags in dbt_project.yml\n+time: 2023-12-18T19:58:54.075811-05:00\n+custom:\n+  Author: gshank\n+  Issue: \"9183\"\n```\n\nFilename: .changes/unreleased/Features-20240422-173703.yaml:\n```\n@@ -0,0 +1,6 @@\n+kind: Features\n+body: Add require_explicit_package_overrides_for_builtin_materializations to dbt_project.yml flags, which can be used to opt-out of overriding built-in materializations from packages\n+time: 2024-04-22T17:37:03.892268-04:00\n+custom:\n+  Author: michelleark\n+  Issue: \"10007\"\n```\n\nFilename: .changes/unreleased/Under the Hood-20240418-172528.yaml:\n```\n@@ -0,0 +1,6 @@\n+kind: Under the Hood\n+body: Raise deprecation warning if installed package overrides built-in materialization\n+time: 2024-04-18T17:25:28.37886-04:00\n+custom:\n+  Author: michelleark\n+  Issue: \"9971\"\n```\n\nFilename: core/dbt/cli/flags.py:\n```\n@@ -3,6 +3,7 @@\nfrom dataclasses import dataclass\n from importlib import import_module\n from multiprocessing import get_context\n+from pathlib import Path\n from pprint import pformat as pf\n from typing import Any, Callable, Dict, List, Optional, Set, Union\n\n@@ -11,8 +12,8 @@\nfrom dbt.cli.exceptions import DbtUsageException\n from dbt.cli.resolvers import default_log_path, default_project_dir\n from dbt.cli.types import Command as CliCommand\n-from dbt.config.profile import read_user_config\n-from dbt.contracts.project import UserConfig\n+from dbt.config.project import read_project_flags\n+from dbt.contracts.project import ProjectFlags\n from dbt.exceptions import DbtInternalError\n from dbt.deprecations import renamed_env_var\n from dbt.helper_types import WarnErrorOptions\n\n@@ -25,7 +26,7 @@\n\"INDIRECT_SELECTION\": \"eager\",\n     \"TARGET_PATH\": None,\n     \"WARN_ERROR\": None,\n-    # Cli args without user_config or env var option.\n+    # Cli args without project_flags or env var option.\n     \"FULL_REFRESH\": False,\n     \"STRICT_MODE\": False,\n     \"STORE_FAILURES\": False,\n\n@@ -77,7 +78,7 @@\nclass Flags:\n     \"\"\"Primary configuration artifact for running dbt\"\"\"\n \n     def __init__(\n-        self, ctx: Optional[Context] = None, user_config: Optional[UserConfig] = None\n+        self, ctx: Optional[Context] = None, project_flags: Optional[ProjectFlags] = None\n     ) -> None:\n         # Set the default flags.\n         for key, value in FLAGS_DEFAULTS.items():\n\n@@ -200,27 +201,40 @@\ndef _assign_params(\n                 invoked_subcommand_ctx, params_assigned_from_default, deprecated_env_vars\n             )\n \n-        if not user_config:\n+        if not project_flags:\n+            project_dir = getattr(self, \"PROJECT_DIR\", str(default_project_dir()))\n             profiles_dir = getattr(self, \"PROFILES_DIR\", None)\n-            user_config = read_user_config(profiles_dir) if profiles_dir else None\n+            if profiles_dir and project_dir:\n+                project_flags = read_project_flags(project_dir, profiles_dir)\n+            else:\n+                project_flags = None\n \n         # Add entire invocation command to flags\n         object.__setattr__(self, \"INVOCATION_COMMAND\", \"dbt \" + \" \".join(sys.argv[1:]))\n \n-        # Overwrite default assignments with user config if available.\n-        if user_config:\n+        if project_flags:\n+            # Overwrite default assignments with project flags if available.\n             param_assigned_from_default_copy = params_assigned_from_default.copy()\n             for param_assigned_from_default in params_assigned_from_default:\n-                user_config_param_value = getattr(user_config, param_assigned_from_default, None)\n-                if user_config_param_value is not None:\n+                project_flags_param_value = getattr(\n+                    project_flags, param_assigned_from_default, None\n+                )\n+                if project_flags_param_value is not None:\n                     object.__setattr__(\n                         self,\n                         param_assigned_from_default.upper(),\n-                        convert_config(param_assigned_from_default, user_config_param_value),\n+                        convert_config(param_assigned_from_default, project_flags_param_value),\n                     )\n                     param_assigned_from_default_copy.remove(param_assigned_from_default)\n             params_assigned_from_default = param_assigned_from_default_copy\n \n+            # Add project-level flags that are not available as CLI options / env vars\n+            for (\n+                project_level_flag_name,\n+                project_level_flag_value,\n+            ) in project_flags.project_only_flags.items():\n+                object.__setattr__(self, project_level_flag_name.upper(), project_level_flag_value)\n+\n         # Set hard coded flags.\n         object.__setattr__(self, \"WHICH\", invoked_subcommand_name or ctx.info_name)\n         object.__setattr__(self, \"MP_CONTEXT\", get_context(\"spawn\"))\n\n@@ -234,9 +248,11 @@\ndef _assign_params(\n         # Starting in v1.5, if `log-path` is set in `dbt_project.yml`, it will raise a deprecation warning,\n         # with the possibility of removing it in a future release.\n         if getattr(self, \"LOG_PATH\", None) is None:\n-            project_dir = getattr(self, \"PROJECT_DIR\", default_project_dir())\n+            project_dir = getattr(self, \"PROJECT_DIR\", str(default_project_dir()))\n             version_check = getattr(self, \"VERSION_CHECK\", True)\n-            object.__setattr__(self, \"LOG_PATH\", default_log_path(project_dir, version_check))\n+            object.__setattr__(\n+                self, \"LOG_PATH\", default_log_path(Path(project_dir), version_check)\n+            )\n \n         # Support console DO NOT TRACK initiative.\n         if os.getenv(\"DO_NOT_TRACK\", \"\").lower() in (\"1\", \"t\", \"true\", \"y\", \"yes\"):\n```\n\nFilename: core/dbt/config/__init__.py:\n```\n@@ -1,4 +1,4 @@\n# all these are just exports, they need \"noqa\" so flake8 will not complain.\n-from .profile import Profile, read_user_config  # noqa\n+from .profile import Profile  # noqa\n from .project import Project, IsFQNResource, PartialProject  # noqa\n from .runtime import RuntimeConfig  # noqa\n```\n\nFilename: core/dbt/config/profile.py:\n```\n@@ -8,7 +8,7 @@\nfrom dbt.clients.system import load_file_contents\n from dbt.clients.yaml_helper import load_yaml_text\n from dbt.contracts.connection import Credentials, HasCredentials\n-from dbt.contracts.project import ProfileConfig, UserConfig\n+from dbt.contracts.project import ProfileConfig\n from dbt.exceptions import (\n     CompilationError,\n     DbtProfileError,\n\n@@ -19,7 +19,6 @@\n)\n from dbt.events.types import MissingProfileTarget\n from dbt.events.functions import fire_event\n-from dbt.utils import coerce_dict_str\n \n from .renderer import ProfileRenderer\n\n@@ -51,27 +50,13 @@\ndef read_profile(profiles_dir: str) -> Dict[str, Any]:\n     return {}\n \n \n-def read_user_config(directory: str) -> UserConfig:\n-    try:\n-        profile = read_profile(directory)\n-        if profile:\n-            user_config = coerce_dict_str(profile.get(\"config\", {}))\n-            if user_config is not None:\n-                UserConfig.validate(user_config)\n-                return UserConfig.from_dict(user_config)\n-    except (DbtRuntimeError, ValidationError):\n-        pass\n-    return UserConfig()\n-\n-\n # The Profile class is included in RuntimeConfig, so any attribute\n # additions must also be set where the RuntimeConfig class is created\n # `init=False` is a workaround for https://bugs.python.org/issue45081\n @dataclass(init=False)\n class Profile(HasCredentials):\n     profile_name: str\n     target_name: str\n-    user_config: UserConfig\n     threads: int\n     credentials: Credentials\n     profile_env_vars: Dict[str, Any]\n\n@@ -80,7 +65,6 @@\ndef __init__(\n         self,\n         profile_name: str,\n         target_name: str,\n-        user_config: UserConfig,\n         threads: int,\n         credentials: Credentials,\n     ) -> None:\n\n@@ -89,7 +73,6 @@\ndef __init__(\n         \"\"\"\n         self.profile_name = profile_name\n         self.target_name = target_name\n-        self.user_config = user_config\n         self.threads = threads\n         self.credentials = credentials\n         self.profile_env_vars = {}  # never available on init\n\n@@ -106,12 +89,10 @@\ndef to_profile_info(self, serialize_credentials: bool = False) -> Dict[str, Any]\n         result = {\n             \"profile_name\": self.profile_name,\n             \"target_name\": self.target_name,\n-            \"user_config\": self.user_config,\n             \"threads\": self.threads,\n             \"credentials\": self.credentials,\n         }\n         if serialize_credentials:\n-            result[\"user_config\"] = self.user_config.to_dict(omit_none=True)\n             result[\"credentials\"] = self.credentials.to_dict(omit_none=True)\n         return result\n\n@@ -124,7 +105,6 @@\ndef to_target_dict(self) -> Dict[str, Any]:\n                 \"name\": self.target_name,\n                 \"target_name\": self.target_name,\n                 \"profile_name\": self.profile_name,\n-                \"config\": self.user_config.to_dict(omit_none=True),\n             }\n         )\n         return target\n\n@@ -246,7 +226,6 @@\ndef from_credentials(\n         threads: int,\n         profile_name: str,\n         target_name: str,\n-        user_config: Optional[Dict[str, Any]] = None,\n     ) -> \"Profile\":\n         \"\"\"Create a profile from an existing set of Credentials and the\n         remaining information.\n\n@@ -255,20 +234,13 @@\ndef from_credentials(\n         :param threads: The number of threads to use for connections.\n         :param profile_name: The profile name used for this profile.\n         :param target_name: The target name used for this profile.\n-        :param user_config: The user-level config block from the\n-            raw profiles, if specified.\n         :raises DbtProfileError: If the profile is invalid.\n         :returns: The new Profile object.\n         \"\"\"\n-        if user_config is None:\n-            user_config = {}\n-        UserConfig.validate(user_config)\n-        user_config_obj: UserConfig = UserConfig.from_dict(user_config)\n \n         profile = cls(\n             profile_name=profile_name,\n             target_name=target_name,\n-            user_config=user_config_obj,\n             threads=threads,\n             credentials=credentials,\n         )\n\n@@ -316,7 +288,6 @@\ndef from_raw_profile_info(\n         raw_profile: Dict[str, Any],\n         profile_name: str,\n         renderer: ProfileRenderer,\n-        user_config: Optional[Dict[str, Any]] = None,\n         target_override: Optional[str] = None,\n         threads_override: Optional[int] = None,\n     ) -> \"Profile\":\n\n@@ -328,8 +299,6 @@\ndef from_raw_profile_info(\n             disk as yaml and its values rendered with jinja.\n         :param profile_name: The profile name used.\n         :param renderer: The config renderer.\n-        :param user_config: The global config for the user, if it\n-            was present.\n         :param target_override: The target to use, if provided on\n             the command line.\n         :param threads_override: The thread count to use, if\n\n@@ -338,9 +307,6 @@\ndef from_raw_profile_info(\n             target could not be found\n         :returns: The new Profile object.\n         \"\"\"\n-        # user_config is not rendered.\n-        if user_config is None:\n-            user_config = raw_profile.get(\"config\")\n         # TODO: should it be, and the values coerced to bool?\n         target_name, profile_data = cls.render_profile(\n             raw_profile, profile_name, target_override, renderer\n\n@@ -361,7 +327,6 @@\ndef from_raw_profile_info(\n             profile_name=profile_name,\n             target_name=target_name,\n             threads=threads,\n-            user_config=user_config,\n         )\n \n     @classmethod\n\n@@ -396,13 +361,11 @@\ndef from_raw_profiles(\n         if not raw_profile:\n             msg = f\"Profile {profile_name} in profiles.yml is empty\"\n             raise DbtProfileError(INVALID_PROFILE_MESSAGE.format(error_string=msg))\n-        user_config = raw_profiles.get(\"config\")\n \n         return cls.from_raw_profile_info(\n             raw_profile=raw_profile,\n             profile_name=profile_name,\n             renderer=renderer,\n-            user_config=user_config,\n             target_override=target_override,\n             threads_override=threads_override,\n         )\n```\n\nFilename: core/dbt/config/project.py:\n```\n@@ -20,6 +20,7 @@\nDEPENDENCIES_FILE_NAME,\n     PACKAGES_FILE_NAME,\n     PACKAGE_LOCK_HASH_KEY,\n+    DBT_PROJECT_FILE_NAME,\n )\n from dbt.clients.system import path_exists, load_file_contents\n from dbt.clients.yaml_helper import load_yaml_text\n\n@@ -35,12 +36,13 @@\nfrom dbt.helper_types import NoValue\n from dbt.semver import VersionSpecifier, versions_compatible\n from dbt.version import get_installed_version\n-from dbt.utils import MultiDict, md5\n+from dbt.utils import MultiDict, md5, coerce_dict_str\n from dbt.node_types import NodeType\n from dbt.config.selectors import SelectorDict\n from dbt.contracts.project import (\n     Project as ProjectContract,\n     SemverString,\n+    ProjectFlags,\n )\n from dbt.contracts.project import PackageConfig, ProjectPackageMetadata\n from dbt.dataclass_schema import ValidationError\n\n@@ -81,8 +83,8 @@\n\"\"\"\n \n MISSING_DBT_PROJECT_ERROR = \"\"\"\\\n-No dbt_project.yml found at expected path {path}\n-Verify that each entry within packages.yml (and their transitive dependencies) contains a file named dbt_project.yml\n+No {DBT_PROJECT_FILE_NAME} found at expected path {path}\n+Verify that each entry within packages.yml (and their transitive dependencies) contains a file named {DBT_PROJECT_FILE_NAME}\n \"\"\"\n\n@@ -199,16 +201,20 @@\ndef value_or(value: Optional[T], default: T) -> T:\n def load_raw_project(project_root: str) -> Dict[str, Any]:\n \n     project_root = os.path.normpath(project_root)\n-    project_yaml_filepath = os.path.join(project_root, \"dbt_project.yml\")\n+    project_yaml_filepath = os.path.join(project_root, DBT_PROJECT_FILE_NAME)\n \n     # get the project.yml contents\n     if not path_exists(project_yaml_filepath):\n-        raise DbtProjectError(MISSING_DBT_PROJECT_ERROR.format(path=project_yaml_filepath))\n+        raise DbtProjectError(\n+            MISSING_DBT_PROJECT_ERROR.format(\n+                path=project_yaml_filepath, DBT_PROJECT_FILE_NAME=DBT_PROJECT_FILE_NAME\n+            )\n+        )\n \n     project_dict = _load_yaml(project_yaml_filepath)\n \n     if not isinstance(project_dict, dict):\n-        raise DbtProjectError(\"dbt_project.yml does not parse to a dictionary\")\n+        raise DbtProjectError(f\"{DBT_PROJECT_FILE_NAME} does not parse to a dictionary\")\n \n     return project_dict\n\n@@ -323,21 +329,21 @@\ndef get_rendered(\n             selectors_dict=rendered_selectors,\n         )\n \n-    # Called by Project.from_project_root (not PartialProject.from_project_root!)\n+    # Called by Project.from_project_root which first calls PartialProject.from_project_root\n     def render(self, renderer: DbtProjectYamlRenderer) -> \"Project\":\n         try:\n             rendered = self.get_rendered(renderer)\n             return self.create_project(rendered)\n         except DbtProjectError as exc:\n             if exc.path is None:\n-                exc.path = os.path.join(self.project_root, \"dbt_project.yml\")\n+                exc.path = os.path.join(self.project_root, DBT_PROJECT_FILE_NAME)\n             raise\n \n     def render_package_metadata(self, renderer: PackageRenderer) -> ProjectPackageMetadata:\n         packages_data = renderer.render_data(self.packages_dict)\n         packages_config = package_config_from_data(packages_data, self.packages_dict)\n         if not self.project_name:\n-            raise DbtProjectError(\"Package dbt_project.yml must have a name!\")\n+            raise DbtProjectError(f\"Package defined in {DBT_PROJECT_FILE_NAME} must have a name!\")\n         return ProjectPackageMetadata(self.project_name, packages_config.packages)\n \n     def check_config_path(\n\n@@ -348,7 +354,7 @@\ndef check_config_path(\n                 msg = (\n                     \"{deprecated_path} and {expected_path} cannot both be defined. The \"\n                     \"`{deprecated_path}` config has been deprecated in favor of `{expected_path}`. \"\n-                    \"Please update your `dbt_project.yml` configuration to reflect this \"\n+                    f\"Please update your `{DBT_PROJECT_FILE_NAME}` configuration to reflect this \"\n                     \"change.\"\n                 )\n                 raise DbtProjectError(\n\n@@ -420,11 +426,11 @@\ndef create_project(self, rendered: RenderComponents) -> \"Project\":\n \n         docs_paths: List[str] = value_or(cfg.docs_paths, all_source_paths)\n         asset_paths: List[str] = value_or(cfg.asset_paths, [])\n-        flags = get_flags()\n+        global_flags = get_flags()\n \n-        flag_target_path = str(flags.TARGET_PATH) if flags.TARGET_PATH else None\n+        flag_target_path = str(global_flags.TARGET_PATH) if global_flags.TARGET_PATH else None\n         target_path: str = flag_or(flag_target_path, cfg.target_path, \"target\")\n-        log_path: str = str(flags.LOG_PATH)\n+        log_path: str = str(global_flags.LOG_PATH)\n \n         clean_targets: List[str] = value_or(cfg.clean_targets, [target_path])\n         packages_install_path: str = value_or(cfg.packages_install_path, \"dbt_packages\")\n\n@@ -569,6 +575,11 @@\ndef from_project_root(\n         ) = package_and_project_data_from_root(project_root)\n         selectors_dict = selector_data_from_root(project_root)\n \n+        if \"flags\" in project_dict:\n+            # We don't want to include \"flags\" in the Project,\n+            # it goes in ProjectFlags\n+            project_dict.pop(\"flags\")\n+\n         return cls.from_dicts(\n             project_root=project_root,\n             project_dict=project_dict,\n\n@@ -709,7 +720,6 @@\ndef to_project_config(self, with_packages=False):\n                 \"exposures\": self.exposures,\n                 \"vars\": self.vars.to_dict(),\n                 \"require-dbt-version\": [v.to_version_string() for v in self.dbt_version],\n-                \"config-version\": self.config_version,\n                 \"restrict-access\": self.restrict_access,\n                 \"dbt-cloud\": self.dbt_cloud,\n             }\n\n@@ -773,3 +783,52 @@\ndef get_macro_search_order(self, macro_namespace: str):\n     def project_target_path(self):\n         # If target_path is absolute, project_root will not be included\n         return os.path.join(self.project_root, self.target_path)\n+\n+\n+def read_project_flags(project_dir: str, profiles_dir: str) -> ProjectFlags:\n+    try:\n+        project_flags: Dict[str, Any] = {}\n+        # Read project_flags from dbt_project.yml first\n+        # Flags are instantiated before the project, so we don't\n+        # want to throw an error for non-existence of dbt_project.yml here\n+        # because it breaks things.\n+        project_root = os.path.normpath(project_dir)\n+        project_yaml_filepath = os.path.join(project_root, DBT_PROJECT_FILE_NAME)\n+        if path_exists(project_yaml_filepath):\n+            try:\n+                project_dict = load_raw_project(project_root)\n+                if \"flags\" in project_dict:\n+                    project_flags = project_dict.pop(\"flags\")\n+            except Exception:\n+                # This is probably a yaml load error.The error will be reported\n+                # later, when the project loads.\n+                pass\n+\n+        from dbt.config.profile import read_profile\n+\n+        profile = read_profile(profiles_dir)\n+        profile_project_flags: Optional[Dict[str, Any]] = {}\n+        if profile:\n+            profile_project_flags = coerce_dict_str(profile.get(\"config\", {}))\n+\n+        if project_flags and profile_project_flags:\n+            raise DbtProjectError(\n+                f\"Do not specify both 'config' in profiles.yml and 'flags' in {DBT_PROJECT_FILE_NAME}. \"\n+                \"Using 'config' in profiles.yml is deprecated.\"\n+            )\n+\n+        if profile_project_flags:\n+            # This can't use WARN_ERROR or WARN_ERROR_OPTIONS because they're in\n+            # the config that we're loading. Uses special \"warn\" method.\n+            deprecations.warn(\"project-flags-moved\")\n+            project_flags = profile_project_flags\n+\n+        if project_flags is not None:\n+            ProjectFlags.validate(project_flags)\n+            return ProjectFlags.from_dict(project_flags)\n+    except (DbtProjectError) as exc:\n+        # We don't want to eat the DbtProjectError for UserConfig to ProjectFlags\n+        raise exc\n+    except (DbtRuntimeError, ValidationError):\n+        pass\n+    return ProjectFlags()\n```\n\nFilename: core/dbt/config/runtime.py:\n```\n@@ -20,7 +20,7 @@\nfrom dbt.config.project import load_raw_project\n from dbt.contracts.connection import AdapterRequiredConfig, Credentials, HasCredentials\n from dbt.contracts.graph.manifest import ManifestMetadata\n-from dbt.contracts.project import Configuration, UserConfig\n+from dbt.contracts.project import Configuration\n from dbt.contracts.relation import ComponentName\n from dbt.dataclass_schema import ValidationError\n from dbt.events.functions import warn_or_error\n\n@@ -178,7 +178,6 @@\ndef from_parts(\n             profile_env_vars=profile.profile_env_vars,\n             profile_name=profile.profile_name,\n             target_name=profile.target_name,\n-            user_config=profile.user_config,\n             threads=profile.threads,\n             credentials=profile.credentials,\n             args=args,\n\n@@ -432,7 +431,6 @@\ndef _connection_keys(self):\n class UnsetProfile(Profile):\n     def __init__(self):\n         self.credentials = UnsetCredentials()\n-        self.user_config = UserConfig()  # This will be read in _get_rendered_profile\n         self.profile_name = \"\"\n         self.target_name = \"\"\n         self.threads = -1\n```\n\nFilename: core/dbt/contracts/connection.py:\n```\n@@ -178,17 +178,9 @@\ndef __post_serialize__(self, dct):\n         return dct\n \n \n-class UserConfigContract(Protocol):\n-    send_anonymous_usage_stats: bool\n-    use_colors: Optional[bool] = None\n-    partial_parse: Optional[bool] = None\n-    printer_width: Optional[int] = None\n-\n-\n class HasCredentials(Protocol):\n     credentials: Credentials\n     profile_name: str\n-    user_config: UserConfigContract\n     target_name: str\n     threads: int\n```\n\nFilename: core/dbt/contracts/graph/manifest.py:\n```\n@@ -25,6 +25,7 @@\nfrom typing_extensions import Protocol\n from uuid import UUID\n \n+\n from dbt.contracts.graph.nodes import (\n     BaseNode,\n     Documentation,\n\n@@ -67,7 +68,7 @@\nfrom dbt.events.contextvars import get_node_info\n from dbt.node_types import NodeType, AccessType\n from dbt.flags import get_flags, MP_CONTEXT\n-from dbt import tracking\n+from dbt import tracking, deprecations\n import dbt.utils\n\n@@ -616,11 +617,29 @@\ndef __lt__(self, other: object) -> bool:\n \n \n class CandidateList(List[M]):\n-    def last(self) -> Optional[Macro]:\n+    def last_candidate(\n+        self, valid_localities: Optional[List[Locality]] = None\n+    ) -> Optional[MacroCandidate]:\n+        \"\"\"\n+        Obtain the last (highest precedence) MacroCandidate from the CandidateList of any locality in valid_localities.\n+        If valid_localities is not specified, return the last MacroCandidate of any locality.\n+        \"\"\"\n         if not self:\n             return None\n         self.sort()\n-        return self[-1].macro\n+\n+        if valid_localities is None:\n+            return self[-1]\n+\n+        for candidate in reversed(self):\n+            if candidate.locality in valid_localities:\n+                return candidate\n+\n+        return None\n+\n+    def last(self) -> Optional[Macro]:\n+        last_candidate = self.last_candidate()\n+        return last_candidate.macro if last_candidate is not None else None\n \n \n def _get_locality(macro: Macro, root_project_name: str, internal_packages: Set[str]) -> Locality:\n\n@@ -914,7 +933,33 @@\ndef find_materialization_macro_by_name(\n                 for specificity, atype in enumerate(self._get_parent_adapter_types(adapter_type))\n             )\n         )\n-        return candidates.last()\n+        core_candidates = [\n+            candidate for candidate in candidates if candidate.locality == Locality.Core\n+        ]\n+\n+        materialization_candidate = candidates.last_candidate()\n+        # If an imported materialization macro was found that also had a core candidate, fire a deprecation\n+        if (\n+            materialization_candidate is not None\n+            and materialization_candidate.locality == Locality.Imported\n+            and core_candidates\n+        ):\n+            # preserve legacy behaviour - allow materialization override\n+            if (\n+                get_flags().require_explicit_package_overrides_for_builtin_materializations\n+                is False\n+            ):\n+                deprecations.warn(\n+                    \"package-materialization-override\",\n+                    package_name=materialization_candidate.macro.package_name,\n+                    materialization_name=materialization_name,\n+                )\n+            else:\n+                materialization_candidate = candidates.last_candidate(\n+                    valid_localities=[Locality.Core, Locality.Root]\n+                )\n+\n+        return materialization_candidate.macro if materialization_candidate else None\n \n     def get_resource_fqns(self) -> Mapping[str, PathSet]:\n         resource_fqns: Dict[str, Set[Tuple[str, ...]]] = {}\n```\n\nFilename: core/dbt/contracts/project.py:\n```\n@@ -1,5 +1,5 @@\nfrom dbt.contracts.util import Replaceable, Mergeable, list_str, Identifier\n-from dbt.contracts.connection import QueryComment, UserConfigContract\n+from dbt.contracts.connection import QueryComment\n from dbt.helper_types import NoValue\n from dbt.dataclass_schema import (\n     dbtClassMixin,\n\n@@ -283,7 +283,7 @@\ndef validate(cls, data):\n \n \n @dataclass\n-class UserConfig(ExtensibleDbtClassMixin, Replaceable, UserConfigContract):\n+class ProjectFlags(ExtensibleDbtClassMixin, Replaceable):\n     cache_selected_only: Optional[bool] = None\n     debug: Optional[bool] = None\n     fail_fast: Optional[bool] = None\n\n@@ -295,6 +295,7 @@\nclass UserConfig(ExtensibleDbtClassMixin, Replaceable, UserConfigContract):\n     partial_parse: Optional[bool] = None\n     populate_cache: Optional[bool] = None\n     printer_width: Optional[int] = None\n+    require_explicit_package_overrides_for_builtin_materializations: bool = False\n     send_anonymous_usage_stats: bool = DEFAULT_SEND_ANONYMOUS_USAGE_STATS\n     static_parser: Optional[bool] = None\n     use_colors: Optional[bool] = None\n\n@@ -305,12 +306,17 @@\nclass UserConfig(ExtensibleDbtClassMixin, Replaceable, UserConfigContract):\n     warn_error_options: Optional[Dict[str, Union[str, List[str]]]] = None\n     write_json: Optional[bool] = None\n \n+    @property\n+    def project_only_flags(self) -> Dict[str, Any]:\n+        return {\n+            \"require_explicit_package_overrides_for_builtin_materializations\": self.require_explicit_package_overrides_for_builtin_materializations,\n+        }\n+\n \n @dataclass\n class ProfileConfig(dbtClassMixin, Replaceable):\n     profile_name: str\n     target_name: str\n-    user_config: UserConfig\n     threads: int\n     # TODO: make this a dynamic union of some kind?\n     credentials: Optional[Dict[str, Any]]\n```\n\nFilename: core/dbt/deprecations.py:\n```\n@@ -96,6 +96,25 @@\nclass CollectFreshnessReturnSignature(DBTDeprecation):\n     _event = \"CollectFreshnessReturnSignature\"\n \n \n+class ProjectFlagsMovedDeprecation(DBTDeprecation):\n+    _name = \"project-flags-moved\"\n+    _event = \"ProjectFlagsMovedDeprecation\"\n+\n+    def show(self, *args, **kwargs) -> None:\n+        if self.name not in active_deprecations:\n+            event = self.event(**kwargs)\n+            # We can't do warn_or_error because the ProjectFlags\n+            # is where that is set up and we're just reading it.\n+            dbt.events.functions.fire_event(event)\n+            self.track_deprecation_warn()\n+            active_deprecations.add(self.name)\n+\n+\n+class PackageMaterializationOverrideDeprecation(DBTDeprecation):\n+    _name = \"package-materialization-override\"\n+    _event = \"PackageMaterializationOverrideDeprecation\"\n+\n+\n def renamed_env_var(old_name: str, new_name: str):\n     class EnvironmentVariableRenamed(DBTDeprecation):\n         _name = f\"environment-variable-renamed:{old_name}\"\n\n@@ -134,6 +153,8 @@\ndef warn(name, *args, **kwargs):\n     ConfigLogPathDeprecation(),\n     ConfigTargetPathDeprecation(),\n     CollectFreshnessReturnSignature(),\n+    ProjectFlagsMovedDeprecation(),\n+    PackageMaterializationOverrideDeprecation(),\n ]\n \n deprecations: Dict[str, DBTDeprecation] = {d.name: d for d in deprecations_list}\n```\n\nFilename: core/dbt/events/types.proto:\n```\n@@ -415,6 +415,26 @@\nmessage CollectFreshnessReturnSignatureMsg {\n     CollectFreshnessReturnSignature data = 2;\n }\n \n+// D013\n+message ProjectFlagsMovedDeprecation {\n+}\n+\n+message ProjectFlagsMovedDeprecationMsg {\n+    EventInfo info = 1;\n+    ProjectFlagsMovedDeprecation data = 2;\n+}\n+\n+// D016\n+message PackageMaterializationOverrideDeprecation {\n+    string package_name = 1;\n+    string materialization_name = 2;\n+}\n+\n+message PackageMaterializationOverrideDeprecationMsg {\n+    EventInfo info = 1;\n+    PackageMaterializationOverrideDeprecation data = 2;\n+}\n+\n // E - DB Adapter\n \n // E001\n```\n\nFilename: core/dbt/events/types.py:\n```\n@@ -796,6 +796,29 @@\ndef message(self) -> str:\n         return line_wrap_message(warning_tag(msg))\n \n \n+class ProjectFlagsMovedDeprecation(WarnLevel):\n+    def code(self) -> str:\n+        return \"D013\"\n+\n+    def message(self) -> str:\n+        description = (\n+            \"User config should be moved from the 'config' key in profiles.yml to the 'flags' \"\n+            \"key in dbt_project.yml.\"\n+        )\n+        # Can't use line_wrap_message here because flags.printer_width isn't available yet\n+        return warning_tag(f\"Deprecated functionality\\n\\n{description}\")\n+\n+\n+class PackageMaterializationOverrideDeprecation(WarnLevel):\n+    def code(self) -> str:\n+        return \"D016\"\n+\n+    def message(self) -> str:\n+        description = f\"Installed package '{self.package_name}' is overriding the built-in materialization '{self.materialization_name}'. Overrides of built-in materializations from installed packages will be deprecated in future versions of dbt. Please refer to https://docs.getdbt.com/reference/global-configs/legacy-behaviors#require_explicit_package_overrides_for_builtin_materializations for detailed documentation and suggested workarounds.\"\n+\n+        return line_wrap_message(warning_tag(description))\n+\n+\n # =======================================================\n # I - Project parsing\n # =======================================================\n```\n\nFilename: core/dbt/events/types_pb2.py:\n```\n\n```\n\nFilename: core/dbt/flags.py:\n```\n@@ -39,23 +39,24 @@\ndef get_flags():\n     return GLOBAL_FLAGS\n \n \n-def set_from_args(args: Namespace, user_config):\n+def set_from_args(args: Namespace, project_flags):\n     global GLOBAL_FLAGS\n     from dbt.cli.main import cli\n     from dbt.cli.flags import Flags, convert_config\n \n-    # we set attributes of args after initialize the flags, but user_config\n+    # we set attributes of args after initialize the flags, but project_flags\n     # is being read in the Flags constructor, so we need to read it here and pass in\n-    # to make sure we use the correct user_config\n-    if (hasattr(args, \"PROFILES_DIR\") or hasattr(args, \"profiles_dir\")) and not user_config:\n-        from dbt.config.profile import read_user_config\n+    # to make sure we use the correct project_flags\n+    profiles_dir = getattr(args, \"PROFILES_DIR\", None) or getattr(args, \"profiles_dir\", None)\n+    project_dir = getattr(args, \"PROJECT_DIR\", None) or getattr(args, \"project_dir\", None)\n+    if profiles_dir and project_dir:\n+        from dbt.config.project import read_project_flags\n \n-        profiles_dir = getattr(args, \"PROFILES_DIR\", None) or getattr(args, \"profiles_dir\")\n-        user_config = read_user_config(profiles_dir)\n+        project_flags = read_project_flags(project_dir, profiles_dir)\n \n     # make a dummy context to get the flags, totally arbitrary\n     ctx = cli.make_context(\"run\", [\"run\"])\n-    flags = Flags(ctx, user_config)\n+    flags = Flags(ctx, project_flags)\n     for arg_name, args_param_value in vars(args).items():\n         args_param_value = convert_config(arg_name, args_param_value)\n         object.__setattr__(flags, arg_name.upper(), args_param_value)\n```\n\nFilename: core/dbt/include/starter_project/dbt_project.yml:\n```\n@@ -4,7 +4,6 @@\n# name or the intended use of these models\n name: '{project_name}'\n version: '1.0.0'\n-config-version: 2\n \n # This setting configures which \"profile\" dbt uses for this project.\n profile: '{profile_name}'\n```\n\nFilename: core/dbt/tests/fixtures/project.py:\n```\n@@ -142,7 +142,6 @@\ndef profiles_config_update():\n @pytest.fixture(scope=\"class\")\n def dbt_profile_data(unique_schema, dbt_profile_target, profiles_config_update):\n     profile = {\n-        \"config\": {\"send_anonymous_usage_stats\": False},\n         \"test\": {\n             \"outputs\": {\n                 \"default\": {},\n\n@@ -181,6 +180,7 @@\ndef dbt_project_yml(project_root, project_config_update):\n     project_config = {\n         \"name\": \"test\",\n         \"profile\": \"test\",\n+        \"flags\": {\"send_anonymous_usage_stats\": False},\n     }\n     if project_config_update:\n         if isinstance(project_config_update, dict):\n```\n\nFilename: core/dbt/tracking.py:\n```\n@@ -471,7 +471,6 @@\ndef process(self, record):\n \n \n def initialize_from_flags(send_anonymous_usage_stats, profiles_dir):\n-    # Setting these used to be in UserConfig, but had to be moved here\n     global active_user\n     if send_anonymous_usage_stats:\n         active_user = User(profiles_dir)\n```\n\nFilename: core/dbt/utils.py:\n```\n@@ -631,7 +631,7 @@\ndef _connection_exception_retry(fn, max_attempts: int, attempt: int = 0):\n def args_to_dict(args):\n     var_args = vars(args).copy()\n     # update the args with the flags, which could also come from environment\n-    # variables or user_config\n+    # variables or project_flags\n     flag_dict = flags.get_flag_dict()\n     var_args.update(flag_dict)\n     dict_args = {}\n```\n\nFilename: tests/functional/basic/test_mixed_case_db.py:\n```\n@@ -16,7 +16,6 @@\ndef models():\n def dbt_profile_data(unique_schema):\n \n     return {\n-        \"config\": {\"send_anonymous_usage_stats\": False},\n         \"test\": {\n             \"outputs\": {\n                 \"default\": {\n```\n\nFilename: tests/functional/basic/test_project.py:\n```\n@@ -77,11 +77,16 @@\ndef test_dbt_cloud(self, project):\n         conf = yaml.safe_load(\n             Path(os.path.join(project.project_root, \"dbt_project.yml\")).read_text()\n         )\n-        assert conf == {\"name\": \"test\", \"profile\": \"test\"}\n+        assert conf == {\n+            \"name\": \"test\",\n+            \"profile\": \"test\",\n+            \"flags\": {\"send_anonymous_usage_stats\": False},\n+        }\n \n         config = {\n             \"name\": \"test\",\n             \"profile\": \"test\",\n+            \"flags\": {\"send_anonymous_usage_stats\": False},\n             \"dbt-cloud\": {\n                 \"account_id\": \"123\",\n                 \"application\": \"test\",\n```\n\nFilename: tests/functional/configs/test_disabled_configs.py:\n```\n@@ -9,7 +9,6 @@\nclass TestDisabledConfigs(BaseConfigProject):\n     @pytest.fixture(scope=\"class\")\n     def dbt_profile_data(self, unique_schema):\n         return {\n-            \"config\": {\"send_anonymous_usage_stats\": False},\n             \"test\": {\n                 \"outputs\": {\n                     \"default\": {\n```\n\nFilename: tests/functional/dependencies/test_local_dependency.py:\n```\n@@ -243,6 +243,10 @@\nclass TestSimpleDependencyNoVersionCheckConfig(BaseDependencyTest):\n     @pytest.fixture(scope=\"class\")\n     def project_config_update(self):\n         return {\n+            \"flags\": {\n+                \"send_anonymous_usage_stats\": False,\n+                \"version_check\": False,\n+            },\n             \"models\": {\n                 \"schema\": \"dbt_test\",\n             },\n\n@@ -251,15 +255,6 @@\ndef project_config_update(self):\n             },\n         }\n \n-    @pytest.fixture(scope=\"class\")\n-    def profiles_config_update(self):\n-        return {\n-            \"config\": {\n-                \"send_anonymous_usage_stats\": False,\n-                \"version_check\": False,\n-            }\n-        }\n-\n     @pytest.fixture(scope=\"class\")\n     def macros(self):\n         return {\"macro.sql\": macros__macro_override_schema_sql}\n```\n\nFilename: tests/functional/deprecations/test_deprecations.py:\n```\n@@ -2,7 +2,8 @@\nfrom dbt import deprecations\n import dbt.exceptions\n-from dbt.tests.util import run_dbt\n+from dbt.tests.util import run_dbt, write_file\n+import yaml\n \n \n models__already_exists_sql = \"\"\"\n\n@@ -157,3 +158,31 @@\ndef test_exposure_name_fail(self, project):\n         exc_str = \" \".join(str(exc.value).split())  # flatten all whitespace\n         expected_msg = \"Starting in v1.3, the 'name' of an exposure should contain only letters, numbers, and underscores.\"\n         assert expected_msg in exc_str\n+\n+\n+class TestPrjectFlagsMovedDeprecation:\n+    @pytest.fixture(scope=\"class\")\n+    def profiles_config_update(self):\n+        return {\n+            \"config\": {\"send_anonymous_usage_stats\": False},\n+        }\n+\n+    @pytest.fixture(scope=\"class\")\n+    def dbt_project_yml(self, project_root, project_config_update):\n+        project_config = {\n+            \"name\": \"test\",\n+            \"profile\": \"test\",\n+        }\n+        write_file(yaml.safe_dump(project_config), project_root, \"dbt_project.yml\")\n+        return project_config\n+\n+    @pytest.fixture(scope=\"class\")\n+    def models(self):\n+        return {\"my_model.sql\": \"select 1 as fun\"}\n+\n+    def test_profile_config_deprecation(self, project):\n+        deprecations.reset_deprecations()\n+        assert deprecations.active_deprecations == set()\n+        run_dbt([\"parse\"])\n+        expected = {\"project-flags-moved\"}\n+        assert expected == deprecations.active_deprecations\n```\n\nFilename: tests/functional/fail_fast/test_fail_fast_run.py:\n```\n@@ -44,15 +44,15 @@\ndef test_fail_fast_run(\n \n class TestFailFastFromConfig(FailFastBase):\n     @pytest.fixture(scope=\"class\")\n-    def profiles_config_update(self):\n+    def project_config_update(self):\n         return {\n-            \"config\": {\n+            \"flags\": {\n                 \"send_anonymous_usage_stats\": False,\n                 \"fail_fast\": True,\n             }\n         }\n \n-    def test_fail_fast_run_user_config(\n+    def test_fail_fast_run_project_flags(\n         self,\n         project,\n         models,  # noqa: F811\n```\n\nFilename: tests/functional/init/test_init.py:\n```\n@@ -70,9 +70,7 @@\ndef test_init_task_in_project_with_existing_profiles_yml(\n         with open(os.path.join(project.profiles_dir, \"profiles.yml\"), \"r\") as f:\n             assert (\n                 f.read()\n-                == \"\"\"config:\n-  send_anonymous_usage_stats: false\n-test:\n+                == \"\"\"test:\n   outputs:\n     dev:\n       dbname: test_db\n\n@@ -391,9 +389,7 @@\ndef test_init_task_in_project_with_invalid_profile_template(\n         with open(os.path.join(project.profiles_dir, \"profiles.yml\"), \"r\") as f:\n             assert (\n                 f.read()\n-                == \"\"\"config:\n-  send_anonymous_usage_stats: false\n-test:\n+                == \"\"\"test:\n   outputs:\n     dev:\n       dbname: test_db\n\n@@ -430,7 +426,6 @@\nclass TestInitOutsideOfProject(TestInitOutsideOfProjectBase):\n     @pytest.fixture(scope=\"class\")\n     def dbt_profile_data(self, unique_schema):\n         return {\n-            \"config\": {\"send_anonymous_usage_stats\": False},\n             \"test\": {\n                 \"outputs\": {\n                     \"default2\": {\n\n@@ -513,9 +508,7 @@\ndef test_init_task_outside_of_project(\n         with open(os.path.join(project.profiles_dir, \"profiles.yml\"), \"r\") as f:\n             assert (\n                 f.read()\n-                == f\"\"\"config:\n-  send_anonymous_usage_stats: false\n-{project_name}:\n+                == f\"\"\"{project_name}:\n   outputs:\n     dev:\n       dbname: test_db\n\n@@ -560,7 +553,6 @@\ndef test_init_task_outside_of_project(\n # name or the intended use of these models\n name: '{project_name}'\n version: '1.0.0'\n-config-version: 2\n \n # This setting configures which \"profile\" dbt uses for this project.\n profile: '{project_name}'\n\n@@ -679,7 +671,6 @@\ndef test_init_provided_project_name_and_skip_profile_setup(\n # name or the intended use of these models\n name: '{project_name}'\n version: '1.0.0'\n-config-version: 2\n \n # This setting configures which \"profile\" dbt uses for this project.\n profile: '{project_name}'\n\n@@ -766,7 +757,6 @@\ndef test_init_task_outside_of_project_with_specified_profile(\n # name or the intended use of these models\n name: '{project_name}'\n version: '1.0.0'\n-config-version: 2\n \n # This setting configures which \"profile\" dbt uses for this project.\n profile: 'test'\n```\n\nFilename: tests/functional/materializations/conftest.py:\n```\n@@ -325,6 +325,21 @@\n{%- endmaterialization -%}\n \"\"\"\n \n+custom_materialization_dep__dbt_project_yml = \"\"\"\n+name: custom_materialization_default\n+macro-paths: ['macros']\n+\"\"\"\n+\n+custom_materialization_sql = \"\"\"\n+{% materialization custom_materialization, default %}\n+    {%- set target_relation = this.incorporate(type='table') %}\n+    {% call statement('main') -%}\n+        select 1 as column1\n+    {%- endcall %}\n+    {{ return({'relations': [target_relation]}) }}\n+{% endmaterialization %}\n+\"\"\"\n+\n \n @pytest.fixture(scope=\"class\")\n def override_view_adapter_pass_dep(project_root):\n\n@@ -368,3 +383,12 @@\ndef override_view_return_no_relation(project_root):\n         },\n     }\n     write_project_files(project_root, \"override-view-return-no-relation\", files)\n+\n+\n+@pytest.fixture(scope=\"class\")\n+def custom_materialization_dep(project_root):\n+    files = {\n+        \"dbt_project.yml\": custom_materialization_dep__dbt_project_yml,\n+        \"macros\": {\"custom_materialization.sql\": custom_materialization_sql},\n+    }\n+    write_project_files(project_root, \"custom-materialization-dep\", files)\n```\n\nFilename: tests/functional/materializations/test_custom_materialization.py:\n```\n@@ -1,7 +1,7 @@\nimport pytest\n \n from dbt.tests.util import run_dbt\n-\n+from dbt import deprecations\n \n models__model_sql = \"\"\"\n {{ config(materialized='view') }}\n\n@@ -10,34 +10,196 @@\n\"\"\"\n \n \n+models_custom_materialization__model_sql = \"\"\"\n+{{ config(materialized='custom_materialization') }}\n+select 1 as id\n+\n+\"\"\"\n+\n+\n @pytest.fixture(scope=\"class\")\n def models():\n     return {\"model.sql\": models__model_sql}\n \n \n+@pytest.fixture(scope=\"class\")\n+def set_up_deprecations():\n+    deprecations.reset_deprecations()\n+    assert deprecations.active_deprecations == set()\n+\n+\n class TestOverrideAdapterDependency:\n     # make sure that if there's a dependency with an adapter-specific\n     # materialization, we honor that materialization\n     @pytest.fixture(scope=\"class\")\n     def packages(self):\n         return {\"packages\": [{\"local\": \"override-view-adapter-dep\"}]}\n \n-    def test_adapter_dependency(self, project, override_view_adapter_dep):\n+    def test_adapter_dependency(self, project, override_view_adapter_dep, set_up_deprecations):\n+        run_dbt([\"deps\"])\n+        # this should error because the override is buggy\n+        run_dbt([\"run\"], expect_pass=False)\n+\n+        # overriding a built-in materialization scoped to adapter from package is deprecated\n+        assert deprecations.active_deprecations == {\"package-materialization-override\"}\n+\n+\n+class TestOverrideAdapterDependencyDeprecated:\n+    # make sure that if there's a dependency with an adapter-specific\n+    # materialization, we honor that materialization\n+    @pytest.fixture(scope=\"class\")\n+    def packages(self):\n+        return {\"packages\": [{\"local\": \"override-view-adapter-dep\"}]}\n+\n+    @pytest.fixture(scope=\"class\")\n+    def project_config_update(self):\n+        return {\n+            \"flags\": {\n+                \"require_explicit_package_overrides_for_builtin_materializations\": True,\n+            },\n+        }\n+\n+    def test_adapter_dependency_deprecate_overrides(\n+        self, project, override_view_adapter_dep, set_up_deprecations\n+    ):\n+        run_dbt([\"deps\"])\n+        # this should pass because the override is buggy and unused\n+        run_dbt([\"run\"])\n+\n+        # no deprecation warning -- flag used correctly\n+        assert deprecations.active_deprecations == set()\n+\n+\n+class TestOverrideAdapterDependencyLegacy:\n+    # make sure that if there's a dependency with an adapter-specific\n+    # materialization, we honor that materialization\n+    @pytest.fixture(scope=\"class\")\n+    def packages(self):\n+        return {\"packages\": [{\"local\": \"override-view-adapter-dep\"}]}\n+\n+    @pytest.fixture(scope=\"class\")\n+    def project_config_update(self):\n+        return {\n+            \"flags\": {\n+                \"require_explicit_package_overrides_for_builtin_materializations\": False,\n+            },\n+        }\n+\n+    def test_adapter_dependency(self, project, override_view_adapter_dep, set_up_deprecations):\n         run_dbt([\"deps\"])\n         # this should error because the override is buggy\n         run_dbt([\"run\"], expect_pass=False)\n \n+        # overriding a built-in materialization scoped to adapter from package is deprecated\n+        assert deprecations.active_deprecations == {\"package-materialization-override\"}\n+\n \n class TestOverrideDefaultDependency:\n     @pytest.fixture(scope=\"class\")\n     def packages(self):\n         return {\"packages\": [{\"local\": \"override-view-default-dep\"}]}\n \n-    def test_default_dependency(self, project, override_view_default_dep):\n+    def test_default_dependency(self, project, override_view_default_dep, set_up_deprecations):\n+        run_dbt([\"deps\"])\n+        # this should error because the override is buggy\n+        run_dbt([\"run\"], expect_pass=False)\n+\n+        # overriding a built-in materialization from package is deprecated\n+        assert deprecations.active_deprecations == {\"package-materialization-override\"}\n+\n+\n+class TestOverrideDefaultDependencyDeprecated:\n+    @pytest.fixture(scope=\"class\")\n+    def packages(self):\n+        return {\"packages\": [{\"local\": \"override-view-default-dep\"}]}\n+\n+    @pytest.fixture(scope=\"class\")\n+    def project_config_update(self):\n+        return {\n+            \"flags\": {\n+                \"require_explicit_package_overrides_for_builtin_materializations\": True,\n+            },\n+        }\n+\n+    def test_default_dependency_deprecated(\n+        self, project, override_view_default_dep, set_up_deprecations\n+    ):\n+        run_dbt([\"deps\"])\n+        # this should pass because the override is buggy and unused\n+        run_dbt([\"run\"])\n+\n+        # overriding a built-in materialization from package is deprecated\n+        assert deprecations.active_deprecations == set()\n+\n+\n+class TestOverrideDefaultDependencyLegacy:\n+    @pytest.fixture(scope=\"class\")\n+    def packages(self):\n+        return {\"packages\": [{\"local\": \"override-view-default-dep\"}]}\n+\n+    @pytest.fixture(scope=\"class\")\n+    def project_config_update(self):\n+        return {\n+            \"flags\": {\n+                \"require_explicit_package_overrides_for_builtin_materializations\": False,\n+            },\n+        }\n+\n+    def test_default_dependency(self, project, override_view_default_dep, set_up_deprecations):\n+        run_dbt([\"deps\"])\n+        # this should error because the override is buggy\n+        run_dbt([\"run\"], expect_pass=False)\n+\n+        # overriding a built-in materialization from package is deprecated\n+        assert deprecations.active_deprecations == {\"package-materialization-override\"}\n+\n+\n+root_view_override_macro = \"\"\"\n+{% materialization view, default %}\n+ {{ return(view_default_override.materialization_view_default()) }}\n+{% endmaterialization %}\n+\"\"\"\n+\n+\n+class TestOverrideDefaultDependencyRootOverride:\n+    @pytest.fixture(scope=\"class\")\n+    def packages(self):\n+        return {\"packages\": [{\"local\": \"override-view-default-dep\"}]}\n+\n+    @pytest.fixture(scope=\"class\")\n+    def macros(self):\n+        return {\"my_view.sql\": root_view_override_macro}\n+\n+    def test_default_dependency_with_root_override(\n+        self, project, override_view_default_dep, set_up_deprecations\n+    ):\n         run_dbt([\"deps\"])\n         # this should error because the override is buggy\n         run_dbt([\"run\"], expect_pass=False)\n \n+        # using an package-overriden built-in materialization in a root matereialization is _not_ deprecated\n+        assert deprecations.active_deprecations == set()\n+\n+\n+class TestCustomMaterializationDependency:\n+    @pytest.fixture(scope=\"class\")\n+    def models(self):\n+        return {\"model.sql\": models_custom_materialization__model_sql}\n+\n+    @pytest.fixture(scope=\"class\")\n+    def packages(self):\n+        return {\"packages\": [{\"local\": \"custom-materialization-dep\"}]}\n+\n+    def test_custom_materialization_deopendency(\n+        self, project, custom_materialization_dep, set_up_deprecations\n+    ):\n+        run_dbt([\"deps\"])\n+        # custom materilization is valid\n+        run_dbt([\"run\"])\n+\n+        # using a custom materialization is from an installed package is _not_ deprecated\n+        assert deprecations.active_deprecations == set()\n+\n \n class TestOverrideAdapterDependencyPassing:\n     @pytest.fixture(scope=\"class\")\n```\n\nFilename: tests/functional/metrics/test_metric_deferral.py:\n```\n@@ -23,7 +23,6 @@\ndef setup(self, project):\n     @pytest.fixture(scope=\"class\")\n     def dbt_profile_data(self, unique_schema):\n         return {\n-            \"config\": {\"send_anonymous_usage_stats\": False},\n             \"test\": {\n                 \"outputs\": {\n                     \"default\": {\n```\n\nFilename: tests/functional/run_operations/test_run_operations.py:\n```\n@@ -28,7 +28,6 @@\ndef macros(self):\n     @pytest.fixture(scope=\"class\")\n     def dbt_profile_data(self, unique_schema):\n         return {\n-            \"config\": {\"send_anonymous_usage_stats\": False},\n             \"test\": {\n                 \"outputs\": {\n                     \"default\": {\n```\n\nFilename: tests/unit/test_cli_flags.py:\n```\n@@ -9,7 +9,7 @@\nfrom dbt.cli.flags import Flags\n from dbt.cli.main import cli\n from dbt.cli.types import Command\n-from dbt.contracts.project import UserConfig\n+from dbt.contracts.project import ProjectFlags\n from dbt.exceptions import DbtInternalError\n from dbt.helper_types import WarnErrorOptions\n from dbt.tests.util import rm_file, write_file\n\n@@ -27,8 +27,8 @@\ndef run_context(self) -> click.Context:\n         return self.make_dbt_context(\"run\", [\"run\"])\n \n     @pytest.fixture\n-    def user_config(self) -> UserConfig:\n-        return UserConfig()\n+    def project_flags(self) -> ProjectFlags:\n+        return ProjectFlags()\n \n     def test_which(self, run_context):\n         flags = Flags(run_context)\n\n@@ -110,35 +110,35 @@\ndef test_anonymous_usage_state(\n         flags = Flags(run_context)\n         assert flags.SEND_ANONYMOUS_USAGE_STATS == expected_anonymous_usage_stats\n \n-    def test_empty_user_config_uses_default(self, run_context, user_config):\n-        flags = Flags(run_context, user_config)\n+    def test_empty_project_flags_uses_default(self, run_context, project_flags):\n+        flags = Flags(run_context, project_flags)\n         assert flags.USE_COLORS == run_context.params[\"use_colors\"]\n \n-    def test_none_user_config_uses_default(self, run_context):\n+    def test_none_project_flags_uses_default(self, run_context):\n         flags = Flags(run_context, None)\n         assert flags.USE_COLORS == run_context.params[\"use_colors\"]\n \n-    def test_prefer_user_config_to_default(self, run_context, user_config):\n-        user_config.use_colors = False\n+    def test_prefer_project_flags_to_default(self, run_context, project_flags):\n+        project_flags.use_colors = False\n         # ensure default value is not the same as user config\n-        assert run_context.params[\"use_colors\"] is not user_config.use_colors\n+        assert run_context.params[\"use_colors\"] is not project_flags.use_colors\n \n-        flags = Flags(run_context, user_config)\n-        assert flags.USE_COLORS == user_config.use_colors\n+        flags = Flags(run_context, project_flags)\n+        assert flags.USE_COLORS == project_flags.use_colors\n \n-    def test_prefer_param_value_to_user_config(self):\n-        user_config = UserConfig(use_colors=False)\n+    def test_prefer_param_value_to_project_flags(self):\n+        project_flags = ProjectFlags(use_colors=False)\n         context = self.make_dbt_context(\"run\", [\"--use-colors\", \"True\", \"run\"])\n \n-        flags = Flags(context, user_config)\n+        flags = Flags(context, project_flags)\n         assert flags.USE_COLORS\n \n-    def test_prefer_env_to_user_config(self, monkeypatch, user_config):\n-        user_config.use_colors = False\n+    def test_prefer_env_to_project_flags(self, monkeypatch, project_flags):\n+        project_flags.use_colors = False\n         monkeypatch.setenv(\"DBT_USE_COLORS\", \"True\")\n         context = self.make_dbt_context(\"run\", [\"run\"])\n \n-        flags = Flags(context, user_config)\n+        flags = Flags(context, project_flags)\n         assert flags.USE_COLORS\n \n     def test_mutually_exclusive_options_passed_separately(self):\n\n@@ -163,14 +163,14 @@\ndef test_mutually_exclusive_options_from_cli(self):\n             Flags(context)\n \n     @pytest.mark.parametrize(\"warn_error\", [True, False])\n-    def test_mutually_exclusive_options_from_user_config(self, warn_error, user_config):\n-        user_config.warn_error = warn_error\n+    def test_mutually_exclusive_options_from_project_flags(self, warn_error, project_flags):\n+        project_flags.warn_error = warn_error\n         context = self.make_dbt_context(\n             \"run\", [\"--warn-error-options\", '{\"include\": \"all\"}', \"run\"]\n         )\n \n         with pytest.raises(DbtUsageException):\n-            Flags(context, user_config)\n+            Flags(context, project_flags)\n \n     @pytest.mark.parametrize(\"warn_error\", [\"True\", \"False\"])\n     def test_mutually_exclusive_options_from_envvar(self, warn_error, monkeypatch):\n\n@@ -182,14 +182,16 @@\ndef test_mutually_exclusive_options_from_envvar(self, warn_error, monkeypatch):\n             Flags(context)\n \n     @pytest.mark.parametrize(\"warn_error\", [True, False])\n-    def test_mutually_exclusive_options_from_cli_and_user_config(self, warn_error, user_config):\n-        user_config.warn_error = warn_error\n+    def test_mutually_exclusive_options_from_cli_and_project_flags(\n+        self, warn_error, project_flags\n+    ):\n+        project_flags.warn_error = warn_error\n         context = self.make_dbt_context(\n             \"run\", [\"--warn-error-options\", '{\"include\": \"all\"}', \"run\"]\n         )\n \n         with pytest.raises(DbtUsageException):\n-            Flags(context, user_config)\n+            Flags(context, project_flags)\n \n     @pytest.mark.parametrize(\"warn_error\", [\"True\", \"False\"])\n     def test_mutually_exclusive_options_from_cli_and_envvar(self, warn_error, monkeypatch):\n\n@@ -202,15 +204,15 @@\ndef test_mutually_exclusive_options_from_cli_and_envvar(self, warn_error, monkey\n             Flags(context)\n \n     @pytest.mark.parametrize(\"warn_error\", [\"True\", \"False\"])\n-    def test_mutually_exclusive_options_from_user_config_and_envvar(\n-        self, user_config, warn_error, monkeypatch\n+    def test_mutually_exclusive_options_from_project_flags_and_envvar(\n+        self, project_flags, warn_error, monkeypatch\n     ):\n-        user_config.warn_error = warn_error\n+        project_flags.warn_error = warn_error\n         monkeypatch.setenv(\"DBT_WARN_ERROR_OPTIONS\", '{\"include\": \"all\"}')\n         context = self.make_dbt_context(\"run\", [\"run\"])\n \n         with pytest.raises(DbtUsageException):\n-            Flags(context, user_config)\n+            Flags(context, project_flags)\n \n     @pytest.mark.parametrize(\n         \"cli_colors,cli_colors_file,flag_colors,flag_colors_file\",\n\n@@ -319,10 +321,10 @@\ndef test_log_format_interaction(\n         assert flags.LOG_FORMAT_FILE == flag_log_format_file\n \n     def test_log_settings_from_config(self):\n-        \"\"\"Test that values set in UserConfig for log settings will set flags as expected\"\"\"\n+        \"\"\"Test that values set in ProjectFlags for log settings will set flags as expected\"\"\"\n         context = self.make_dbt_context(\"run\", [\"run\"])\n \n-        config = UserConfig(log_format=\"json\", log_level=\"warn\", use_colors=False)\n+        config = ProjectFlags(log_format=\"json\", log_level=\"warn\", use_colors=False)\n \n         flags = Flags(context, config)\n\n@@ -334,11 +336,11 @@\ndef test_log_settings_from_config(self):\n         assert flags.USE_COLORS_FILE is False\n \n     def test_log_file_settings_from_config(self):\n-        \"\"\"Test that values set in UserConfig for log *file* settings will set flags as expected, leaving the console\n+        \"\"\"Test that values set in ProjectFlags for log *file* settings will set flags as expected, leaving the console\n         logging flags with their default values\"\"\"\n         context = self.make_dbt_context(\"run\", [\"run\"])\n \n-        config = UserConfig(log_format_file=\"json\", log_level_file=\"warn\", use_colors_file=False)\n+        config = ProjectFlags(log_format_file=\"json\", log_level_file=\"warn\", use_colors_file=False)\n \n         flags = Flags(context, config)\n\n@@ -369,6 +371,14 @@\ndef test_global_flag_at_child_context(self):\n \n         assert flags_a.USE_COLORS == flags_b.USE_COLORS\n \n+    def test_set_project_only_flags(self, project_flags, run_context):\n+        flags = Flags(run_context, project_flags)\n+\n+        for project_only_flag, project_only_flag_value in project_flags.project_only_flags.items():\n+            assert getattr(flags, project_only_flag) == project_only_flag_value\n+            # sanity check: ensure project_only_flag is not part of the click context\n+            assert project_only_flag not in run_context.params\n+\n     def _create_flags_from_dict(self, cmd, d):\n         write_file(\"\", \"profiles.yml\")\n         result = Flags.from_dict(cmd, d)\n\n@@ -409,3 +419,38 @@\ndef test_from_dict_0_value(self):\n         args_dict = {\"log_file_max_bytes\": 0}\n         flags = Flags.from_dict(Command.RUN, args_dict)\n         assert flags.LOG_FILE_MAX_BYTES == 0\n+\n+\n+def test_project_flag_defaults():\n+    flags = ProjectFlags()\n+    # From # 9183: Let's add a unit test that ensures that:\n+    # every attribute of ProjectFlags that has a corresponding click option\n+    # in params.py should be set to None by default (except for anon user\n+    # tracking). Going forward, flags can have non-None defaults if they\n+    # do not have a corresponding CLI option/env var. These will be used\n+    # to control backwards incompatible interface or behaviour changes.\n+\n+    # List of all flags except send_anonymous_usage_stats\n+    project_flags = [\n+        \"cache_selected_only\",\n+        \"debug\",\n+        \"fail_fast\",\n+        \"indirect_selection\",\n+        \"log_format\",\n+        \"log_format_file\",\n+        \"log_level\",\n+        \"log_level_file\",\n+        \"partial_parse\",\n+        \"populate_cache\",\n+        \"printer_width\",\n+        \"static_parser\",\n+        \"use_colors\",\n+        \"use_colors_file\",\n+        \"use_experimental_parser\",\n+        \"version_check\",\n+        \"warn_error\",\n+        \"warn_error_options\",\n+        \"write_json\",\n+    ]\n+    for flag in project_flags:\n+        assert getattr(flags, flag) is None\n```\n\nFilename: tests/unit/test_config.py:\n```\n@@ -119,12 +119,17 @@\nclass BaseConfigTest(unittest.TestCase):\n     \"\"\"\n \n     def setUp(self):\n+        # Write project\n+        self.project_dir = normalize(tempfile.mkdtemp())\n         self.default_project_data = {\n             \"version\": \"0.0.1\",\n             \"name\": \"my_test_project\",\n             \"profile\": \"default\",\n-            \"config-version\": 2,\n         }\n+        self.write_project(self.default_project_data)\n+\n+        # Write profile\n+        self.profiles_dir = normalize(tempfile.mkdtemp())\n         self.default_profile_data = {\n             \"default\": {\n                 \"outputs\": {\n\n@@ -176,6 +181,8 @@\ndef setUp(self):\n             },\n             \"empty_profile_data\": {},\n         }\n+        self.write_profile(self.default_profile_data)\n+\n         self.args = Namespace(\n             profiles_dir=self.profiles_dir,\n             cli_vars={},\n\n@@ -203,13 +210,6 @@\ndef assertRaisesOrReturns(self, exc):\n         else:\n             return self.assertRaises(exc)\n \n-\n-class BaseFileTest(BaseConfigTest):\n-    def setUp(self):\n-        self.project_dir = normalize(tempfile.mkdtemp())\n-        self.profiles_dir = normalize(tempfile.mkdtemp())\n-        super().setUp()\n-\n     def tearDown(self):\n         try:\n             shutil.rmtree(self.project_dir)\n\n@@ -248,11 +248,6 @@\ndef write_empty_profile(self):\n \n \n class TestProfile(BaseConfigTest):\n-    def setUp(self):\n-        self.profiles_dir = \"/invalid-path\"\n-        self.project_dir = \"/invalid-project-path\"\n-        super().setUp()\n-\n     def from_raw_profiles(self):\n         renderer = empty_profile_renderer()\n         return dbt.config.Profile.from_raw_profiles(self.default_profile_data, \"default\", renderer)\n\n@@ -262,8 +257,6 @@\ndef test_from_raw_profiles(self):\n         self.assertEqual(profile.profile_name, \"default\")\n         self.assertEqual(profile.target_name, \"postgres\")\n         self.assertEqual(profile.threads, 7)\n-        self.assertTrue(profile.user_config.send_anonymous_usage_stats)\n-        self.assertIsNone(profile.user_config.use_colors)\n         self.assertTrue(isinstance(profile.credentials, PostgresCredentials))\n         self.assertEqual(profile.credentials.type, \"postgres\")\n         self.assertEqual(profile.credentials.host, \"postgres-db-hostname\")\n\n@@ -273,29 +266,6 @@\ndef test_from_raw_profiles(self):\n         self.assertEqual(profile.credentials.schema, \"postgres-schema\")\n         self.assertEqual(profile.credentials.database, \"postgres-db-name\")\n \n-    def test_config_override(self):\n-        self.default_profile_data[\"config\"] = {\n-            \"send_anonymous_usage_stats\": False,\n-            \"use_colors\": False,\n-        }\n-        profile = self.from_raw_profiles()\n-        self.assertEqual(profile.profile_name, \"default\")\n-        self.assertEqual(profile.target_name, \"postgres\")\n-        self.assertFalse(profile.user_config.send_anonymous_usage_stats)\n-        self.assertFalse(profile.user_config.use_colors)\n-\n-    def test_partial_config_override(self):\n-        self.default_profile_data[\"config\"] = {\n-            \"send_anonymous_usage_stats\": False,\n-            \"printer_width\": 60,\n-        }\n-        profile = self.from_raw_profiles()\n-        self.assertEqual(profile.profile_name, \"default\")\n-        self.assertEqual(profile.target_name, \"postgres\")\n-        self.assertFalse(profile.user_config.send_anonymous_usage_stats)\n-        self.assertIsNone(profile.user_config.use_colors)\n-        self.assertEqual(profile.user_config.printer_width, 60)\n-\n     def test_missing_type(self):\n         del self.default_profile_data[\"default\"][\"outputs\"][\"postgres\"][\"type\"]\n         with self.assertRaises(dbt.exceptions.DbtProfileError) as exc:\n\n@@ -337,7 +307,7 @@\ndef test_extra_path(self):\n             }\n         )\n         with self.assertRaises(dbt.exceptions.DbtProjectError) as exc:\n-            project_from_config_norender(self.default_project_data)\n+            project_from_config_norender(self.default_project_data, project_root=self.project_dir)\n \n         self.assertIn(\"source-paths and model-paths\", str(exc.exception))\n         self.assertIn(\"cannot both be defined.\", str(exc.exception))\n\n@@ -403,11 +373,7 @@\ndef test_invalid_env_vars(self):\n         self.assertIn(\"Could not convert value 'hello' into type 'number'\", str(exc.exception))\n \n \n-class TestProfileFile(BaseFileTest):\n-    def setUp(self):\n-        super().setUp()\n-        self.write_profile(self.default_profile_data)\n-\n+class TestProfileFile(BaseConfigTest):\n     def from_raw_profile_info(self, raw_profile=None, profile_name=\"default\", **kwargs):\n         if raw_profile is None:\n             raw_profile = self.default_profile_data[\"default\"]\n\n@@ -438,8 +404,6 @@\ndef test_profile_simple(self):\n         self.assertEqual(profile.profile_name, \"default\")\n         self.assertEqual(profile.target_name, \"postgres\")\n         self.assertEqual(profile.threads, 7)\n-        self.assertTrue(profile.user_config.send_anonymous_usage_stats)\n-        self.assertIsNone(profile.user_config.use_colors)\n         self.assertTrue(isinstance(profile.credentials, PostgresCredentials))\n         self.assertEqual(profile.credentials.type, \"postgres\")\n         self.assertEqual(profile.credentials.host, \"postgres-db-hostname\")\n\n@@ -464,8 +428,6 @@\ndef test_profile_override(self):\n         self.assertEqual(profile.profile_name, \"other\")\n         self.assertEqual(profile.target_name, \"other-postgres\")\n         self.assertEqual(profile.threads, 3)\n-        self.assertTrue(profile.user_config.send_anonymous_usage_stats)\n-        self.assertIsNone(profile.user_config.use_colors)\n         self.assertTrue(isinstance(profile.credentials, PostgresCredentials))\n         self.assertEqual(profile.credentials.type, \"postgres\")\n         self.assertEqual(profile.credentials.host, \"other-postgres-db-hostname\")\n\n@@ -485,8 +447,6 @@\ndef test_env_vars(self):\n         self.assertEqual(profile.profile_name, \"default\")\n         self.assertEqual(profile.target_name, \"with-vars\")\n         self.assertEqual(profile.threads, 1)\n-        self.assertTrue(profile.user_config.send_anonymous_usage_stats)\n-        self.assertIsNone(profile.user_config.use_colors)\n         self.assertEqual(profile.credentials.type, \"postgres\")\n         self.assertEqual(profile.credentials.host, \"env-postgres-host\")\n         self.assertEqual(profile.credentials.port, 6543)\n\n@@ -505,8 +465,6 @@\ndef test_env_vars_env_target(self):\n         self.assertEqual(profile.profile_name, \"default\")\n         self.assertEqual(profile.target_name, \"with-vars\")\n         self.assertEqual(profile.threads, 1)\n-        self.assertTrue(profile.user_config.send_anonymous_usage_stats)\n-        self.assertIsNone(profile.user_config.use_colors)\n         self.assertEqual(profile.credentials.type, \"postgres\")\n         self.assertEqual(profile.credentials.host, \"env-postgres-host\")\n         self.assertEqual(profile.credentials.port, 6543)\n\n@@ -537,8 +495,6 @@\ndef test_cli_and_env_vars(self):\n         self.assertEqual(profile.profile_name, \"default\")\n         self.assertEqual(profile.target_name, \"cli-and-env-vars\")\n         self.assertEqual(profile.threads, 1)\n-        self.assertTrue(profile.user_config.send_anonymous_usage_stats)\n-        self.assertIsNone(profile.user_config.use_colors)\n         self.assertEqual(profile.credentials.type, \"postgres\")\n         self.assertEqual(profile.credentials.host, \"cli-postgres-host\")\n         self.assertEqual(profile.credentials.port, 6543)\n\n@@ -567,18 +523,19 @@\ndef test_profile_with_empty_profile_data(self):\n \n \n def project_from_config_norender(\n-    cfg, packages=None, path=\"/invalid-root-path\", verify_version=False\n+    cfg, packages=None, project_root=\"/invalid-root-path\", verify_version=False\n ):\n     if packages is None:\n         packages = {}\n     partial = dbt.config.project.PartialProject.from_dicts(\n-        path,\n+        project_root,\n         project_dict=cfg,\n         packages_dict=packages,\n         selectors_dict={},\n         verify_version=verify_version,\n     )\n-    # no rendering\n+    # no rendering ... Why?\n+    partial.project_dict[\"project-root\"] = project_root\n     rendered = dbt.config.project.RenderComponents(\n         project_dict=partial.project_dict,\n         packages_dict=partial.packages_dict,\n\n@@ -590,14 +547,14 @@\ndef project_from_config_norender(\n def project_from_config_rendered(\n     cfg,\n     packages=None,\n-    path=\"/invalid-root-path\",\n+    project_root=\"/invalid-root-path\",\n     verify_version=False,\n     packages_specified_path=PACKAGES_FILE_NAME,\n ):\n     if packages is None:\n         packages = {}\n     partial = dbt.config.project.PartialProject.from_dicts(\n-        path,\n+        project_root,\n         project_dict=cfg,\n         packages_dict=packages,\n         selectors_dict={},\n\n@@ -608,18 +565,14 @@\ndef project_from_config_rendered(\n \n \n class TestProject(BaseConfigTest):\n-    def setUp(self):\n-        self.profiles_dir = \"/invalid-profiles-path\"\n-        self.project_dir = \"/invalid-root-path\"\n-        super().setUp()\n-        self.default_project_data[\"project-root\"] = self.project_dir\n-\n     def test_defaults(self):\n-        project = project_from_config_norender(self.default_project_data)\n+        project = project_from_config_norender(\n+            self.default_project_data, project_root=self.project_dir\n+        )\n         self.assertEqual(project.project_name, \"my_test_project\")\n         self.assertEqual(project.version, \"0.0.1\")\n         self.assertEqual(project.profile_name, \"default\")\n-        self.assertEqual(project.project_root, \"/invalid-root-path\")\n+        self.assertEqual(project.project_root, self.project_dir)\n         self.assertEqual(project.model_paths, [\"models\"])\n         self.assertEqual(project.macro_paths, [\"macros\"])\n         self.assertEqual(project.seed_paths, [\"seeds\"])\n\n@@ -645,30 +598,38 @@\ndef test_defaults(self):\n         str(project)\n \n     def test_eq(self):\n-        project = project_from_config_norender(self.default_project_data)\n-        other = project_from_config_norender(self.default_project_data)\n+        project = project_from_config_norender(\n+            self.default_project_data, project_root=self.project_dir\n+        )\n+        other = project_from_config_norender(\n+            self.default_project_data, project_root=self.project_dir\n+        )\n         self.assertEqual(project, other)\n \n     def test_neq(self):\n-        project = project_from_config_norender(self.default_project_data)\n+        project = project_from_config_norender(\n+            self.default_project_data, project_root=self.project_dir\n+        )\n         self.assertNotEqual(project, object())\n \n     def test_implicit_overrides(self):\n         self.default_project_data.update(\n             {\n                 \"model-paths\": [\"other-models\"],\n-                \"target-path\": \"other-target\",\n             }\n         )\n-        project = project_from_config_norender(self.default_project_data)\n+        project = project_from_config_norender(\n+            self.default_project_data, project_root=self.project_dir\n+        )\n         self.assertEqual(\n             set(project.docs_paths),\n             set([\"other-models\", \"seeds\", \"snapshots\", \"analyses\", \"macros\"]),\n         )\n-        self.assertEqual(project.clean_targets, [\"other-target\"])\n \n     def test_hashed_name(self):\n-        project = project_from_config_norender(self.default_project_data)\n+        project = project_from_config_norender(\n+            self.default_project_data, project_root=self.project_dir\n+        )\n         self.assertEqual(project.hashed_name(), \"754cd47eac1d6f50a5f7cd399ec43da4\")\n \n     def test_all_overrides(self):\n\n@@ -682,7 +643,6 @@\ndef test_all_overrides(self):\n                 \"analysis-paths\": [\"other-analyses\"],\n                 \"docs-paths\": [\"docs\"],\n                 \"asset-paths\": [\"other-assets\"],\n-                \"target-path\": \"other-target\",\n                 \"clean-targets\": [\"another-target\"],\n                 \"packages-install-path\": \"other-dbt_packages\",\n                 \"quoting\": {\"identifier\": False},\n\n@@ -731,19 +691,19 @@\ndef test_all_overrides(self):\n                 {\"git\": \"git@example.com:dbt-labs/dbt-utils.git\", \"revision\": \"test-rev\"},\n             ],\n         }\n-        project = project_from_config_norender(self.default_project_data, packages=packages)\n+        project = project_from_config_norender(\n+            self.default_project_data, project_root=self.project_dir, packages=packages\n+        )\n         self.assertEqual(project.project_name, \"my_test_project\")\n         self.assertEqual(project.version, \"0.0.1\")\n         self.assertEqual(project.profile_name, \"default\")\n-        self.assertEqual(project.project_root, \"/invalid-root-path\")\n         self.assertEqual(project.model_paths, [\"other-models\"])\n         self.assertEqual(project.macro_paths, [\"other-macros\"])\n         self.assertEqual(project.seed_paths, [\"other-seeds\"])\n         self.assertEqual(project.test_paths, [\"other-tests\"])\n         self.assertEqual(project.analysis_paths, [\"other-analyses\"])\n         self.assertEqual(project.docs_paths, [\"docs\"])\n         self.assertEqual(project.asset_paths, [\"other-assets\"])\n-        self.assertEqual(project.target_path, \"other-target\")\n         self.assertEqual(project.clean_targets, [\"another-target\"])\n         self.assertEqual(project.packages_install_path, \"other-dbt_packages\")\n         self.assertEqual(project.quoting, {\"identifier\": False})\n\n@@ -822,11 +782,12 @@\ndef test_string_run_hooks(self):\n     def test_invalid_project_name(self):\n         self.default_project_data[\"name\"] = \"invalid-project-name\"\n         with self.assertRaises(dbt.exceptions.DbtProjectError) as exc:\n-            project_from_config_norender(self.default_project_data)\n+            project_from_config_norender(self.default_project_data, project_root=self.project_dir)\n \n         self.assertIn(\"invalid-project-name\", str(exc.exception))\n \n     def test_no_project(self):\n+        os.remove(os.path.join(self.project_dir, \"dbt_project.yml\"))\n         renderer = empty_project_renderer()\n         with self.assertRaises(dbt.exceptions.DbtProjectError) as exc:\n             dbt.config.Project.from_project_root(self.project_dir, renderer)\n\n@@ -836,12 +797,12 @@\ndef test_no_project(self):\n     def test_invalid_version(self):\n         self.default_project_data[\"require-dbt-version\"] = \"hello!\"\n         with self.assertRaises(dbt.exceptions.DbtProjectError):\n-            project_from_config_norender(self.default_project_data)\n+            project_from_config_norender(self.default_project_data, project_root=self.project_dir)\n \n     def test_unsupported_version(self):\n         self.default_project_data[\"require-dbt-version\"] = \">99999.0.0\"\n         # allowed, because the RuntimeConfig checks, not the Project itself\n-        project_from_config_norender(self.default_project_data)\n+        project_from_config_norender(self.default_project_data, project_root=self.project_dir)\n \n     def test_none_values(self):\n         self.default_project_data.update(\n\n@@ -891,7 +852,9 @@\ndef test_query_comment_disabled(self):\n                 \"query-comment\": None,\n             }\n         )\n-        project = project_from_config_norender(self.default_project_data)\n+        project = project_from_config_norender(\n+            self.default_project_data, project_root=self.project_dir\n+        )\n         self.assertEqual(project.query_comment.comment, \"\")\n         self.assertEqual(project.query_comment.append, False)\n\n@@ -900,12 +863,16 @@\ndef test_query_comment_disabled(self):\n                 \"query-comment\": \"\",\n             }\n         )\n-        project = project_from_config_norender(self.default_project_data)\n+        project = project_from_config_norender(\n+            self.default_project_data, project_root=self.project_dir\n+        )\n         self.assertEqual(project.query_comment.comment, \"\")\n         self.assertEqual(project.query_comment.append, False)\n \n     def test_default_query_comment(self):\n-        project = project_from_config_norender(self.default_project_data)\n+        project = project_from_config_norender(\n+            self.default_project_data, project_root=self.project_dir\n+        )\n         self.assertEqual(project.query_comment, QueryComment())\n \n     def test_default_query_comment_append(self):\n\n@@ -914,7 +881,9 @@\ndef test_default_query_comment_append(self):\n                 \"query-comment\": {\"append\": True},\n             }\n         )\n-        project = project_from_config_norender(self.default_project_data)\n+        project = project_from_config_norender(\n+            self.default_project_data, project_root=self.project_dir\n+        )\n         self.assertEqual(project.query_comment.comment, DEFAULT_QUERY_COMMENT)\n         self.assertEqual(project.query_comment.append, True)\n\n@@ -924,7 +893,9 @@\ndef test_custom_query_comment_append(self):\n                 \"query-comment\": {\"comment\": \"run by user test\", \"append\": True},\n             }\n         )\n-        project = project_from_config_norender(self.default_project_data)\n+        project = project_from_config_norender(\n+            self.default_project_data, project_root=self.project_dir\n+        )\n         self.assertEqual(project.query_comment.comment, \"run by user test\")\n         self.assertEqual(project.query_comment.append, True)\n\n@@ -946,17 +917,13 @@\ndef test_packages_from_dependencies(self):\n         assert git_package.git == \"{{ env_var('some_package') }}\"\n \n \n-class TestProjectFile(BaseFileTest):\n-    def setUp(self):\n-        super().setUp()\n-        self.write_project(self.default_project_data)\n-        # and after the fact, add the project root\n-        self.default_project_data[\"project-root\"] = self.project_dir\n-\n+class TestProjectFile(BaseConfigTest):\n     def test_from_project_root(self):\n         renderer = empty_project_renderer()\n         project = dbt.config.Project.from_project_root(self.project_dir, renderer)\n-        from_config = project_from_config_norender(self.default_project_data)\n+        from_config = project_from_config_norender(\n+            self.default_project_data, project_root=self.project_dir\n+        )\n         self.assertEqual(project, from_config)\n         self.assertEqual(project.version, \"0.0.1\")\n         self.assertEqual(project.project_name, \"my_test_project\")\n\n@@ -973,12 +940,7 @@\ndef run(self):\n         pass\n \n \n-class TestConfiguredTask(BaseFileTest):\n-    def setUp(self):\n-        super().setUp()\n-        self.write_project(self.default_project_data)\n-        self.write_profile(self.default_profile_data)\n-\n+class TestConfiguredTask(BaseConfigTest):\n     def tearDown(self):\n         super().tearDown()\n         # These tests will change the directory to the project path,\n\n@@ -997,15 +959,13 @@\ndef test_configured_task_dir_change_with_bad_path(self):\n             InheritsFromConfiguredTask.from_args(self.args)\n \n \n-class TestVariableProjectFile(BaseFileTest):\n+class TestVariableProjectFile(BaseConfigTest):\n     def setUp(self):\n         super().setUp()\n         self.default_project_data[\"version\"] = \"{{ var('cli_version') }}\"\n         self.default_project_data[\"name\"] = \"blah\"\n         self.default_project_data[\"profile\"] = \"{{ env_var('env_value_profile') }}\"\n         self.write_project(self.default_project_data)\n-        # and after the fact, add the project root\n-        self.default_project_data[\"project-root\"] = self.project_dir\n \n     def test_cli_and_env_vars(self):\n         renderer = dbt.config.renderer.DbtProjectYamlRenderer(None, {\"cli_version\": \"0.1.2\"})\n\n@@ -1022,15 +982,11 @@\ndef test_cli_and_env_vars(self):\n \n \n class TestRuntimeConfig(BaseConfigTest):\n-    def setUp(self):\n-        self.profiles_dir = \"/invalid-profiles-path\"\n-        self.project_dir = \"/invalid-root-path\"\n-        super().setUp()\n-        self.default_project_data[\"project-root\"] = self.project_dir\n-\n     def get_project(self):\n         return project_from_config_norender(\n-            self.default_project_data, verify_version=self.args.version_check\n+            self.default_project_data,\n+            project_root=self.project_dir,\n+            verify_version=self.args.version_check,\n         )\n \n     def get_profile(self):\n\n@@ -1079,14 +1035,6 @@\ndef test_str(self):\n         # to make sure nothing terrible happens\n         str(config)\n \n-    def test_validate_fails(self):\n-        project = self.get_project()\n-        profile = self.get_profile()\n-        # invalid - must be boolean\n-        profile.user_config.use_colors = 100\n-        with self.assertRaises(dbt.exceptions.DbtProjectError):\n-            dbt.config.RuntimeConfig.from_parts(project, profile, {})\n-\n     def test_supported_version(self):\n         self.default_project_data[\"require-dbt-version\"] = \">0.0.0\"\n         conf = self.from_parts()\n\n@@ -1210,7 +1158,9 @@\ndef setUp(self):\n         }\n \n     def get_project(self):\n-        return project_from_config_norender(self.default_project_data, verify_version=True)\n+        return project_from_config_norender(\n+            self.default_project_data, project_root=self.project_dir, verify_version=True\n+        )\n \n     def get_profile(self):\n         renderer = empty_profile_renderer()\n\n@@ -1242,14 +1192,7 @@\ndef test__warn_for_unused_resource_config_paths(self):\n             assert expected_msg in msg\n \n \n-class TestRuntimeConfigFiles(BaseFileTest):\n-    def setUp(self):\n-        super().setUp()\n-        self.write_profile(self.default_profile_data)\n-        self.write_project(self.default_project_data)\n-        # and after the fact, add the project root\n-        self.default_project_data[\"project-root\"] = self.project_dir\n-\n+class TestRuntimeConfigFiles(BaseConfigTest):\n     def test_from_args(self):\n         with temp_cd(self.project_dir):\n             config = dbt.config.RuntimeConfig.from_args(self.args)\n\n@@ -1279,7 +1222,7 @@\ndef test_from_args(self):\n         self.assertEqual(config.project_name, \"my_test_project\")\n \n \n-class TestVariableRuntimeConfigFiles(BaseFileTest):\n+class TestVariableRuntimeConfigFiles(BaseConfigTest):\n     def setUp(self):\n         super().setUp()\n         self.default_project_data.update(\n\n@@ -1311,9 +1254,6 @@\ndef setUp(self):\n             }\n         )\n         self.write_project(self.default_project_data)\n-        self.write_profile(self.default_profile_data)\n-        # and after the fact, add the project root\n-        self.default_project_data[\"project-root\"] = self.project_dir\n \n     def test_cli_and_env_vars(self):\n         self.args.target = \"cli-and-env-vars\"\n\n@@ -1387,3 +1327,30 @@\ndef test_lookups(self):\n         for node, key, expected_value in expected:\n             value = vars_provider.vars_for(node, \"postgres\").get(key)\n             assert value == expected_value\n+\n+\n+class TestMultipleProjectFlags(BaseConfigTest):\n+    def setUp(self):\n+        super().setUp()\n+\n+        self.default_project_data.update(\n+            {\n+                \"flags\": {\n+                    \"send_anonymous_usage_data\": False,\n+                }\n+            }\n+        )\n+        self.write_project(self.default_project_data)\n+\n+        self.default_profile_data.update(\n+            {\n+                \"config\": {\n+                    \"send_anonymous_usage_data\": False,\n+                }\n+            }\n+        )\n+        self.write_profile(self.default_profile_data)\n+\n+    def test_setting_multiple_flags(self):\n+        with pytest.raises(dbt.exceptions.DbtProjectError):\n+            set_from_args(self.args, None)\n```\n\nFilename: tests/unit/test_events.py:\n```\n@@ -145,6 +145,10 @@\ndef test_event_codes(self):\n     types.ConfigLogPathDeprecation(deprecated_path=\"\"),\n     types.ConfigTargetPathDeprecation(deprecated_path=\"\"),\n     types.CollectFreshnessReturnSignature(),\n+    types.ProjectFlagsMovedDeprecation(),\n+    types.PackageMaterializationOverrideDeprecation(\n+        package_name=\"my_package\", materialization_name=\"view\"\n+    ),\n     # E - DB Adapter ======================\n     types.AdapterEventDebug(),\n     types.AdapterEventInfo(),\n```\n\nFilename: tests/unit/test_flags.py:\n```\n@@ -1,340 +0,0 @@\n-import os\n-from unittest import TestCase\n-from argparse import Namespace\n-import pytest\n-\n-from dbt import flags\n-from dbt.contracts.project import UserConfig\n-from dbt.graph.selector_spec import IndirectSelection\n-from dbt.helper_types import WarnErrorOptions\n-\n-# Skip due to interface for flag updated\n-pytestmark = pytest.mark.skip\n-\n-\n-class TestFlags(TestCase):\n-    def setUp(self):\n-        self.args = Namespace()\n-        self.user_config = UserConfig()\n-\n-    def test__flags(self):\n-\n-        # use_experimental_parser\n-        self.user_config.use_experimental_parser = True\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.USE_EXPERIMENTAL_PARSER, True)\n-        os.environ[\"DBT_USE_EXPERIMENTAL_PARSER\"] = \"false\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.USE_EXPERIMENTAL_PARSER, False)\n-        setattr(self.args, \"use_experimental_parser\", True)\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.USE_EXPERIMENTAL_PARSER, True)\n-        # cleanup\n-        os.environ.pop(\"DBT_USE_EXPERIMENTAL_PARSER\")\n-        delattr(self.args, \"use_experimental_parser\")\n-        flags.USE_EXPERIMENTAL_PARSER = False\n-        self.user_config.use_experimental_parser = None\n-\n-        # static_parser\n-        self.user_config.static_parser = False\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.STATIC_PARSER, False)\n-        os.environ[\"DBT_STATIC_PARSER\"] = \"true\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.STATIC_PARSER, True)\n-        setattr(self.args, \"static_parser\", False)\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.STATIC_PARSER, False)\n-        # cleanup\n-        os.environ.pop(\"DBT_STATIC_PARSER\")\n-        delattr(self.args, \"static_parser\")\n-        flags.STATIC_PARSER = True\n-        self.user_config.static_parser = None\n-\n-        # warn_error\n-        self.user_config.warn_error = False\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.WARN_ERROR, False)\n-        os.environ[\"DBT_WARN_ERROR\"] = \"true\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.WARN_ERROR, True)\n-        setattr(self.args, \"warn_error\", False)\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.WARN_ERROR, False)\n-        # cleanup\n-        os.environ.pop(\"DBT_WARN_ERROR\")\n-        delattr(self.args, \"warn_error\")\n-        flags.WARN_ERROR = False\n-        self.user_config.warn_error = None\n-\n-        # warn_error_options\n-        self.user_config.warn_error_options = '{\"include\": \"all\"}'\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.WARN_ERROR_OPTIONS, WarnErrorOptions(include=\"all\"))\n-        os.environ[\"DBT_WARN_ERROR_OPTIONS\"] = '{\"include\": []}'\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.WARN_ERROR_OPTIONS, WarnErrorOptions(include=[]))\n-        setattr(self.args, \"warn_error_options\", '{\"include\": \"all\"}')\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.WARN_ERROR_OPTIONS, WarnErrorOptions(include=\"all\"))\n-        # cleanup\n-        os.environ.pop(\"DBT_WARN_ERROR_OPTIONS\")\n-        delattr(self.args, \"warn_error_options\")\n-        self.user_config.warn_error_options = None\n-\n-        # write_json\n-        self.user_config.write_json = True\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.WRITE_JSON, True)\n-        os.environ[\"DBT_WRITE_JSON\"] = \"false\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.WRITE_JSON, False)\n-        setattr(self.args, \"write_json\", True)\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.WRITE_JSON, True)\n-        # cleanup\n-        os.environ.pop(\"DBT_WRITE_JSON\")\n-        delattr(self.args, \"write_json\")\n-\n-        # partial_parse\n-        self.user_config.partial_parse = True\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.PARTIAL_PARSE, True)\n-        os.environ[\"DBT_PARTIAL_PARSE\"] = \"false\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.PARTIAL_PARSE, False)\n-        setattr(self.args, \"partial_parse\", True)\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.PARTIAL_PARSE, True)\n-        # cleanup\n-        os.environ.pop(\"DBT_PARTIAL_PARSE\")\n-        delattr(self.args, \"partial_parse\")\n-        self.user_config.partial_parse = False\n-\n-        # use_colors\n-        self.user_config.use_colors = True\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.USE_COLORS, True)\n-        os.environ[\"DBT_USE_COLORS\"] = \"false\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.USE_COLORS, False)\n-        setattr(self.args, \"use_colors\", True)\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.USE_COLORS, True)\n-        # cleanup\n-        os.environ.pop(\"DBT_USE_COLORS\")\n-        delattr(self.args, \"use_colors\")\n-\n-        # debug\n-        self.user_config.debug = True\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.DEBUG, True)\n-        os.environ[\"DBT_DEBUG\"] = \"True\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.DEBUG, True)\n-        os.environ[\"DBT_DEBUG\"] = \"False\"\n-        setattr(self.args, \"debug\", True)\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.DEBUG, True)\n-        # cleanup\n-        os.environ.pop(\"DBT_DEBUG\")\n-        delattr(self.args, \"debug\")\n-        self.user_config.debug = None\n-\n-        # log_format -- text, json, default\n-        self.user_config.log_format = \"text\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.LOG_FORMAT, \"text\")\n-        os.environ[\"DBT_LOG_FORMAT\"] = \"json\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.LOG_FORMAT, \"json\")\n-        setattr(self.args, \"log_format\", \"text\")\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.LOG_FORMAT, \"text\")\n-        # cleanup\n-        os.environ.pop(\"DBT_LOG_FORMAT\")\n-        delattr(self.args, \"log_format\")\n-        self.user_config.log_format = None\n-\n-        # version_check\n-        self.user_config.version_check = True\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.VERSION_CHECK, True)\n-        os.environ[\"DBT_VERSION_CHECK\"] = \"false\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.VERSION_CHECK, False)\n-        setattr(self.args, \"version_check\", True)\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.VERSION_CHECK, True)\n-        # cleanup\n-        os.environ.pop(\"DBT_VERSION_CHECK\")\n-        delattr(self.args, \"version_check\")\n-\n-        # fail_fast\n-        self.user_config.fail_fast = True\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.FAIL_FAST, True)\n-        os.environ[\"DBT_FAIL_FAST\"] = \"false\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.FAIL_FAST, False)\n-        setattr(self.args, \"fail_fast\", True)\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.FAIL_FAST, True)\n-        # cleanup\n-        os.environ.pop(\"DBT_FAIL_FAST\")\n-        delattr(self.args, \"fail_fast\")\n-        self.user_config.fail_fast = False\n-\n-        # send_anonymous_usage_stats\n-        self.user_config.send_anonymous_usage_stats = True\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.SEND_ANONYMOUS_USAGE_STATS, True)\n-        os.environ[\"DBT_SEND_ANONYMOUS_USAGE_STATS\"] = \"false\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.SEND_ANONYMOUS_USAGE_STATS, False)\n-        setattr(self.args, \"send_anonymous_usage_stats\", True)\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.SEND_ANONYMOUS_USAGE_STATS, True)\n-        os.environ[\"DO_NOT_TRACK\"] = \"1\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.SEND_ANONYMOUS_USAGE_STATS, False)\n-        # cleanup\n-        os.environ.pop(\"DBT_SEND_ANONYMOUS_USAGE_STATS\")\n-        os.environ.pop(\"DO_NOT_TRACK\")\n-        delattr(self.args, \"send_anonymous_usage_stats\")\n-\n-        # printer_width\n-        self.user_config.printer_width = 100\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.PRINTER_WIDTH, 100)\n-        os.environ[\"DBT_PRINTER_WIDTH\"] = \"80\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.PRINTER_WIDTH, 80)\n-        setattr(self.args, \"printer_width\", \"120\")\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.PRINTER_WIDTH, 120)\n-        # cleanup\n-        os.environ.pop(\"DBT_PRINTER_WIDTH\")\n-        delattr(self.args, \"printer_width\")\n-        self.user_config.printer_width = None\n-\n-        # indirect_selection\n-        self.user_config.indirect_selection = \"eager\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.INDIRECT_SELECTION, IndirectSelection.Eager)\n-        self.user_config.indirect_selection = \"cautious\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.INDIRECT_SELECTION, IndirectSelection.Cautious)\n-        self.user_config.indirect_selection = \"buildable\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.INDIRECT_SELECTION, IndirectSelection.Buildable)\n-        self.user_config.indirect_selection = None\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.INDIRECT_SELECTION, IndirectSelection.Eager)\n-        os.environ[\"DBT_INDIRECT_SELECTION\"] = \"cautious\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.INDIRECT_SELECTION, IndirectSelection.Cautious)\n-        setattr(self.args, \"indirect_selection\", \"cautious\")\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.INDIRECT_SELECTION, IndirectSelection.Cautious)\n-        # cleanup\n-        os.environ.pop(\"DBT_INDIRECT_SELECTION\")\n-        delattr(self.args, \"indirect_selection\")\n-        self.user_config.indirect_selection = None\n-\n-        # quiet\n-        self.user_config.quiet = True\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.QUIET, True)\n-        # cleanup\n-        self.user_config.quiet = None\n-\n-        # no_print\n-        self.user_config.no_print = True\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.NO_PRINT, True)\n-        # cleanup\n-        self.user_config.no_print = None\n-\n-        # cache_selected_only\n-        self.user_config.cache_selected_only = True\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.CACHE_SELECTED_ONLY, True)\n-        os.environ[\"DBT_CACHE_SELECTED_ONLY\"] = \"false\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.CACHE_SELECTED_ONLY, False)\n-        setattr(self.args, \"cache_selected_only\", True)\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.CACHE_SELECTED_ONLY, True)\n-        # cleanup\n-        os.environ.pop(\"DBT_CACHE_SELECTED_ONLY\")\n-        delattr(self.args, \"cache_selected_only\")\n-        self.user_config.cache_selected_only = False\n-\n-        # target_path/log_path\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertIsNone(flags.LOG_PATH)\n-        os.environ[\"DBT_LOG_PATH\"] = \"a/b/c\"\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.LOG_PATH, \"a/b/c\")\n-        setattr(self.args, \"log_path\", \"d/e/f\")\n-        flags.set_from_args(self.args, self.user_config)\n-        self.assertEqual(flags.LOG_PATH, \"d/e/f\")\n-        # cleanup\n-        os.environ.pop(\"DBT_LOG_PATH\")\n-        delattr(self.args, \"log_path\")\n-\n-    def test__flags_are_mutually_exclusive(self):\n-        # options from user config\n-        self.user_config.warn_error = False\n-        self.user_config.warn_error_options = '{\"include\":\"all\"}'\n-        with pytest.raises(ValueError):\n-            flags.set_from_args(self.args, self.user_config)\n-        # cleanup\n-        self.user_config.warn_error = None\n-        self.user_config.warn_error_options = None\n-\n-        # options from args\n-        setattr(self.args, \"warn_error\", False)\n-        setattr(self.args, \"warn_error_options\", '{\"include\":\"all\"}')\n-        with pytest.raises(ValueError):\n-            flags.set_from_args(self.args, self.user_config)\n-        # cleanup\n-        delattr(self.args, \"warn_error\")\n-        delattr(self.args, \"warn_error_options\")\n-\n-        # options from environment\n-        os.environ[\"DBT_WARN_ERROR\"] = \"false\"\n-        os.environ[\"DBT_WARN_ERROR_OPTIONS\"] = '{\"include\": []}'\n-        with pytest.raises(ValueError):\n-            flags.set_from_args(self.args, self.user_config)\n-        # cleanup\n-        os.environ.pop(\"DBT_WARN_ERROR\")\n-        os.environ.pop(\"DBT_WARN_ERROR_OPTIONS\")\n-\n-        # options from user config + args\n-        self.user_config.warn_error = False\n-        setattr(self.args, \"warn_error_options\", '{\"include\":\"all\"}')\n-        with pytest.raises(ValueError):\n-            flags.set_from_args(self.args, self.user_config)\n-        # cleanup\n-        self.user_config.warn_error = None\n-        delattr(self.args, \"warn_error_options\")\n-\n-        # options from user config + environ\n-        self.user_config.warn_error = False\n-        os.environ[\"DBT_WARN_ERROR_OPTIONS\"] = '{\"include\": []}'\n-        with pytest.raises(ValueError):\n-            flags.set_from_args(self.args, self.user_config)\n-        # cleanup\n-        self.user_config.warn_error = None\n-        os.environ.pop(\"DBT_WARN_ERROR_OPTIONS\")\n-\n-        # options from args + environ\n-        setattr(self.args, \"warn_error\", False)\n-        os.environ[\"DBT_WARN_ERROR_OPTIONS\"] = '{\"include\": []}'\n-        with pytest.raises(ValueError):\n-            flags.set_from_args(self.args, self.user_config)\n-        # cleanup\n-        delattr(self.args, \"warn_error\")\n-        os.environ.pop(\"DBT_WARN_ERROR_OPTIONS\")\n```\n\nFilename: tests/unit/test_graph.py:\n```\n@@ -16,6 +16,7 @@\nimport dbt.parser.manifest\n from dbt import tracking\n from dbt.contracts.files import SourceFile, FileHash, FilePath\n+from dbt.contracts.project import ProjectFlags\n from dbt.contracts.graph.manifest import MacroManifest, ManifestStateCheck\n from dbt.graph import NodeSelector, parse_difference\n from dbt.events.functions import setup_event_logger\n\n@@ -130,7 +131,7 @@\ndef get_config(self, extra_cfg=None):\n         cfg.update(extra_cfg)\n \n         config = config_from_parts_or_dicts(project=cfg, profile=self.profile)\n-        dbt.flags.set_from_args(Namespace(), config)\n+        dbt.flags.set_from_args(Namespace(), ProjectFlags())\n         setup_event_logger(dbt.flags.get_flags())\n         object.__setattr__(dbt.flags.get_flags(), \"PARTIAL_PARSE\", False)\n         return config\n```\n\nFilename: tests/unit/test_graph_selection.py:\n```\n@@ -13,9 +13,9 @@\nfrom dbt import flags\n \n from argparse import Namespace\n-from dbt.contracts.project import UserConfig\n+from dbt.contracts.project import ProjectFlags\n \n-flags.set_from_args(Namespace(), UserConfig())\n+flags.set_from_args(Namespace(), ProjectFlags())\n \n \n def _get_graph():\n```\n\nFilename: tests/unit/test_manifest.py:\n```\n@@ -1239,7 +1239,7 @@\ndef test_find_generate_macros_by_name(macros, expectations):\n FindMaterializationSpec = namedtuple(\"FindMaterializationSpec\", \"macros,adapter_type,expected\")\n \n \n-def _materialization_parameter_sets():\n+def _materialization_parameter_sets_legacy():\n     # inject the plugins used for materialization parameter tests\n     with mock.patch(\"dbt.adapters.base.plugin.project_name_from_path\") as get_name:\n         get_name.return_value = \"foo\"\n\n@@ -1386,12 +1386,187 @@\ndef id_mat(arg):\n         return \"_\".join(arg)\n \n \n+@pytest.mark.parametrize(\n+    \"macros,adapter_type,expected\",\n+    _materialization_parameter_sets_legacy(),\n+    ids=id_mat,\n+)\n+def test_find_materialization_by_name_legacy(macros, adapter_type, expected):\n+    set_from_args(\n+        Namespace(\n+            SEND_ANONYMOUS_USAGE_STATS=False,\n+            REQUIRE_EXPLICIT_PACKAGE_OVERRIDES_FOR_BUILTIN_MATERIALIZATIONS=False,\n+        ),\n+        None,\n+    )\n+\n+    manifest = make_manifest(macros=macros)\n+    result = manifest.find_materialization_macro_by_name(\n+        project_name=\"root\",\n+        materialization_name=\"my_materialization\",\n+        adapter_type=adapter_type,\n+    )\n+    if expected is None:\n+        assert result is expected\n+    else:\n+        expected_package, expected_adapter_type = expected\n+        assert result.adapter_type == expected_adapter_type\n+        assert result.package_name == expected_package\n+\n+\n+def _materialization_parameter_sets():\n+    # inject the plugins used for materialization parameter tests\n+    with mock.patch(\"dbt.adapters.base.plugin.project_name_from_path\") as get_name:\n+        get_name.return_value = \"foo\"\n+        FooPlugin = AdapterPlugin(\n+            adapter=mock.MagicMock(),\n+            credentials=mock.MagicMock(),\n+            include_path=\"/path/to/root/plugin\",\n+        )\n+        FooPlugin.adapter.type.return_value = \"foo\"\n+        inject_plugin(FooPlugin)\n+\n+        BarPlugin = AdapterPlugin(\n+            adapter=mock.MagicMock(),\n+            credentials=mock.MagicMock(),\n+            include_path=\"/path/to/root/plugin\",\n+            dependencies=[\"foo\"],\n+        )\n+        BarPlugin.adapter.type.return_value = \"bar\"\n+        inject_plugin(BarPlugin)\n+\n+        sets = [\n+            FindMaterializationSpec(macros=[], adapter_type=\"foo\", expected=None),\n+        ]\n+\n+        # default only, each project\n+        sets.extend(\n+            FindMaterializationSpec(\n+                macros=[MockMaterialization(project, adapter_type=None)],\n+                adapter_type=\"foo\",\n+                expected=(project, \"default\"),\n+            )\n+            for project in [\"root\", \"dep\", \"dbt\"]\n+        )\n+\n+        # other type only, each project\n+        sets.extend(\n+            FindMaterializationSpec(\n+                macros=[MockMaterialization(project, adapter_type=\"bar\")],\n+                adapter_type=\"foo\",\n+                expected=None,\n+            )\n+            for project in [\"root\", \"dep\", \"dbt\"]\n+        )\n+\n+        # matching type only, each project\n+        sets.extend(\n+            FindMaterializationSpec(\n+                macros=[MockMaterialization(project, adapter_type=\"foo\")],\n+                adapter_type=\"foo\",\n+                expected=(project, \"foo\"),\n+            )\n+            for project in [\"root\", \"dep\", \"dbt\"]\n+        )\n+\n+        sets.extend(\n+            [\n+                # matching type and default everywhere\n+                FindMaterializationSpec(\n+                    macros=[\n+                        MockMaterialization(project, adapter_type=atype)\n+                        for (project, atype) in product([\"root\", \"dep\", \"dbt\"], [\"foo\", None])\n+                    ],\n+                    adapter_type=\"foo\",\n+                    expected=(\"root\", \"foo\"),\n+                ),\n+                # default in core, override is in dep, and root has unrelated override\n+                # should find the dbt default because default materializations cannot be overwritten by packages.\n+                FindMaterializationSpec(\n+                    macros=[\n+                        MockMaterialization(\"root\", adapter_type=\"bar\"),\n+                        MockMaterialization(\"dep\", adapter_type=\"foo\"),\n+                        MockMaterialization(\"dbt\", adapter_type=None),\n+                    ],\n+                    adapter_type=\"foo\",\n+                    expected=(\"dbt\", \"default\"),\n+                ),\n+                # default in core, unrelated override is in dep, and root has an override\n+                # should find the root override.\n+                FindMaterializationSpec(\n+                    macros=[\n+                        MockMaterialization(\"root\", adapter_type=\"foo\"),\n+                        MockMaterialization(\"dep\", adapter_type=\"bar\"),\n+                        MockMaterialization(\"dbt\", adapter_type=None),\n+                    ],\n+                    adapter_type=\"foo\",\n+                    expected=(\"root\", \"foo\"),\n+                ),\n+                # default in core, override is in dep, and root has an override too.\n+                # should find the root override.\n+                FindMaterializationSpec(\n+                    macros=[\n+                        MockMaterialization(\"root\", adapter_type=\"foo\"),\n+                        MockMaterialization(\"dep\", adapter_type=\"foo\"),\n+                        MockMaterialization(\"dbt\", adapter_type=None),\n+                    ],\n+                    adapter_type=\"foo\",\n+                    expected=(\"root\", \"foo\"),\n+                ),\n+                # core has default + adapter, dep has adapter, root has default\n+                # should find the default adapter implementation, because it's the most specific\n+                # and default materializations cannot be overwritten by packages\n+                FindMaterializationSpec(\n+                    macros=[\n+                        MockMaterialization(\"root\", adapter_type=None),\n+                        MockMaterialization(\"dep\", adapter_type=\"foo\"),\n+                        MockMaterialization(\"dbt\", adapter_type=None),\n+                        MockMaterialization(\"dbt\", adapter_type=\"foo\"),\n+                    ],\n+                    adapter_type=\"foo\",\n+                    expected=(\"dbt\", \"foo\"),\n+                ),\n+            ]\n+        )\n+\n+        # inherit from parent adapter\n+        sets.extend(\n+            FindMaterializationSpec(\n+                macros=[MockMaterialization(project, adapter_type=\"foo\")],\n+                adapter_type=\"bar\",\n+                expected=(project, \"foo\"),\n+            )\n+            for project in [\"root\", \"dep\", \"dbt\"]\n+        )\n+        sets.extend(\n+            FindMaterializationSpec(\n+                macros=[\n+                    MockMaterialization(project, adapter_type=\"foo\"),\n+                    MockMaterialization(project, adapter_type=\"bar\"),\n+                ],\n+                adapter_type=\"bar\",\n+                expected=(project, \"bar\"),\n+            )\n+            for project in [\"root\", \"dep\", \"dbt\"]\n+        )\n+\n+        return sets\n+\n+\n @pytest.mark.parametrize(\n     \"macros,adapter_type,expected\",\n     _materialization_parameter_sets(),\n     ids=id_mat,\n )\n def test_find_materialization_by_name(macros, adapter_type, expected):\n+    set_from_args(\n+        Namespace(\n+            SEND_ANONYMOUS_USAGE_STATS=False,\n+            REQUIRE_EXPLICIT_PACKAGE_OVERRIDES_FOR_BUILTIN_MATERIALIZATIONS=True,\n+        ),\n+        None,\n+    )\n+\n     manifest = make_manifest(macros=macros)\n     result = manifest.find_materialization_macro_by_name(\n         project_name=\"root\",\n```"
            }
        ],
        "sw_version": "v1.6.13",
        "sw_version_wget": "https://github.com/dbt-labs/dbt-core/archive/refs/tags/v1.6.13.zip",
        "description": "dbt enables data analysts and engineers to transform their data using the same practices that software engineers use to build applications. When a user installs a package in dbt, it has the ability to override macros, materializations, and other core components of dbt. This is by design, as it allows packages to extend and customize dbt's functionality. However, this also means that a malicious package could potentially override these components with harmful code. This issue has been fixed in versions 1.8.0, 1.6.14 and 1.7.14. Users are advised to upgrade. There are no kn own workarounds for this vulnerability. Users updating to either 1.6.14 or 1.7.14 will need to set `flags.require_explicit_package_overrides_for_builtin_materializations: False` in their configuration in `dbt_project.yml`.",
        "sec_adv": [
            {
                "url": "https://github.com/dbt-labs/dbt-core/security/advisories/GHSA-p3f3-5ccg-83xq",
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\ndbt-labs\n/\ndbt-core\nPublic\nNotifications You must be signed in to change notification settings\nFork 1.7k\nStar 10.8k\nCode\nIssues\n582\nPull requests\n123\nDiscussions\nActions\nWiki\nSecurity\n4\nInsights\nAdditional navigation options\nImplicit override for built-in materializations from installed packages\nModerate MichelleArk published GHSA-p3f3-5ccg-83xq on Jul 16, 2024Jul 16, 2024\nPackage\ndbt-core\nAffected versions\n1.6, 1.7\nPatched versions\n1.6.14, 1.7.14\nDescription\nImpact\nWhat kind of vulnerability is it? Who is impacted?\nWhen a user installs a package in dbt, it has the ability to override macros, materializations, and other core components of dbt. This is by design, as it allows packages to extend and customize dbt's functionality. However, this also means that a malicious package could potentially override these components with harmful code.\nPatches\nHas the problem been patched? What versions should users upgrade to?\nFixed on 1.8.0, and patched for 1.6.14 and 1.7.14 releases.\nWorkarounds\nIs there a way for users to fix or remediate the vulnerability without upgrading?\nPreviously, a materialization defined in a package that shared a name with one of the built-in materializations would be preferred by default, without user action which is surprising and makes it more difficult to detect the insecure behaviour. We've changed the default behaviour to require explicit overrides by users in 1.8.0, and provided the ability to opt-out of built-in materialization overrides in 1.6 and 1.7 via the flags.require_explicit_package_overrides_for_builtin_materializations: False configuration in dbt_project.yml\nVersions older than 1.6 are EOL.\nReferences\nAre there any links users can visit to find out more?\ndbt documentation: https://docs.getdbt.com/reference/global-configs/legacy-behaviors#behavior-change-flags\nhttps://www.elementary-data.com/post/are-dbt-packages-secure-the-answer-lies-in-your-dwh-policies\nhttps://www.equalexperts.com/blog/tech-focus/are-you-at-risk-from-this-critical-dbt-vulnerability/\nhttps://tempered.works/posts/2024/07/06/preventing-data-theft-with-gcp-service-controls/\nSeverity\nModerate\n4.2\n/ 10\nCVSS v3 base metrics\nAttack vector\nLocal\nAttack complexity\nHigh\nPrivileges required\nLow\nUser interaction\nRequired\nScope\nUnchanged\nConfidentiality\nLow\nIntegrity\nLow\nAvailability\nLow\nLearn more about base metrics\nCVSS:3.1/AV:L/AC:H/PR:L/UI:R/S:U/C:L/I:L/A:L\nCVE ID\nCVE-2024-40637\nWeaknesses\nNo CWEs\nCredits\nbrabster\nReporter\nFooter\n 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": false,
                "effective_reason": "The advisory does not provide step-by-step instructions or a proof of concept to reproduce the vulnerability, only a description."
            }
        ],
        "cwe": [
            {
                "id": "CWE-74",
                "value": "CWE-74: Improper Neutralization of Special Elements in Output Used by a Downstream Component ('Injection')"
            }
        ]
    }
}