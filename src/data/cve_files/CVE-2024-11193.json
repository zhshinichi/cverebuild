{
    "CVE-2024-11193": {
        "published_date": "2024-11-13T21:04:12.910Z",
        "patch_commits": [
            {
                "url": "https://github.com/yugabyte/yugabyte-db/commit/0bf6e5a3e9c0718a28e654483596615d0798b208",
                "content": "[BACKPORT 2024.1][PLAT-13707] redact ysql_hba_conf_csv value from logs\n\nSummary:\nOriginal commit: 6fe34d463ea87943ef2c483687008ab42b2d2970/D37481\n\nWe currently log the value of ysql_hba_conf_csv during Gflags operations.\nThis gflag contains the ldap bind password so need to redact it before logging.\n\nTest Plan: Manually verified that the value of the flag is redacted in logs during gflag upgrade.\n\nReviewers: vbansal\n\nReviewed By: vbansal\n\nSubscribers: yugaware\n\nDifferential Revision: https://phorge.dev.yugabyte.com/D37499\n\nFilename: managed/src/main/java/com/yugabyte/yw/commissioner/TaskExecutor.java:\n```\n@@ -1017,9 +1017,9 @@\nsynchronized void updateTaskDetailsOnError(TaskInfo.State state, Throwable t) {\n           \"Task state must be one of \" + TaskInfo.ERROR_STATES);\n       taskInfo.refresh();\n       ObjectNode taskDetails = taskInfo.getDetails().deepCopy();\n-      // Method maskConfig does not modify the input as it makes a deep-copy.\n-      String maskedTaskDetails = CommonUtils.maskConfig(taskDetails).toString();\n       String errorString;\n+      // Method getRedactedParams does not modify the input as it makes a deep-copy.\n+      String redactedTaskParams = taskInfo.getRedactedParams().toString();\n       if (state == TaskInfo.State.Aborted && isShutdown.get()) {\n         errorString = \"Platform shutdown\";\n       } else {\n\n@@ -1032,14 +1032,14 @@\nsynchronized void updateTaskDetailsOnError(TaskInfo.State state, Throwable t) {\n         errorString =\n             String.format(\n                 \"Failed to execute task %s, hit error:\\n\\n %s.\",\n-                StringUtils.abbreviate(maskedTaskDetails, 500),\n+                StringUtils.abbreviate(redactedTaskParams, 500),\n                 StringUtils.abbreviateMiddle(cause.getMessage(), \"...\", 3000));\n       }\n       log.error(\n           \"Failed to execute task type {} UUID {} details {}, hit error.\",\n           taskInfo.getTaskType(),\n           taskInfo.getTaskUUID(),\n-          maskedTaskDetails,\n+          redactedTaskParams,\n           t);\n \n       if (log.isDebugEnabled()) {\n\n@@ -1330,7 +1330,14 @@\npublic void run() {\n             throw e;\n           }\n \n-          log.warn(\"Task {} attempt {} has failed\", getTask(), currentAttempt);\n+          String redactedParams =\n+              RedactingService.filterSecretFields(getTask().getTaskDetails(), RedactionTarget.LOGS)\n+                  .toString();\n+          log.warn(\n+              \"Task {} with params {} attempt {} has failed\",\n+              getTask().getName(),\n+              redactedParams,\n+              currentAttempt);\n           if (!getTask().onFailure(getTaskInfo(), e)) {\n             throw e;\n           }\n```\n\nFilename: managed/src/main/java/com/yugabyte/yw/commissioner/tasks/upgrade/GFlagsUpgrade.java:\n```\n@@ -4,12 +4,15 @@\nimport static play.mvc.Http.Status.BAD_REQUEST;\n \n+import com.fasterxml.jackson.databind.ObjectMapper;\n import com.yugabyte.yw.commissioner.BaseTaskDependencies;\n import com.yugabyte.yw.commissioner.ITask.Abortable;\n import com.yugabyte.yw.commissioner.ITask.Retryable;\n import com.yugabyte.yw.commissioner.UpgradeTaskBase;\n import com.yugabyte.yw.commissioner.UserTaskDetails.SubTaskGroupType;\n import com.yugabyte.yw.common.PlatformServiceException;\n+import com.yugabyte.yw.common.RedactingService;\n+import com.yugabyte.yw.common.RedactingService.RedactionTarget;\n import com.yugabyte.yw.common.XClusterUniverseService;\n import com.yugabyte.yw.common.config.UniverseConfKeys;\n import com.yugabyte.yw.common.gflags.GFlagsUtil;\n\n@@ -162,16 +165,37 @@\nprotected MastersAndTservers calculateNodesToBeRestarted() {\n           GFlagsUtil.getBaseGFlags(ServerType.MASTER, newCluster, newClusters.values());\n       Map<String, String> tserverGflags =\n           GFlagsUtil.getBaseGFlags(ServerType.TSERVER, newCluster, newClusters.values());\n+      ObjectMapper mapper = new ObjectMapper();\n+      String redactedMasterNewFlags =\n+          RedactingService.filterSecretFields(\n+                  mapper.valueToTree(masterGflags), RedactionTarget.LOGS)\n+              .toString();\n+      String redactedMasterOldFlags =\n+          RedactingService.filterSecretFields(\n+                  mapper.valueToTree(\n+                      GFlagsUtil.getBaseGFlags(ServerType.MASTER, curCluster, curClusters)),\n+                  RedactionTarget.LOGS)\n+              .toString();\n       log.debug(\n           \"Cluster {} master: new flags {} old flags {}\",\n           curCluster.clusterType,\n-          masterGflags,\n-          GFlagsUtil.getBaseGFlags(ServerType.MASTER, curCluster, curClusters));\n+          redactedMasterNewFlags,\n+          redactedMasterOldFlags);\n+      String redactedTsNewFlags =\n+          RedactingService.filterSecretFields(\n+                  mapper.valueToTree(tserverGflags), RedactionTarget.LOGS)\n+              .toString();\n+      String redactedTsOldFlags =\n+          RedactingService.filterSecretFields(\n+                  mapper.valueToTree(\n+                      GFlagsUtil.getBaseGFlags(ServerType.TSERVER, curCluster, curClusters)),\n+                  RedactionTarget.LOGS)\n+              .toString();\n       log.debug(\n           \"Cluster {} tserver: new flags {} old flags {}\",\n           curCluster.clusterType,\n-          tserverGflags,\n-          GFlagsUtil.getBaseGFlags(ServerType.TSERVER, curCluster, curClusters));\n+          redactedTsNewFlags,\n+          redactedTsOldFlags);\n \n       boolean changedByMasterFlags =\n           curCluster.clusterType == UniverseDefinitionTaskParams.ClusterType.PRIMARY\n```\n\nFilename: managed/src/main/java/com/yugabyte/yw/common/RedactingService.java:\n```\n@@ -92,6 +92,7 @@\npublic class RedactingService {\n           // LDAP - DB Universe Sync\n           .add(\"$..dbuserPassword\")\n           .add(\"$..ldapBindPassword\")\n+          .add(\"$..ysql_hba_conf_csv\")\n           .build();\n \n   // List of json paths to any secret fields we want to redact.\n```"
            }
        ],
        "sw_version": "v2.20.6.0",
        "sw_version_wget": "https://github.com/yugabyte/yugabyte-db/archive/refs/tags/v2.20.6.0.zip",
        "description": "An information disclosure vulnerability exists in Yugabyte Anywhere, where the LDAP bind password is logged in plaintext within application logs. This flaw results in the unintentional exposure of sensitive information in Yugabyte Anywhere logs, potentially allowing unauthorized users with access to these logs to view the LDAP bind password.Â An attacker with log access could exploit this vulnerability to gain unauthorized access to the LDAP server, leading to potential exposure or compromise of LDAP-managed resources\nThis issue affects YugabyteDB Anywhere: from 2.20.0.0 before 2.20.7.0, from 2.23.0.0 before 2.23.1.0, from 2024.1.0.0 before 2024.1.3.0.",
        "sec_adv": [],
        "cwe": [
            {
                "id": "CWE-532",
                "value": "CWE-532: Information Exposure Through Log Files"
            }
        ]
    }
}