{
    "CVE-2024-35234": {
        "published_date": "2024-07-03T18:23:10.179Z",
        "patch_commits": [
            {
                "url": "https://github.com/discourse/discourse/commit/26aef0c288839378b9de5819e96eac8cf4ea60fd",
                "content": "SECURITY: Fix Stored-dom XSS via Facebook Oneboxes\n\nFilename: lib/onebox/engine/facebook_media_onebox.rb:\n```\n@@ -6,7 +6,7 @@\nclass FacebookMediaOnebox\n       include Engine\n       include StandardEmbed\n \n-      matches_regexp(%r{^https?://.*\\.facebook\\.com/(\\w+)/(videos|\\?).*})\n+      matches_regexp(%r{^https?://(?:www\\.)?facebook\\.com/(\\w+)/(videos|\\?).*})\n       always_https\n       requires_iframe_origins \"https://www.facebook.com\"\n```\n\nFilename: spec/lib/onebox/engine/facebook_media_onebox_spec.rb:\n```\n@@ -0,0 +1,21 @@\n+# frozen_string_literal: true\n+\n+RSpec.describe Onebox::Engine::FacebookMediaOnebox do\n+  describe \"regex URI match\" do\n+    it \"matches videos with title\" do\n+      expect(match(\"https://www.facebook.com/user/videos/title/123456789/\")).to eq true\n+    end\n+\n+    it \"matches videos without a title\" do\n+      expect(match(\"https://facebook.com/user/videos/123456789\")).to eq true\n+    end\n+\n+    it \"only matches the facebook.com domain\" do\n+      expect(match(\"https://somedomain.com/a.facebook.com/a/videos\")).to eq false\n+    end\n+\n+    def match(url)\n+      Onebox::Engine::FacebookMediaOnebox === URI(url)\n+    end\n+  end\n+end\n```"
            },
            {
                "url": "https://github.com/discourse/discourse/commit/311b737c910cf0a69f61e1b8bc0b78374b6619d2",
                "content": "SECURITY: Fix Stored-dom XSS via Facebook Oneboxes\n\nFilename: lib/onebox/engine/facebook_media_onebox.rb:\n```\n@@ -6,7 +6,7 @@\nclass FacebookMediaOnebox\n       include Engine\n       include StandardEmbed\n \n-      matches_regexp(%r{^https?://.*\\.facebook\\.com/(\\w+)/(videos|\\?).*})\n+      matches_regexp(%r{^https?://(?:www\\.)?facebook\\.com/(\\w+)/(videos|\\?).*})\n       always_https\n       requires_iframe_origins \"https://www.facebook.com\"\n```\n\nFilename: spec/lib/onebox/engine/facebook_media_onebox_spec.rb:\n```\n@@ -0,0 +1,21 @@\n+# frozen_string_literal: true\n+\n+RSpec.describe Onebox::Engine::FacebookMediaOnebox do\n+  describe \"regex URI match\" do\n+    it \"matches videos with title\" do\n+      expect(match(\"https://www.facebook.com/user/videos/title/123456789/\")).to eq true\n+    end\n+\n+    it \"matches videos without a title\" do\n+      expect(match(\"https://facebook.com/user/videos/123456789\")).to eq true\n+    end\n+\n+    it \"only matches the facebook.com domain\" do\n+      expect(match(\"https://somedomain.com/a.facebook.com/a/videos\")).to eq false\n+    end\n+\n+    def match(url)\n+      Onebox::Engine::FacebookMediaOnebox === URI(url)\n+    end\n+  end\n+end\n```"
            }
        ],
        "sw_version": "v3.2.2",
        "sw_version_wget": "https://github.com/discourse/discourse/archive/refs/tags/v3.2.2.zip",
        "description": "Discourse is an open-source discussion platform. Prior to version 3.2.3 on the `stable` branch and version 3.3.0.beta3 on the `tests-passed` branch, an attacker can execute arbitrary JavaScript on users’ browsers by posting a specific URL containing maliciously crafted meta tags. This issue only affects sites with Content Security Polic (CSP) disabled. The problem has been patched in version 3.2.3 on the `stable` branch and version 3.3.0.beta3 on the `tests-passed` branch. As a workaround, ensure CSP is enabled on the forum.",
        "sec_adv": [
            {
                "url": "https://github.com/discourse/discourse/security/advisories/GHSA-5chg-hm8c-wc58",
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\ndiscourse\n/\ndiscourse\nPublic\nNotifications You must be signed in to change notification settings\nFork 8.5k\nStar 44k\nCode\nPull requests\n65\nActions\nSecurity\n147\nInsights\nAdditional navigation options\nStored-dom XSS via Facebook Oneboxes\nModerate nattsw published GHSA-5chg-hm8c-wc58 on Jul 3, 2024Jul 3, 2024\nPackage\nDiscourse\n(Discourse)\nAffected versions\nstable <= 3.2.2; tests-passed <= 3.3.0.beta2\nPatched versions\nstable > 3.2.2; tests-passed > 3.3.0.beta2\nDescription\nImpact\nAn attacker can execute arbitrary JavaScript on users’ browsers by posting a specific URL containing maliciously crafted meta tags. This issue only affects sites with CSP disabled.\nPatches\nThis problem is patched in the latest version of Discourse.\nWorkarounds\nEnsure CSP is enabled on the forum\nSeverity\nModerate\n4.2\n/ 10\nCVSS v3 base metrics\nAttack vector\nNetwork\nAttack complexity\nHigh\nPrivileges required\nNone\nUser interaction\nRequired\nScope\nUnchanged\nConfidentiality\nLow\nIntegrity\nNone\nAvailability\nLow\nLearn more about base metrics\nCVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:U/C:L/I:N/A:L\nCVE ID\nCVE-2024-35234\nWeaknesses\nNo CWEs\nCredits\n0xMokusou\nReporter\nFooter\n© 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": false,
                "effective_reason": "The advisory describes the vulnerability and mitigating actions but does not include a proof of concept or detailed reproduction steps."
            }
        ],
        "cwe": [
            {
                "id": "CWE-79",
                "value": "CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')"
            }
        ]
    }
}