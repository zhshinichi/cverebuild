{
    "CVE-2024-7472": {
        "published_date": "2024-10-29T12:49:50.701Z",
        "patch_commits": [
            {
                "url": "https://github.com/lunary-ai/lunary/commit/a39837d7c49936a0c435d241f37ca2ea7904d2cd",
                "content": "feat: name sanitization in emails (#517)\n\nFilename: packages/backend/src/utils/emails.ts:\n```\n@@ -1,9 +1,14 @@\nimport { signJWT } from \"@/src/api/v1/auth/utils\"\n import { sendEmail } from \"./sendEmail\"\n \n-function extractFirstName(name: string) {\n+function sanitizeName(name: string): string {\n+  return name.replace(/\\s+/g, \" \").trim()\n+}\n+\n+function extractFirstName(name: string): string {\n   if (!name) return \"there\"\n-  return name.split(\" \")[0]\n+  const sanitizedName = sanitizeName(name)\n+  return sanitizedName.split(\" \")[0]\n }\n \n export async function sendVerifyEmail(email: string, name: string = \"\") {\n```"
            }
        ],
        "sw_version": "v1.4.8",
        "sw_version_wget": "https://github.com/lunary-ai/lunary/archive/refs/tags/v1.4.8.zip",
        "description": "lunary-ai/lunary v1.2.26 contains an email injection vulnerability in the Send email verification API (/v1/users/send-verification) and Sign up API (/auth/signup). An unauthenticated attacker can inject data into outgoing emails by bypassing the extractFirstName function using a different whitespace character (e.g., \\xa0). This vulnerability can be exploited to conduct phishing attacks, damage the application's brand, cause legal and compliance issues, and result in financial impact due to unauthorized email usage.",
        "sec_adv": [
            {
                "url": "https://huntr.com/bounties/dc1feec6-1efb-4538-9b56-ab25deb80948",
                "content": "Bounties\nPartners\nCommunity\nInfo\nSUBMIT REPORT\nUnauthorized Email Injection Vulnerability in lunary-ai/lunary\nValid\nReported on Jul 10th 2024\nDescription\nThe Send email verification API (/v1/users/send-verification) and Sign up (/auth/signup) in the application contains a critical vulnerability that allows an unauthenticated attacker to inject data into outgoing emails.\nAlthough there is an extractFirstName function to prevent injection, it can be easily bypassed by using a different whitespace character, for example: \"\\xa0\".\nPoC\nReplace all \\x20 (normal whitespace character) in name to \\xa0 (another whitespace character) and send this POST request,\nPOST /v1/users/send-verification HTTP/1.1\nHost: {domain}\nContent-Type: application/json\nContent-Length: 159\n\n{\n    \"email\": \"{enter-email}\",\n    \"name\": \"Hi Inject Email Name\\nEmail Line 2\\nInjection Link: http://attacker.com/abcd\\nLine 4\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\"\n}\nCheck mailbox\nVideo PoC: YouTube\nImpact\nThe email verification feature within the application contains a critical vulnerability that allows an unauthenticated attacker to inject data into outgoing emails. This vulnerability poses several severe risks:\nPhishing Attacks\nAttackers can craft emails that appear legitimate to trick recipients into revealing sensitive information, such as passwords, credit card details, or personal identification numbers. Or injected content can include links to malicious websites or attachments, spreading malware or ransomware to unsuspecting recipients, which can compromise their systems and networks.\nBrand Damage\nThe integrity of the application's brand can be severely damaged if users receive fraudulent emails purportedly from the organization, leading to a loss of trust and credibility.\nLegal and Compliance Issues\nThe organization could face legal repercussions and fines if the vulnerability is exploited, leading to non-compliance with security standards and regulations.\nFinancial Impact\nSince the application uses api.resend.com to send emails, attackers can exhaust the service's quotas by sending a large volume of unauthorized emails. This can significantly increase operating costs due to overage charges or the need to purchase additional email quotas.\nBy addressing this critical vulnerability promptly, the organization can prevent these severe impacts and protect both its users and its reputation.\nOccurrences\nusers.ts L137-L144\n/v1/users/send-verification\nUnAuth API\ncan send multiple times to an email address\nname and email from user input\nWe are processing your report and will contact thelunary-ai/lunary team within 24 hours.10 months ago\nNguyen Cong Vinh modified the report10 months ago\nhuntr-helpermodified the Severity from Critical (9.4) to Critical (9.1)10 months ago\nWe have contacted a member of thelunary-ai/lunary team and are waiting to hear back10 months ago\nMarcellomodified the Severity from Critical (9.1) to Medium (5.3)10 months ago\nWe have sent a follow up to the lunary-ai/lunary team. We will try again in 4 days.10 months ago\nWe have sent a second follow up to the lunary-ai/lunary team. We will try again in 7 days.10 months ago\nWe have sent a third follow up to the lunary-ai/lunary team. We will try again in 14 days.10 months ago\nThe researcher has received a minor penalty to their credibility for miscalculating the severity: -1\nHugues Chocart validated this vulnerability9 months ago\nvn-ncvinhhas been awarded the disclosure bounty\nThe fix bounty is now up for grabs\nThe researcher's credibility has increased: +7\nCVE-2024-7472assigned to this report.9 months ago\nHugues Chocartmarked this as fixedin 1.4.10with commita398379 months ago\nHugues Chocarthas been awarded the fix bounty\nusers.ts#L137-L144 has been validated\nWe have sent a warning to the lunary-ai/lunary team to inform them that this report will be published in 48 hours7 months ago\nWe have notified the lunary-ai/lunary maintainers about this report in their weekly follow-up7 months ago\nThis vulnerability has now been published7 months ago\nSign in to join this conversation\nCVE\nCVE-2024-7472\n(Published)\nVulnerability Type\nCWE-75: Failure to Sanitize Special Elements into a Different Plane (Special Element Injection)\nSeverity\nMedium (5.3)\nAttack vector\nNetwork\nAttack complexity\nLow\nPrivileges required\nNone\nUser interaction\nNone\nScope\nUnchanged\nConfidentiality\nLow\nIntegrity\nNone\nAvailability\nNone\nOpen in visual CVSS calculator\nRegistry\nNpm\nAffected Version\nv1.2.26\nVisibility\nPublic\nStatus\nFixed\nDisclosure Bounty\n$75\nFix Bounty\n$18.75\nFound by\nFixed by\nSupported by Protect AI and leading the way to MLSecOps and greater AI security.\nÂ© 2024\nPrivacy Policy\nTerms of Service\nCode of Conduct\nCookie Preferences\nContact Us",
                "effective": true,
                "effective_reason": "The advisory includes a proof of concept by providing a direct example of an HTTP POST request that demonstrates the issue."
            }
        ],
        "cwe": [
            {
                "id": "CWE-75",
                "value": "CWE-75 Failure to Sanitize Special Elements into a Different Plane (Special Element Injection)"
            }
        ]
    }
}