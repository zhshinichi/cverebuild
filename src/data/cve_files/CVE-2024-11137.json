{
    "CVE-2024-11137": {
        "published_date": "2025-03-20T10:09:01.212Z",
        "patch_commits": [
            {
                "url": "https://github.com/lunary-ai/lunary/commit/ded72a95c220904a151d27daf3c67e8644e386c6",
                "content": "fix: security patch (#651)\n\nFilename: packages/backend/src/api/v1/runs/index.ts:\n```\n@@ -2,7 +2,7 @@\nimport sql from \"@/src/utils/db\";\n import { Context } from \"koa\";\n import Router from \"koa-router\";\n \n-import { checkAccess } from \"@/src/utils/authorization\";\n+import { checkAccess, checkProjectAccess } from \"@/src/utils/authorization\";\n import { convertChecksToSQL } from \"@/src/utils/checks\";\n import { jsonrepair } from \"jsonrepair\";\n import { Feedback, Score, deserializeLogic } from \"shared\";\n\n@@ -1016,8 +1016,14 @@\nruns.patch(\n   checkAccess(\"logs\", \"update\"),\n   async (ctx: Context) => {\n     const { id: runId } = ctx.params;\n+    const { projectId, userId } = ctx.state;\n     const { label, value, comment } = Score.parse(ctx.request.body);\n \n+    const hasProjectAccess = await checkProjectAccess(projectId, userId);\n+    if (!hasProjectAccess) {\n+      ctx.throw(401, \"Unauthorized\");\n+    }\n+\n     let [existingScore] =\n       await sql`select * from run_score where run_id = ${runId} and label = ${label}`;\n```"
            }
        ],
        "sw_version": "v1.6.0",
        "sw_version_wget": "https://github.com/lunary-ai/lunary/archive/refs/tags/v1.6.0.zip",
        "description": "An Insecure Direct Object Reference (IDOR) vulnerability exists in the `PATCH /v1/runs/:id/score` endpoint of lunary-ai/lunary version 1.6.0. This vulnerability allows an attacker to update the score data of any run by manipulating the id parameter in the request URL, which corresponds to the `runId_score` in the database. The endpoint does not sufficiently validate whether the authenticated user has permission to modify the specified runId, enabling an attacker with a valid account to modify other users' runId scores by specifying different id values. This issue was fixed in version 1.6.1.",
        "sec_adv": [
            {
                "url": "https://huntr.com/bounties/0a399d86-0105-4f48-a77b-9fa7d7054be8",
                "content": "Bounties\nPartners\nCommunity\nInfo\nSUBMIT REPORT\nIDOR Vulnerability in PATCH `/v1/runs/:id/score` Endpoint Allows Unauthorized Score Updates for Other Users’ Runs in lunary-ai/lunary\nValid\nReported on Nov 7th 2024\nDescription\nAn Insecure Direct Object Reference (IDOR) vulnerability exists in the PATCH /v1/runs/:id/score endpoint. This endpoint allows an attacker to update the score data of any run by manipulating the id parameter in the request URL, which corresponds to the runId_score in the database.\nThe endpoint does not sufficiently validate whether the authenticated user has permission to modify the specified runId. This allows an attacker with a valid account to modify other users’ runId scores by specifying different id values.\nVulnerable function\nruns.patch(\n  \"/:id/score\",\n  checkAccess(\"logs\", \"update\"),\n  async (ctx: Context) => {\n    const { id: runId } = ctx.params;\n    const { label, value, comment } = Score.parse(ctx.request.body);\n\n    let [existingScore] =\n      await sql`select * from run_score where run_id = ${runId}`;\n\n    if (!existingScore) {\n      await sql`insert into run_score ${sql({ runId, label, value, comment })}`;\n    } else {\n      await sql`update run_score set ${sql({ label, value, comment })} where run_id = ${runId}`;\n    }\n\n    ctx.status = 200;\n  },\n);\nIn this function, the application does not verify if the runId belongs to the authenticated user. As a result, an attacker can supply any arbitrary runId and, if the ID exists, the application will update the associated data in the database. If the runId does not exist, the application inserts new data. This lack of validation allows for an Insecure Direct Object Reference (IDOR) vulnerability, enabling attackers to access and modify other users’ data.\nProof of Concept\nLogin with a valid user account and obtain an authorization token.\nSend the following request to update the score associated with the victim’s runId:\nPATCH /v1/runs/:UUID/score HTTP/1.1\nHost: api.lunary.ai\nAuthorization: Bearer <your_auth_token>\nContent-Type: application/json\n\n{\n  \"label\": \"New Label\",\n  \"value\": 100,\n  \"comment\": \"Updated score via IDOR\"\n}\nReplace :UUID in the URL with the victim’s runId to update their score.\nImpact\nAn attacker can update the label, value, and comment fields for any runId in the run_score table, potentially altering or disrupting data integrity across user accounts.\nReferences\nOWASP Top 10 - Broken Access Control\nWe are processing your report and will contact thelunary-ai/lunary team within 24 hours.6 months ago\nHugues Chocartmodified the Severity from Medium (6.5) to High (7.5)6 months ago\nThe researcher has received a minor penalty to their credibility for miscalculating the severity: -1\nHugues Chocart validated this vulnerability6 months ago\nsharokhataiehas been awarded the disclosure bounty\nThe fix bounty is now up for grabs\nThe researcher's credibility has increased: +7\nCVE-2024-11137assigned to this report.6 months ago\nHugues Chocartmarked this as fixedin 1.6.1with commitded72a6 months ago\nHugues Chocarthas been awarded the fix bounty\nHugues Chocart\ncommented6 months ago\nMaintainer\n(fixed in version 1.6.2, not 1.6.1)\nA lunary-ai/lunary maintainerhas acknowledged this report6 months ago\nThe scheduled publication date was automatically extended from 5th Feb 2025  to 12th Feb 2025  due to the maintainers acknowledgement of the report6 months ago\nHugues Chocart gave praise6 months ago\nthanks for contibuting\nThe researcher's credibility has slightly increased as a result of the maintainer's thanks: +1\nSharo_k_h\ncommented6 months ago\nResearcher\nThank you for the bounty and for being an incredible team!\nWe have sent a warning to the lunary-ai/lunary team to inform them that this report will be published in 48 hours3 months ago\nWe have notified the lunary-ai/lunary maintainers about this report in their weekly follow-up3 months ago\nThis vulnerability has now been published3 months ago\nCVE-2024-11137has now been published2 months ago\nSign in to join this conversation\nCVE\nCVE-2024-11137\n(Published)\nVulnerability Type\nCWE-284: Improper Access Control\nSeverity\nHigh (7.5)\nAttack vector\nNetwork\nAttack complexity\nLow\nPrivileges required\nNone\nUser interaction\nNone\nScope\nUnchanged\nConfidentiality\nNone\nIntegrity\nHigh\nAvailability\nNone\nOpen in visual CVSS calculator\nRegistry\nNpm\nAffected Version\nv1.6.0\nVisibility\nPublic\nStatus\nFixed\nDisclosure Bounty\n$450\nFix Bounty\n$112.5\nFound by\nSharo_k_h\n@sharokhataie\nLIGHTWEIGHT\nFixed by\nSupported by Protect AI and leading the way to MLSecOps and greater AI security.\n© 2024\nPrivacy Policy\nTerms of Service\nCode of Conduct\nCookie Preferences\nContact Us",
                "effective": true,
                "effective_reason": "The security advisory includes a step-by-step proof of concept for exploiting the IDOR vulnerability."
            }
        ],
        "cwe": [
            {
                "id": "CWE-284",
                "value": "CWE-284 Improper Access Control"
            }
        ]
    }
}