{
    "CVE-2024-7456": {
        "published_date": "2024-11-01T12:05:12.189Z",
        "patch_commits": [
            {
                "url": "https://github.com/lunary-ai/lunary/commit/6a0bc201181e0f4a0cc375ccf4ef0d7ae65c8a8e",
                "content": "fix: query param vulnerability (#467)\n\nFilename: packages/backend/src/api/v1/external-users.ts:\n```\n@@ -18,7 +18,10 @@\nusers.get(\"/\", checkAccess(\"users\", \"list\"), async (ctx: Context) => {\n     endDate: z.string().datetime().optional(),\n     timeZone: z.string().optional(),\n     sortField: z.string().optional().default(\"createdAt\"),\n-    sortDirection: z.string().optional().default(\"desc\"),\n+    sortDirection: z\n+      .union([z.literal(\"acs\"), z.literal(\"desc\")])\n+      .optional()\n+      .default(\"desc\"),\n   })\n   const {\n     limit,\n```"
            }
        ],
        "sw_version": "v1.4.3-alpha.2",
        "sw_version_wget": "https://github.com/lunary-ai/lunary/archive/refs/tags/v1.4.3-alpha.2.zip",
        "description": "A SQL injection vulnerability exists in the `/api/v1/external-users` route of lunary-ai/lunary version v1.4.2. The `order by` clause of the SQL query uses `sql.unsafe` without prior sanitization, allowing for SQL injection. The `orderByClause` variable is constructed without server-side validation or sanitization, enabling an attacker to execute arbitrary SQL commands. Successful exploitation can lead to complete data loss, modification, or corruption.",
        "sec_adv": [
            {
                "url": "https://huntr.com/bounties/bfb3015e-5642-4d94-ab49-e8b49c4e07e4",
                "content": "Bounties\nPartners\nCommunity\nInfo\nSUBMIT REPORT\nSQL injection in the `/api/v1/external-users` route in lunary-ai/lunary\nValid\nReported on Aug 3rd 2024\nDescription\nIn the external-users route, the order by clause of the SQL query uses sql.unsafe, allowing for SQL injection without prior sanitization. The variable is constructed without server-side validation or sanitization:\nlet orderByClause = ${sortMapping[sortField]} ${sortDirection} nulls last\nThe variable passed unsafely is prepared without validation on the server :\nData is passed directly from the client without validation on the server.\nProof of Concept\nEnsure the application is running.\nOpen the dashboard, inspect a request, and copy the access token.\nRun the malicious query:\ncurl -X GET \"http://localhost:3000/api/v1/external-users?sortField=createdAt);DROP%20TABLE%20public.external_user;--&sortDirection=asc\" -H \"Authorization: Bearer YourToken\"\nImpact\nSuccessful exploitation can lead to the execution of arbitrary SQL commands, leading to complete data loss, modification or corruption.\nOccurrences\nexternal-users.ts L51-L87\nHere the order by clause is left unprotected:\n order by\n        ${sql.unsafe(orderByClause)} \nAnd the variable is constructed without sanitization:\nlet orderByClause = `${sortMapping[sortField]} ${sortDirection} nulls last`\nThe zod validation allows for any string:\nconst querySchema = z.object({\n    limit: z.coerce.number().optional().default(100),\n    page: z.coerce.number().optional().default(0),\n    search: z.string().optional(),\n    startDate: z.string().datetime().optional(),\n    endDate: z.string().datetime().optional(),\n    timeZone: z.string().optional(),\n    sortField: z.string().optional().default(\"createdAt\"),\n    sortDirection: z.string().optional().default(\"desc\"),\n})\nWe are processing your report and will contact thelunary-ai/lunary team within 24 hours.9 months ago\nhuntr-helpermodified the Severity from Critical (9.9) to Critical (9.8)9 months ago\nThe researcher has received a minor penalty to their credibility for miscalculating the severity: -1\nHugues Chocart validated this vulnerability9 months ago\nantonin36330has been awarded the disclosure bounty\nThe fix bounty is now up for grabs\nThe researcher's credibility has increased: +7\nCVE-2024-7456assigned to this report.9 months ago\nHugues Chocartmarked this as fixedin 1.4.3with commit6a0bc29 months ago\nHugues Chocarthas been awarded the fix bounty\nexternal-users.ts#L51-L87 has been validated\nWe have notified the lunary-ai/lunary maintainers about this report in their weekly follow-up7 months ago\nWe have sent a warning to the lunary-ai/lunary team to inform them that this report will be published in 48 hours7 months ago\nThis vulnerability has now been published7 months ago\nCVE-2024-7456has now been published7 months ago\nmonty099\ncommented6 months ago\nGood\nmonty099\ncommented6 months ago\nGood\nmonty099\ncommented6 months ago\nnice\nmonty099\ncommented6 months ago\nparticle-ioa\ncommented6 months ago\ntest\nSign in to join this conversation\nCVE\nCVE-2024-7456\n(Published)\nVulnerability Type\nCWE-89: SQL Injection\nSeverity\nCritical (9.8)\nAttack vector\nNetwork\nAttack complexity\nLow\nPrivileges required\nNone\nUser interaction\nNone\nScope\nUnchanged\nConfidentiality\nHigh\nIntegrity\nHigh\nAvailability\nHigh\nOpen in visual CVSS calculator\nRegistry\nNpm\nAffected Version\nv1.4.2\nVisibility\nPublic\nStatus\nFixed\nDisclosure Bounty\n$900\nFix Bounty\n$225\nFound by\nFixed by\nSupported by Protect AI and leading the way to MLSecOps and greater AI security.\nÂ© 2024\nPrivacy Policy\nTerms of Service\nCode of Conduct\nCookie Preferences\nContact Us",
                "effective": true,
                "effective_reason": "The advisory contains a detailed example illustrating the exploit, such as a specific curl command structured to exploit the vulnerability."
            }
        ],
        "cwe": [
            {
                "id": "CWE-89",
                "value": "CWE-89 Improper Neutralization of Special Elements used in an SQL Command"
            }
        ]
    }
}