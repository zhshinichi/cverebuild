{
    "CVE-2024-3501": {
        "published_date": "2024-11-14T17:34:36.048Z",
        "patch_commits": [
            {
                "url": "https://github.com/lunary-ai/lunary/commit/17e95f6c99c7d5ac4ee5451c5857b97a12892c74",
                "content": "fix: user payload (#191)\n\nFilename: packages/backend/src/api/v1/users.ts:\n```\n@@ -34,14 +34,12 @@\nusers.get(\"/me/org\", async (ctx: Context) => {\n       select\n         account.id,\n         account.created_at,\n-        account.recovery_token,\n         account.email,\n         account.org_id,\n         account.role,\n         account.verified,\n         account.avatar_url,\n         account.last_login_at,\n-        account.single_use_token,\n         array_agg(account_project.project_id) as projects\n       from\n         account\n\n@@ -66,14 +64,12 @@\nusers.get(\"/me\", async (ctx: Context) => {\n       select\n         account.id,\n         account.created_at,\n-        account.recovery_token,\n         account.email,\n         account.org_id,\n         account.role,\n         account.verified,\n         account.avatar_url,\n         account.last_login_at,\n-        account.single_use_token,\n         array_agg(account_project.project_id) as projects\n       from\n         account\n```"
            }
        ],
        "sw_version": "v1.2.5",
        "sw_version_wget": "https://github.com/lunary-ai/lunary/archive/refs/tags/v1.2.5.zip",
        "description": "In lunary-ai/lunary versions up to and including 1.2.5, an information disclosure vulnerability exists due to the inclusion of single-use tokens in the responses of `GET /v1/users/me` and `GET /v1/users/me/org` API endpoints. These tokens, intended for sensitive operations such as password resets or account verification, are exposed to unauthorized actors, potentially allowing them to perform actions on behalf of the user. This issue was addressed in version 1.2.6, where the exposure of single-use tokens in user-facing queries was mitigated.",
        "sec_adv": [
            {
                "url": "https://huntr.com/bounties/8fdfdb9d-10bd-4f00-8004-d5baabc20c6e",
                "content": "Bounties\nPartners\nCommunity\nInfo\nSUBMIT REPORT\nSingle-use tokens of users are returned in the responses in lunary-ai/lunary\nValid\nReported on Apr 8th 2024\nDescription\nA user can see the single-use tokens of users in a project when inspecting GET /v1/users/me and GET /v1/users/me/org responses.\nProof of Concept\nLog in with a member in the app, where this user already belongs to a project.\nInspect the traffic and capture the requests/responses for GET /v1/users/me and GET /v1/users/me/org.\nNote the responses include the single-use tokens (account.single_use_token) for the authenticated user and the rest of the users in the project.\nImpact\nSingle-use tokens are typically used for sensitive operations, such as password resets or account verification. Exposing these tokens to unauthorized actors could potentially allow them to perform actions on behalf of the user, compromising the security of user accounts. It is crucial to ensure that single-use tokens are not returned in any user-facing queries and are properly invalidated after their intended use.\nOccurrences\nusers.ts L37\nNote the SQL query here: single_use_token is included in the selected attributes and returned when GET /v1/users/me/org is requested.\nconst users = await sql`\n      select\n        account.id,\n        account.created_at,\n        account.recovery_token,\n        account.email,\n        account.org_id,\n        account.role,\n        account.verified,\n        account.avatar_url,\n        account.last_login_at,\n        account.single_use_token,\n        array_agg(account_project.project_id) as projects\n      from\n        account\n        left join account_project on account.id = account_project.account_id\n      where\n        account.org_id = ${org.id}\n      group by\n        account.id\n      order by\n        account.role,\n        account.name\n    `\n  org.users = users\n  ctx.body = org\nWe are processing your report and will contact thelunary-ai/lunary team within 24 hours.a year ago\nhuntr-helpermodified the Severity from Critical (9.9) to Critical (9.1)a year ago\nThe researcher has received a minor penalty to their credibility for miscalculating the severity: -1\nHugues Chocart validated this vulnerabilitya year ago\nantonin36330has been awarded the disclosure bounty\nThe fix bounty is now up for grabs\nThe researcher's credibility has increased: +7\nCVE-2024-3501assigned to this report.a year ago\nHugues Chocartmarked this as fixedin 1.2.6with commit17e95fa year ago\nThe fix bounty has been dropped\nusers.ts#L37 has been validated\nHugues Chocart gave praisea year ago\nThank you\nThe researcher's credibility has slightly increased as a result of the maintainer's thanks: +1\nPavlosmarked this as fixedin 1.2.6with commit17e95fa year ago\nHugues Chocarthas been awarded the fix bounty\nusers.ts#L37 has been validated\nWe have notified the lunary-ai/lunary maintainers about this report in their weekly follow-up6 months ago\nThis vulnerability has now been published6 months ago\nCVE-2024-3501has now been published6 months ago\nSign in to join this conversation\nCVE\nCVE-2024-3501\n(Published)\nVulnerability Type\nCWE-922: Insecure Storage of Sensitive Information\nSeverity\nCritical (9.1)\nAttack vector\nNetwork\nAttack complexity\nLow\nPrivileges required\nNone\nUser interaction\nNone\nScope\nUnchanged\nConfidentiality\nHigh\nIntegrity\nHigh\nAvailability\nNone\nOpen in visual CVSS calculator\nRegistry\nNpm\nAffected Version\n1.2.5\nVisibility\nPublic\nStatus\nFixed\nDisclosure Bounty\n$1080\nFix Bounty\n$225\nFound by\nFixed by\nSupported by Protect AI and leading the way to MLSecOps and greater AI security.\nÂ© 2024\nPrivacy Policy\nTerms of Service\nCode of Conduct\nCookie Preferences\nContact Us",
                "effective": true,
                "effective_reason": "The provided advisory includes a detailed proof of concept for reproducing the vulnerability."
            }
        ],
        "cwe": [
            {
                "id": "CWE-200",
                "value": "CWE-200 Exposure of Sensitive Information to an Unauthorized Actor"
            }
        ]
    }
}