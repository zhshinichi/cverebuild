{
    "CVE-2024-3651": {
        "published_date": "2024-07-07T17:22:10.032Z",
        "patch_commits": [
            {
                "url": "https://github.com/kjd/idna/commit/1d365e17e10d72d0b7876316fc7b9ca0eebdd38d",
                "content": "Release v3.7\n\nFilename: HISTORY.rst:\n```\n@@ -3,6 +3,14 @@\nHistory\n -------\n \n+3.7 (2024-04-11)\n+++++++++++++++++\n+\n+- Fix issue where specially crafted inputs to encode() could\n+  take exceptionally long amount of time to process. [CVE-2024-3651]\n+\n+Thanks to Guido Vranken for reporting the issue.\n+\n 3.6 (2023-11-25)\n ++++++++++++++++\n```\n\nFilename: LICENSE.md:\n```\n@@ -1,6 +1,6 @@\nBSD 3-Clause License\n \n-Copyright (c) 2013-2023, Kim Davies and contributors.\n+Copyright (c) 2013-2024, Kim Davies and contributors.\n All rights reserved.\n \n Redistribution and use in source and binary forms, with or without\n```\n\nFilename: idna/package_data.py:\n```\n@@ -1,2 +1,2 @@\n-__version__ = '3.6'\n+__version__ = '3.7'\n```"
            }
        ],
        "sw_version": "v3.6",
        "sw_version_wget": "https://github.com/kjd/idna/archive/refs/tags/v3.6.zip",
        "description": "A vulnerability was identified in the kjd/idna library, specifically within the `idna.encode()` function, affecting version 3.6. The issue arises from the function's handling of crafted input strings, which can lead to quadratic complexity and consequently, a denial of service condition. This vulnerability is triggered by a crafted input that causes the `idna.encode()` function to process the input with considerable computational load, significantly increasing the processing time in a quadratic manner relative to the input size.",
        "sec_adv": [
            {
                "url": "https://huntr.com/bounties/93d78d07-d791-4b39-a845-cbfabc44aadb",
                "content": "Bounties\nPartners\nCommunity\nInfo\nSUBMIT REPORT\nidna encode() quadratic complexity leading to denial of service in kjd/idna\nValid\nReported on Mar 17th 2024\nA crafted input string can take idna.encode() a long time to process. Reproducer:\nimport idna\nSIZE = 16384\nheader = [0x32, 0xdf, 0x8d]\nmiddle = [0xe2, 0x80, 0x8c] * SIZE\nfooter = [0xdf, 0x8c]\nb = bytes(header) + bytes(middle) + bytes(footer)\nd = b.decode('utf-8')\nidna.encode(d.lower(), strict=True, std3_rules=True)\nOne high-profile library affected is urllib3 where parsing a crafted URL can impose considerable a computational load.\nimport urllib3\nSIZE = 16384\nheader = [0x32, 0xdf, 0x8d]\nmiddle = [0xe2, 0x80, 0x8c] * SIZE\nfooter = [0xdf, 0x8c]\nb = bytes(header) + bytes(middle) + bytes(footer)\nd = b.decode('utf-8')\nurllib3.util.url.parse_url(d)\nThis takes approx. 75 seconds with a 16kb input string on my machine, and since the processing logic in idna has quadratic complexity, each doubling of the input size quadruples the running time.\nI've selected 'network' as the attack vector because although this software capable of running locally, there are plenty of cases where this can be invoked remotely.\nImpact\nURL parsing is ubiquitous and relatively small malicious payloads can incur a large computational load. Repeated/concurrent exploitation of this bug in susceptible API endpoints or ingestion mechanisms can reasonably be expected to reduce availability or rack up compute costs.\nOccurrences\ncore.py L149-L167\nThese two loops are executed for every inner loop: https://github.com/kjd/idna/blob/60a0a4cb61ec6834d74306bd8a1fa46daac94c98/idna/core.py#L234-L242\nWe are processing your report and will contact thekjd/idna team within 24 hours.a year ago\nWe were unable to make contact with the kjd/idna team automatically, our community manager will try to reach out to them instead.a year ago\ngvranken\ncommenteda year ago\nResearcher\nDo you have an update you can share on this please? Were you able to contact the maintainer?\ngvranken\ncommenteda year ago\nResearcher\nAre you processing this report? Did you even read it?\nWe have sent a magic link to the kjd/idna team via the email provided in their security policya year ago\nDan McInerney\ncommenteda year ago\nAdmin\nMaintainer contacted. Ultimately, this is a DoS condition in a local library which generally is not considered impactful enough for a CVE, but we'll let the maintainer weigh in with their opinion in the standard 45 day window.\nKim Davies\ncommenteda year ago\nMaintainer\nHard to say whether to classify it as a vulnerability in the idna library itself, it is implementing the standard-specified algorithm faithfully, but I agree there is room for optimization.\nI see two candidate areas for improvement:\nDomain names cannot exceed 254 characters in length, which is checked later in the function, so the length check could be moved to earlier in processing which would eliminate the need to do the number of context evaluations performed for this 16k input.\nMaking some of the evaluation loop more explicit (i.e. computation of Joiner Type \"T\") through precomputation allows dismissal of this string prior to the bulk of the iteration.\nI've implemented #2 here and it seems to greatly improve how this string is handled: https://github.com/kjd/idna/commit/5beb28b9dd77912c0dd656d8b0fdba3eb80222e7\nA kjd/idna maintainerhas acknowledged this reporta year ago\nThe scheduled publication date was automatically extended from 30th Jun 2024  to 7th Jul 2024  due to the maintainers acknowledgement of the reporta year ago\ngvranken\ncommenteda year ago\nResearcher\nThank you @kjd. I have confirmed that your patch drastically reduces the execution time from ~75 sec to a fraction of a second and I cannot find any other slow code paths in idna encode() or decode().\nKim Davies\ncommenteda year ago\nMaintainer\nI plan on applying the patch to the source repository and adding it to the change log. Its been my practice to acknowledge bug reports — do you want to be credited, and if so, how?\nDan McInerneymodified the Severity from High (7.5) to Medium (6.2)a year ago\nDan McInerney\ncommenteda year ago\nAdmin\n@kjd, you can the green \"Resolve\" button at the bottom of this page and select \"Valid\". That will issue a CVE crediting this report and the reporter in the references of the CVE and release the bounty to the reporter.\ngvranken\ncommenteda year ago\nResearcher\nHi @kjd, feel free to credit me, my name is Guido Vranken and my username on Github is guidovranken (different from the GH username I'm using for Huntr since I don't want to use OAuth using my main GH profile).\nKim Davies\ncommenteda year ago\nMaintainer\n@Dan McInerney, there is no Resolve button, only a comment field and a comment button.\nPavlos\ncommenteda year ago\nSorry about that Kim, can you check now please?\nKim Davies\ncommenteda year ago\nMaintainer\nSorry, still nothing other than the ability to add a comment.\nPavlos\ncommenteda year ago\nSent you an email\nThe researcher has received a minor penalty to their credibility for miscalculating the severity: -1\nKim Davies validated this vulnerabilitya year ago\ngvrankenhas been awarded the disclosure bounty\nThe fix bounty is now up for grabs\nThe researcher's credibility has increased: +7\nCVE-2024-3651assigned to this report.a year ago\nKim Davies\ncommenteda year ago\nMaintainer\nThis is an abbreviated reproduction of the above code that exhibits the behaviour.\nimport idna\ns = \"2\\u07cd\" + (\"\\u200c\"*16384) + \"\\u07cc”\nidna.encode(s)\nKim Daviesmarked this as fixedin 3.7with commit1d365ea year ago\nKim Davieshas been awarded the fix bounty\ncore.py#L149-L167 has been validated\nWe have sent a warning to the kjd/idna team to inform them that this report will be published in 48 hours10 months ago\nThis vulnerability has now been published10 months ago\nCVE-2024-3651has now been published10 months ago\nSign in to join this conversation\nCVE\nCVE-2024-3651\n(Published)\nVulnerability Type\nCWE-400: Denial of Service\nSeverity\nMedium (6.2)\nAttack vector\nLocal\nAttack complexity\nLow\nPrivileges required\nNone\nUser interaction\nNone\nScope\nUnchanged\nConfidentiality\nNone\nIntegrity\nNone\nAvailability\nHigh\nOpen in visual CVSS calculator\nRegistry\nPypi\nAffected Version\n3.6\nVisibility\nPublic\nStatus\nFixed\nDisclosure Bounty\n$125\nFix Bounty\n$31.25\nFound by\nFixed by\nSupported by Protect AI and leading the way to MLSecOps and greater AI security.\n© 2024\nPrivacy Policy\nTerms of Service\nCode of Conduct\nCookie Preferences\nContact Us",
                "effective": true,
                "effective_reason": "The advisory provides example code to demonstrate and reproduce the vulnerability."
            }
        ],
        "cwe": [
            {
                "id": "CWE-400",
                "value": "CWE-400 Uncontrolled Resource Consumption"
            }
        ]
    }
}