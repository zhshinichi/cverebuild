{
    "CVE-2024-50347": {
        "published_date": "2024-10-31T17:56:41.503Z",
        "patch_commits": [
            {
                "url": "https://github.com/laravel/reverb/commit/73cc140d76e803b151fc2dd2e4eb3eb784a82ee2",
                "content": "[1.x] Implements API signature verification (#252)\n\n* add signature validation\r\n\r\n* update query string sorting\r\n\r\n* formatting\r\n\r\n* add tests\n\nFilename: src/Protocols/Pusher/Http/Controllers/Controller.php:\n```\n@@ -48,6 +48,7 @@\npublic function verify(RequestInterface $request, Connection $connection, $appId\n \n         $this->setApplication($appId);\n         $this->setChannels();\n+        $this->verifySignature($request);\n     }\n \n     /**\n\n@@ -100,8 +101,9 @@\nprotected function verifySignature(RequestInterface $request): void\n         ]);\n \n         $signature = hash_hmac('sha256', $signature, $this->application->secret());\n+        $authSignature = $this->query['auth_signature'] ?? '';\n \n-        if ($signature !== $this->query['auth_signature']) {\n+        if ($signature !== $authSignature) {\n             throw new HttpException(401, 'Authentication signature invalid.');\n         }\n     }\n```\n\nFilename: tests/Feature/Protocols/Pusher/Reverb/ChannelControllerTest.php:\n```\n@@ -1,6 +1,7 @@\n<?php\n \n use Laravel\\Reverb\\Tests\\ReverbTestCase;\n+use React\\Http\\Message\\ResponseException;\n \n use function React\\Async\\await;\n\n@@ -141,3 +142,9 @@\nexpect($response->getHeader('Content-Length'))->toBe(['40']);\n });\n+\n+it('fails when using an invalid signature', function () {\n+    $response = await($this->request('channels/test-channel-one?info=user_count,subscription_count,cache'));\n+\n+    expect($response->getStatusCode())->toBe(401);\n+})->throws(ResponseException::class, exceptionCode: 401);\n```\n\nFilename: tests/Feature/Protocols/Pusher/Reverb/ChannelUsersControllerTest.php:\n```\n@@ -13,11 +13,11 @@\nit('returns an error when presence channel not provided', function () {\n     subscribe('test-channel');\n     await($this->signedRequest('channels/test-channel/users'));\n-})->throws(ResponseException::class);\n+})->throws(ResponseException::class, exceptionCode: 400);\n \n it('returns an error when unoccupied channel provided', function () {\n     await($this->signedRequest('channels/presence-test-channel/users'));\n-})->throws(ResponseException::class);\n+})->throws(ResponseException::class, exceptionCode: 404);\n \n it('returns the user data', function () {\n     $channel = app(ChannelManager::class)\n\n@@ -53,13 +53,13 @@\nsubscribe('test-channel');\n \n     await($this->signedRequest('channels/test-channel/users'));\n-})->throws(ResponseException::class);\n+})->throws(ResponseException::class, exceptionCode: 400);\n \n it('returns an error when gathering unoccupied channel provided', function () {\n     $this->usingRedis();\n \n     await($this->signedRequest('channels/presence-test-channel/users'));\n-})->throws(ResponseException::class);\n+})->throws(ResponseException::class, exceptionCode: 404);\n \n it('can send the content-length header', function () {\n     $channel = app(ChannelManager::class)\n\n@@ -120,3 +120,9 @@\nexpect($response->getHeader('Content-Length'))->toBe(['38']);\n });\n+\n+it('fails when using an invalid signature', function () {\n+    $response = await($this->request('channels/presence-test-channel/users'));\n+\n+    expect($response->getStatusCode())->toBe(401);\n+})->throws(ResponseException::class, exceptionCode: 401);\n```\n\nFilename: tests/Feature/Protocols/Pusher/Reverb/ChannelsControllerTest.php:\n```\n@@ -2,6 +2,7 @@\nuse Illuminate\\Support\\Arr;\n use Laravel\\Reverb\\Tests\\ReverbTestCase;\n+use React\\Http\\Message\\ResponseException;\n \n use function React\\Async\\await;\n\n@@ -122,3 +123,9 @@\nexpect($response->getHeader('Content-Length'))->toBe(['81']);\n });\n+\n+it('fails when using an invalid signature', function () {\n+    $response = await($this->request('channels?info=user_count'));\n+\n+    expect($response->getStatusCode())->toBe(401);\n+})->throws(ResponseException::class, exceptionCode: 401);\n```\n\nFilename: tests/Feature/Protocols/Pusher/Reverb/ConnectionsControllerTest.php:\n```\n@@ -1,6 +1,7 @@\n<?php\n \n use Laravel\\Reverb\\Tests\\ReverbTestCase;\n+use React\\Http\\Message\\ResponseException;\n \n use function React\\Async\\await;\n\n@@ -71,3 +72,9 @@\nexpect($response->getHeader('Content-Length'))->toBe(['17']);\n });\n+\n+it('fails when using an invalid signature', function () {\n+    $response = await($this->request('connections'));\n+\n+    expect($response->getStatusCode())->toBe(401);\n+})->throws(ResponseException::class, exceptionCode: 401);\n```\n\nFilename: tests/Feature/Protocols/Pusher/Reverb/EventsBatchControllerTest.php:\n```\n@@ -171,3 +171,15 @@\nexpect($response->getHeader('Content-Length'))->toBe(['12']);\n });\n+\n+it('fails when using an invalid signature', function () {\n+    $response = await($this->postRequest('batch_events', ['batch' => [\n+        [\n+            'name' => 'NewEvent',\n+            'channel' => 'test-channel',\n+            'data' => json_encode(['some' => 'data']),\n+        ],\n+    ]]));\n+\n+    expect($response->getStatusCode())->toBe(401);\n+})->throws(ResponseException::class, exceptionCode: 401);\n```\n\nFilename: tests/Feature/Protocols/Pusher/Reverb/EventsControllerTest.php:\n```\n@@ -182,7 +182,7 @@\n'name' => 'NewEvent',\n         'channel' => 'test-channel',\n         'data' => json_encode([str_repeat('a', 10_100)]),\n-    ], appId: '654321'));\n+    ], appId: '654321', key: 'reverb-key-2', secret: 'reverb-secret-2'));\n \n     expect($response->getStatusCode())->toBe(200);\n     expect($response->getBody()->getContents())->toBe('{}');\n\n@@ -207,3 +207,13 @@\nexpect($response->getHeader('Content-Length'))->toBe(['2']);\n });\n+\n+it('fails when using an invalid signature', function () {\n+    $response = await($this->postRequest('events', [\n+        'name' => 'NewEvent',\n+        'channel' => 'test-channel',\n+        'data' => json_encode(['some' => 'data']),\n+    ]));\n+\n+    expect($response->getStatusCode())->toBe(401);\n+})->throws(ResponseException::class, exceptionCode: 401);\n```\n\nFilename: tests/Feature/Protocols/Pusher/Reverb/ServerTest.php:\n```\n@@ -465,7 +465,7 @@\n'name' => 'NewEvent',\n         'channel' => 'test-channel',\n         'data' => json_encode([str_repeat('a', 150_000)]),\n-    ], appId: '654321'));\n+    ], appId: '654321', key: 'reverb-key-2', secret: 'reverb-secret-2'));\n \n     expect($response->getStatusCode())->toBe(200);\n     expect($response->getBody()->getContents())->toBe('{}');\n```\n\nFilename: tests/Feature/Protocols/Pusher/Reverb/UsersTerminateControllerTest.php:\n```\n@@ -9,7 +9,7 @@\nit('returns an error when connection cannot be found', function () {\n     await($this->signedPostRequest('channels/users/not-a-user/terminate_connections'));\n-})->throws(ResponseException::class);\n+})->throws(ResponseException::class, exceptionCode: 404);\n \n it('unsubscribes from all channels and terminates a user', function () {\n     $connection = connect();\n\n@@ -54,3 +54,9 @@\nexpect(collect(channels()->all())->get('test-channel-two')->connections())->toHaveCount(1);\n     expect($response->getHeader('Content-Length'))->toBe(['2']);\n });\n+\n+it('fails when using an invalid signature', function () {\n+    $response = await($this->postRequest('users/987/terminate_connections'));\n+\n+    expect($response->getStatusCode())->toBe(401);\n+})->throws(ResponseException::class, exceptionCode: 401);\n```\n\nFilename: tests/ReverbTestCase.php:\n```\n@@ -160,16 +160,29 @@\npublic function requestWithoutAppId(string $path, string $method = 'GET', mixed\n     /**\n      * Send a signed request to the server.\n      */\n-    public function signedRequest(string $path, string $method = 'GET', mixed $data = '', string $host = '0.0.0.0', string $port = '8080', string $appId = '123456'): PromiseInterface\n+    public function signedRequest(string $path, string $method = 'GET', mixed $data = '', string $host = '0.0.0.0', string $port = '8080', string $appId = '123456', string $key = 'reverb-key', string $secret = 'reverb-secret'): PromiseInterface\n     {\n-        $hash = md5(json_encode($data));\n         $timestamp = time();\n-        $query = \"auth_key=reverb-key&auth_timestamp={$timestamp}&auth_version=1.0&body_md5={$hash}\";\n-        $string = \"POST\\n/apps/{$appId}/{$path}\\n$query\";\n-        $signature = hash_hmac('sha256', $string, 'reverb-secret');\n-        $path = Str::contains($path, '?') ? \"{$path}&{$query}\" : \"{$path}?{$query}\";\n \n-        return $this->request(\"{$path}&auth_signature={$signature}\", $method, $data, $host, $port, $appId);\n+        $query = Str::contains($path, '?') ? Str::after($path, '?') : '';\n+        $auth = \"auth_key={$key}&auth_timestamp={$timestamp}&auth_version=1.0\";\n+        $query = $query ? \"{$query}&{$auth}\" : $auth;\n+\n+        $query = explode('&', $query);\n+        sort($query);\n+        $query = implode('&', $query);\n+        \n+        $path = Str::before($path, '?');\n+\n+        if ($data) {\n+            $hash = md5(json_encode($data));\n+            $query .= \"&body_md5={$hash}\";\n+        }\n+\n+        $string = \"{$method}\\n/apps/{$appId}/{$path}\\n$query\";\n+        $signature = hash_hmac('sha256', $string, $secret);\n+\n+        return $this->request(\"{$path}?{$query}&auth_signature={$signature}\", $method, $data, $host, $port, $appId);\n     }\n \n     /**\n\n@@ -183,30 +196,8 @@\npublic function postRequest(string $path, ?array $data = [], string $host = '0.0\n     /**\n      * Send a signed POST request to the server.\n      */\n-    public function signedPostRequest(string $path, ?array $data = [], string $host = '0.0.0.0', string $port = '8080', string $appId = '123456'): PromiseInterface\n+    public function signedPostRequest(string $path, ?array $data = [], string $host = '0.0.0.0', string $port = '8080', string $appId = '123456', $key = 'reverb-key', $secret = 'reverb-secret'): PromiseInterface\n     {\n-        $hash = md5(json_encode($data));\n-        $timestamp = time();\n-        $query = \"auth_key=reverb-key&auth_timestamp={$timestamp}&auth_version=1.0&body_md5={$hash}\";\n-        $string = \"POST\\n/apps/{$appId}/{$path}\\n$query\";\n-        $signature = hash_hmac('sha256', $string, 'reverb-secret');\n-\n-        return $this->postRequest(\"{$path}?{$query}&auth_signature={$signature}\", $data, $host, $port, $appId);\n-    }\n-\n-    /**\n-     * Send a signed GET request to the server.\n-     */\n-    public function getWithSignature(string $path, array $data = [], string $host = '0.0.0.0', string $port = '8080', string $appId = '123456'): PromiseInterface\n-    {\n-        $hash = md5(json_encode($data));\n-        $timestamp = time();\n-        $query = \"auth_key=reverb-key&auth_timestamp={$timestamp}&auth_version=1.0&body_md5={$hash}\";\n-        $string = \"POST\\n/apps/{$appId}/{$path}\\n$query\";\n-        $signature = hash_hmac('sha256', $string, 'reverb-secret');\n-\n-        $path = Str::contains($path, '?') ? \"{$path}&{$query}\" : \"{$path}?{$query}\";\n-\n-        return $this->request(\"{$path}&auth_signature={$signature}\", 'GET', '', $host, $port, $appId);\n+        return $this->signedRequest($path, 'POST', $data, $host, $port, $appId, $key, $secret);\n     }\n }\n```"
            }
        ],
        "sw_version": "v1.3.1",
        "sw_version_wget": "https://github.com/laravel/reverb/archive/refs/tags/v1.3.1.zip",
        "description": "Laravel Reverb provides a real-time WebSocket communication backend for Laravel applications. Prior to 1.4.0, there is an issue where verification signatures for requests sent to Reverb's Pusher-compatible API were not being verified. This API is used in scenarios such as broadcasting a message from a backend service or for obtaining statistical information (such as number of connections) about a given channel. This issue only affects the Pusher-compatible API endpoints and not the WebSocket connections themselves. In order to exploit this vulnerability, the application ID which, should never be exposed, would need to be known by an attacker. This vulnerability is fixed in 1.4.0.",
        "sec_adv": [
            {
                "url": "https://github.com/laravel/reverb/security/advisories/GHSA-pfrr-xvrf-pxjx",
                "content": "Skip to content\nNavigation Menu\nProduct\nSolutions\nResources\nOpen Source\nEnterprise\nPricing\nSearch or jump to...\nSign in\nSign up\nAppearance settings\nDismiss alert\nlaravel\n/\nreverb\nPublic\nNotifications You must be signed in to change notification settings\nFork 122\nStar 1.3k\nCode\nIssues\n5\nPull requests\n1\nActions\nSecurity\n1\nInsights\nAdditional navigation options\nMissing API Signature Verification\nLow joedixon published GHSA-pfrr-xvrf-pxjx on Oct 31, 2024Oct 31, 2024\nPackage\ncomposer laravel/reverb\n(\nComposer\n)\nAffected versions\n< 1.4.0\nPatched versions\n1.4.0\nDescription\nImpact\nA community member disclosed an issue where verification signatures for requests sent to Reverb's Pusher-compatible API were not being verified. This API is used in scenarios such as broadcasting a message from a backend service or for obtaining statistical information (such as number of connections) about a given channel.\nThe verification signature is a hash comprised of different parts of the request signed by the app's secret key. The signature is sent as part of the request and should be regenerated by Reverb. Only when both the signature in the request and the one generated by Reverb match should the request be allowed. This helps to verify the request came from a known source.\nNote\nThis issue only affects the Pusher-compatible API endpoints and not the WebSocket connections themselves. In order to exploit this vulnerability, the application ID which, should never be exposed, would need to be known by an attacker.\nThe following endpoints were affected:\nPOST /events\nPOST /events_batch\nGET /connections\nGET /channels\nGET /channel\nGET /channel_users\nPOST /users_terminate\nPatches\nThe issue was resolved by #252 and the patch released in v1.4.0.\nReferences\nGenerating Pusher authentication signatures\nSeverity\nLow\nCVE ID\nCVE-2024-50347\nWeaknesses\nNo CWEs\nCredits\nRobertBoes\nReporter\nFooter\nÂ© 2025 GitHub, Inc.\nFooter navigation\nTerms\nPrivacy\nSecurity\nStatus\nDocs\nContact\nManage cookies\nDo not share my personal information",
                "effective": false,
                "effective_reason": "The advisory describes the vulnerability but doesn't give explicit technical details or proof-of-concept instructions for reproducing the issue."
            }
        ],
        "cwe": [
            {
                "id": "CWE-347",
                "value": "CWE-347: Improper Verification of Cryptographic Signature"
            }
        ]
    }
}