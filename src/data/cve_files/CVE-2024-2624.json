{
    "CVE-2024-2624": {
        "published_date": "2024-06-06T18:11:44.254Z",
        "patch_commits": [
            {
                "url": "https://github.com/parisneo/lollms-webui/commit/aeba79f3ea934331b8ecd625a58bae6e4f7e7d3f",
                "content": "sync\n\nFilename: lollms_core:\n```\n@@ -1 +1 @@\n-Subproject commit 517ffa0c58c8f5a5d7884c3336a5c2797da07f99\n+Subproject commit 443bcb322d358c531ca7fcb5a74fff34d8f1734f\n```"
            }
        ],
        "sw_version": "v9.3",
        "sw_version_wget": "https://github.com/parisneo/lollms-webui/archive/refs/tags/v9.3.zip",
        "description": "A path traversal and arbitrary file upload vulnerability exists in the parisneo/lollms-webui application, specifically within the `@router.get(\"/switch_personal_path\")` endpoint in `./lollms-webui/lollms_core/lollms/server/endpoints/lollms_user.py`. The vulnerability arises due to insufficient sanitization of user-supplied input for the `path` parameter, allowing an attacker to specify arbitrary file system paths. This flaw enables direct arbitrary file uploads, leakage of `personal_data`, and overwriting of configurations in `lollms-webui`->`configs` by exploiting the same named directory in `personal_data`. The issue affects the latest version of the application and is fixed in version 9.4. Successful exploitation could lead to sensitive information disclosure, unauthorized file uploads, and potentially remote code execution by overwriting critical configuration files.",
        "sec_adv": [
            {
                "url": "https://huntr.com/bounties/39e17897-0e92-4473-91c7-f728322191aa",
                "content": "Bounties\nPartners\nCommunity\nInfo\nSUBMIT REPORT\nPath traversal in '/switch_personal_path' cause sensitive configs leakage && Arbitrary Upload & Overwrites in parisneo/lollms-webui\nValid\nReported on Mar 16th 2024\nDescription\nIn ./lollms-webui/lollms_core/lollms/server/endpoints/lollms_user.py @router.get(\"/switch_personal_path\"), personal path can be change to arbitrary location on the file system via relative or absolute paths, this firstly causes Arbitary file uploads. Nevertheless, due the server it don't remove the cache data in the previous personal_data when switching to another, it allow us to leak all files in personal_data .\nProof of Concept\n/lollms-webui/lollms_core/lollms/server/endpoints/lollms_user.py: @router.get(\"/switch_personal_path\")\nclass PersonalPathParameters(BaseModel):\n    path:str\n@router.get(\"/switch_personal_path\")\ndef switch_personal_path(data:PersonalPathParameters):\n    path = data.path\n    global_paths_cfg = Path(\"./global_paths_cfg.yaml\")\n    if global_paths_cfg.exists():\n        try:\n            cfg = BaseConfig()\n            cfg.load_config(global_paths_cfg)\n            cfg.lollms_personal_path = path\n            cfg.save_config(global_paths_cfg)\n            return {\"status\": True}      \n        except Exception as ex:\n            print(ex)\n            return {\"status\": False, 'error':f\"Couldn't switch path: {ex}\"}    \n        \nThe switch_personal_path function is an API endpoint, designed to update the lollms_personal_path entry within a global_paths_cfg.yaml file. When called, it receives PersonalPathParameters data, specifically a new path. It checks if the global configuration file exists, then attempts to load, modify, and save the configuration with the new path. Upon successful update, it returns a positive status; if an error occurs, such as an issue with file access or parsing, it captures the exception, prints it, and returns a negative status with the error detail.\nHowever, this function failed to sanitize path = data.path when cfg.lollms_personal_path = path, it allow us to enter a relative path pointing to arbitrary location on the file system.\nTo exploit this vulnerability, you may use this poc.py (json=is implemented since class PersonalPathParameters(BaseModel): path:str settings,paramordata won't work and will cause 422)\ndef exploit(\n    base_url: str,\n    path: str,\n):\n    \n    import requests\n    req = requests.get(f'{base_url}/switch_personal_path',\n                 json={'path': path},\n                 )\n    \n    if req.status_code == 200:\n        print(req.text)\nLeakage?\nHowever, the exploitation of this vulnerability do not stops here. due to the fact that don't remove the cache data in the previous personal_data when switching to other one. (e.g. if we switch from a to b, personal_data in a will not be removed), we can construct a vector allow us to access beyond the public directories such as uploads; By firstly setting uploads as our lollms_personal_path, the server will transfer or copy the vict personal_data file into the new one, in this case re-creating personal_data under upload\nAfter that, since rebinding lollms_personal_path will not empty the dest folder, we can rebind lollms_personal_path to the father directory of uploads, thus uploads will contain all the data of lollms_personal_path, causing leakage\nFurthermore exploitations?\nDue to the fact that we just mentioned, the server neither remove the cache data in the previous personal_data or empty the directory when we are when switching to other one, it means that same named directory can be binds in different configs which have different security level and functions. For instance this vulnerability will also allow us to overwrite contents in lollms-webui->configs via personal_data->configs(Since same named directory exist in personal_data, visiting personal_data->configs = lollms-webui->configs). Additionally, configs in lollms-webui->configs might be vulnerable to Path traversal leading RCE since their keys are only being checked when inputting, not implementing. Thus by externally editing lollms-webui->configs, same vulnerabilities that would leads to RCE can also being exploited since we are editing the configs via a completely different endpoint.\nImpact\n1: Direct Arbitrary Uploads\n2: Leakage personal_data\n3: Overwriting lollms-webui->configs (Since same named directory exist in personal_data, visiting personal_data->configs = lollms-webui->configs)\nWe are processing your report and will contact theparisneo/lollms-webui team within 24 hours.a year ago\nhuntr-helpermodified the Severity from Critical (10) to Critical (9.8)a year ago\nWe have contacted a member of theparisneo/lollms-webui team and are waiting to hear backa year ago\nDan McInerneymodified the Severity from Critical (9.8) to Critical (9.4)a year ago\nThe researcher has received a minor penalty to their credibility for miscalculating the severity: -1\nSaifeddine ALOUI validated this vulnerabilitya year ago\nTo fix this I'm going to forbid access to changing the personal folder from the UI completely because this can be locally setup in the settings file and close this problem.\nretr0reghas been awarded the disclosure bounty\nThe fix bounty is now up for grabs\nThe researcher's credibility has increased: +7\nCVE-2024-2624assigned to this report.a year ago\nSaifeddine ALOUImarked this as fixedin 9.4with commitaeba79a year ago\nSaifeddine ALOUIhas been awarded the fix bounty\nWe have sent a warning to the parisneo/lollms-webui team to inform them that this report will be published in 48 hoursa year ago\nThis vulnerability has now been publisheda year ago\nCVE-2024-2624has now been publisheda year ago\nSign in to join this conversation\nCVE\nCVE-2024-2624\n(Published)\nVulnerability Type\nCWE-29: Path Traversal: '\\..\\filename'\nSeverity\nCritical (9.4)\nAttack vector\nNetwork\nAttack complexity\nLow\nPrivileges required\nNone\nUser interaction\nNone\nScope\nUnchanged\nConfidentiality\nLow\nIntegrity\nHigh\nAvailability\nHigh\nOpen in visual CVSS calculator\nRegistry\nOther\nAffected Version\nLatest\nVisibility\nPublic\nStatus\nFixed\nDisclosure Bounty\n$900\nFix Bounty\n$225\nFound by\nRuikai Peng\n@retr0reg\nMIDDLEWEIGHT\nFixed by\nSupported by Protect AI and leading the way to MLSecOps and greater AI security.\nÂ© 2024\nPrivacy Policy\nTerms of Service\nCode of Conduct\nCookie Preferences\nContact Us",
                "effective": true,
                "effective_reason": "The security advisory includes Python code explicitly labeled as a proof of concept for exploiting the described vulnerabilities, offering a practical demonstration."
            }
        ],
        "cwe": [
            {
                "id": "CWE-29",
                "value": "CWE-29 Path Traversal: '\\..\\filename'"
            }
        ]
    }
}