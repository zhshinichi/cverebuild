{
    "CVE-2024-8462": {
        "published_date": "2024-09-05T13:00:05.647Z",
        "patch_commits": [
            {
                "url": "https://github.com/windmill-labs/windmill/commit/acfe7786152f036f2476f93ab5536571514fa9e3",
                "content": "fix: prevent brute force attacks on tokens by slowing unauthorized response\n\nFilename: backend/windmill-api/src/users.rs:\n```\n@@ -8,6 +8,7 @@\n#![allow(non_snake_case)]\n \n+use std::sync::atomic::{AtomicI64, AtomicU64, Ordering};\n use std::sync::Arc;\n \n use crate::db::ApiAuthed;\n\n@@ -145,6 +146,7 @@\npub struct ExpiringAuthCache {\n     pub authed: ApiAuthed,\n     pub expiry: chrono::DateTime<chrono::Utc>,\n }\n+\n pub struct AuthCache {\n     cache: Cache<(String, String), ExpiringAuthCache>,\n     db: DB,\n\n@@ -502,6 +504,32 @@\npub struct Tokened {\n     pub token: String,\n }\n \n+struct BruteForceCounter {\n+    counter: AtomicU64,\n+    last_reset: AtomicI64,\n+}\n+\n+lazy_static! {\n+    static ref BRUTE_FORCE_COUNTER: BruteForceCounter =\n+        BruteForceCounter { last_reset: AtomicI64::new(0), counter: AtomicU64::new(0) };\n+}\n+\n+impl BruteForceCounter {\n+    async fn increment(&self) {\n+        let now = time::OffsetDateTime::now_utc().unix_timestamp();\n+        if self.counter.fetch_add(1, Ordering::Relaxed) > 10000 {\n+            tracing::error!(\n+                \"Brute force attack to find valid token detected, sleeping unauthorized response for 2 seconds\"\n+            );\n+            tokio::time::sleep(std::time::Duration::from_secs(2)).await;\n+        }\n+        if now - self.last_reset.load(Ordering::Relaxed) > 60 {\n+            self.counter.store(0, Ordering::Relaxed);\n+            self.last_reset.store(now, Ordering::Relaxed);\n+        }\n+    }\n+}\n+\n #[async_trait]\n impl<S> FromRequestParts<S> for Tokened\n where\n\n@@ -526,6 +554,7 @@\nwhere\n                 parts.extensions.insert(tokened.clone());\n                 Ok(tokened)\n             } else {\n+                BRUTE_FORCE_COUNTER.increment().await;\n                 Err((StatusCode::UNAUTHORIZED, \"Unauthorized\".to_owned()))\n             }\n         }\n\n@@ -625,6 +654,7 @@\nwhere\n                             && (path_vec.len() < 3\n                                 || (path_vec[4] != \"jobs\" && path_vec[4] != \"jobs_u\"))\n                         {\n+                            BRUTE_FORCE_COUNTER.increment().await;\n                             return Err((\n                                 StatusCode::UNAUTHORIZED,\n                                 format!(\"Unauthorized scoped token: {:?}\", authed.scopes),\n\n@@ -640,6 +670,7 @@\nwhere\n                     }\n                 }\n             }\n+            BRUTE_FORCE_COUNTER.increment().await;\n             Err((StatusCode::UNAUTHORIZED, \"Unauthorized\".to_owned()))\n         }\n     }\n```"
            }
        ],
        "sw_version": "v1.380.0",
        "sw_version_wget": "https://github.com/windmill-labs/windmill/archive/refs/tags/v1.380.0.zip",
        "description": "A vulnerability was found in Windmill 1.380.0. It has been classified as problematic. Affected is an unknown function of the file backend/windmill-api/src/users.rs of the component HTTP Request Handler. The manipulation leads to improper restriction of excessive authentication attempts. It is possible to launch the attack remotely. The complexity of an attack is rather high. The exploitability is told to be difficult. Upgrading to version 1.390.1 is able to address this issue. The patch is identified as acfe7786152f036f2476f93ab5536571514fa9e3. It is recommended to upgrade the affected component.",
        "sec_adv": [],
        "cwe": [
            {
                "id": "CWE-307",
                "value": "CWE-307 Improper Restriction of Excessive Authentication Attempts"
            }
        ]
    }
}