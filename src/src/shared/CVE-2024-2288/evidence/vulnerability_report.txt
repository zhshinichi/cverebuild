
┌────────────────────────────────────────────────────────────────────┐
│                          漏洞基本信息                               │
├────────────────────────────────────────────────────────────────────┤
│ CVE 编号:        CVE-2024-2288                                     │
│ 漏洞名称:        Lollms WebUI CSRF + 存储型 XSS                    │
│ 影响组件:        /upload_avatar 端点                               │
│ 影响版本:        ≤ 9.2                                             │
│ 修复版本:        9.3+                                              │
│ CVSS 评分:       8.8 (高危)                                        │
│ CWE 分类:        CWE-352 (CSRF) + CWE-79 (XSS)                    │
└────────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────────┐
│                         漏洞验证结果                                │
├────────────────────────────────────────────────────────────────────┤
│ ✅ CSRF 漏洞验证:          成功                                    │
│    - 跨域请求被接受                                                │
│    - 无 CSRF Token 验证                                            │
│    - 无 Origin/Referer 检查                                        │
│                                                                    │
│ ✅ 任意文件上传验证:       成功                                    │
│    - 接受 .html 文件                                               │
│    - 无文件类型白名单                                              │
│    - 文件名未随机化                                                │
│                                                                    │
│ ✅ 存储型 XSS 验证:        成功                                    │
│    - <script> 标签未过滤                                           │
│    - JavaScript 代码完整保留                                       │
│    - 文件直接可访问并执行                                          │
└────────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────────┐
│                         攻击影响分析                                │
├────────────────────────────────────────────────────────────────────┤
│ 1. Session 劫持                                                    │
│    └─> 攻击者可窃取受害者 Cookie,接管账户                          │
│                                                                    │
│ 2. 权限提升                                                        │
│    └─> 以受害者身份执行任意操作                                    │
│                                                                    │
│ 3. 数据窃取                                                        │
│    └─> 访问受害者的私密数据和设置                                  │
│                                                                    │
│ 4. 蠕虫传播                                                        │
│    └─> XSS 可自我复制,感染更多用户                                │
│                                                                    │
│ 5. 钓鱼攻击                                                        │
│    └─> 在受信任域名上显示虚假登录页                                │
└────────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────────┐
│                         修复建议                                    │
├────────────────────────────────────────────────────────────────────┤
│ 1. 添加 CSRF Token 验证                                            │
│    - 生成随机 Token 并验证                                         │
│    - 使用 SameSite Cookie 属性                                     │
│                                                                    │
│ 2. 验证 Origin/Referer 头                                          │
│    - 拒绝跨域请求                                                  │
│    - 白名单允许的来源                                              │
│                                                                    │
│ 3. 文件类型白名单                                                  │
│    - 只允许图片文件 (MIME type 检查)                               │
│    - 验证文件魔术字节                                              │
│                                                                    │
│ 4. 文件名随机化                                                    │
│    - 使用 UUID 生成文件名                                          │
│    - 移除原始扩展名                                                │
│                                                                    │
│ 5. Content Security Policy                                        │
│    - 设置严格的 CSP 头                                             │
│    - 禁止内联脚本执行                                              │
│                                                                    │
│ 6. 独立文件域名                                                    │
│    - 使用 CDN 或子域名存储上传文件                                 │
│    - 隔离用户内容与应用代码                                        │
└────────────────────────────────────────────────────────────────────┘

✅ 漏洞复现状态: 成功
📅 验证时间: 2025-11-19 09:16:43
🔬 验证方法: HTTP 请求/响应分析 + Payload 验证
